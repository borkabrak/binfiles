/* ---------------------------------------------------------------------------------
   file-start: js/jquery/jquery.lj.calendar.js 
*/

/* ---------------------------------------------------------------------------------
   file-start: js/jquery/jquery.lj.inlineCalendar.js 
*/

/*!
 * LiveJournal Inline calendar
 *
 * Copyright 2011, dmitry.petrov@sup.com
 *
 * http://docs.jquery.com/UI
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.widget.js
 *
 * @overview Inline calendar widget.
 *
 * Widget can be attached to any existant markup.
 *
 * Date wildcards used:
 *  - %D - day ( 01 - 31 )
 *  - %M - month ( 01 - 02 )
 *  - %Y - year ( yyyy, e.g. 2002 )
 *  - %s - unix timestamp in ms
 *
 * Options:
 *  - dayRef: Format of the url that will be attached to each day in the calendar.
 *  - allRefs: Wether to attach links to days in the calendar.
 *    and override currentDate on success.
 *    Could be: true/false/Object {from: Date, to: Date} (all fields are not required)
 *  - activeFrom: Days before this will be inactive in calendar.
 *  - actoveUntil: Days after this willbe inactive incalendar.
 *  - startMonth: Widget will not allow to switch calendar pane to the month before this.
 *  - endMonth: Widget will not allow to switch calendar pane to the month after this.
 *  - startAtSunday: Wether to count sunday as the start of the week.
 *  - events: Object, containing events to show in the calendar. They will be rendered as links. Structure of the object:
 *    { "yyyy": { "mm1" : [ d1, d2, d3, d4 ], "mm2": [ d5, d6, d7 ] } }
 *
 *  Events:
 *  - daySelected: Event is triggered when user selects a day in the calendar. The second parameter passed to the
 *  function is a Date object.
 *  - dateChange Event is triggered when user click on next or prev month/year button.
 *  - currentDateChange: Events is triggered when a new date is set in calendar as current.
 *
 *  Consistent options ( setting these options is guaranteed to work correctly ):
 *  - currentDate, date - Set/get current date.
 *  - activeFrom, date - Set/get earliest active date.
 *  - activeUntil, date - Set/get last active date.
 *  - title, title - set calendar title.
 *  - events, obj - override current events object
 *
 *  @TODO: move all service functions to the widget object and merge it with the view.
 *
 */

(function( $, window ) {

	var defaultOptions = {
		dayRef: '/%Y/%M/%D',
		monthRef: '', //the same, but for the months and year. Calendar will render link, if options are set
		yearRef: '',
		allRefs: false,
		currentDate: new Date(),
		//allow user to select dates in this range
		activeUntil: null,
		activeFrom: null,
		//allow user to switch months between these dates
		startMonth: new Date( 1900, 0, 1 ),
		endMonth: new Date( 2050, 0, 1 ),
		startAtSunday: !(LJ.ml('date.format.offset') !== '0') || false,
		dateFormat: "%Y-%M-%D",
		defaultTitle: "Calendar",
		longMonth: false,

		events: null, //object with events to show in the calendar
		displayedMonth: null, //month displayed on the calendar. If not specified at
								//startup currentDate is used instead.
		dateChange: null,

		selectors: {
			table: 'table',
			title: 'h5',
			tbody: 'tbody',

			month: '.cal-nav-month',
			year:  '.cal-nav-year',
			monthSelect: '.cal-nav-month-select',
			yearSelect:  '.cal-nav-year-select',

			prevMonth: '.cal-nav-month .cal-nav-prev',
			nextMonth: '.cal-nav-month .cal-nav-next',
			prevYear:  '.cal-nav-year .cal-nav-prev',
			nextYear:  '.cal-nav-year .cal-nav-next',

			monthLabel: '.cal-nav-month .cal-month',
			yearLabel: '.cal-nav-year .cal-year'
		},

		classNames: {
			container: '',
			inactive : 'other',
			future : 'other',
			current  : 'current',
			weekend: 'weekend',
			nextDisabled : 'cal-nav-next-dis',
			prevDisabled : 'cal-nav-prev-dis',
			cellHover : 'hover',
			longMonth: 'sidebar-cal-longmonth'
		},

		//now, all lang variables are collected from Site.ml_text and should not be modified
		mlPrefix: {
			monthNamesShort: ['monthNames', 'date.month.{name}.short'],
			monthNamesLong: ['monthNames', 'date.month.{name}.long'],
			dayNamesShort: ['dayNames', 'date.day.{name}.short']
		},

		ml: {
			monthNames: [ "january", "february", "march", "april", "may", "june", "july",
							 "august", "september", "october", "november", "december"],
			dayNames: ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'],
			caption: "Calendar"
		}
	};

	function getDateNumber( d, dropDays ) {
		dropDays = dropDays || false;
		var day = d.getDate().toString();
		if( day.length === 1 ) { day = "0" + day; }
		if( dropDays ) {
			day = "";
		}

		var month = d.getMonth().toString();
		if( month.length === 1 ) { month = "0" + month; }

		return parseInt( d.getFullYear().toString() + month + day, 10);
	}

	function insideTimeRange( range, iDate ) {
		return getDateNumber( iDate, true ) >= getDateNumber( range[0], true ) &&
				getDateNumber( iDate, true ) <= getDateNumber( range[1], true );
	}

	function View(nodes, styles, o)
	{
		this.initialize = function (date) {
			this.tbody = this.catchTableStructure(date);
		};

		this.modelChanged = function (monthDate, events, switcherStates)
		{
			var monthml = o.longMonth? o.ml.monthNamesLong : o.ml.monthNamesShort;
			//we have a 30% speedup when we temporary remove tbody from dom
			this.tbody.detach();
			this.fillDates(monthDate, events);

			for (var sws in switcherStates) {
				nodes[sws][ (!switcherStates[sws]) ? 'addClass' : 'removeClass']( this.disabledStyle(sws) );
			}

			var monthText = o.monthRef
					? $( '<a>', {
						href: LJ.Util.Date.format( monthDate, o.monthRef ),
						text: monthml[ monthDate.getMonth() ] + (o.monthWithYear ?  (' ' + monthDate.getFullYear()) : '')
					} )
					: monthml[ monthDate.getMonth() ];

			var yearText = o.yearRef
					? $( '<a>', { href: LJ.Util.Date.format( monthDate, o.yearRef ), text: monthDate.getFullYear() } )
					: monthDate.getFullYear();

			nodes.monthLabel.empty().append( monthText );
			nodes.yearLabel.empty().append( yearText );

			this.tbody.appendTo( nodes.table );
		};

		this.catchTableStructure = function(date) {
			var tbody = nodes.tbody[0];
			nodes.daysCells = [];
			nodes.daysSpans = [];

			var row, rowsCount = tbody.rows.length, cell, cellsCount;

			var toAdd = 6 - rowsCount;

			var rowStr = '<tr>';
			for( var i = 0; i < 7; ++i ) { rowStr += '<td><span></span></td>'; }
			rowStr += '</tr>';

			while( toAdd-- > 0 ) {
				//add missing rows if server has rendered not enough markup
				$( rowStr ).hide().appendTo( nodes.tbody );
			}
			rowsCount = 6;
			nodes.lastRow = jQuery( tbody.rows[ tbody.rows.length - 1 ] );
			date = new Date(date);

			for( row = 0; row < rowsCount; ++row ) {
				for( cell = 0, cellsCount = tbody.rows[ row ].cells.length; cell < cellsCount; ++cell ) {
					// take into account span inside td
					var node = jQuery( tbody.rows[ row ].cells[ cell ] ),
						children = node.children(),
						day = children.text().trim();

					if(day) {
						date.setDate(day);
						node.data('isActive', true);
						node.data('day', date);
					}

					nodes.daysCells.push(node);
					nodes.daysSpans.push(children);
				}
			}

			return jQuery( tbody );
		};

		this.fillDates = function (monthDate, events)
		{
			function hasEvents( date ) {
				var year = date.getFullYear(),
					month = date.getMonth(),
					day = date.getDate();

				return( events && events[ year ] && events[ year ][ month ] && events[ year ][ month ][ day ] );
			}

			var d = new Date( monthDate );
			d.setDate( 1 );

			var offset;
			if( o.startAtSunday ) {
				offset = d.getDay();
			} else {
				offset = ( d.getDay() === 0 ? 6 : d.getDay()  - 1 );
			}
			d.setDate( 1 - offset );

			for( var i = 0, l = nodes.daysCells.length; i < l; ++i ) {
				var cell = nodes.daysCells[ i ],
					span = nodes.daysSpans[ i ];

				this.formDayString( d, cell, span, hasEvents( d ), this.isActiveDate( d, monthDate ) );

				d.setDate( d.getDate() + 1 );
			}

			d.setDate( d.getDate() - 1 ); //get the date from the last cell
			//we do not use show and hide methods, because show method sets display: block;
			if( d.getDate() < 7 ) {
				nodes.lastRow.css('display', '');
			} else {
				nodes.lastRow.css('display', 'none');
			}
		};

		this.isActiveDate = function( date, currentMonth ) {
			var isActive = true;

			isActive = ( currentMonth.getFullYear() === date.getFullYear() && currentMonth.getMonth() === date.getMonth() );

			if( isActive && ( o.activeFrom || o.activeUntil ) ) {
				isActive = ( o.activeFrom && getDateNumber( o.activeFrom ) <= getDateNumber( date ) ) ||
					( o.activeUntil && getDateNumber( o.activeUntil ) >= getDateNumber( date ) );
			}

			return isActive;
		};

		this.formDayString = function( d, cell, span, hasEvents, isActive )
		{
			d = new Date( d );
			var oldDay = cell.data( 'day' ),
				oldHasEvents = cell.data( 'hasEvents' ),
				oldIsActive = cell.data( 'isActive' );

			var isCurrentDay = ( getDateNumber( d ) === getDateNumber( o.currentDate ) );

			cell.data( 'day', d );
			cell.data( 'isActive', isActive );
			cell.data( 'hasEvents', hasEvents );

			cell[isCurrentDay ? 'addClass' : 'removeClass']( styles.current );
			cell.removeClass( styles.cellHover );

			if( !isActive ) {
				cell.addClass( styles.inactive );
				span.html(d.getDate());
			} else if( hasEvents || o.allRefs ) {

				var _tmpAllRefs = true;
				if (o.allRefs && typeof o.allRefs === 'object') {
					if (o.allRefs.from && d < o.allRefs.from) {
						_tmpAllRefs = false;
					}

					if (o.allRefs.to && d > o.allRefs.to) {
						_tmpAllRefs = false;
					}
				}

				if (_tmpAllRefs) {
					cell.removeClass( styles.inactive );
					span.html( $( '<a />', {
						html: d.getDate(),
						href: LJ.Util.Date.format( d, o.dayRef )
					}));
				} else {
					cell.removeClass(styles.inactive);
					span.html(d.getDate());
				}

			} else {
				cell.removeClass( styles.inactive );
				span.html(d.getDate());
			}
		};

		this.disabledStyle = function (sws)
		{
			if(sws === 'prevMonth' || sws === 'prevYear') {
				return styles.prevDisabled;
			} else {
				return styles.nextDisabled;
			}
		};
	}

	var Calendar = {
		options: {}, //all options were move to the default options object

		_create: function() {
			this._preInit();
			this._initialize();
			this._postInit();
		},

		_preInit: function() {
			var def = $[ this.namespace ][ this.widgetName ].getDefaults();
			this.options = jQuery.extend( true, {}, def, this.options );
			this._prepareMLVars();
		},

		_prepareMLVars: function() {
			var self = this,
				expandVar = function(prefix, name) {
					return LJ.ml(prefix.supplant({name: name}));
				},
				prefixData;

			for (var prefix in this.options.mlPrefix) {
				if (this.options.mlPrefix.hasOwnProperty(prefix)) {
					prefixData = this.options.mlPrefix[prefix];
					this.options.ml[prefix] = this.options.ml[prefixData[0]].map(expandVar.bind(null, prefixData[1]));
				}
			}
		},

		// @TODO: need to change the structure of initialization code to remove this method
		_initialize: function() {
			if( !this.options.displayedMonth ) {
				this.options.displayedMonth = new Date( this.options.currentDate );
			}

			this._events = this.options.events;
			this._hideTimer = null;
			this._nodes = this._nodes || { container: this.element, root: this.element };
			this._invalidateTimer = null;

			if (this.element.hasClass(this.options.classNames.longMonth)) {
				this.options.longMonth = true;
			}

			this._bindNodes();

			this.options.startMonth.setDate( 1 );

			this._view = new (this._getView())( this._nodes, this.options.classNames, this.options );
			this._view.initialize(this.options.currentDate);

			if( this._nodes.table.hasClass( "monday" ) ) {
				this._setOption( "startAtSunday", false );
			}

			this._nodes.monthSelect.val(this.options.displayedMonth.getMonth());
			this._nodes.yearSelect.val(this.options.displayedMonth.getFullYear());

			this._bindEvents();
		},

		_postInit: function() {
		},

		_getView: function() {
			return View;
		},

		_bindNodes: function() {
			for( var i in this.options.selectors ) {
				if( !( i in this._nodes ) ) {
					this._nodes[ i ] = this._nodes.container.find( this.options.selectors[ i ] );
				}
			}

			var displayedMonth = LJ.Util.Date.parse(this._nodes.table.attr( "data-date"), this.options.dateFormat)
			if(displayedMonth) {
				this.options.displayedMonth = displayedMonth;
			}
		},

		destroy: function() {
			$.Widget.prototype.destroy.apply(this, arguments);
		},

		_bindEvents: function() {
			var self = this;

			var switcherStates = this._getSwitcherStates( this.options.currentDate ),
				switcherMouseDown = function( item ) {
					return function (ev) {
						ev.preventDefault();
						ev.stopPropagation();
						var switcherStates = self._getSwitcherStates( self.options.currentDate );

						if( switcherStates[item] ) {
							self["_" + item]();
						}
					};
				};

			for (var sws in switcherStates) {
				this._nodes[sws].click( switcherMouseDown(sws) );
			}

			this._nodes.monthSelect.change(function(ev) {
				var d = new Date(self.options.currentDate);
				d.setMonth(this.value);
				self._setOption('currentDate', d);
			});

			this._nodes.yearSelect.change(function(ev) {
				var d = new Date(self.options.currentDate);
				d.setFullYear(this.value);
				self._setOption('currentDate', d);
			});

			this._nodes.tbody
				.delegate( 'td', 'click', function( ev ) {
					self._cellSelectedEvent( $( this ), ev );
				} );
		},

		_switchMonth: function ( go ) {
			var event = jQuery.Event( "dateChange" );
			event.moveForward = go > 0;
			event.switchType = Math.abs( go ) === 12 ? "year" : ( Math.abs( go ) === 1 ? "month" : null );

			event.date = new Date(this.options.displayedMonth.getFullYear(), this.options.displayedMonth.getMonth() + go, 1);

			this._nodes.root.trigger( event );
			this._setOption( 'displayedMonth', event.date );
		},

		_prevMonth: function () { this._switchMonth( -1 ); },
		_nextMonth: function () { this._switchMonth( 1 ); },

		_prevYear : function () { this._switchMonth( -12 ); },
		_nextYear : function () { this._switchMonth( 12 ); },

		_cellSelectedEvent: function( cell, ev ) {
			//if cell is inactive or user controls it's behavior we do not pass event to the link
			if( !cell.data('isActive' ) || this._cellSelected( cell.data( 'day' ) ) ) {
				ev.stopPropagation();
				ev.preventDefault();
			}
		},

		/**
		 * @return {Boolean} returns true if user prevents default behaviour
		 */
		_cellSelected: function( date ) {
			var event = jQuery.Event( "daySelected" );
			this._nodes.root.trigger( event, [ date, LJ.Util.Date.format(date, this.options.dateFormat) ] );

			if( !event.isDefaultPrevented() ) {
				this._setOption( 'currentDate', date );
			}

			return !event.isDefaultPrevented();
		},

		_fitDate: function( date ) {
			date = new Date( date );
			var enabledMonthsRange = [ this.options.startMonth, this.options.endMonth ];

			if( !insideTimeRange( enabledMonthsRange, date ) ) {
				if( getDateNumber( date, true ) < getDateNumber( enabledMonthsRange[ 0 ], true ) ) {
					date = new Date( enabledMonthsRange[ 0 ] );
				} else {
					date = new Date( enabledMonthsRange[ 1 ] );
				}
			}

			return date;
		},

		_getSwitcherStates: function () {
			var monthDate = this.options.displayedMonth,
				yearStart = new Date( monthDate.getFullYear(), 0, 1 ),
				yearEnd = new Date( monthDate.getFullYear(), 11, 1 );

			return {
				prevMonth: this._isActivePrev( monthDate ) !== false,
				prevYear: this._isActivePrev( yearStart ) !== false,
				nextMonth: this._isActiveNext( monthDate ) !== false,
				nextYear: this._isActiveNext( yearEnd ) !== false
			};
		},

		_isActiveNext: function( date ) { return this._isActiveDate( date, 1 ); },
		_isActivePrev: function( date ) { return this._isActiveDate( date, -1 ); },
		_isActiveDate: function( date, dir ) {
			var d = new Date( date );
			d.setMonth( d.getMonth() + dir );
			d.setDate( 1 );

			return insideTimeRange( [ this.options.startMonth, this.options.endMonth ], d );
		},

		_invalidateDisplay: function() {
			var self = this;
			clearTimeout( this._invalidateTimer );

			setTimeout( function() {
				self._view.modelChanged( self.options.displayedMonth, self._events, self._getSwitcherStates() );
			}, 50 );
		},

		_setOption: function( name, value ) {
			switch( name ) {
				case 'currentDate':
					this.options.currentDate = this._fitDate( value );

					var event = jQuery.Event("currentDateChange"),
						date = new Date(this.options.currentDate);
					this._nodes.root.trigger( event, [ date, LJ.Util.Date.format(date, this.options.dateFormat) ] );

					this._setOption( 'displayedMonth', value );
					this._invalidateDisplay();
					break;
				case 'activeFrom':
					this.options.activeFrom = new Date( value );
					this._invalidateDisplay();
					break;
				case 'activeUntil':
					this.options.activeUntil = new Date( value );
					this._invalidateDisplay();
					break;
				case 'title':
					this._title = value;
					this._nodes.title.html( value );
					break;
				case 'events':
					this._events = value;
					this._invalidateDisplay();
					break;
				case 'displayedMonth':
					var newDate = this._fitDate( new Date( value ) ),
						isCurrentMonth = getDateNumber(newDate, true) === getDateNumber(this.options.displayedMonth, true);

					if( !isCurrentMonth ) {
						this.options.displayedMonth = this._fitDate( new Date( value ) );
						this._nodes.monthSelect.val(this.options.displayedMonth.getMonth());
						this._nodes.yearSelect.val(this.options.displayedMonth.getFullYear());
						this._invalidateDisplay();
					}

					break;
				case 'startMonth':
					this.options.startMonth = new Date( value );
					this._invalidateDisplay();
					break;
				case 'endMonth':
					this.options.endMonth = new Date( value );
					this._invalidateDisplay();
					break;
				case 'startAtSunday':
					this.options.startAtSunday = !!value;
					break;
				case 'monthWithYear':
					this.options.monthWithYear = Boolean(value);
					break;
			}
		},

		getElement: function( name ) {
			if( name in this._nodes ) {
				return this._nodes[ name ];
			} else {
				return null;
			}
		}

	};

	$.widget('lj.inlineCalendar', Calendar );

	jQuery.extend( $.lj.inlineCalendar, {

		getDefaults: function() {
			return defaultOptions;
		},

		setDefaults: function ( opts ) {
			if( opts ) {
				jQuery.extend( true, defaultOptions, opts );
			}
		}
	} );

} ( jQuery, window ) );

;

/* file-end: js/jquery/jquery.lj.inlineCalendar.js 
----------------------------------------------------------------------------------*/

!function(a,b){var c,d={showOn:"click",closeControl:!0,showCellHovers:!1,hoverDelay:400,align:"center",events:null,displayedMonth:null,bubbleClass:!1,selectors:{tmpl:".appwidget-calendar .calendar"},classNames:{showCellHovers:"all-days",popup:"b-bubble-calendar"},templates:{calendar:'<div class="popup-inner calendar" style="display: none;"> 						<h5>${caption}</h5> 						<p class="cal-nav"> 							<span class="cal-nav-month"> 								<i class="cal-nav-prev"></i> 								<span class="cal-month"></span> 								<i class="cal-nav-next cal-nav-next-dis"></i> 							</span> 							<span class="cal-nav-year"> 								<i class="cal-nav-prev cal-nav-prev"></i> 								<span class="cal-year"></span> 								<i class="cal-nav-next cal-nav-next-dis"></i> 							</span> 						</p> 						<table cellspacing="0" cellpadding="0"> 							<thead> 								<tr> 									{{each days}} 										<th class="{{if $index % 7 === weekend1 || $index % 7 === weekend2}} weekend{{/if}}{{if $index === 0}} first{{/if}}{{if $index === days.length - 1}} last{{/if}}">${day}</th> 									{{/each}} 								</tr> 							</thead> 							<tbody> 								{{each cells}} 								{{if $index % 7 === 0}}<tr>{{/if}} 								<td{{if $index % 7 === weekend1 || $index % 7 === weekend2}} class="weekend"{{/if}}><span></span></td> 								{{if $index % 7 === 6}}</tr>{{/if}} 								{{/each}} 							</tbody> 						</table></div>'}},e={options:{},_initialize:function(){c||(c=this._buildDOM()),this._nodes={container:c.clone(),root:this.element},a.lj.inlineCalendar.prototype._initialize.apply(this),this._invalidateDisplay()},_bindNodes:function(){a.lj.inlineCalendar.prototype._bindNodes.apply(this);var b=this;this._nodes.container.bubble({classNames:{containerAddClass:this.options.bubbleClass?this.options.classNames.popup:""},target:this._nodes.root,align:this.options.align,closeControl:this.options.closeControl,showOn:this.options.showOn,closeOnContentClick:!1}).bind("bubbleshow",function(){b._trigger("show")}).bind("bubblehide",function(){b._trigger("hide")}).addClass(this.options.classNames.container),this._nodes.input=this.options.input?this.options.input:this._nodes.root.is("[type=text]")?this._nodes.root:a(),this._nodes.input.mask&&this._nodes.input.mask("?dddd-dd-dd",{placeholder:" "}),this._nodes.input.input(this._parseInputValue.bind(this));var c=LJ.Util.Date.parse(this._nodes.input.val(),this.options.dateFormat);c&&(this.options.currentDate=c),this.options.showCellHovers&&this._nodes.table.addClass(this.options.classNames.showCellHovers)},destroy:function(){this._nodes.container.bubble("destroy"),a.lj.inlineCalendar.prototype.destroy.apply(this)},_buildDOM:function(){var a=this.options.ml.dayNamesShort.map(function(a){return{day:a}}),b=0,c=6,d=function(a,b){for(var c=[];a--;)c.push(b);return c};this.options.startAtSunday||(a[7]=a[0],a.shift(),b=5);for(var e=[],f=[],g=this.options.endMonth.getFullYear(),h=this.options.startMonth.getFullYear();g>=h;)e.push({year:g--});f=this.options.ml.monthNamesLong.map(function(a){return{month:a}});var i={caption:this.options.ml.caption,days:a,months:f,years:e,cells:d(42,{}),weekend1:b,weekend2:c};return-1!==this.options.templates.calendar.indexOf(" ")?jQuery.tmpl(this.options.templates.calendar,i):LJ.UI.template(this.options.templates.calendar,i)},_parseInputValue:function(){var a=LJ.Util.Date.parse(this._nodes.input.val(),this.options.dateFormat);a&&this._cellSelected(a)},_cellSelectedEvent:function(c,d){var e=this;a.lj.inlineCalendar.prototype._cellSelectedEvent.call(this,c,d),e.options.showCellHovers&&c.data("isActive")&&e._nodes.container.bubble("hide"),"a"==d.target.tagName.toLowerCase()&&(b.location.href=d.target.href)},_invalidateDisplay:function(){this._view.modelChanged(this.options.displayedMonth,this._events,this._getSwitcherStates())},_setOption:function(b,c){switch(a.lj.inlineCalendar.prototype._setOption.call(this,b,c),b){case"currentDate":this._nodes.input.val(LJ.Util.Date.format(this.options.currentDate,this.options.dateFormat))}}};a.widget("lj.calendar",a.lj.inlineCalendar,e),jQuery.extend(a.lj.calendar,{getDefaults:function(){return jQuery.extend(!0,{},a.lj.inlineCalendar.getDefaults(),d)},setDefaults:function(a){a&&jQuery.extend(d,a)}})}(jQuery,window);;

/* file-end: js/jquery/jquery.lj.calendar.js 
----------------------------------------------------------------------------------*/
/* ---------------------------------------------------------------------------------
   file-start: js/jquery/jquery.mask.js 
*/

!function(a){var b=(a.browser.msie?"paste":"input")+".mask",c=void 0!=window.orientation;a.mask={definitions:{d:"[0-9]",w:"[A-Za-z]","*":"[A-Za-z0-9а-яА-Я]"}},a.fn.extend({unmask:function(){return this.trigger("unmask")},mask:function(d,e){if(!d&&this.length>0){var f=a(this[0]),g=f.data("tests");return a.map(f.data("buffer"),function(a,b){return g[b]?a:null}).join("")}e=a.extend({placeholder:"_",completed:null},e);var h=a.mask.definitions,g=[],i=d.length,j=null,k=d.length;return a.each(d.split(""),function(a,b){"?"==b?(k--,i=a):h[b]?(g.push(new RegExp(h[b])),null==j&&(j=g.length-1)):g.push(null)}),this.each(function(){function f(a){for(;++a<=k&&!g[a];);return a}function l(a){for(;!g[a]&&--a>=0;);for(var b=a;k>b;b++)if(g[b]){t[b]=e.placeholder;var c=f(b);if(!(k>c&&g[b].test(t[c])))break;t[b]=t[c]}q(),s.caret(Math.max(j,a))}function m(a){for(var b=a,c=e.placeholder;k>b;b++)if(g[b]){var d=f(b),h=t[b];if(t[b]=c,!(k>d&&g[d].test(h)))break;c=h}}function n(b){var d=a(this).caret(),e=b.keyCode;return u=16>e||e>16&&32>e||e>32&&41>e,d.start-d.end==0||u&&8!=e&&46!=e||p(d.start,d.end),8==e||46==e||c&&127==e?(l(d.start+(46==e?0:-1)),!1):27==e?(s.val(v),s.caret(0,r()),!1):void 0}function o(b){if(u)return u=!1,8==b.keyCode?!1:null;b=b||window.event;var c=b.charCode||b.keyCode||b.which,d=a(this).caret();if(b.ctrlKey||b.altKey||b.metaKey)return!0;if(c>=32&&125>=c||c>186){var h=f(d.start-1);if(k>h){var i=String.fromCharCode(c);if(g[h].test(i)){m(h),t[h]=i,q();var d=f(h);a(this).caret(d),e.completed&&d==k&&e.completed.call(s)}}}return!1}function p(a,b){for(var c=a;b>c&&k>c;c++)g[c]&&(t[c]=e.placeholder)}function q(){return s.val(t.join("")).val()}function r(a){for(var b=s.val(),c=-1,d=0,f=0;k>d;d++)if(g[d]){for(t[d]=e.placeholder;f++<b.length;){var h=b.charAt(f-1);if(g[d].test(h)){t[d]=h,c=d;break}}if(f>b.length)break}else t[d]==b.charAt(f)&&d!=i&&(f++,c=d);return!a&&i>c+1?(s.val(""),p(0,k)):(a||c+1>=i)&&(q(),a||s.val(s.val().substring(0,c+1))),i?d:j}var s=a(this),t=a.map(d.split(""),function(a){return"?"!=a?h[a]?e.placeholder:a:void 0}),u=!1,v=s.val();s.data("buffer",t).data("tests",g),s.attr("readonly")||s.one("unmask",function(){s.unbind(".mask").removeData("buffer").removeData("tests")}).bind("focus.mask",function(){v=s.val();var a=r();q(),setTimeout(function(){a==d.length?s.caret(0,a):s.caret(a)},0)}).bind("blur.mask",function(){r(),s.val()!=v&&s.change()}).bind("keydown.mask",n).bind("keypress.mask",o).bind(b,function(){setTimeout(function(){s.caret(r(!0))},0)}),r()})}})}(jQuery);;

/* file-end: js/jquery/jquery.mask.js 
----------------------------------------------------------------------------------*/
/* ---------------------------------------------------------------------------------
   file-start: js/controlstrip.js 
*/

/* ---------------------------------------------------------------------------------
   file-start: js/jquery/jquery.calendarEvents.js 
*/

!function(a){var b={};a.fn.calendarEvents=function(c){function d(a,b){return"cache_"+a+b}function e(a,b){var c=this;this.calendar=a,this.events=null,this.options=b,this._ajaxActive=!1,this._currentDate;var e,f=function(b,f){"string"!=typeof a.data("noFetch")&&(clearTimeout(e),c._currentDate=d(b.getFullYear(),b.getMonth()+1),e=setTimeout(function(){c.fetchEvents(b.getFullYear(),b.getMonth()+1,f)},200))};this.calendar.bind("dateChange",function(a){var b=c.calendar[c.options.calendarType]("option","displayedMonth"),d=1===Math.abs(12*(a.date.getFullYear()-b.getFullYear())+(a.date.getMonth()-b.getMonth()));f(a.date,d)}),this.options.fetchOnFirstDisplay&&this.calendar.one("calendarshow",function(){f(new Date,!0)})}var f={calendarType:"calendar",classNames:{idle:"idle"},fetchOnFirstDisplay:!1};return e.prototype={getEvents:function(a,b,c){var d={};return d[+a]={},d[+a][+b-1]=c,d},fetchEvents:function(c,e,f){f=arguments.length>=3?!!f:!0;var g=this,h=(this.calendar[this.options.calendarType]("option","displayedMonth"),this.calendar[this.options.calendarType]("getElement",f?"month":"year")),i=this.options.classNames.idle,j=!0,k=function(){g._ajaxActive||j||h.removeClass(i)};this.calendar[this.options.calendarType]("getElement","year").removeClass(i),this.calendar[this.options.calendarType]("getElement","month").removeClass(i),h.addClass(i),this._ajaxActive=!0,setTimeout(function(){j=!1,k()},500);var l=d(c,e);processResults=function(){l===g._currentDate&&(g.events=b[l],g.calendar[g.options.calendarType]("option","events",g.getEvents(g.events.year,g.events.month,g.events.days)),g._ajaxActive=!1,k())},l in b?processResults(b[l]):a.getJSON(LiveJournal.getAjaxUrl("calendar"),{year:c,month:e},function(a){b[l]=a,processResults(a)})}},this.each(function(){new e(a(this),a.extend({},f,c))})}}(jQuery);;

/* file-end: js/jquery/jquery.calendarEvents.js 
----------------------------------------------------------------------------------*/

/* ---------------------------------------------------------------------------------
   file-start: js/relations/menu.js 
*/

/**
 * Change relations from controlstrip/profile menu block
 */

/* ---------------------------------------------------------------------------------
   file-start: js/lib/angular/1.2.18/angular.min.js 
*/

/*
 AngularJS v1.2.18
 (c) 2010-2014 Google, Inc. http://angularjs.org
 License: MIT
*/
(function(T,V,s){'use strict';function t(b){return function(){var a=arguments[0],c,a="["+(b?b+":":"")+a+"] http://errors.angularjs.org/1.2.18/"+(b?b+"/":"")+a;for(c=1;c<arguments.length;c++)a=a+(1==c?"?":"&")+"p"+(c-1)+"="+encodeURIComponent("function"==typeof arguments[c]?arguments[c].toString().replace(/ \{[\s\S]*$/,""):"undefined"==typeof arguments[c]?"undefined":"string"!=typeof arguments[c]?JSON.stringify(arguments[c]):arguments[c]);return Error(a)}}function db(b){if(null==b||Ea(b))return!1;
var a=b.length;return 1===b.nodeType&&a?!0:C(b)||O(b)||0===a||"number"===typeof a&&0<a&&a-1 in b}function q(b,a,c){var d;if(b)if(Q(b))for(d in b)"prototype"==d||("length"==d||"name"==d||b.hasOwnProperty&&!b.hasOwnProperty(d))||a.call(c,b[d],d);else if(b.forEach&&b.forEach!==q)b.forEach(a,c);else if(db(b))for(d=0;d<b.length;d++)a.call(c,b[d],d);else for(d in b)b.hasOwnProperty(d)&&a.call(c,b[d],d);return b}function Wb(b){var a=[],c;for(c in b)b.hasOwnProperty(c)&&a.push(c);return a.sort()}function Sc(b,
a,c){for(var d=Wb(b),e=0;e<d.length;e++)a.call(c,b[d[e]],d[e]);return d}function Xb(b){return function(a,c){b(c,a)}}function eb(){for(var b=ja.length,a;b;){b--;a=ja[b].charCodeAt(0);if(57==a)return ja[b]="A",ja.join("");if(90==a)ja[b]="0";else return ja[b]=String.fromCharCode(a+1),ja.join("")}ja.unshift("0");return ja.join("")}function Yb(b,a){a?b.$$hashKey=a:delete b.$$hashKey}function J(b){var a=b.$$hashKey;q(arguments,function(a){a!==b&&q(a,function(a,c){b[c]=a})});Yb(b,a);return b}function Z(b){return parseInt(b,
10)}function Zb(b,a){return J(new (J(function(){},{prototype:b})),a)}function y(){}function Fa(b){return b}function $(b){return function(){return b}}function D(b){return"undefined"===typeof b}function B(b){return"undefined"!==typeof b}function U(b){return null!=b&&"object"===typeof b}function C(b){return"string"===typeof b}function yb(b){return"number"===typeof b}function Na(b){return"[object Date]"===wa.call(b)}function Q(b){return"function"===typeof b}function fb(b){return"[object RegExp]"===wa.call(b)}
function Ea(b){return b&&b.document&&b.location&&b.alert&&b.setInterval}function Tc(b){return!(!b||!(b.nodeName||b.prop&&b.attr&&b.find))}function Uc(b,a,c){var d=[];q(b,function(b,g,f){d.push(a.call(c,b,g,f))});return d}function Oa(b,a){if(b.indexOf)return b.indexOf(a);for(var c=0;c<b.length;c++)if(a===b[c])return c;return-1}function Pa(b,a){var c=Oa(b,a);0<=c&&b.splice(c,1);return a}function Ga(b,a,c,d){if(Ea(b)||b&&b.$evalAsync&&b.$watch)throw Qa("cpws");if(a){if(b===a)throw Qa("cpi");c=c||[];
d=d||[];if(U(b)){var e=Oa(c,b);if(-1!==e)return d[e];c.push(b);d.push(a)}if(O(b))for(var g=a.length=0;g<b.length;g++)e=Ga(b[g],null,c,d),U(b[g])&&(c.push(b[g]),d.push(e)),a.push(e);else{var f=a.$$hashKey;q(a,function(b,c){delete a[c]});for(g in b)e=Ga(b[g],null,c,d),U(b[g])&&(c.push(b[g]),d.push(e)),a[g]=e;Yb(a,f)}}else(a=b)&&(O(b)?a=Ga(b,[],c,d):Na(b)?a=new Date(b.getTime()):fb(b)?a=RegExp(b.source):U(b)&&(a=Ga(b,{},c,d)));return a}function ka(b,a){if(O(b)){a=a||[];for(var c=0;c<b.length;c++)a[c]=
b[c]}else if(U(b))for(c in a=a||{},b)!zb.call(b,c)||"$"===c.charAt(0)&&"$"===c.charAt(1)||(a[c]=b[c]);return a||b}function xa(b,a){if(b===a)return!0;if(null===b||null===a)return!1;if(b!==b&&a!==a)return!0;var c=typeof b,d;if(c==typeof a&&"object"==c)if(O(b)){if(!O(a))return!1;if((c=b.length)==a.length){for(d=0;d<c;d++)if(!xa(b[d],a[d]))return!1;return!0}}else{if(Na(b))return Na(a)&&b.getTime()==a.getTime();if(fb(b)&&fb(a))return b.toString()==a.toString();if(b&&b.$evalAsync&&b.$watch||a&&a.$evalAsync&&
a.$watch||Ea(b)||Ea(a)||O(a))return!1;c={};for(d in b)if("$"!==d.charAt(0)&&!Q(b[d])){if(!xa(b[d],a[d]))return!1;c[d]=!0}for(d in a)if(!c.hasOwnProperty(d)&&"$"!==d.charAt(0)&&a[d]!==s&&!Q(a[d]))return!1;return!0}return!1}function $b(){return V.securityPolicy&&V.securityPolicy.isActive||V.querySelector&&!(!V.querySelector("[ng-csp]")&&!V.querySelector("[data-ng-csp]"))}function Ab(b,a){var c=2<arguments.length?ya.call(arguments,2):[];return!Q(a)||a instanceof RegExp?a:c.length?function(){return arguments.length?
a.apply(b,c.concat(ya.call(arguments,0))):a.apply(b,c)}:function(){return arguments.length?a.apply(b,arguments):a.call(b)}}function Vc(b,a){var c=a;"string"===typeof b&&"$"===b.charAt(0)?c=s:Ea(a)?c="$WINDOW":a&&V===a?c="$DOCUMENT":a&&(a.$evalAsync&&a.$watch)&&(c="$SCOPE");return c}function ra(b,a){return"undefined"===typeof b?s:JSON.stringify(b,Vc,a?"  ":null)}function ac(b){return C(b)?JSON.parse(b):b}function Ra(b){"function"===typeof b?b=!0:b&&0!==b.length?(b=L(""+b),b=!("f"==b||"0"==b||"false"==
b||"no"==b||"n"==b||"[]"==b)):b=!1;return b}function ga(b){b=w(b).clone();try{b.empty()}catch(a){}var c=w("<div>").append(b).html();try{return 3===b[0].nodeType?L(c):c.match(/^(<[^>]+>)/)[1].replace(/^<([\w\-]+)/,function(a,b){return"<"+L(b)})}catch(d){return L(c)}}function bc(b){try{return decodeURIComponent(b)}catch(a){}}function cc(b){var a={},c,d;q((b||"").split("&"),function(b){b&&(c=b.split("="),d=bc(c[0]),B(d)&&(b=B(c[1])?bc(c[1]):!0,a[d]?O(a[d])?a[d].push(b):a[d]=[a[d],b]:a[d]=b))});return a}
function Bb(b){var a=[];q(b,function(b,d){O(b)?q(b,function(b){a.push(za(d,!0)+(!0===b?"":"="+za(b,!0)))}):a.push(za(d,!0)+(!0===b?"":"="+za(b,!0)))});return a.length?a.join("&"):""}function gb(b){return za(b,!0).replace(/%26/gi,"&").replace(/%3D/gi,"=").replace(/%2B/gi,"+")}function za(b,a){return encodeURIComponent(b).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,a?"%20":"+")}function Wc(b,a){function c(a){a&&d.push(a)}var d=[b],e,g,f=["ng:app",
"ng-app","x-ng-app","data-ng-app"],k=/\sng[:\-]app(:\s*([\w\d_]+);?)?\s/;q(f,function(a){f[a]=!0;c(V.getElementById(a));a=a.replace(":","\\:");b.querySelectorAll&&(q(b.querySelectorAll("."+a),c),q(b.querySelectorAll("."+a+"\\:"),c),q(b.querySelectorAll("["+a+"]"),c))});q(d,function(a){if(!e){var b=k.exec(" "+a.className+" ");b?(e=a,g=(b[2]||"").replace(/\s+/g,",")):q(a.attributes,function(b){!e&&f[b.name]&&(e=a,g=b.value)})}});e&&a(e,g?[g]:[])}function dc(b,a){var c=function(){b=w(b);if(b.injector()){var c=
b[0]===V?"document":ga(b);throw Qa("btstrpd",c);}a=a||[];a.unshift(["$provide",function(a){a.value("$rootElement",b)}]);a.unshift("ng");c=ec(a);c.invoke(["$rootScope","$rootElement","$compile","$injector","$animate",function(a,b,c,d,e){a.$apply(function(){b.data("$injector",d);c(b)(a)})}]);return c},d=/^NG_DEFER_BOOTSTRAP!/;if(T&&!d.test(T.name))return c();T.name=T.name.replace(d,"");Sa.resumeBootstrap=function(b){q(b,function(b){a.push(b)});c()}}function hb(b,a){a=a||"_";return b.replace(Xc,function(b,
d){return(d?a:"")+b.toLowerCase()})}function Cb(b,a,c){if(!b)throw Qa("areq",a||"?",c||"required");return b}function Ta(b,a,c){c&&O(b)&&(b=b[b.length-1]);Cb(Q(b),a,"not a function, got "+(b&&"object"==typeof b?b.constructor.name||"Object":typeof b));return b}function Aa(b,a){if("hasOwnProperty"===b)throw Qa("badname",a);}function fc(b,a,c){if(!a)return b;a=a.split(".");for(var d,e=b,g=a.length,f=0;f<g;f++)d=a[f],b&&(b=(e=b)[d]);return!c&&Q(b)?Ab(e,b):b}function Db(b){var a=b[0];b=b[b.length-1];if(a===
b)return w(a);var c=[a];do{a=a.nextSibling;if(!a)break;c.push(a)}while(a!==b);return w(c)}function Yc(b){var a=t("$injector"),c=t("ng");b=b.angular||(b.angular={});b.$$minErr=b.$$minErr||t;return b.module||(b.module=function(){var b={};return function(e,g,f){if("hasOwnProperty"===e)throw c("badname","module");g&&b.hasOwnProperty(e)&&(b[e]=null);return b[e]||(b[e]=function(){function b(a,d,e){return function(){c[e||"push"]([a,d,arguments]);return n}}if(!g)throw a("nomod",e);var c=[],d=[],l=b("$injector",
"invoke"),n={_invokeQueue:c,_runBlocks:d,requires:g,name:e,provider:b("$provide","provider"),factory:b("$provide","factory"),service:b("$provide","service"),value:b("$provide","value"),constant:b("$provide","constant","unshift"),animation:b("$animateProvider","register"),filter:b("$filterProvider","register"),controller:b("$controllerProvider","register"),directive:b("$compileProvider","directive"),config:l,run:function(a){d.push(a);return this}};f&&l(f);return n}())}}())}function Zc(b){J(b,{bootstrap:dc,
copy:Ga,extend:J,equals:xa,element:w,forEach:q,injector:ec,noop:y,bind:Ab,toJson:ra,fromJson:ac,identity:Fa,isUndefined:D,isDefined:B,isString:C,isFunction:Q,isObject:U,isNumber:yb,isElement:Tc,isArray:O,version:$c,isDate:Na,lowercase:L,uppercase:Ha,callbacks:{counter:0},$$minErr:t,$$csp:$b});Ua=Yc(T);try{Ua("ngLocale")}catch(a){Ua("ngLocale",[]).provider("$locale",ad)}Ua("ng",["ngLocale"],["$provide",function(a){a.provider({$$sanitizeUri:bd});a.provider("$compile",gc).directive({a:cd,input:hc,textarea:hc,
form:dd,script:ed,select:fd,style:gd,option:hd,ngBind:id,ngBindHtml:jd,ngBindTemplate:kd,ngClass:ld,ngClassEven:md,ngClassOdd:nd,ngCloak:od,ngController:pd,ngForm:qd,ngHide:rd,ngIf:sd,ngInclude:td,ngInit:ud,ngNonBindable:vd,ngPluralize:wd,ngRepeat:xd,ngShow:yd,ngStyle:zd,ngSwitch:Ad,ngSwitchWhen:Bd,ngSwitchDefault:Cd,ngOptions:Dd,ngTransclude:Ed,ngModel:Fd,ngList:Gd,ngChange:Hd,required:ic,ngRequired:ic,ngValue:Id}).directive({ngInclude:Jd}).directive(Eb).directive(jc);a.provider({$anchorScroll:Kd,
$animate:Ld,$browser:Md,$cacheFactory:Nd,$controller:Od,$document:Pd,$exceptionHandler:Qd,$filter:kc,$interpolate:Rd,$interval:Sd,$http:Td,$httpBackend:Ud,$location:Vd,$log:Wd,$parse:Xd,$rootScope:Yd,$q:Zd,$sce:$d,$sceDelegate:ae,$sniffer:be,$templateCache:ce,$timeout:de,$window:ee,$$rAF:fe,$$asyncCallback:ge})}])}function Va(b){return b.replace(he,function(a,b,d,e){return e?d.toUpperCase():d}).replace(ie,"Moz$1")}function Fb(b,a,c,d){function e(b){var e=c&&b?[this.filter(b)]:[this],m=a,h,l,n,p,r,
v;if(!d||null!=b)for(;e.length;)for(h=e.shift(),l=0,n=h.length;l<n;l++)for(p=w(h[l]),m?p.triggerHandler("$destroy"):m=!m,r=0,p=(v=p.children()).length;r<p;r++)e.push(Ba(v[r]));return g.apply(this,arguments)}var g=Ba.fn[b],g=g.$original||g;e.$original=g;Ba.fn[b]=e}function R(b){if(b instanceof R)return b;C(b)&&(b=aa(b));if(!(this instanceof R)){if(C(b)&&"<"!=b.charAt(0))throw Gb("nosel");return new R(b)}if(C(b)){var a=b;b=V;var c;if(c=je.exec(a))b=[b.createElement(c[1])];else{var d=b,e;b=d.createDocumentFragment();
c=[];if(Hb.test(a)){d=b.appendChild(d.createElement("div"));e=(ke.exec(a)||["",""])[1].toLowerCase();e=da[e]||da._default;d.innerHTML="<div>&#160;</div>"+e[1]+a.replace(le,"<$1></$2>")+e[2];d.removeChild(d.firstChild);for(a=e[0];a--;)d=d.lastChild;a=0;for(e=d.childNodes.length;a<e;++a)c.push(d.childNodes[a]);d=b.firstChild;d.textContent=""}else c.push(d.createTextNode(a));b.textContent="";b.innerHTML="";b=c}Ib(this,b);w(V.createDocumentFragment()).append(this)}else Ib(this,b)}function Jb(b){return b.cloneNode(!0)}
function Ia(b){lc(b);var a=0;for(b=b.childNodes||[];a<b.length;a++)Ia(b[a])}function mc(b,a,c,d){if(B(d))throw Gb("offargs");var e=la(b,"events");la(b,"handle")&&(D(a)?q(e,function(a,c){Wa(b,c,a);delete e[c]}):q(a.split(" "),function(a){D(c)?(Wa(b,a,e[a]),delete e[a]):Pa(e[a]||[],c)}))}function lc(b,a){var c=b[ib],d=Xa[c];d&&(a?delete Xa[c].data[a]:(d.handle&&(d.events.$destroy&&d.handle({},"$destroy"),mc(b)),delete Xa[c],b[ib]=s))}function la(b,a,c){var d=b[ib],d=Xa[d||-1];if(B(c))d||(b[ib]=d=++me,
d=Xa[d]={}),d[a]=c;else return d&&d[a]}function nc(b,a,c){var d=la(b,"data"),e=B(c),g=!e&&B(a),f=g&&!U(a);d||f||la(b,"data",d={});if(e)d[a]=c;else if(g){if(f)return d&&d[a];J(d,a)}else return d}function Kb(b,a){return b.getAttribute?-1<(" "+(b.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ").indexOf(" "+a+" "):!1}function jb(b,a){a&&b.setAttribute&&q(a.split(" "),function(a){b.setAttribute("class",aa((" "+(b.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ").replace(" "+aa(a)+" "," ")))})}
function kb(b,a){if(a&&b.setAttribute){var c=(" "+(b.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ");q(a.split(" "),function(a){a=aa(a);-1===c.indexOf(" "+a+" ")&&(c+=a+" ")});b.setAttribute("class",aa(c))}}function Ib(b,a){if(a){a=a.nodeName||!B(a.length)||Ea(a)?[a]:a;for(var c=0;c<a.length;c++)b.push(a[c])}}function oc(b,a){return lb(b,"$"+(a||"ngController")+"Controller")}function lb(b,a,c){b=w(b);9==b[0].nodeType&&(b=b.find("html"));for(a=O(a)?a:[a];b.length;){for(var d=b[0],e=0,g=a.length;e<
g;e++)if((c=b.data(a[e]))!==s)return c;b=w(d.parentNode||11===d.nodeType&&d.host)}}function pc(b){for(var a=0,c=b.childNodes;a<c.length;a++)Ia(c[a]);for(;b.firstChild;)b.removeChild(b.firstChild)}function qc(b,a){var c=mb[a.toLowerCase()];return c&&rc[b.nodeName]&&c}function ne(b,a){var c=function(c,e){c.preventDefault||(c.preventDefault=function(){c.returnValue=!1});c.stopPropagation||(c.stopPropagation=function(){c.cancelBubble=!0});c.target||(c.target=c.srcElement||V);if(D(c.defaultPrevented)){var g=
c.preventDefault;c.preventDefault=function(){c.defaultPrevented=!0;g.call(c)};c.defaultPrevented=!1}c.isDefaultPrevented=function(){return c.defaultPrevented||!1===c.returnValue};var f=ka(a[e||c.type]||[]);q(f,function(a){a.call(b,c)});8>=S?(c.preventDefault=null,c.stopPropagation=null,c.isDefaultPrevented=null):(delete c.preventDefault,delete c.stopPropagation,delete c.isDefaultPrevented)};c.elem=b;return c}function Ja(b){var a=typeof b,c;"object"==a&&null!==b?"function"==typeof(c=b.$$hashKey)?c=
b.$$hashKey():c===s&&(c=b.$$hashKey=eb()):c=b;return a+":"+c}function Ya(b){q(b,this.put,this)}function sc(b){var a,c;"function"==typeof b?(a=b.$inject)||(a=[],b.length&&(c=b.toString().replace(oe,""),c=c.match(pe),q(c[1].split(qe),function(b){b.replace(re,function(b,c,d){a.push(d)})})),b.$inject=a):O(b)?(c=b.length-1,Ta(b[c],"fn"),a=b.slice(0,c)):Ta(b,"fn",!0);return a}function ec(b){function a(a){return function(b,c){if(U(b))q(b,Xb(a));else return a(b,c)}}function c(a,b){Aa(a,"service");if(Q(b)||
O(b))b=n.instantiate(b);if(!b.$get)throw Za("pget",a);return l[a+k]=b}function d(a,b){return c(a,{$get:b})}function e(a){var b=[],c,d,g,k;q(a,function(a){if(!h.get(a)){h.put(a,!0);try{if(C(a))for(c=Ua(a),b=b.concat(e(c.requires)).concat(c._runBlocks),d=c._invokeQueue,g=0,k=d.length;g<k;g++){var f=d[g],m=n.get(f[0]);m[f[1]].apply(m,f[2])}else Q(a)?b.push(n.invoke(a)):O(a)?b.push(n.invoke(a)):Ta(a,"module")}catch(l){throw O(a)&&(a=a[a.length-1]),l.message&&(l.stack&&-1==l.stack.indexOf(l.message))&&
(l=l.message+"\n"+l.stack),Za("modulerr",a,l.stack||l.message||l);}}});return b}function g(a,b){function c(d){if(a.hasOwnProperty(d)){if(a[d]===f)throw Za("cdep",d+" <- "+m.join(" <- "));return a[d]}try{return m.unshift(d),a[d]=f,a[d]=b(d)}catch(e){throw a[d]===f&&delete a[d],e;}finally{m.shift()}}function d(a,b,e){var g=[],k=sc(a),f,m,h;m=0;for(f=k.length;m<f;m++){h=k[m];if("string"!==typeof h)throw Za("itkn",h);g.push(e&&e.hasOwnProperty(h)?e[h]:c(h))}a.$inject||(a=a[f]);return a.apply(b,g)}return{invoke:d,
instantiate:function(a,b){var c=function(){},e;c.prototype=(O(a)?a[a.length-1]:a).prototype;c=new c;e=d(a,c,b);return U(e)||Q(e)?e:c},get:c,annotate:sc,has:function(b){return l.hasOwnProperty(b+k)||a.hasOwnProperty(b)}}}var f={},k="Provider",m=[],h=new Ya,l={$provide:{provider:a(c),factory:a(d),service:a(function(a,b){return d(a,["$injector",function(a){return a.instantiate(b)}])}),value:a(function(a,b){return d(a,$(b))}),constant:a(function(a,b){Aa(a,"constant");l[a]=b;p[a]=b}),decorator:function(a,
b){var c=n.get(a+k),d=c.$get;c.$get=function(){var a=r.invoke(d,c);return r.invoke(b,null,{$delegate:a})}}}},n=l.$injector=g(l,function(){throw Za("unpr",m.join(" <- "));}),p={},r=p.$injector=g(p,function(a){a=n.get(a+k);return r.invoke(a.$get,a)});q(e(b),function(a){r.invoke(a||y)});return r}function Kd(){var b=!0;this.disableAutoScrolling=function(){b=!1};this.$get=["$window","$location","$rootScope",function(a,c,d){function e(a){var b=null;q(a,function(a){b||"a"!==L(a.nodeName)||(b=a)});return b}
function g(){var b=c.hash(),d;b?(d=f.getElementById(b))?d.scrollIntoView():(d=e(f.getElementsByName(b)))?d.scrollIntoView():"top"===b&&a.scrollTo(0,0):a.scrollTo(0,0)}var f=a.document;b&&d.$watch(function(){return c.hash()},function(){d.$evalAsync(g)});return g}]}function ge(){this.$get=["$$rAF","$timeout",function(b,a){return b.supported?function(a){return b(a)}:function(b){return a(b,0,!1)}}]}function se(b,a,c,d){function e(a){try{a.apply(null,ya.call(arguments,1))}finally{if(v--,0===v)for(;I.length;)try{I.pop()()}catch(b){c.error(b)}}}
function g(a,b){(function ba(){q(x,function(a){a()});u=b(ba,a)})()}function f(){z=null;M!=k.url()&&(M=k.url(),q(ha,function(a){a(k.url())}))}var k=this,m=a[0],h=b.location,l=b.history,n=b.setTimeout,p=b.clearTimeout,r={};k.isMock=!1;var v=0,I=[];k.$$completeOutstandingRequest=e;k.$$incOutstandingRequestCount=function(){v++};k.notifyWhenNoOutstandingRequests=function(a){q(x,function(a){a()});0===v?a():I.push(a)};var x=[],u;k.addPollFn=function(a){D(u)&&g(100,n);x.push(a);return a};var M=h.href,F=a.find("base"),
z=null;k.url=function(a,c){h!==b.location&&(h=b.location);l!==b.history&&(l=b.history);if(a){if(M!=a)return M=a,d.history?c?l.replaceState(null,"",a):(l.pushState(null,"",a),F.attr("href",F.attr("href"))):(z=a,c?h.replace(a):h.href=a),k}else return z||h.href.replace(/%27/g,"'")};var ha=[],P=!1;k.onUrlChange=function(a){if(!P){if(d.history)w(b).on("popstate",f);if(d.hashchange)w(b).on("hashchange",f);else k.addPollFn(f);P=!0}ha.push(a);return a};k.baseHref=function(){var a=F.attr("href");return a?
a.replace(/^(https?\:)?\/\/[^\/]*/,""):""};var N={},ca="",E=k.baseHref();k.cookies=function(a,b){var d,e,g,k;if(a)b===s?m.cookie=escape(a)+"=;path="+E+";expires=Thu, 01 Jan 1970 00:00:00 GMT":C(b)&&(d=(m.cookie=escape(a)+"="+escape(b)+";path="+E).length+1,4096<d&&c.warn("Cookie '"+a+"' possibly not set or overflowed because it was too large ("+d+" > 4096 bytes)!"));else{if(m.cookie!==ca)for(ca=m.cookie,d=ca.split("; "),N={},g=0;g<d.length;g++)e=d[g],k=e.indexOf("="),0<k&&(a=unescape(e.substring(0,
k)),N[a]===s&&(N[a]=unescape(e.substring(k+1))));return N}};k.defer=function(a,b){var c;v++;c=n(function(){delete r[c];e(a)},b||0);r[c]=!0;return c};k.defer.cancel=function(a){return r[a]?(delete r[a],p(a),e(y),!0):!1}}function Md(){this.$get=["$window","$log","$sniffer","$document",function(b,a,c,d){return new se(b,d,a,c)}]}function Nd(){this.$get=function(){function b(b,d){function e(a){a!=n&&(p?p==a&&(p=a.n):p=a,g(a.n,a.p),g(a,n),n=a,n.n=null)}function g(a,b){a!=b&&(a&&(a.p=b),b&&(b.n=a))}if(b in
a)throw t("$cacheFactory")("iid",b);var f=0,k=J({},d,{id:b}),m={},h=d&&d.capacity||Number.MAX_VALUE,l={},n=null,p=null;return a[b]={put:function(a,b){if(h<Number.MAX_VALUE){var c=l[a]||(l[a]={key:a});e(c)}if(!D(b))return a in m||f++,m[a]=b,f>h&&this.remove(p.key),b},get:function(a){if(h<Number.MAX_VALUE){var b=l[a];if(!b)return;e(b)}return m[a]},remove:function(a){if(h<Number.MAX_VALUE){var b=l[a];if(!b)return;b==n&&(n=b.p);b==p&&(p=b.n);g(b.n,b.p);delete l[a]}delete m[a];f--},removeAll:function(){m=
{};f=0;l={};n=p=null},destroy:function(){l=k=m=null;delete a[b]},info:function(){return J({},k,{size:f})}}}var a={};b.info=function(){var b={};q(a,function(a,e){b[e]=a.info()});return b};b.get=function(b){return a[b]};return b}}function ce(){this.$get=["$cacheFactory",function(b){return b("templates")}]}function gc(b,a){var c={},d="Directive",e=/^\s*directive\:\s*([\d\w_\-]+)\s+(.*)$/,g=/(([\d\w_\-]+)(?:\:([^;]+))?;?)/,f=/^(on[a-z]+|formaction)$/;this.directive=function m(a,e){Aa(a,"directive");C(a)?
(Cb(e,"directiveFactory"),c.hasOwnProperty(a)||(c[a]=[],b.factory(a+d,["$injector","$exceptionHandler",function(b,d){var e=[];q(c[a],function(c,g){try{var f=b.invoke(c);Q(f)?f={compile:$(f)}:!f.compile&&f.link&&(f.compile=$(f.link));f.priority=f.priority||0;f.index=g;f.name=f.name||a;f.require=f.require||f.controller&&f.name;f.restrict=f.restrict||"A";e.push(f)}catch(m){d(m)}});return e}])),c[a].push(e)):q(a,Xb(m));return this};this.aHrefSanitizationWhitelist=function(b){return B(b)?(a.aHrefSanitizationWhitelist(b),
this):a.aHrefSanitizationWhitelist()};this.imgSrcSanitizationWhitelist=function(b){return B(b)?(a.imgSrcSanitizationWhitelist(b),this):a.imgSrcSanitizationWhitelist()};this.$get=["$injector","$interpolate","$exceptionHandler","$http","$templateCache","$parse","$controller","$rootScope","$document","$sce","$animate","$$sanitizeUri",function(a,b,l,n,p,r,v,I,x,u,M,F){function z(a,b,c,d,e){a instanceof w||(a=w(a));q(a,function(b,c){3==b.nodeType&&b.nodeValue.match(/\S+/)&&(a[c]=w(b).wrap("<span></span>").parent()[0])});
var g=P(a,b,a,c,d,e);ha(a,"ng-scope");return function(b,c,d,e){Cb(b,"scope");var f=c?Ka.clone.call(a):a;q(d,function(a,b){f.data("$"+b+"Controller",a)});d=0;for(var m=f.length;d<m;d++){var h=f[d].nodeType;1!==h&&9!==h||f.eq(d).data("$scope",b)}c&&c(f,b);g&&g(b,f,f,e);return f}}function ha(a,b){try{a.addClass(b)}catch(c){}}function P(a,b,c,d,e,g){function f(a,c,d,e){var g,h,l,r,n,p,v;g=c.length;var K=Array(g);for(n=0;n<g;n++)K[n]=c[n];v=n=0;for(p=m.length;n<p;v++)h=K[v],c=m[n++],g=m[n++],l=w(h),c?
(c.scope?(r=a.$new(),l.data("$scope",r)):r=a,l=c.transcludeOnThisElement?N(a,c.transclude,e):!c.templateOnThisElement&&e?e:!e&&b?N(a,b):null,c(g,r,h,d,l)):g&&g(a,h.childNodes,s,e)}for(var m=[],h,l,r,n,p=0;p<a.length;p++)h=new Lb,l=ca(a[p],[],h,0===p?d:s,e),(g=l.length?H(l,a[p],h,b,c,null,[],[],g):null)&&g.scope&&ha(w(a[p]),"ng-scope"),h=g&&g.terminal||!(r=a[p].childNodes)||!r.length?null:P(r,g?(g.transcludeOnThisElement||!g.templateOnThisElement)&&g.transclude:b),m.push(g,h),n=n||g||h,g=null;return n?
f:null}function N(a,b,c){return function(d,e,g){var f=!1;d||(d=a.$new(),f=d.$$transcluded=!0);e=b(d,e,g,c);if(f)e.on("$destroy",function(){d.$destroy()});return e}}function ca(a,b,c,d,f){var m=c.$attr,h;switch(a.nodeType){case 1:ba(b,ma(La(a).toLowerCase()),"E",d,f);var l,r,n;h=a.attributes;for(var p=0,v=h&&h.length;p<v;p++){var x=!1,I=!1;l=h[p];if(!S||8<=S||l.specified){r=l.name;n=ma(r);W.test(n)&&(r=hb(n.substr(6),"-"));var M=n.replace(/(Start|End)$/,"");n===M+"Start"&&(x=r,I=r.substr(0,r.length-
5)+"end",r=r.substr(0,r.length-6));n=ma(r.toLowerCase());m[n]=r;c[n]=l=aa(l.value);qc(a,n)&&(c[n]=!0);R(a,b,l,n);ba(b,n,"A",d,f,x,I)}}a=a.className;if(C(a)&&""!==a)for(;h=g.exec(a);)n=ma(h[2]),ba(b,n,"C",d,f)&&(c[n]=aa(h[3])),a=a.substr(h.index+h[0].length);break;case 3:t(b,a.nodeValue);break;case 8:try{if(h=e.exec(a.nodeValue))n=ma(h[1]),ba(b,n,"M",d,f)&&(c[n]=aa(h[2]))}catch(u){}}b.sort(D);return b}function E(a,b,c){var d=[],e=0;if(b&&a.hasAttribute&&a.hasAttribute(b)){do{if(!a)throw ia("uterdir",
b,c);1==a.nodeType&&(a.hasAttribute(b)&&e++,a.hasAttribute(c)&&e--);d.push(a);a=a.nextSibling}while(0<e)}else d.push(a);return w(d)}function A(a,b,c){return function(d,e,g,f,h){e=E(e[0],b,c);return a(d,e,g,f,h)}}function H(a,c,d,e,g,f,m,n,p){function x(a,b,c,d){if(a){c&&(a=A(a,c,d));a.require=G.require;a.directiveName=na;if(N===G||G.$$isolateScope)a=uc(a,{isolateScope:!0});m.push(a)}if(b){c&&(b=A(b,c,d));b.require=G.require;b.directiveName=na;if(N===G||G.$$isolateScope)b=uc(b,{isolateScope:!0});n.push(b)}}
function I(a,b,c,d){var e,g="data",f=!1;if(C(b)){for(;"^"==(e=b.charAt(0))||"?"==e;)b=b.substr(1),"^"==e&&(g="inheritedData"),f=f||"?"==e;e=null;d&&"data"===g&&(e=d[b]);e=e||c[g]("$"+b+"Controller");if(!e&&!f)throw ia("ctreq",b,a);}else O(b)&&(e=[],q(b,function(b){e.push(I(a,b,c,d))}));return e}function M(a,e,g,f,p){function x(a,b){var c;2>arguments.length&&(b=a,a=s);Ca&&(c=ca);return p(a,b,c)}var u,K,z,F,A,E,ca={},nb;u=c===g?d:ka(d,new Lb(w(g),d.$attr));K=u.$$element;if(N){var ba=/^\s*([@=&])(\??)\s*(\w*)\s*$/;
f=w(g);E=e.$new(!0);!H||H!==N&&H!==N.$$originalDirective?f.data("$isolateScopeNoTemplate",E):f.data("$isolateScope",E);ha(f,"ng-isolate-scope");q(N.scope,function(a,c){var d=a.match(ba)||[],g=d[3]||c,f="?"==d[2],d=d[1],m,l,n,p;E.$$isolateBindings[c]=d+g;switch(d){case "@":u.$observe(g,function(a){E[c]=a});u.$$observers[g].$$scope=e;u[g]&&(E[c]=b(u[g])(e));break;case "=":if(f&&!u[g])break;l=r(u[g]);p=l.literal?xa:function(a,b){return a===b};n=l.assign||function(){m=E[c]=l(e);throw ia("nonassign",u[g],
N.name);};m=E[c]=l(e);E.$watch(function(){var a=l(e);p(a,E[c])||(p(a,m)?n(e,a=E[c]):E[c]=a);return m=a},null,l.literal);break;case "&":l=r(u[g]);E[c]=function(a){return l(e,a)};break;default:throw ia("iscp",N.name,c,a);}})}nb=p&&x;P&&q(P,function(a){var b={$scope:a===N||a.$$isolateScope?E:e,$element:K,$attrs:u,$transclude:nb},c;A=a.controller;"@"==A&&(A=u[a.name]);c=v(A,b);ca[a.name]=c;Ca||K.data("$"+a.name+"Controller",c);a.controllerAs&&(b.$scope[a.controllerAs]=c)});f=0;for(z=m.length;f<z;f++)try{F=
m[f],F(F.isolateScope?E:e,K,u,F.require&&I(F.directiveName,F.require,K,ca),nb)}catch(G){l(G,ga(K))}f=e;N&&(N.template||null===N.templateUrl)&&(f=E);a&&a(f,g.childNodes,s,p);for(f=n.length-1;0<=f;f--)try{F=n[f],F(F.isolateScope?E:e,K,u,F.require&&I(F.directiveName,F.require,K,ca),nb)}catch(B){l(B,ga(K))}}p=p||{};for(var u=-Number.MAX_VALUE,F,P=p.controllerDirectives,N=p.newIsolateScopeDirective,H=p.templateDirective,ba=p.nonTlbTranscludeDirective,D=!1,J=!1,Ca=p.hasElementTranscludeDirective,t=d.$$element=
w(c),G,na,X,T=e,R,S=0,oa=a.length;S<oa;S++){G=a[S];var W=G.$$start,Y=G.$$end;W&&(t=E(c,W,Y));X=s;if(u>G.priority)break;if(X=G.scope)F=F||G,G.templateUrl||(L("new/isolated scope",N,G,t),U(X)&&(N=G));na=G.name;!G.templateUrl&&G.controller&&(X=G.controller,P=P||{},L("'"+na+"' controller",P[na],G,t),P[na]=G);if(X=G.transclude)D=!0,G.$$tlb||(L("transclusion",ba,G,t),ba=G),"element"==X?(Ca=!0,u=G.priority,X=E(c,W,Y),t=d.$$element=w(V.createComment(" "+na+": "+d[na]+" ")),c=t[0],ob(g,w(ya.call(X,0)),c),
T=z(X,e,u,f&&f.name,{nonTlbTranscludeDirective:ba})):(X=w(Jb(c)).contents(),t.empty(),T=z(X,e));if(G.template)if(J=!0,L("template",H,G,t),H=G,X=Q(G.template)?G.template(t,d):G.template,X=Z(X),G.replace){f=G;X=Hb.test(X)?w(aa(X)):[];c=X[0];if(1!=X.length||1!==c.nodeType)throw ia("tplrt",na,"");ob(g,t,c);oa={$attr:{}};X=ca(c,[],oa);var te=a.splice(S+1,a.length-(S+1));N&&tc(X);a=a.concat(X).concat(te);B(d,oa);oa=a.length}else t.html(X);if(G.templateUrl)J=!0,L("template",H,G,t),H=G,G.replace&&(f=G),M=
y(a.splice(S,a.length-S),t,d,g,D&&T,m,n,{controllerDirectives:P,newIsolateScopeDirective:N,templateDirective:H,nonTlbTranscludeDirective:ba}),oa=a.length;else if(G.compile)try{R=G.compile(t,d,T),Q(R)?x(null,R,W,Y):R&&x(R.pre,R.post,W,Y)}catch($){l($,ga(t))}G.terminal&&(M.terminal=!0,u=Math.max(u,G.priority))}M.scope=F&&!0===F.scope;M.transcludeOnThisElement=D;M.templateOnThisElement=J;M.transclude=T;p.hasElementTranscludeDirective=Ca;return M}function tc(a){for(var b=0,c=a.length;b<c;b++)a[b]=Zb(a[b],
{$$isolateScope:!0})}function ba(b,e,g,f,h,r,n){if(e===h)return null;h=null;if(c.hasOwnProperty(e)){var p;e=a.get(e+d);for(var v=0,x=e.length;v<x;v++)try{p=e[v],(f===s||f>p.priority)&&-1!=p.restrict.indexOf(g)&&(r&&(p=Zb(p,{$$start:r,$$end:n})),b.push(p),h=p)}catch(I){l(I)}}return h}function B(a,b){var c=b.$attr,d=a.$attr,e=a.$$element;q(a,function(d,e){"$"!=e.charAt(0)&&(b[e]&&b[e]!==d&&(d+=("style"===e?";":" ")+b[e]),a.$set(e,d,!0,c[e]))});q(b,function(b,g){"class"==g?(ha(e,b),a["class"]=(a["class"]?
a["class"]+" ":"")+b):"style"==g?(e.attr("style",e.attr("style")+";"+b),a.style=(a.style?a.style+";":"")+b):"$"==g.charAt(0)||a.hasOwnProperty(g)||(a[g]=b,d[g]=c[g])})}function y(a,b,c,d,e,g,f,h){var m=[],l,r,v=b[0],x=a.shift(),I=J({},x,{templateUrl:null,transclude:null,replace:null,$$originalDirective:x}),M=Q(x.templateUrl)?x.templateUrl(b,c):x.templateUrl;b.empty();n.get(u.getTrustedResourceUrl(M),{cache:p}).success(function(n){var p,u;n=Z(n);if(x.replace){n=Hb.test(n)?w(aa(n)):[];p=n[0];if(1!=
n.length||1!==p.nodeType)throw ia("tplrt",x.name,M);n={$attr:{}};ob(d,b,p);var z=ca(p,[],n);U(x.scope)&&tc(z);a=z.concat(a);B(c,n)}else p=v,b.html(n);a.unshift(I);l=H(a,p,c,e,b,x,g,f,h);q(d,function(a,c){a==p&&(d[c]=b[0])});for(r=P(b[0].childNodes,e);m.length;){n=m.shift();u=m.shift();var F=m.shift(),A=m.shift(),z=b[0];if(u!==v){var E=u.className;h.hasElementTranscludeDirective&&x.replace||(z=Jb(p));ob(F,w(u),z);ha(w(z),E)}u=l.transcludeOnThisElement?N(n,l.transclude,A):A;l(r,n,z,d,u)}m=null}).error(function(a,
b,c,d){throw ia("tpload",d.url);});return function(a,b,c,d,e){a=e;m?(m.push(b),m.push(c),m.push(d),m.push(a)):(l.transcludeOnThisElement&&(a=N(b,l.transclude,e)),l(r,b,c,d,a))}}function D(a,b){var c=b.priority-a.priority;return 0!==c?c:a.name!==b.name?a.name<b.name?-1:1:a.index-b.index}function L(a,b,c,d){if(b)throw ia("multidir",b.name,c.name,a,ga(d));}function t(a,c){var d=b(c,!0);d&&a.push({priority:0,compile:function(a){var b=a.parent().length;b&&ha(a.parent(),"ng-binding");return function(a,
c){var e=c.parent(),g=e.data("$binding")||[];g.push(d);e.data("$binding",g);b||ha(e,"ng-binding");a.$watch(d,function(a){c[0].nodeValue=a})}}})}function T(a,b){if("srcdoc"==b)return u.HTML;var c=La(a);if("xlinkHref"==b||"FORM"==c&&"action"==b||"IMG"!=c&&("src"==b||"ngSrc"==b))return u.RESOURCE_URL}function R(a,c,d,e){var g=b(d,!0);if(g){if("multiple"===e&&"SELECT"===La(a))throw ia("selmulti",ga(a));c.push({priority:100,compile:function(){return{pre:function(c,d,m){d=m.$$observers||(m.$$observers=
{});if(f.test(e))throw ia("nodomevents");if(g=b(m[e],!0,T(a,e)))m[e]=g(c),(d[e]||(d[e]=[])).$$inter=!0,(m.$$observers&&m.$$observers[e].$$scope||c).$watch(g,function(a,b){"class"===e&&a!=b?m.$updateClass(a,b):m.$set(e,a)})}}}})}}function ob(a,b,c){var d=b[0],e=b.length,g=d.parentNode,f,m;if(a)for(f=0,m=a.length;f<m;f++)if(a[f]==d){a[f++]=c;m=f+e-1;for(var h=a.length;f<h;f++,m++)m<h?a[f]=a[m]:delete a[f];a.length-=e-1;break}g&&g.replaceChild(c,d);a=V.createDocumentFragment();a.appendChild(d);c[w.expando]=
d[w.expando];d=1;for(e=b.length;d<e;d++)g=b[d],w(g).remove(),a.appendChild(g),delete b[d];b[0]=c;b.length=1}function uc(a,b){return J(function(){return a.apply(null,arguments)},a,b)}var Lb=function(a,b){this.$$element=a;this.$attr=b||{}};Lb.prototype={$normalize:ma,$addClass:function(a){a&&0<a.length&&M.addClass(this.$$element,a)},$removeClass:function(a){a&&0<a.length&&M.removeClass(this.$$element,a)},$updateClass:function(a,b){var c=vc(a,b),d=vc(b,a);0===c.length?M.removeClass(this.$$element,d):
0===d.length?M.addClass(this.$$element,c):M.setClass(this.$$element,c,d)},$set:function(a,b,c,d){var e=qc(this.$$element[0],a);e&&(this.$$element.prop(a,b),d=e);this[a]=b;d?this.$attr[a]=d:(d=this.$attr[a])||(this.$attr[a]=d=hb(a,"-"));e=La(this.$$element);if("A"===e&&"href"===a||"IMG"===e&&"src"===a)this[a]=b=F(b,"src"===a);!1!==c&&(null===b||b===s?this.$$element.removeAttr(d):this.$$element.attr(d,b));(c=this.$$observers)&&q(c[a],function(a){try{a(b)}catch(c){l(c)}})},$observe:function(a,b){var c=
this,d=c.$$observers||(c.$$observers={}),e=d[a]||(d[a]=[]);e.push(b);I.$evalAsync(function(){e.$$inter||b(c[a])});return b}};var Ca=b.startSymbol(),oa=b.endSymbol(),Z="{{"==Ca||"}}"==oa?Fa:function(a){return a.replace(/\{\{/g,Ca).replace(/}}/g,oa)},W=/^ngAttr[A-Z]/;return z}]}function ma(b){return Va(b.replace(ue,""))}function vc(b,a){var c="",d=b.split(/\s+/),e=a.split(/\s+/),g=0;a:for(;g<d.length;g++){for(var f=d[g],k=0;k<e.length;k++)if(f==e[k])continue a;c+=(0<c.length?" ":"")+f}return c}function Od(){var b=
{},a=/^(\S+)(\s+as\s+(\w+))?$/;this.register=function(a,d){Aa(a,"controller");U(a)?J(b,a):b[a]=d};this.$get=["$injector","$window",function(c,d){return function(e,g){var f,k,m;C(e)&&(f=e.match(a),k=f[1],m=f[3],e=b.hasOwnProperty(k)?b[k]:fc(g.$scope,k,!0)||fc(d,k,!0),Ta(e,k,!0));f=c.instantiate(e,g);if(m){if(!g||"object"!=typeof g.$scope)throw t("$controller")("noscp",k||e.name,m);g.$scope[m]=f}return f}}]}function Pd(){this.$get=["$window",function(b){return w(b.document)}]}function Qd(){this.$get=
["$log",function(b){return function(a,c){b.error.apply(b,arguments)}}]}function wc(b){var a={},c,d,e;if(!b)return a;q(b.split("\n"),function(b){e=b.indexOf(":");c=L(aa(b.substr(0,e)));d=aa(b.substr(e+1));c&&(a[c]=a[c]?a[c]+(", "+d):d)});return a}function xc(b){var a=U(b)?b:s;return function(c){a||(a=wc(b));return c?a[L(c)]||null:a}}function yc(b,a,c){if(Q(c))return c(b,a);q(c,function(c){b=c(b,a)});return b}function Td(){var b=/^\s*(\[|\{[^\{])/,a=/[\}\]]\s*$/,c=/^\)\]\}',?\n/,d={"Content-Type":"application/json;charset=utf-8"},
e=this.defaults={transformResponse:[function(d){C(d)&&(d=d.replace(c,""),b.test(d)&&a.test(d)&&(d=ac(d)));return d}],transformRequest:[function(a){return U(a)&&"[object File]"!==wa.call(a)&&"[object Blob]"!==wa.call(a)?ra(a):a}],headers:{common:{Accept:"application/json, text/plain, */*"},post:ka(d),put:ka(d),patch:ka(d)},xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN"},g=this.interceptors=[],f=this.responseInterceptors=[];this.$get=["$httpBackend","$browser","$cacheFactory","$rootScope",
"$q","$injector",function(a,b,c,d,n,p){function r(a){function b(a){var d=J({},a,{data:yc(a.data,a.headers,c.transformResponse)});return 200<=a.status&&300>a.status?d:n.reject(d)}var c={method:"get",transformRequest:e.transformRequest,transformResponse:e.transformResponse},d=function(a){function b(a){var c;q(a,function(b,d){Q(b)&&(c=b(),null!=c?a[d]=c:delete a[d])})}var c=e.headers,d=J({},a.headers),g,f,c=J({},c.common,c[L(a.method)]);b(c);b(d);a:for(g in c){a=L(g);for(f in d)if(L(f)===a)continue a;
d[g]=c[g]}return d}(a);J(c,a);c.headers=d;c.method=Ha(c.method);var g=[function(a){d=a.headers;var c=yc(a.data,xc(d),a.transformRequest);D(a.data)&&q(d,function(a,b){"content-type"===L(b)&&delete d[b]});D(a.withCredentials)&&!D(e.withCredentials)&&(a.withCredentials=e.withCredentials);return v(a,c,d).then(b,b)},s],f=n.when(c);for(q(u,function(a){(a.request||a.requestError)&&g.unshift(a.request,a.requestError);(a.response||a.responseError)&&g.push(a.response,a.responseError)});g.length;){a=g.shift();
var m=g.shift(),f=f.then(a,m)}f.success=function(a){f.then(function(b){a(b.data,b.status,b.headers,c)});return f};f.error=function(a){f.then(null,function(b){a(b.data,b.status,b.headers,c)});return f};return f}function v(c,g,f){function h(a,b,c,e){A&&(200<=a&&300>a?A.put(w,[a,b,wc(c),e]):A.remove(w));p(b,a,c,e);d.$$phase||d.$apply()}function p(a,b,d,e){b=Math.max(b,0);(200<=b&&300>b?u.resolve:u.reject)({data:a,status:b,headers:xc(d),config:c,statusText:e})}function v(){var a=Oa(r.pendingRequests,
c);-1!==a&&r.pendingRequests.splice(a,1)}var u=n.defer(),q=u.promise,A,H,w=I(c.url,c.params);r.pendingRequests.push(c);q.then(v,v);(c.cache||e.cache)&&(!1!==c.cache&&"GET"==c.method)&&(A=U(c.cache)?c.cache:U(e.cache)?e.cache:x);if(A)if(H=A.get(w),B(H)){if(H.then)return H.then(v,v),H;O(H)?p(H[1],H[0],ka(H[2]),H[3]):p(H,200,{},"OK")}else A.put(w,q);D(H)&&((H=Mb(c.url)?b.cookies()[c.xsrfCookieName||e.xsrfCookieName]:s)&&(f[c.xsrfHeaderName||e.xsrfHeaderName]=H),a(c.method,w,g,h,f,c.timeout,c.withCredentials,
c.responseType));return q}function I(a,b){if(!b)return a;var c=[];Sc(b,function(a,b){null===a||D(a)||(O(a)||(a=[a]),q(a,function(a){U(a)&&(a=ra(a));c.push(za(b)+"="+za(a))}))});0<c.length&&(a+=(-1==a.indexOf("?")?"?":"&")+c.join("&"));return a}var x=c("$http"),u=[];q(g,function(a){u.unshift(C(a)?p.get(a):p.invoke(a))});q(f,function(a,b){var c=C(a)?p.get(a):p.invoke(a);u.splice(b,0,{response:function(a){return c(n.when(a))},responseError:function(a){return c(n.reject(a))}})});r.pendingRequests=[];
(function(a){q(arguments,function(a){r[a]=function(b,c){return r(J(c||{},{method:a,url:b}))}})})("get","delete","head","jsonp");(function(a){q(arguments,function(a){r[a]=function(b,c,d){return r(J(d||{},{method:a,url:b,data:c}))}})})("post","put");r.defaults=e;return r}]}function ve(b){if(8>=S&&(!b.match(/^(get|post|head|put|delete|options)$/i)||!T.XMLHttpRequest))return new T.ActiveXObject("Microsoft.XMLHTTP");if(T.XMLHttpRequest)return new T.XMLHttpRequest;throw t("$httpBackend")("noxhr");}function Ud(){this.$get=
["$browser","$window","$document",function(b,a,c){return we(b,ve,b.defer,a.angular.callbacks,c[0])}]}function we(b,a,c,d,e){function g(a,b,c){var g=e.createElement("script"),f=null;g.type="text/javascript";g.src=a;g.async=!0;f=function(a){Wa(g,"load",f);Wa(g,"error",f);e.body.removeChild(g);g=null;var k=-1,v="unknown";a&&("load"!==a.type||d[b].called||(a={type:"error"}),v=a.type,k="error"===a.type?404:200);c&&c(k,v)};pb(g,"load",f);pb(g,"error",f);8>=S&&(g.onreadystatechange=function(){C(g.readyState)&&
/loaded|complete/.test(g.readyState)&&(g.onreadystatechange=null,f({type:"load"}))});e.body.appendChild(g);return f}var f=-1;return function(e,m,h,l,n,p,r,v){function I(){u=f;F&&F();z&&z.abort()}function x(a,d,e,g,f){P&&c.cancel(P);F=z=null;0===d&&(d=e?200:"file"==sa(m).protocol?404:0);a(1223===d?204:d,e,g,f||"");b.$$completeOutstandingRequest(y)}var u;b.$$incOutstandingRequestCount();m=m||b.url();if("jsonp"==L(e)){var M="_"+(d.counter++).toString(36);d[M]=function(a){d[M].data=a;d[M].called=!0};
var F=g(m.replace("JSON_CALLBACK","angular.callbacks."+M),M,function(a,b){x(l,a,d[M].data,"",b);d[M]=y})}else{var z=a(e);z.open(e,m,!0);q(n,function(a,b){B(a)&&z.setRequestHeader(b,a)});z.onreadystatechange=function(){if(z&&4==z.readyState){var a=null,b=null;u!==f&&(a=z.getAllResponseHeaders(),b="response"in z?z.response:z.responseText);x(l,u||z.status,b,a,z.statusText||"")}};r&&(z.withCredentials=!0);if(v)try{z.responseType=v}catch(s){if("json"!==v)throw s;}z.send(h||null)}if(0<p)var P=c(I,p);else p&&
p.then&&p.then(I)}}function Rd(){var b="{{",a="}}";this.startSymbol=function(a){return a?(b=a,this):b};this.endSymbol=function(b){return b?(a=b,this):a};this.$get=["$parse","$exceptionHandler","$sce",function(c,d,e){function g(g,h,l){for(var n,p,r=0,v=[],I=g.length,x=!1,u=[];r<I;)-1!=(n=g.indexOf(b,r))&&-1!=(p=g.indexOf(a,n+f))?(r!=n&&v.push(g.substring(r,n)),v.push(r=c(x=g.substring(n+f,p))),r.exp=x,r=p+k,x=!0):(r!=I&&v.push(g.substring(r)),r=I);(I=v.length)||(v.push(""),I=1);if(l&&1<v.length)throw zc("noconcat",
g);if(!h||x)return u.length=I,r=function(a){try{for(var b=0,c=I,f;b<c;b++){if("function"==typeof(f=v[b]))if(f=f(a),f=l?e.getTrusted(l,f):e.valueOf(f),null==f)f="";else switch(typeof f){case "string":break;case "number":f=""+f;break;default:f=ra(f)}u[b]=f}return u.join("")}catch(k){a=zc("interr",g,k.toString()),d(a)}},r.exp=g,r.parts=v,r}var f=b.length,k=a.length;g.startSymbol=function(){return b};g.endSymbol=function(){return a};return g}]}function Sd(){this.$get=["$rootScope","$window","$q",function(b,
a,c){function d(d,f,k,m){var h=a.setInterval,l=a.clearInterval,n=c.defer(),p=n.promise,r=0,v=B(m)&&!m;k=B(k)?k:0;p.then(null,null,d);p.$$intervalId=h(function(){n.notify(r++);0<k&&r>=k&&(n.resolve(r),l(p.$$intervalId),delete e[p.$$intervalId]);v||b.$apply()},f);e[p.$$intervalId]=n;return p}var e={};d.cancel=function(a){return a&&a.$$intervalId in e?(e[a.$$intervalId].reject("canceled"),clearInterval(a.$$intervalId),delete e[a.$$intervalId],!0):!1};return d}]}function ad(){this.$get=function(){return{id:"en-us",
NUMBER_FORMATS:{DECIMAL_SEP:".",GROUP_SEP:",",PATTERNS:[{minInt:1,minFrac:0,maxFrac:3,posPre:"",posSuf:"",negPre:"-",negSuf:"",gSize:3,lgSize:3},{minInt:1,minFrac:2,maxFrac:2,posPre:"\u00a4",posSuf:"",negPre:"(\u00a4",negSuf:")",gSize:3,lgSize:3}],CURRENCY_SYM:"$"},DATETIME_FORMATS:{MONTH:"January February March April May June July August September October November December".split(" "),SHORTMONTH:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),DAY:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),
SHORTDAY:"Sun Mon Tue Wed Thu Fri Sat".split(" "),AMPMS:["AM","PM"],medium:"MMM d, y h:mm:ss a","short":"M/d/yy h:mm a",fullDate:"EEEE, MMMM d, y",longDate:"MMMM d, y",mediumDate:"MMM d, y",shortDate:"M/d/yy",mediumTime:"h:mm:ss a",shortTime:"h:mm a"},pluralCat:function(b){return 1===b?"one":"other"}}}}function Nb(b){b=b.split("/");for(var a=b.length;a--;)b[a]=gb(b[a]);return b.join("/")}function Ac(b,a,c){b=sa(b,c);a.$$protocol=b.protocol;a.$$host=b.hostname;a.$$port=Z(b.port)||xe[b.protocol]||null}
function Bc(b,a,c){var d="/"!==b.charAt(0);d&&(b="/"+b);b=sa(b,c);a.$$path=decodeURIComponent(d&&"/"===b.pathname.charAt(0)?b.pathname.substring(1):b.pathname);a.$$search=cc(b.search);a.$$hash=decodeURIComponent(b.hash);a.$$path&&"/"!=a.$$path.charAt(0)&&(a.$$path="/"+a.$$path)}function pa(b,a){if(0===a.indexOf(b))return a.substr(b.length)}function $a(b){var a=b.indexOf("#");return-1==a?b:b.substr(0,a)}function Ob(b){return b.substr(0,$a(b).lastIndexOf("/")+1)}function Cc(b,a){this.$$html5=!0;a=a||
"";var c=Ob(b);Ac(b,this,b);this.$$parse=function(a){var e=pa(c,a);if(!C(e))throw Pb("ipthprfx",a,c);Bc(e,this,b);this.$$path||(this.$$path="/");this.$$compose()};this.$$compose=function(){var a=Bb(this.$$search),b=this.$$hash?"#"+gb(this.$$hash):"";this.$$url=Nb(this.$$path)+(a?"?"+a:"")+b;this.$$absUrl=c+this.$$url.substr(1)};this.$$rewrite=function(d){var e;if((e=pa(b,d))!==s)return d=e,(e=pa(a,e))!==s?c+(pa("/",e)||e):b+d;if((e=pa(c,d))!==s)return c+e;if(c==d+"/")return c}}function Qb(b,a){var c=
Ob(b);Ac(b,this,b);this.$$parse=function(d){var e=pa(b,d)||pa(c,d),e="#"==e.charAt(0)?pa(a,e):this.$$html5?e:"";if(!C(e))throw Pb("ihshprfx",d,a);Bc(e,this,b);d=this.$$path;var g=/^\/[A-Z]:(\/.*)/;0===e.indexOf(b)&&(e=e.replace(b,""));g.exec(e)||(d=(e=g.exec(d))?e[1]:d);this.$$path=d;this.$$compose()};this.$$compose=function(){var c=Bb(this.$$search),e=this.$$hash?"#"+gb(this.$$hash):"";this.$$url=Nb(this.$$path)+(c?"?"+c:"")+e;this.$$absUrl=b+(this.$$url?a+this.$$url:"")};this.$$rewrite=function(a){if($a(b)==
$a(a))return a}}function Rb(b,a){this.$$html5=!0;Qb.apply(this,arguments);var c=Ob(b);this.$$rewrite=function(d){var e;if(b==$a(d))return d;if(e=pa(c,d))return b+a+e;if(c===d+"/")return c};this.$$compose=function(){var c=Bb(this.$$search),e=this.$$hash?"#"+gb(this.$$hash):"";this.$$url=Nb(this.$$path)+(c?"?"+c:"")+e;this.$$absUrl=b+a+this.$$url}}function qb(b){return function(){return this[b]}}function Dc(b,a){return function(c){if(D(c))return this[b];this[b]=a(c);this.$$compose();return this}}function Vd(){var b=
"",a=!1;this.hashPrefix=function(a){return B(a)?(b=a,this):b};this.html5Mode=function(b){return B(b)?(a=b,this):a};this.$get=["$rootScope","$browser","$sniffer","$rootElement",function(c,d,e,g){function f(a){c.$broadcast("$locationChangeSuccess",k.absUrl(),a)}var k,m,h=d.baseHref(),l=d.url(),n;a?(n=l.substring(0,l.indexOf("/",l.indexOf("//")+2))+(h||"/"),m=e.history?Cc:Rb):(n=$a(l),m=Qb);k=new m(n,"#"+b);k.$$parse(k.$$rewrite(l));g.on("click",function(a){if(!a.ctrlKey&&!a.metaKey&&2!=a.which){for(var e=
w(a.target);"a"!==L(e[0].nodeName);)if(e[0]===g[0]||!(e=e.parent())[0])return;var f=e.prop("href");U(f)&&"[object SVGAnimatedString]"===f.toString()&&(f=sa(f.animVal).href);if(m===Rb){var h=e.attr("href")||e.attr("xlink:href");if(0>h.indexOf("://"))if(f="#"+b,"/"==h[0])f=n+f+h;else if("#"==h[0])f=n+f+(k.path()||"/")+h;else{for(var l=k.path().split("/"),h=h.split("/"),p=0;p<h.length;p++)"."!=h[p]&&(".."==h[p]?l.pop():h[p].length&&l.push(h[p]));f=n+f+l.join("/")}}l=k.$$rewrite(f);f&&(!e.attr("target")&&
l&&!a.isDefaultPrevented())&&(a.preventDefault(),l!=d.url()&&(k.$$parse(l),c.$apply(),T.angular["ff-684208-preventDefault"]=!0))}});k.absUrl()!=l&&d.url(k.absUrl(),!0);d.onUrlChange(function(a){k.absUrl()!=a&&(c.$evalAsync(function(){var b=k.absUrl();k.$$parse(a);c.$broadcast("$locationChangeStart",a,b).defaultPrevented?(k.$$parse(b),d.url(b)):f(b)}),c.$$phase||c.$digest())});var p=0;c.$watch(function(){var a=d.url(),b=k.$$replace;p&&a==k.absUrl()||(p++,c.$evalAsync(function(){c.$broadcast("$locationChangeStart",
k.absUrl(),a).defaultPrevented?k.$$parse(a):(d.url(k.absUrl(),b),f(a))}));k.$$replace=!1;return p});return k}]}function Wd(){var b=!0,a=this;this.debugEnabled=function(a){return B(a)?(b=a,this):b};this.$get=["$window",function(c){function d(a){a instanceof Error&&(a.stack?a=a.message&&-1===a.stack.indexOf(a.message)?"Error: "+a.message+"\n"+a.stack:a.stack:a.sourceURL&&(a=a.message+"\n"+a.sourceURL+":"+a.line));return a}function e(a){var b=c.console||{},e=b[a]||b.log||y;a=!1;try{a=!!e.apply}catch(m){}return a?
function(){var a=[];q(arguments,function(b){a.push(d(b))});return e.apply(b,a)}:function(a,b){e(a,null==b?"":b)}}return{log:e("log"),info:e("info"),warn:e("warn"),error:e("error"),debug:function(){var c=e("debug");return function(){b&&c.apply(a,arguments)}}()}}]}function ea(b,a){if("constructor"===b)throw Da("isecfld",a);return b}function ab(b,a){if(b){if(b.constructor===b)throw Da("isecfn",a);if(b.document&&b.location&&b.alert&&b.setInterval)throw Da("isecwindow",a);if(b.children&&(b.nodeName||b.prop&&
b.attr&&b.find))throw Da("isecdom",a);}return b}function rb(b,a,c,d,e){e=e||{};a=a.split(".");for(var g,f=0;1<a.length;f++){g=ea(a.shift(),d);var k=b[g];k||(k={},b[g]=k);b=k;b.then&&e.unwrapPromises&&(ta(d),"$$v"in b||function(a){a.then(function(b){a.$$v=b})}(b),b.$$v===s&&(b.$$v={}),b=b.$$v)}g=ea(a.shift(),d);return b[g]=c}function Ec(b,a,c,d,e,g,f){ea(b,g);ea(a,g);ea(c,g);ea(d,g);ea(e,g);return f.unwrapPromises?function(f,m){var h=m&&m.hasOwnProperty(b)?m:f,l;if(null==h)return h;(h=h[b])&&h.then&&
(ta(g),"$$v"in h||(l=h,l.$$v=s,l.then(function(a){l.$$v=a})),h=h.$$v);if(!a)return h;if(null==h)return s;(h=h[a])&&h.then&&(ta(g),"$$v"in h||(l=h,l.$$v=s,l.then(function(a){l.$$v=a})),h=h.$$v);if(!c)return h;if(null==h)return s;(h=h[c])&&h.then&&(ta(g),"$$v"in h||(l=h,l.$$v=s,l.then(function(a){l.$$v=a})),h=h.$$v);if(!d)return h;if(null==h)return s;(h=h[d])&&h.then&&(ta(g),"$$v"in h||(l=h,l.$$v=s,l.then(function(a){l.$$v=a})),h=h.$$v);if(!e)return h;if(null==h)return s;(h=h[e])&&h.then&&(ta(g),"$$v"in
h||(l=h,l.$$v=s,l.then(function(a){l.$$v=a})),h=h.$$v);return h}:function(g,f){var h=f&&f.hasOwnProperty(b)?f:g;if(null==h)return h;h=h[b];if(!a)return h;if(null==h)return s;h=h[a];if(!c)return h;if(null==h)return s;h=h[c];if(!d)return h;if(null==h)return s;h=h[d];return e?null==h?s:h=h[e]:h}}function ye(b,a){ea(b,a);return function(a,d){return null==a?s:(d&&d.hasOwnProperty(b)?d:a)[b]}}function ze(b,a,c){ea(b,c);ea(a,c);return function(c,e){if(null==c)return s;c=(e&&e.hasOwnProperty(b)?e:c)[b];return null==
c?s:c[a]}}function Fc(b,a,c){if(Sb.hasOwnProperty(b))return Sb[b];var d=b.split("."),e=d.length,g;if(a.unwrapPromises||1!==e)if(a.unwrapPromises||2!==e)if(a.csp)g=6>e?Ec(d[0],d[1],d[2],d[3],d[4],c,a):function(b,g){var f=0,k;do k=Ec(d[f++],d[f++],d[f++],d[f++],d[f++],c,a)(b,g),g=s,b=k;while(f<e);return k};else{var f="var p;\n";q(d,function(b,d){ea(b,c);f+="if(s == null) return undefined;\ns="+(d?"s":'((k&&k.hasOwnProperty("'+b+'"))?k:s)')+'["'+b+'"];\n'+(a.unwrapPromises?'if (s && s.then) {\n pw("'+
c.replace(/(["\r\n])/g,"\\$1")+'");\n if (!("$$v" in s)) {\n p=s;\n p.$$v = undefined;\n p.then(function(v) {p.$$v=v;});\n}\n s=s.$$v\n}\n':"")});var f=f+"return s;",k=new Function("s","k","pw",f);k.toString=$(f);g=a.unwrapPromises?function(a,b){return k(a,b,ta)}:k}else g=ze(d[0],d[1],c);else g=ye(d[0],c);"hasOwnProperty"!==b&&(Sb[b]=g);return g}function Xd(){var b={},a={csp:!1,unwrapPromises:!1,logPromiseWarnings:!0};this.unwrapPromises=function(b){return B(b)?(a.unwrapPromises=!!b,this):a.unwrapPromises};
this.logPromiseWarnings=function(b){return B(b)?(a.logPromiseWarnings=b,this):a.logPromiseWarnings};this.$get=["$filter","$sniffer","$log",function(c,d,e){a.csp=d.csp;ta=function(b){a.logPromiseWarnings&&!Gc.hasOwnProperty(b)&&(Gc[b]=!0,e.warn("[$parse] Promise found in the expression `"+b+"`. Automatic unwrapping of promises in Angular expressions is deprecated."))};return function(d){var e;switch(typeof d){case "string":if(b.hasOwnProperty(d))return b[d];e=new Tb(a);e=(new bb(e,c,a)).parse(d);"hasOwnProperty"!==
d&&(b[d]=e);return e;case "function":return d;default:return y}}}]}function Zd(){this.$get=["$rootScope","$exceptionHandler",function(b,a){return Ae(function(a){b.$evalAsync(a)},a)}]}function Ae(b,a){function c(a){return a}function d(a){return f(a)}var e=function(){var f=[],h,l;return l={resolve:function(a){if(f){var c=f;f=s;h=g(a);c.length&&b(function(){for(var a,b=0,d=c.length;b<d;b++)a=c[b],h.then(a[0],a[1],a[2])})}},reject:function(a){l.resolve(k(a))},notify:function(a){if(f){var c=f;f.length&&
b(function(){for(var b,d=0,e=c.length;d<e;d++)b=c[d],b[2](a)})}},promise:{then:function(b,g,k){var l=e(),I=function(d){try{l.resolve((Q(b)?b:c)(d))}catch(e){l.reject(e),a(e)}},x=function(b){try{l.resolve((Q(g)?g:d)(b))}catch(c){l.reject(c),a(c)}},u=function(b){try{l.notify((Q(k)?k:c)(b))}catch(d){a(d)}};f?f.push([I,x,u]):h.then(I,x,u);return l.promise},"catch":function(a){return this.then(null,a)},"finally":function(a){function b(a,c){var d=e();c?d.resolve(a):d.reject(a);return d.promise}function d(e,
g){var f=null;try{f=(a||c)()}catch(k){return b(k,!1)}return f&&Q(f.then)?f.then(function(){return b(e,g)},function(a){return b(a,!1)}):b(e,g)}return this.then(function(a){return d(a,!0)},function(a){return d(a,!1)})}}}},g=function(a){return a&&Q(a.then)?a:{then:function(c){var d=e();b(function(){d.resolve(c(a))});return d.promise}}},f=function(a){var b=e();b.reject(a);return b.promise},k=function(c){return{then:function(g,f){var k=e();b(function(){try{k.resolve((Q(f)?f:d)(c))}catch(b){k.reject(b),
a(b)}});return k.promise}}};return{defer:e,reject:f,when:function(k,h,l,n){var p=e(),r,v=function(b){try{return(Q(h)?h:c)(b)}catch(d){return a(d),f(d)}},I=function(b){try{return(Q(l)?l:d)(b)}catch(c){return a(c),f(c)}},x=function(b){try{return(Q(n)?n:c)(b)}catch(d){a(d)}};b(function(){g(k).then(function(a){r||(r=!0,p.resolve(g(a).then(v,I,x)))},function(a){r||(r=!0,p.resolve(I(a)))},function(a){r||p.notify(x(a))})});return p.promise},all:function(a){var b=e(),c=0,d=O(a)?[]:{};q(a,function(a,e){c++;
g(a).then(function(a){d.hasOwnProperty(e)||(d[e]=a,--c||b.resolve(d))},function(a){d.hasOwnProperty(e)||b.reject(a)})});0===c&&b.resolve(d);return b.promise}}}function fe(){this.$get=["$window","$timeout",function(b,a){var c=b.requestAnimationFrame||b.webkitRequestAnimationFrame||b.mozRequestAnimationFrame,d=b.cancelAnimationFrame||b.webkitCancelAnimationFrame||b.mozCancelAnimationFrame||b.webkitCancelRequestAnimationFrame,e=!!c,g=e?function(a){var b=c(a);return function(){d(b)}}:function(b){var c=
a(b,16.66,!1);return function(){a.cancel(c)}};g.supported=e;return g}]}function Yd(){var b=10,a=t("$rootScope"),c=null;this.digestTtl=function(a){arguments.length&&(b=a);return b};this.$get=["$injector","$exceptionHandler","$parse","$browser",function(d,e,g,f){function k(){this.$id=eb();this.$$phase=this.$parent=this.$$watchers=this.$$nextSibling=this.$$prevSibling=this.$$childHead=this.$$childTail=null;this["this"]=this.$root=this;this.$$destroyed=!1;this.$$asyncQueue=[];this.$$postDigestQueue=[];
this.$$listeners={};this.$$listenerCount={};this.$$isolateBindings={}}function m(b){if(p.$$phase)throw a("inprog",p.$$phase);p.$$phase=b}function h(a,b){var c=g(a);Ta(c,b);return c}function l(a,b,c){do a.$$listenerCount[c]-=b,0===a.$$listenerCount[c]&&delete a.$$listenerCount[c];while(a=a.$parent)}function n(){}k.prototype={constructor:k,$new:function(a){a?(a=new k,a.$root=this.$root,a.$$asyncQueue=this.$$asyncQueue,a.$$postDigestQueue=this.$$postDigestQueue):(this.$$childScopeClass||(this.$$childScopeClass=
function(){this.$$watchers=this.$$nextSibling=this.$$childHead=this.$$childTail=null;this.$$listeners={};this.$$listenerCount={};this.$id=eb();this.$$childScopeClass=null},this.$$childScopeClass.prototype=this),a=new this.$$childScopeClass);a["this"]=a;a.$parent=this;a.$$prevSibling=this.$$childTail;this.$$childHead?this.$$childTail=this.$$childTail.$$nextSibling=a:this.$$childHead=this.$$childTail=a;return a},$watch:function(a,b,d){var e=h(a,"watch"),g=this.$$watchers,f={fn:b,last:n,get:e,exp:a,
eq:!!d};c=null;if(!Q(b)){var k=h(b||y,"listener");f.fn=function(a,b,c){k(c)}}if("string"==typeof a&&e.constant){var m=f.fn;f.fn=function(a,b,c){m.call(this,a,b,c);Pa(g,f)}}g||(g=this.$$watchers=[]);g.unshift(f);return function(){Pa(g,f);c=null}},$watchCollection:function(a,b){var c=this,d,e,f,k=1<b.length,h=0,m=g(a),l=[],n={},p=!0,q=0;return this.$watch(function(){d=m(c);var a,b;if(U(d))if(db(d))for(e!==l&&(e=l,q=e.length=0,h++),a=d.length,q!==a&&(h++,e.length=q=a),b=0;b<a;b++)e[b]!==e[b]&&d[b]!==
d[b]||e[b]===d[b]||(h++,e[b]=d[b]);else{e!==n&&(e=n={},q=0,h++);a=0;for(b in d)d.hasOwnProperty(b)&&(a++,e.hasOwnProperty(b)?e[b]!==d[b]&&(h++,e[b]=d[b]):(q++,e[b]=d[b],h++));if(q>a)for(b in h++,e)e.hasOwnProperty(b)&&!d.hasOwnProperty(b)&&(q--,delete e[b])}else e!==d&&(e=d,h++);return h},function(){p?(p=!1,b(d,d,c)):b(d,f,c);if(k)if(U(d))if(db(d)){f=Array(d.length);for(var a=0;a<d.length;a++)f[a]=d[a]}else for(a in f={},d)zb.call(d,a)&&(f[a]=d[a]);else f=d})},$digest:function(){var d,g,f,k,h=this.$$asyncQueue,
l=this.$$postDigestQueue,q,z,s=b,P,N=[],w,E,A;m("$digest");c=null;do{z=!1;for(P=this;h.length;){try{A=h.shift(),A.scope.$eval(A.expression)}catch(H){p.$$phase=null,e(H)}c=null}a:do{if(k=P.$$watchers)for(q=k.length;q--;)try{if(d=k[q])if((g=d.get(P))!==(f=d.last)&&!(d.eq?xa(g,f):"number"==typeof g&&"number"==typeof f&&isNaN(g)&&isNaN(f)))z=!0,c=d,d.last=d.eq?Ga(g,null):g,d.fn(g,f===n?g:f,P),5>s&&(w=4-s,N[w]||(N[w]=[]),E=Q(d.exp)?"fn: "+(d.exp.name||d.exp.toString()):d.exp,E+="; newVal: "+ra(g)+"; oldVal: "+
ra(f),N[w].push(E));else if(d===c){z=!1;break a}}catch(B){p.$$phase=null,e(B)}if(!(k=P.$$childHead||P!==this&&P.$$nextSibling))for(;P!==this&&!(k=P.$$nextSibling);)P=P.$parent}while(P=k);if((z||h.length)&&!s--)throw p.$$phase=null,a("infdig",b,ra(N));}while(z||h.length);for(p.$$phase=null;l.length;)try{l.shift()()}catch(t){e(t)}},$destroy:function(){if(!this.$$destroyed){var a=this.$parent;this.$broadcast("$destroy");this.$$destroyed=!0;this!==p&&(q(this.$$listenerCount,Ab(null,l,this)),a.$$childHead==
this&&(a.$$childHead=this.$$nextSibling),a.$$childTail==this&&(a.$$childTail=this.$$prevSibling),this.$$prevSibling&&(this.$$prevSibling.$$nextSibling=this.$$nextSibling),this.$$nextSibling&&(this.$$nextSibling.$$prevSibling=this.$$prevSibling),this.$parent=this.$$nextSibling=this.$$prevSibling=this.$$childHead=this.$$childTail=this.$root=null,this.$$listeners={},this.$$watchers=this.$$asyncQueue=this.$$postDigestQueue=[],this.$destroy=this.$digest=this.$apply=y,this.$on=this.$watch=function(){return y})}},
$eval:function(a,b){return g(a)(this,b)},$evalAsync:function(a){p.$$phase||p.$$asyncQueue.length||f.defer(function(){p.$$asyncQueue.length&&p.$digest()});this.$$asyncQueue.push({scope:this,expression:a})},$$postDigest:function(a){this.$$postDigestQueue.push(a)},$apply:function(a){try{return m("$apply"),this.$eval(a)}catch(b){e(b)}finally{p.$$phase=null;try{p.$digest()}catch(c){throw e(c),c;}}},$on:function(a,b){var c=this.$$listeners[a];c||(this.$$listeners[a]=c=[]);c.push(b);var d=this;do d.$$listenerCount[a]||
(d.$$listenerCount[a]=0),d.$$listenerCount[a]++;while(d=d.$parent);var e=this;return function(){c[Oa(c,b)]=null;l(e,1,a)}},$emit:function(a,b){var c=[],d,g=this,f=!1,k={name:a,targetScope:g,stopPropagation:function(){f=!0},preventDefault:function(){k.defaultPrevented=!0},defaultPrevented:!1},h=[k].concat(ya.call(arguments,1)),m,l;do{d=g.$$listeners[a]||c;k.currentScope=g;m=0;for(l=d.length;m<l;m++)if(d[m])try{d[m].apply(null,h)}catch(n){e(n)}else d.splice(m,1),m--,l--;if(f)break;g=g.$parent}while(g);
return k},$broadcast:function(a,b){for(var c=this,d=this,g={name:a,targetScope:this,preventDefault:function(){g.defaultPrevented=!0},defaultPrevented:!1},f=[g].concat(ya.call(arguments,1)),k,h;c=d;){g.currentScope=c;d=c.$$listeners[a]||[];k=0;for(h=d.length;k<h;k++)if(d[k])try{d[k].apply(null,f)}catch(m){e(m)}else d.splice(k,1),k--,h--;if(!(d=c.$$listenerCount[a]&&c.$$childHead||c!==this&&c.$$nextSibling))for(;c!==this&&!(d=c.$$nextSibling);)c=c.$parent}return g}};var p=new k;return p}]}function bd(){var b=
/^\s*(https?|ftp|mailto|tel|file):/,a=/^\s*(https?|ftp|file):|data:image\//;this.aHrefSanitizationWhitelist=function(a){return B(a)?(b=a,this):b};this.imgSrcSanitizationWhitelist=function(b){return B(b)?(a=b,this):a};this.$get=function(){return function(c,d){var e=d?a:b,g;if(!S||8<=S)if(g=sa(c).href,""!==g&&!g.match(e))return"unsafe:"+g;return c}}}function Be(b){if("self"===b)return b;if(C(b)){if(-1<b.indexOf("***"))throw ua("iwcard",b);b=b.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,
"\\x08").replace("\\*\\*",".*").replace("\\*","[^:/.?&;]*");return RegExp("^"+b+"$")}if(fb(b))return RegExp("^"+b.source+"$");throw ua("imatcher");}function Hc(b){var a=[];B(b)&&q(b,function(b){a.push(Be(b))});return a}function ae(){this.SCE_CONTEXTS=fa;var b=["self"],a=[];this.resourceUrlWhitelist=function(a){arguments.length&&(b=Hc(a));return b};this.resourceUrlBlacklist=function(b){arguments.length&&(a=Hc(b));return a};this.$get=["$injector",function(c){function d(a){var b=function(a){this.$$unwrapTrustedValue=
function(){return a}};a&&(b.prototype=new a);b.prototype.valueOf=function(){return this.$$unwrapTrustedValue()};b.prototype.toString=function(){return this.$$unwrapTrustedValue().toString()};return b}var e=function(a){throw ua("unsafe");};c.has("$sanitize")&&(e=c.get("$sanitize"));var g=d(),f={};f[fa.HTML]=d(g);f[fa.CSS]=d(g);f[fa.URL]=d(g);f[fa.JS]=d(g);f[fa.RESOURCE_URL]=d(f[fa.URL]);return{trustAs:function(a,b){var c=f.hasOwnProperty(a)?f[a]:null;if(!c)throw ua("icontext",a,b);if(null===b||b===
s||""===b)return b;if("string"!==typeof b)throw ua("itype",a);return new c(b)},getTrusted:function(c,d){if(null===d||d===s||""===d)return d;var g=f.hasOwnProperty(c)?f[c]:null;if(g&&d instanceof g)return d.$$unwrapTrustedValue();if(c===fa.RESOURCE_URL){var g=sa(d.toString()),l,n,p=!1;l=0;for(n=b.length;l<n;l++)if("self"===b[l]?Mb(g):b[l].exec(g.href)){p=!0;break}if(p)for(l=0,n=a.length;l<n;l++)if("self"===a[l]?Mb(g):a[l].exec(g.href)){p=!1;break}if(p)return d;throw ua("insecurl",d.toString());}if(c===
fa.HTML)return e(d);throw ua("unsafe");},valueOf:function(a){return a instanceof g?a.$$unwrapTrustedValue():a}}}]}function $d(){var b=!0;this.enabled=function(a){arguments.length&&(b=!!a);return b};this.$get=["$parse","$sniffer","$sceDelegate",function(a,c,d){if(b&&c.msie&&8>c.msieDocumentMode)throw ua("iequirks");var e=ka(fa);e.isEnabled=function(){return b};e.trustAs=d.trustAs;e.getTrusted=d.getTrusted;e.valueOf=d.valueOf;b||(e.trustAs=e.getTrusted=function(a,b){return b},e.valueOf=Fa);e.parseAs=
function(b,c){var d=a(c);return d.literal&&d.constant?d:function(a,c){return e.getTrusted(b,d(a,c))}};var g=e.parseAs,f=e.getTrusted,k=e.trustAs;q(fa,function(a,b){var c=L(b);e[Va("parse_as_"+c)]=function(b){return g(a,b)};e[Va("get_trusted_"+c)]=function(b){return f(a,b)};e[Va("trust_as_"+c)]=function(b){return k(a,b)}});return e}]}function be(){this.$get=["$window","$document",function(b,a){var c={},d=Z((/android (\d+)/.exec(L((b.navigator||{}).userAgent))||[])[1]),e=/Boxee/i.test((b.navigator||
{}).userAgent),g=a[0]||{},f=g.documentMode,k,m=/^(Moz|webkit|O|ms)(?=[A-Z])/,h=g.body&&g.body.style,l=!1,n=!1;if(h){for(var p in h)if(l=m.exec(p)){k=l[0];k=k.substr(0,1).toUpperCase()+k.substr(1);break}k||(k="WebkitOpacity"in h&&"webkit");l=!!("transition"in h||k+"Transition"in h);n=!!("animation"in h||k+"Animation"in h);!d||l&&n||(l=C(g.body.style.webkitTransition),n=C(g.body.style.webkitAnimation))}return{history:!(!b.history||!b.history.pushState||4>d||e),hashchange:"onhashchange"in b&&(!f||7<
f),hasEvent:function(a){if("input"==a&&9==S)return!1;if(D(c[a])){var b=g.createElement("div");c[a]="on"+a in b}return c[a]},csp:$b(),vendorPrefix:k,transitions:l,animations:n,android:d,msie:S,msieDocumentMode:f}}]}function de(){this.$get=["$rootScope","$browser","$q","$exceptionHandler",function(b,a,c,d){function e(e,k,m){var h=c.defer(),l=h.promise,n=B(m)&&!m;k=a.defer(function(){try{h.resolve(e())}catch(a){h.reject(a),d(a)}finally{delete g[l.$$timeoutId]}n||b.$apply()},k);l.$$timeoutId=k;g[k]=h;
return l}var g={};e.cancel=function(b){return b&&b.$$timeoutId in g?(g[b.$$timeoutId].reject("canceled"),delete g[b.$$timeoutId],a.defer.cancel(b.$$timeoutId)):!1};return e}]}function sa(b,a){var c=b;S&&(W.setAttribute("href",c),c=W.href);W.setAttribute("href",c);return{href:W.href,protocol:W.protocol?W.protocol.replace(/:$/,""):"",host:W.host,search:W.search?W.search.replace(/^\?/,""):"",hash:W.hash?W.hash.replace(/^#/,""):"",hostname:W.hostname,port:W.port,pathname:"/"===W.pathname.charAt(0)?W.pathname:
"/"+W.pathname}}function Mb(b){b=C(b)?sa(b):b;return b.protocol===Ic.protocol&&b.host===Ic.host}function ee(){this.$get=$(T)}function kc(b){function a(d,e){if(U(d)){var g={};q(d,function(b,c){g[c]=a(c,b)});return g}return b.factory(d+c,e)}var c="Filter";this.register=a;this.$get=["$injector",function(a){return function(b){return a.get(b+c)}}];a("currency",Jc);a("date",Kc);a("filter",Ce);a("json",De);a("limitTo",Ee);a("lowercase",Fe);a("number",Lc);a("orderBy",Mc);a("uppercase",Ge)}function Ce(){return function(b,
a,c){if(!O(b))return b;var d=typeof c,e=[];e.check=function(a){for(var b=0;b<e.length;b++)if(!e[b](a))return!1;return!0};"function"!==d&&(c="boolean"===d&&c?function(a,b){return Sa.equals(a,b)}:function(a,b){if(a&&b&&"object"===typeof a&&"object"===typeof b){for(var d in a)if("$"!==d.charAt(0)&&zb.call(a,d)&&c(a[d],b[d]))return!0;return!1}b=(""+b).toLowerCase();return-1<(""+a).toLowerCase().indexOf(b)});var g=function(a,b){if("string"==typeof b&&"!"===b.charAt(0))return!g(a,b.substr(1));switch(typeof a){case "boolean":case "number":case "string":return c(a,
b);case "object":switch(typeof b){case "object":return c(a,b);default:for(var d in a)if("$"!==d.charAt(0)&&g(a[d],b))return!0}return!1;case "array":for(d=0;d<a.length;d++)if(g(a[d],b))return!0;return!1;default:return!1}};switch(typeof a){case "boolean":case "number":case "string":a={$:a};case "object":for(var f in a)(function(b){"undefined"!=typeof a[b]&&e.push(function(c){return g("$"==b?c:c&&c[b],a[b])})})(f);break;case "function":e.push(a);break;default:return b}d=[];for(f=0;f<b.length;f++){var k=
b[f];e.check(k)&&d.push(k)}return d}}function Jc(b){var a=b.NUMBER_FORMATS;return function(b,d){D(d)&&(d=a.CURRENCY_SYM);return Nc(b,a.PATTERNS[1],a.GROUP_SEP,a.DECIMAL_SEP,2).replace(/\u00A4/g,d)}}function Lc(b){var a=b.NUMBER_FORMATS;return function(b,d){return Nc(b,a.PATTERNS[0],a.GROUP_SEP,a.DECIMAL_SEP,d)}}function Nc(b,a,c,d,e){if(null==b||!isFinite(b)||U(b))return"";var g=0>b;b=Math.abs(b);var f=b+"",k="",m=[],h=!1;if(-1!==f.indexOf("e")){var l=f.match(/([\d\.]+)e(-?)(\d+)/);l&&"-"==l[2]&&
l[3]>e+1?f="0":(k=f,h=!0)}if(h)0<e&&(-1<b&&1>b)&&(k=b.toFixed(e));else{f=(f.split(Oc)[1]||"").length;D(e)&&(e=Math.min(Math.max(a.minFrac,f),a.maxFrac));f=Math.pow(10,e+1);b=Math.floor(b*f+5)/f;b=(""+b).split(Oc);f=b[0];b=b[1]||"";var l=0,n=a.lgSize,p=a.gSize;if(f.length>=n+p)for(l=f.length-n,h=0;h<l;h++)0===(l-h)%p&&0!==h&&(k+=c),k+=f.charAt(h);for(h=l;h<f.length;h++)0===(f.length-h)%n&&0!==h&&(k+=c),k+=f.charAt(h);for(;b.length<e;)b+="0";e&&"0"!==e&&(k+=d+b.substr(0,e))}m.push(g?a.negPre:a.posPre);
m.push(k);m.push(g?a.negSuf:a.posSuf);return m.join("")}function Ub(b,a,c){var d="";0>b&&(d="-",b=-b);for(b=""+b;b.length<a;)b="0"+b;c&&(b=b.substr(b.length-a));return d+b}function Y(b,a,c,d){c=c||0;return function(e){e=e["get"+b]();if(0<c||e>-c)e+=c;0===e&&-12==c&&(e=12);return Ub(e,a,d)}}function sb(b,a){return function(c,d){var e=c["get"+b](),g=Ha(a?"SHORT"+b:b);return d[g][e]}}function Kc(b){function a(a){var b;if(b=a.match(c)){a=new Date(0);var g=0,f=0,k=b[8]?a.setUTCFullYear:a.setFullYear,m=
b[8]?a.setUTCHours:a.setHours;b[9]&&(g=Z(b[9]+b[10]),f=Z(b[9]+b[11]));k.call(a,Z(b[1]),Z(b[2])-1,Z(b[3]));g=Z(b[4]||0)-g;f=Z(b[5]||0)-f;k=Z(b[6]||0);b=Math.round(1E3*parseFloat("0."+(b[7]||0)));m.call(a,g,f,k,b)}return a}var c=/^(\d{4})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/;return function(c,e){var g="",f=[],k,m;e=e||"mediumDate";e=b.DATETIME_FORMATS[e]||e;C(c)&&(c=He.test(c)?Z(c):a(c));yb(c)&&(c=new Date(c));if(!Na(c))return c;for(;e;)(m=Ie.exec(e))?
(f=f.concat(ya.call(m,1)),e=f.pop()):(f.push(e),e=null);q(f,function(a){k=Je[a];g+=k?k(c,b.DATETIME_FORMATS):a.replace(/(^'|'$)/g,"").replace(/''/g,"'")});return g}}function De(){return function(b){return ra(b,!0)}}function Ee(){return function(b,a){if(!O(b)&&!C(b))return b;a=Infinity===Math.abs(Number(a))?Number(a):Z(a);if(C(b))return a?0<=a?b.slice(0,a):b.slice(a,b.length):"";var c=[],d,e;a>b.length?a=b.length:a<-b.length&&(a=-b.length);0<a?(d=0,e=a):(d=b.length+a,e=b.length);for(;d<e;d++)c.push(b[d]);
return c}}function Mc(b){return function(a,c,d){function e(a,b){return Ra(b)?function(b,c){return a(c,b)}:a}function g(a,b){var c=typeof a,d=typeof b;return c==d?("string"==c&&(a=a.toLowerCase(),b=b.toLowerCase()),a===b?0:a<b?-1:1):c<d?-1:1}if(!O(a)||!c)return a;c=O(c)?c:[c];c=Uc(c,function(a){var c=!1,d=a||Fa;if(C(a)){if("+"==a.charAt(0)||"-"==a.charAt(0))c="-"==a.charAt(0),a=a.substring(1);d=b(a);if(d.constant){var f=d();return e(function(a,b){return g(a[f],b[f])},c)}}return e(function(a,b){return g(d(a),
d(b))},c)});for(var f=[],k=0;k<a.length;k++)f.push(a[k]);return f.sort(e(function(a,b){for(var d=0;d<c.length;d++){var e=c[d](a,b);if(0!==e)return e}return 0},d))}}function va(b){Q(b)&&(b={link:b});b.restrict=b.restrict||"AC";return $(b)}function Pc(b,a,c,d){function e(a,c){c=c?"-"+hb(c,"-"):"";d.removeClass(b,(a?tb:ub)+c);d.addClass(b,(a?ub:tb)+c)}var g=this,f=b.parent().controller("form")||vb,k=0,m=g.$error={},h=[];g.$name=a.name||a.ngForm;g.$dirty=!1;g.$pristine=!0;g.$valid=!0;g.$invalid=!1;f.$addControl(g);
b.addClass(Ma);e(!0);g.$addControl=function(a){Aa(a.$name,"input");h.push(a);a.$name&&(g[a.$name]=a)};g.$removeControl=function(a){a.$name&&g[a.$name]===a&&delete g[a.$name];q(m,function(b,c){g.$setValidity(c,!0,a)});Pa(h,a)};g.$setValidity=function(a,b,c){var d=m[a];if(b)d&&(Pa(d,c),d.length||(k--,k||(e(b),g.$valid=!0,g.$invalid=!1),m[a]=!1,e(!0,a),f.$setValidity(a,!0,g)));else{k||e(b);if(d){if(-1!=Oa(d,c))return}else m[a]=d=[],k++,e(!1,a),f.$setValidity(a,!1,g);d.push(c);g.$valid=!1;g.$invalid=
!0}};g.$setDirty=function(){d.removeClass(b,Ma);d.addClass(b,wb);g.$dirty=!0;g.$pristine=!1;f.$setDirty()};g.$setPristine=function(){d.removeClass(b,wb);d.addClass(b,Ma);g.$dirty=!1;g.$pristine=!0;q(h,function(a){a.$setPristine()})}}function qa(b,a,c,d){b.$setValidity(a,c);return c?d:s}function Ke(b,a,c){var d=c.prop("validity");U(d)&&b.$parsers.push(function(c){if(b.$error[a]||!(d.badInput||d.customError||d.typeMismatch)||d.valueMissing)return c;b.$setValidity(a,!1)})}function xb(b,a,c,d,e,g){var f=
a.prop("validity"),k=a[0].placeholder,m={};if(!e.android){var h=!1;a.on("compositionstart",function(a){h=!0});a.on("compositionend",function(){h=!1;l()})}var l=function(e){if(!h){var g=a.val();if(S&&"input"===(e||m).type&&a[0].placeholder!==k)k=a[0].placeholder;else if(Ra(c.ngTrim||"T")&&(g=aa(g)),d.$viewValue!==g||f&&""===g&&!f.valueMissing)b.$$phase?d.$setViewValue(g):b.$apply(function(){d.$setViewValue(g)})}};if(e.hasEvent("input"))a.on("input",l);else{var n,p=function(){n||(n=g.defer(function(){l();
n=null}))};a.on("keydown",function(a){a=a.keyCode;91===a||(15<a&&19>a||37<=a&&40>=a)||p()});if(e.hasEvent("paste"))a.on("paste cut",p)}a.on("change",l);d.$render=function(){a.val(d.$isEmpty(d.$viewValue)?"":d.$viewValue)};var r=c.ngPattern;r&&((e=r.match(/^\/(.*)\/([gim]*)$/))?(r=RegExp(e[1],e[2]),e=function(a){return qa(d,"pattern",d.$isEmpty(a)||r.test(a),a)}):e=function(c){var e=b.$eval(r);if(!e||!e.test)throw t("ngPattern")("noregexp",r,e,ga(a));return qa(d,"pattern",d.$isEmpty(c)||e.test(c),
c)},d.$formatters.push(e),d.$parsers.push(e));if(c.ngMinlength){var v=Z(c.ngMinlength);e=function(a){return qa(d,"minlength",d.$isEmpty(a)||a.length>=v,a)};d.$parsers.push(e);d.$formatters.push(e)}if(c.ngMaxlength){var q=Z(c.ngMaxlength);e=function(a){return qa(d,"maxlength",d.$isEmpty(a)||a.length<=q,a)};d.$parsers.push(e);d.$formatters.push(e)}}function Vb(b,a){b="ngClass"+b;return["$animate",function(c){function d(a,b){var c=[],d=0;a:for(;d<a.length;d++){for(var e=a[d],l=0;l<b.length;l++)if(e==
b[l])continue a;c.push(e)}return c}function e(a){if(!O(a)){if(C(a))return a.split(" ");if(U(a)){var b=[];q(a,function(a,c){a&&(b=b.concat(c.split(" ")))});return b}}return a}return{restrict:"AC",link:function(g,f,k){function m(a,b){var c=f.data("$classCounts")||{},d=[];q(a,function(a){if(0<b||c[a])c[a]=(c[a]||0)+b,c[a]===+(0<b)&&d.push(a)});f.data("$classCounts",c);return d.join(" ")}function h(b){if(!0===a||g.$index%2===a){var h=e(b||[]);if(!l){var r=m(h,1);k.$addClass(r)}else if(!xa(b,l)){var q=
e(l),r=d(h,q),h=d(q,h),h=m(h,-1),r=m(r,1);0===r.length?c.removeClass(f,h):0===h.length?c.addClass(f,r):c.setClass(f,r,h)}}l=ka(b)}var l;g.$watch(k[b],h,!0);k.$observe("class",function(a){h(g.$eval(k[b]))});"ngClass"!==b&&g.$watch("$index",function(c,d){var f=c&1;if(f!==(d&1)){var h=e(g.$eval(k[b]));f===a?(f=m(h,1),k.$addClass(f)):(f=m(h,-1),k.$removeClass(f))}})}}}]}var L=function(b){return C(b)?b.toLowerCase():b},zb=Object.prototype.hasOwnProperty,Ha=function(b){return C(b)?b.toUpperCase():b},S,
w,Ba,ya=[].slice,Le=[].push,wa=Object.prototype.toString,Qa=t("ng"),Sa=T.angular||(T.angular={}),Ua,La,ja=["0","0","0"];S=Z((/msie (\d+)/.exec(L(navigator.userAgent))||[])[1]);isNaN(S)&&(S=Z((/trident\/.*; rv:(\d+)/.exec(L(navigator.userAgent))||[])[1]));y.$inject=[];Fa.$inject=[];var O=function(){return Q(Array.isArray)?Array.isArray:function(b){return"[object Array]"===wa.call(b)}}(),aa=function(){return String.prototype.trim?function(b){return C(b)?b.trim():b}:function(b){return C(b)?b.replace(/^\s\s*/,
"").replace(/\s\s*$/,""):b}}();La=9>S?function(b){b=b.nodeName?b:b[0];return b.scopeName&&"HTML"!=b.scopeName?Ha(b.scopeName+":"+b.nodeName):b.nodeName}:function(b){return b.nodeName?b.nodeName:b[0].nodeName};var Xc=/[A-Z]/g,$c={full:"1.2.18",major:1,minor:2,dot:18,codeName:"ear-extendability"},Xa=R.cache={},ib=R.expando="ng"+(new Date).getTime(),me=1,pb=T.document.addEventListener?function(b,a,c){b.addEventListener(a,c,!1)}:function(b,a,c){b.attachEvent("on"+a,c)},Wa=T.document.removeEventListener?
function(b,a,c){b.removeEventListener(a,c,!1)}:function(b,a,c){b.detachEvent("on"+a,c)};R._data=function(b){return this.cache[b[this.expando]]||{}};var he=/([\:\-\_]+(.))/g,ie=/^moz([A-Z])/,Gb=t("jqLite"),je=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,Hb=/<|&#?\w+;/,ke=/<([\w:]+)/,le=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,da={option:[1,'<select multiple="multiple">',"</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>",
"</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};da.optgroup=da.option;da.tbody=da.tfoot=da.colgroup=da.caption=da.thead;da.th=da.td;var Ka=R.prototype={ready:function(b){function a(){c||(c=!0,b())}var c=!1;"complete"===V.readyState?setTimeout(a):(this.on("DOMContentLoaded",a),R(T).on("load",a))},toString:function(){var b=[];q(this,function(a){b.push(""+a)});return"["+b.join(", ")+"]"},eq:function(b){return 0<=b?w(this[b]):w(this[this.length+b])},length:0,
push:Le,sort:[].sort,splice:[].splice},mb={};q("multiple selected checked disabled readOnly required open".split(" "),function(b){mb[L(b)]=b});var rc={};q("input select option textarea button form details".split(" "),function(b){rc[Ha(b)]=!0});q({data:nc,inheritedData:lb,scope:function(b){return w(b).data("$scope")||lb(b.parentNode||b,["$isolateScope","$scope"])},isolateScope:function(b){return w(b).data("$isolateScope")||w(b).data("$isolateScopeNoTemplate")},controller:oc,injector:function(b){return lb(b,
"$injector")},removeAttr:function(b,a){b.removeAttribute(a)},hasClass:Kb,css:function(b,a,c){a=Va(a);if(B(c))b.style[a]=c;else{var d;8>=S&&(d=b.currentStyle&&b.currentStyle[a],""===d&&(d="auto"));d=d||b.style[a];8>=S&&(d=""===d?s:d);return d}},attr:function(b,a,c){var d=L(a);if(mb[d])if(B(c))c?(b[a]=!0,b.setAttribute(a,d)):(b[a]=!1,b.removeAttribute(d));else return b[a]||(b.attributes.getNamedItem(a)||y).specified?d:s;else if(B(c))b.setAttribute(a,c);else if(b.getAttribute)return b=b.getAttribute(a,
2),null===b?s:b},prop:function(b,a,c){if(B(c))b[a]=c;else return b[a]},text:function(){function b(b,d){var e=a[b.nodeType];if(D(d))return e?b[e]:"";b[e]=d}var a=[];9>S?(a[1]="innerText",a[3]="nodeValue"):a[1]=a[3]="textContent";b.$dv="";return b}(),val:function(b,a){if(D(a)){if("SELECT"===La(b)&&b.multiple){var c=[];q(b.options,function(a){a.selected&&c.push(a.value||a.text)});return 0===c.length?null:c}return b.value}b.value=a},html:function(b,a){if(D(a))return b.innerHTML;for(var c=0,d=b.childNodes;c<
d.length;c++)Ia(d[c]);b.innerHTML=a},empty:pc},function(b,a){R.prototype[a]=function(a,d){var e,g,f=this.length;if(b!==pc&&(2==b.length&&b!==Kb&&b!==oc?a:d)===s){if(U(a)){for(e=0;e<f;e++)if(b===nc)b(this[e],a);else for(g in a)b(this[e],g,a[g]);return this}e=b.$dv;f=e===s?Math.min(f,1):f;for(g=0;g<f;g++){var k=b(this[g],a,d);e=e?e+k:k}return e}for(e=0;e<f;e++)b(this[e],a,d);return this}});q({removeData:lc,dealoc:Ia,on:function a(c,d,e,g){if(B(g))throw Gb("onargs");var f=la(c,"events"),k=la(c,"handle");
f||la(c,"events",f={});k||la(c,"handle",k=ne(c,f));q(d.split(" "),function(d){var g=f[d];if(!g){if("mouseenter"==d||"mouseleave"==d){var l=V.body.contains||V.body.compareDocumentPosition?function(a,c){var d=9===a.nodeType?a.documentElement:a,e=c&&c.parentNode;return a===e||!!(e&&1===e.nodeType&&(d.contains?d.contains(e):a.compareDocumentPosition&&a.compareDocumentPosition(e)&16))}:function(a,c){if(c)for(;c=c.parentNode;)if(c===a)return!0;return!1};f[d]=[];a(c,{mouseleave:"mouseout",mouseenter:"mouseover"}[d],
function(a){var c=a.relatedTarget;c&&(c===this||l(this,c))||k(a,d)})}else pb(c,d,k),f[d]=[];g=f[d]}g.push(e)})},off:mc,one:function(a,c,d){a=w(a);a.on(c,function g(){a.off(c,d);a.off(c,g)});a.on(c,d)},replaceWith:function(a,c){var d,e=a.parentNode;Ia(a);q(new R(c),function(c){d?e.insertBefore(c,d.nextSibling):e.replaceChild(c,a);d=c})},children:function(a){var c=[];q(a.childNodes,function(a){1===a.nodeType&&c.push(a)});return c},contents:function(a){return a.contentDocument||a.childNodes||[]},append:function(a,
c){q(new R(c),function(c){1!==a.nodeType&&11!==a.nodeType||a.appendChild(c)})},prepend:function(a,c){if(1===a.nodeType){var d=a.firstChild;q(new R(c),function(c){a.insertBefore(c,d)})}},wrap:function(a,c){c=w(c)[0];var d=a.parentNode;d&&d.replaceChild(c,a);c.appendChild(a)},remove:function(a){Ia(a);var c=a.parentNode;c&&c.removeChild(a)},after:function(a,c){var d=a,e=a.parentNode;q(new R(c),function(a){e.insertBefore(a,d.nextSibling);d=a})},addClass:kb,removeClass:jb,toggleClass:function(a,c,d){c&&
q(c.split(" "),function(c){var g=d;D(g)&&(g=!Kb(a,c));(g?kb:jb)(a,c)})},parent:function(a){return(a=a.parentNode)&&11!==a.nodeType?a:null},next:function(a){if(a.nextElementSibling)return a.nextElementSibling;for(a=a.nextSibling;null!=a&&1!==a.nodeType;)a=a.nextSibling;return a},find:function(a,c){return a.getElementsByTagName?a.getElementsByTagName(c):[]},clone:Jb,triggerHandler:function(a,c,d){c=(la(a,"events")||{})[c];d=d||[];var e=[{preventDefault:y,stopPropagation:y}];q(c,function(c){c.apply(a,
e.concat(d))})}},function(a,c){R.prototype[c]=function(c,e,g){for(var f,k=0;k<this.length;k++)D(f)?(f=a(this[k],c,e,g),B(f)&&(f=w(f))):Ib(f,a(this[k],c,e,g));return B(f)?f:this};R.prototype.bind=R.prototype.on;R.prototype.unbind=R.prototype.off});Ya.prototype={put:function(a,c){this[Ja(a)]=c},get:function(a){return this[Ja(a)]},remove:function(a){var c=this[a=Ja(a)];delete this[a];return c}};var pe=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,qe=/,/,re=/^\s*(_?)(\S+?)\1\s*$/,oe=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/mg,
Za=t("$injector"),Me=t("$animate"),Ld=["$provide",function(a){this.$$selectors={};this.register=function(c,d){var e=c+"-animation";if(c&&"."!=c.charAt(0))throw Me("notcsel",c);this.$$selectors[c.substr(1)]=e;a.factory(e,d)};this.classNameFilter=function(a){1===arguments.length&&(this.$$classNameFilter=a instanceof RegExp?a:null);return this.$$classNameFilter};this.$get=["$timeout","$$asyncCallback",function(a,d){return{enter:function(a,c,f,k){f?f.after(a):(c&&c[0]||(c=f.parent()),c.append(a));k&&
d(k)},leave:function(a,c){a.remove();c&&d(c)},move:function(a,c,d,k){this.enter(a,c,d,k)},addClass:function(a,c,f){c=C(c)?c:O(c)?c.join(" "):"";q(a,function(a){kb(a,c)});f&&d(f)},removeClass:function(a,c,f){c=C(c)?c:O(c)?c.join(" "):"";q(a,function(a){jb(a,c)});f&&d(f)},setClass:function(a,c,f,k){q(a,function(a){kb(a,c);jb(a,f)});k&&d(k)},enabled:y}}]}],ia=t("$compile");gc.$inject=["$provide","$$sanitizeUriProvider"];var ue=/^(x[\:\-_]|data[\:\-_])/i,zc=t("$interpolate"),Ne=/^([^\?#]*)(\?([^#]*))?(#(.*))?$/,
xe={http:80,https:443,ftp:21},Pb=t("$location");Rb.prototype=Qb.prototype=Cc.prototype={$$html5:!1,$$replace:!1,absUrl:qb("$$absUrl"),url:function(a,c){if(D(a))return this.$$url;var d=Ne.exec(a);d[1]&&this.path(decodeURIComponent(d[1]));(d[2]||d[1])&&this.search(d[3]||"");this.hash(d[5]||"",c);return this},protocol:qb("$$protocol"),host:qb("$$host"),port:qb("$$port"),path:Dc("$$path",function(a){return"/"==a.charAt(0)?a:"/"+a}),search:function(a,c){switch(arguments.length){case 0:return this.$$search;
case 1:if(C(a))this.$$search=cc(a);else if(U(a))this.$$search=a;else throw Pb("isrcharg");break;default:D(c)||null===c?delete this.$$search[a]:this.$$search[a]=c}this.$$compose();return this},hash:Dc("$$hash",Fa),replace:function(){this.$$replace=!0;return this}};var Da=t("$parse"),Gc={},ta,cb={"null":function(){return null},"true":function(){return!0},"false":function(){return!1},undefined:y,"+":function(a,c,d,e){d=d(a,c);e=e(a,c);return B(d)?B(e)?d+e:d:B(e)?e:s},"-":function(a,c,d,e){d=d(a,c);e=
e(a,c);return(B(d)?d:0)-(B(e)?e:0)},"*":function(a,c,d,e){return d(a,c)*e(a,c)},"/":function(a,c,d,e){return d(a,c)/e(a,c)},"%":function(a,c,d,e){return d(a,c)%e(a,c)},"^":function(a,c,d,e){return d(a,c)^e(a,c)},"=":y,"===":function(a,c,d,e){return d(a,c)===e(a,c)},"!==":function(a,c,d,e){return d(a,c)!==e(a,c)},"==":function(a,c,d,e){return d(a,c)==e(a,c)},"!=":function(a,c,d,e){return d(a,c)!=e(a,c)},"<":function(a,c,d,e){return d(a,c)<e(a,c)},">":function(a,c,d,e){return d(a,c)>e(a,c)},"<=":function(a,
c,d,e){return d(a,c)<=e(a,c)},">=":function(a,c,d,e){return d(a,c)>=e(a,c)},"&&":function(a,c,d,e){return d(a,c)&&e(a,c)},"||":function(a,c,d,e){return d(a,c)||e(a,c)},"&":function(a,c,d,e){return d(a,c)&e(a,c)},"|":function(a,c,d,e){return e(a,c)(a,c,d(a,c))},"!":function(a,c,d){return!d(a,c)}},Oe={n:"\n",f:"\f",r:"\r",t:"\t",v:"\v","'":"'",'"':'"'},Tb=function(a){this.options=a};Tb.prototype={constructor:Tb,lex:function(a){this.text=a;this.index=0;this.ch=s;this.lastCh=":";for(this.tokens=[];this.index<
this.text.length;){this.ch=this.text.charAt(this.index);if(this.is("\"'"))this.readString(this.ch);else if(this.isNumber(this.ch)||this.is(".")&&this.isNumber(this.peek()))this.readNumber();else if(this.isIdent(this.ch))this.readIdent();else if(this.is("(){}[].,;:?"))this.tokens.push({index:this.index,text:this.ch}),this.index++;else if(this.isWhitespace(this.ch)){this.index++;continue}else{a=this.ch+this.peek();var c=a+this.peek(2),d=cb[this.ch],e=cb[a],g=cb[c];g?(this.tokens.push({index:this.index,
text:c,fn:g}),this.index+=3):e?(this.tokens.push({index:this.index,text:a,fn:e}),this.index+=2):d?(this.tokens.push({index:this.index,text:this.ch,fn:d}),this.index+=1):this.throwError("Unexpected next character ",this.index,this.index+1)}this.lastCh=this.ch}return this.tokens},is:function(a){return-1!==a.indexOf(this.ch)},was:function(a){return-1!==a.indexOf(this.lastCh)},peek:function(a){a=a||1;return this.index+a<this.text.length?this.text.charAt(this.index+a):!1},isNumber:function(a){return"0"<=
a&&"9">=a},isWhitespace:function(a){return" "===a||"\r"===a||"\t"===a||"\n"===a||"\v"===a||"\u00a0"===a},isIdent:function(a){return"a"<=a&&"z">=a||"A"<=a&&"Z">=a||"_"===a||"$"===a},isExpOperator:function(a){return"-"===a||"+"===a||this.isNumber(a)},throwError:function(a,c,d){d=d||this.index;c=B(c)?"s "+c+"-"+this.index+" ["+this.text.substring(c,d)+"]":" "+d;throw Da("lexerr",a,c,this.text);},readNumber:function(){for(var a="",c=this.index;this.index<this.text.length;){var d=L(this.text.charAt(this.index));
if("."==d||this.isNumber(d))a+=d;else{var e=this.peek();if("e"==d&&this.isExpOperator(e))a+=d;else if(this.isExpOperator(d)&&e&&this.isNumber(e)&&"e"==a.charAt(a.length-1))a+=d;else if(!this.isExpOperator(d)||e&&this.isNumber(e)||"e"!=a.charAt(a.length-1))break;else this.throwError("Invalid exponent")}this.index++}a*=1;this.tokens.push({index:c,text:a,literal:!0,constant:!0,fn:function(){return a}})},readIdent:function(){for(var a=this,c="",d=this.index,e,g,f,k;this.index<this.text.length;){k=this.text.charAt(this.index);
if("."===k||this.isIdent(k)||this.isNumber(k))"."===k&&(e=this.index),c+=k;else break;this.index++}if(e)for(g=this.index;g<this.text.length;){k=this.text.charAt(g);if("("===k){f=c.substr(e-d+1);c=c.substr(0,e-d);this.index=g;break}if(this.isWhitespace(k))g++;else break}d={index:d,text:c};if(cb.hasOwnProperty(c))d.fn=cb[c],d.literal=!0,d.constant=!0;else{var m=Fc(c,this.options,this.text);d.fn=J(function(a,c){return m(a,c)},{assign:function(d,e){return rb(d,c,e,a.text,a.options)}})}this.tokens.push(d);
f&&(this.tokens.push({index:e,text:"."}),this.tokens.push({index:e+1,text:f}))},readString:function(a){var c=this.index;this.index++;for(var d="",e=a,g=!1;this.index<this.text.length;){var f=this.text.charAt(this.index),e=e+f;if(g)"u"===f?(f=this.text.substring(this.index+1,this.index+5),f.match(/[\da-f]{4}/i)||this.throwError("Invalid unicode escape [\\u"+f+"]"),this.index+=4,d+=String.fromCharCode(parseInt(f,16))):d=(g=Oe[f])?d+g:d+f,g=!1;else if("\\"===f)g=!0;else{if(f===a){this.index++;this.tokens.push({index:c,
text:e,string:d,literal:!0,constant:!0,fn:function(){return d}});return}d+=f}this.index++}this.throwError("Unterminated quote",c)}};var bb=function(a,c,d){this.lexer=a;this.$filter=c;this.options=d};bb.ZERO=J(function(){return 0},{constant:!0});bb.prototype={constructor:bb,parse:function(a){this.text=a;this.tokens=this.lexer.lex(a);a=this.statements();0!==this.tokens.length&&this.throwError("is an unexpected token",this.tokens[0]);a.literal=!!a.literal;a.constant=!!a.constant;return a},primary:function(){var a;
if(this.expect("("))a=this.filterChain(),this.consume(")");else if(this.expect("["))a=this.arrayDeclaration();else if(this.expect("{"))a=this.object();else{var c=this.expect();(a=c.fn)||this.throwError("not a primary expression",c);a.literal=!!c.literal;a.constant=!!c.constant}for(var d;c=this.expect("(","[",".");)"("===c.text?(a=this.functionCall(a,d),d=null):"["===c.text?(d=a,a=this.objectIndex(a)):"."===c.text?(d=a,a=this.fieldAccess(a)):this.throwError("IMPOSSIBLE");return a},throwError:function(a,
c){throw Da("syntax",c.text,a,c.index+1,this.text,this.text.substring(c.index));},peekToken:function(){if(0===this.tokens.length)throw Da("ueoe",this.text);return this.tokens[0]},peek:function(a,c,d,e){if(0<this.tokens.length){var g=this.tokens[0],f=g.text;if(f===a||f===c||f===d||f===e||!(a||c||d||e))return g}return!1},expect:function(a,c,d,e){return(a=this.peek(a,c,d,e))?(this.tokens.shift(),a):!1},consume:function(a){this.expect(a)||this.throwError("is unexpected, expecting ["+a+"]",this.peek())},
unaryFn:function(a,c){return J(function(d,e){return a(d,e,c)},{constant:c.constant})},ternaryFn:function(a,c,d){return J(function(e,g){return a(e,g)?c(e,g):d(e,g)},{constant:a.constant&&c.constant&&d.constant})},binaryFn:function(a,c,d){return J(function(e,g){return c(e,g,a,d)},{constant:a.constant&&d.constant})},statements:function(){for(var a=[];;)if(0<this.tokens.length&&!this.peek("}",")",";","]")&&a.push(this.filterChain()),!this.expect(";"))return 1===a.length?a[0]:function(c,d){for(var e,g=
0;g<a.length;g++){var f=a[g];f&&(e=f(c,d))}return e}},filterChain:function(){for(var a=this.expression(),c;;)if(c=this.expect("|"))a=this.binaryFn(a,c.fn,this.filter());else return a},filter:function(){for(var a=this.expect(),c=this.$filter(a.text),d=[];;)if(a=this.expect(":"))d.push(this.expression());else{var e=function(a,e,k){k=[k];for(var m=0;m<d.length;m++)k.push(d[m](a,e));return c.apply(a,k)};return function(){return e}}},expression:function(){return this.assignment()},assignment:function(){var a=
this.ternary(),c,d;return(d=this.expect("="))?(a.assign||this.throwError("implies assignment but ["+this.text.substring(0,d.index)+"] can not be assigned to",d),c=this.ternary(),function(d,g){return a.assign(d,c(d,g),g)}):a},ternary:function(){var a=this.logicalOR(),c,d;if(this.expect("?")){c=this.ternary();if(d=this.expect(":"))return this.ternaryFn(a,c,this.ternary());this.throwError("expected :",d)}else return a},logicalOR:function(){for(var a=this.logicalAND(),c;;)if(c=this.expect("||"))a=this.binaryFn(a,
c.fn,this.logicalAND());else return a},logicalAND:function(){var a=this.equality(),c;if(c=this.expect("&&"))a=this.binaryFn(a,c.fn,this.logicalAND());return a},equality:function(){var a=this.relational(),c;if(c=this.expect("==","!=","===","!=="))a=this.binaryFn(a,c.fn,this.equality());return a},relational:function(){var a=this.additive(),c;if(c=this.expect("<",">","<=",">="))a=this.binaryFn(a,c.fn,this.relational());return a},additive:function(){for(var a=this.multiplicative(),c;c=this.expect("+",
"-");)a=this.binaryFn(a,c.fn,this.multiplicative());return a},multiplicative:function(){for(var a=this.unary(),c;c=this.expect("*","/","%");)a=this.binaryFn(a,c.fn,this.unary());return a},unary:function(){var a;return this.expect("+")?this.primary():(a=this.expect("-"))?this.binaryFn(bb.ZERO,a.fn,this.unary()):(a=this.expect("!"))?this.unaryFn(a.fn,this.unary()):this.primary()},fieldAccess:function(a){var c=this,d=this.expect().text,e=Fc(d,this.options,this.text);return J(function(c,d,k){return e(k||
a(c,d))},{assign:function(e,f,k){return rb(a(e,k),d,f,c.text,c.options)}})},objectIndex:function(a){var c=this,d=this.expression();this.consume("]");return J(function(e,g){var f=a(e,g),k=d(e,g),m;if(!f)return s;(f=ab(f[k],c.text))&&(f.then&&c.options.unwrapPromises)&&(m=f,"$$v"in f||(m.$$v=s,m.then(function(a){m.$$v=a})),f=f.$$v);return f},{assign:function(e,g,f){var k=d(e,f);return ab(a(e,f),c.text)[k]=g}})},functionCall:function(a,c){var d=[];if(")"!==this.peekToken().text){do d.push(this.expression());
while(this.expect(","))}this.consume(")");var e=this;return function(g,f){for(var k=[],m=c?c(g,f):g,h=0;h<d.length;h++)k.push(d[h](g,f));h=a(g,f,m)||y;ab(m,e.text);ab(h,e.text);k=h.apply?h.apply(m,k):h(k[0],k[1],k[2],k[3],k[4]);return ab(k,e.text)}},arrayDeclaration:function(){var a=[],c=!0;if("]"!==this.peekToken().text){do{if(this.peek("]"))break;var d=this.expression();a.push(d);d.constant||(c=!1)}while(this.expect(","))}this.consume("]");return J(function(c,d){for(var f=[],k=0;k<a.length;k++)f.push(a[k](c,
d));return f},{literal:!0,constant:c})},object:function(){var a=[],c=!0;if("}"!==this.peekToken().text){do{if(this.peek("}"))break;var d=this.expect(),d=d.string||d.text;this.consume(":");var e=this.expression();a.push({key:d,value:e});e.constant||(c=!1)}while(this.expect(","))}this.consume("}");return J(function(c,d){for(var e={},m=0;m<a.length;m++){var h=a[m];e[h.key]=h.value(c,d)}return e},{literal:!0,constant:c})}};var Sb={},ua=t("$sce"),fa={HTML:"html",CSS:"css",URL:"url",RESOURCE_URL:"resourceUrl",
JS:"js"},W=V.createElement("a"),Ic=sa(T.location.href,!0);kc.$inject=["$provide"];Jc.$inject=["$locale"];Lc.$inject=["$locale"];var Oc=".",Je={yyyy:Y("FullYear",4),yy:Y("FullYear",2,0,!0),y:Y("FullYear",1),MMMM:sb("Month"),MMM:sb("Month",!0),MM:Y("Month",2,1),M:Y("Month",1,1),dd:Y("Date",2),d:Y("Date",1),HH:Y("Hours",2),H:Y("Hours",1),hh:Y("Hours",2,-12),h:Y("Hours",1,-12),mm:Y("Minutes",2),m:Y("Minutes",1),ss:Y("Seconds",2),s:Y("Seconds",1),sss:Y("Milliseconds",3),EEEE:sb("Day"),EEE:sb("Day",!0),
a:function(a,c){return 12>a.getHours()?c.AMPMS[0]:c.AMPMS[1]},Z:function(a){a=-1*a.getTimezoneOffset();return a=(0<=a?"+":"")+(Ub(Math[0<a?"floor":"ceil"](a/60),2)+Ub(Math.abs(a%60),2))}},Ie=/((?:[^yMdHhmsaZE']+)|(?:'(?:[^']|'')*')|(?:E+|y+|M+|d+|H+|h+|m+|s+|a|Z))(.*)/,He=/^\-?\d+$/;Kc.$inject=["$locale"];var Fe=$(L),Ge=$(Ha);Mc.$inject=["$parse"];var cd=$({restrict:"E",compile:function(a,c){8>=S&&(c.href||c.name||c.$set("href",""),a.append(V.createComment("IE fix")));if(!c.href&&!c.xlinkHref&&!c.name)return function(a,
c){var g="[object SVGAnimatedString]"===wa.call(c.prop("href"))?"xlink:href":"href";c.on("click",function(a){c.attr(g)||a.preventDefault()})}}}),Eb={};q(mb,function(a,c){if("multiple"!=a){var d=ma("ng-"+c);Eb[d]=function(){return{priority:100,link:function(a,g,f){a.$watch(f[d],function(a){f.$set(c,!!a)})}}}}});q(["src","srcset","href"],function(a){var c=ma("ng-"+a);Eb[c]=function(){return{priority:99,link:function(d,e,g){var f=a,k=a;"href"===a&&"[object SVGAnimatedString]"===wa.call(e.prop("href"))&&
(k="xlinkHref",g.$attr[k]="xlink:href",f=null);g.$observe(c,function(a){a&&(g.$set(k,a),S&&f&&e.prop(f,g[k]))})}}}});var vb={$addControl:y,$removeControl:y,$setValidity:y,$setDirty:y,$setPristine:y};Pc.$inject=["$element","$attrs","$scope","$animate"];var Qc=function(a){return["$timeout",function(c){return{name:"form",restrict:a?"EAC":"E",controller:Pc,compile:function(){return{pre:function(a,e,g,f){if(!g.action){var k=function(a){a.preventDefault?a.preventDefault():a.returnValue=!1};pb(e[0],"submit",
k);e.on("$destroy",function(){c(function(){Wa(e[0],"submit",k)},0,!1)})}var m=e.parent().controller("form"),h=g.name||g.ngForm;h&&rb(a,h,f,h);if(m)e.on("$destroy",function(){m.$removeControl(f);h&&rb(a,h,s,h);J(f,vb)})}}}}}]},dd=Qc(),qd=Qc(!0),Pe=/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/,Qe=/^[a-z0-9!#$%&'*+/=?^_`{|}~.-]+@[a-z0-9-]+(\.[a-z0-9-]+)*$/i,Re=/^\s*(\-|\+)?(\d+|(\d*(\.\d*)))\s*$/,Rc={text:xb,number:function(a,c,d,e,g,f){xb(a,c,d,e,g,f);e.$parsers.push(function(a){var c=
e.$isEmpty(a);if(c||Re.test(a))return e.$setValidity("number",!0),""===a?null:c?a:parseFloat(a);e.$setValidity("number",!1);return s});Ke(e,"number",c);e.$formatters.push(function(a){return e.$isEmpty(a)?"":""+a});d.min&&(a=function(a){var c=parseFloat(d.min);return qa(e,"min",e.$isEmpty(a)||a>=c,a)},e.$parsers.push(a),e.$formatters.push(a));d.max&&(a=function(a){var c=parseFloat(d.max);return qa(e,"max",e.$isEmpty(a)||a<=c,a)},e.$parsers.push(a),e.$formatters.push(a));e.$formatters.push(function(a){return qa(e,
"number",e.$isEmpty(a)||yb(a),a)})},url:function(a,c,d,e,g,f){xb(a,c,d,e,g,f);a=function(a){return qa(e,"url",e.$isEmpty(a)||Pe.test(a),a)};e.$formatters.push(a);e.$parsers.push(a)},email:function(a,c,d,e,g,f){xb(a,c,d,e,g,f);a=function(a){return qa(e,"email",e.$isEmpty(a)||Qe.test(a),a)};e.$formatters.push(a);e.$parsers.push(a)},radio:function(a,c,d,e){D(d.name)&&c.attr("name",eb());c.on("click",function(){c[0].checked&&a.$apply(function(){e.$setViewValue(d.value)})});e.$render=function(){c[0].checked=
d.value==e.$viewValue};d.$observe("value",e.$render)},checkbox:function(a,c,d,e){var g=d.ngTrueValue,f=d.ngFalseValue;C(g)||(g=!0);C(f)||(f=!1);c.on("click",function(){a.$apply(function(){e.$setViewValue(c[0].checked)})});e.$render=function(){c[0].checked=e.$viewValue};e.$isEmpty=function(a){return a!==g};e.$formatters.push(function(a){return a===g});e.$parsers.push(function(a){return a?g:f})},hidden:y,button:y,submit:y,reset:y,file:y},hc=["$browser","$sniffer",function(a,c){return{restrict:"E",require:"?ngModel",
link:function(d,e,g,f){f&&(Rc[L(g.type)]||Rc.text)(d,e,g,f,c,a)}}}],ub="ng-valid",tb="ng-invalid",Ma="ng-pristine",wb="ng-dirty",Se=["$scope","$exceptionHandler","$attrs","$element","$parse","$animate",function(a,c,d,e,g,f){function k(a,c){c=c?"-"+hb(c,"-"):"";f.removeClass(e,(a?tb:ub)+c);f.addClass(e,(a?ub:tb)+c)}this.$modelValue=this.$viewValue=Number.NaN;this.$parsers=[];this.$formatters=[];this.$viewChangeListeners=[];this.$pristine=!0;this.$dirty=!1;this.$valid=!0;this.$invalid=!1;this.$name=
d.name;var m=g(d.ngModel),h=m.assign;if(!h)throw t("ngModel")("nonassign",d.ngModel,ga(e));this.$render=y;this.$isEmpty=function(a){return D(a)||""===a||null===a||a!==a};var l=e.inheritedData("$formController")||vb,n=0,p=this.$error={};e.addClass(Ma);k(!0);this.$setValidity=function(a,c){p[a]!==!c&&(c?(p[a]&&n--,n||(k(!0),this.$valid=!0,this.$invalid=!1)):(k(!1),this.$invalid=!0,this.$valid=!1,n++),p[a]=!c,k(c,a),l.$setValidity(a,c,this))};this.$setPristine=function(){this.$dirty=!1;this.$pristine=
!0;f.removeClass(e,wb);f.addClass(e,Ma)};this.$setViewValue=function(d){this.$viewValue=d;this.$pristine&&(this.$dirty=!0,this.$pristine=!1,f.removeClass(e,Ma),f.addClass(e,wb),l.$setDirty());q(this.$parsers,function(a){d=a(d)});this.$modelValue!==d&&(this.$modelValue=d,h(a,d),q(this.$viewChangeListeners,function(a){try{a()}catch(d){c(d)}}))};var r=this;a.$watch(function(){var c=m(a);if(r.$modelValue!==c){var d=r.$formatters,e=d.length;for(r.$modelValue=c;e--;)c=d[e](c);r.$viewValue!==c&&(r.$viewValue=
c,r.$render())}return c})}],Fd=function(){return{require:["ngModel","^?form"],controller:Se,link:function(a,c,d,e){var g=e[0],f=e[1]||vb;f.$addControl(g);a.$on("$destroy",function(){f.$removeControl(g)})}}},Hd=$({require:"ngModel",link:function(a,c,d,e){e.$viewChangeListeners.push(function(){a.$eval(d.ngChange)})}}),ic=function(){return{require:"?ngModel",link:function(a,c,d,e){if(e){d.required=!0;var g=function(a){if(d.required&&e.$isEmpty(a))e.$setValidity("required",!1);else return e.$setValidity("required",
!0),a};e.$formatters.push(g);e.$parsers.unshift(g);d.$observe("required",function(){g(e.$viewValue)})}}}},Gd=function(){return{require:"ngModel",link:function(a,c,d,e){var g=(a=/\/(.*)\//.exec(d.ngList))&&RegExp(a[1])||d.ngList||",";e.$parsers.push(function(a){if(!D(a)){var c=[];a&&q(a.split(g),function(a){a&&c.push(aa(a))});return c}});e.$formatters.push(function(a){return O(a)?a.join(", "):s});e.$isEmpty=function(a){return!a||!a.length}}}},Te=/^(true|false|\d+)$/,Id=function(){return{priority:100,
compile:function(a,c){return Te.test(c.ngValue)?function(a,c,g){g.$set("value",a.$eval(g.ngValue))}:function(a,c,g){a.$watch(g.ngValue,function(a){g.$set("value",a)})}}}},id=va({compile:function(a){a.addClass("ng-binding");return function(a,d,e){d.data("$binding",e.ngBind);a.$watch(e.ngBind,function(a){d.text(a==s?"":a)})}}}),kd=["$interpolate",function(a){return function(c,d,e){c=a(d.attr(e.$attr.ngBindTemplate));d.addClass("ng-binding").data("$binding",c);e.$observe("ngBindTemplate",function(a){d.text(a)})}}],
jd=["$sce","$parse",function(a,c){return function(d,e,g){e.addClass("ng-binding").data("$binding",g.ngBindHtml);var f=c(g.ngBindHtml);d.$watch(function(){return(f(d)||"").toString()},function(c){e.html(a.getTrustedHtml(f(d))||"")})}}],ld=Vb("",!0),nd=Vb("Odd",0),md=Vb("Even",1),od=va({compile:function(a,c){c.$set("ngCloak",s);a.removeClass("ng-cloak")}}),pd=[function(){return{scope:!0,controller:"@",priority:500}}],jc={};q("click dblclick mousedown mouseup mouseover mouseout mousemove mouseenter mouseleave keydown keyup keypress submit focus blur copy cut paste".split(" "),
function(a){var c=ma("ng-"+a);jc[c]=["$parse",function(d){return{compile:function(e,g){var f=d(g[c]);return function(c,d){d.on(L(a),function(a){c.$apply(function(){f(c,{$event:a})})})}}}}]});var sd=["$animate",function(a){return{transclude:"element",priority:600,terminal:!0,restrict:"A",$$tlb:!0,link:function(c,d,e,g,f){var k,m,h;c.$watch(e.ngIf,function(g){Ra(g)?m||(m=c.$new(),f(m,function(c){c[c.length++]=V.createComment(" end ngIf: "+e.ngIf+" ");k={clone:c};a.enter(c,d.parent(),d)})):(h&&(h.remove(),
h=null),m&&(m.$destroy(),m=null),k&&(h=Db(k.clone),a.leave(h,function(){h=null}),k=null))})}}}],td=["$http","$templateCache","$anchorScroll","$animate","$sce",function(a,c,d,e,g){return{restrict:"ECA",priority:400,terminal:!0,transclude:"element",controller:Sa.noop,compile:function(f,k){var m=k.ngInclude||k.src,h=k.onload||"",l=k.autoscroll;return function(f,k,r,q,I){var s=0,u,w,F,z=function(){w&&(w.remove(),w=null);u&&(u.$destroy(),u=null);F&&(e.leave(F,function(){w=null}),w=F,F=null)};f.$watch(g.parseAsResourceUrl(m),
function(g){var m=function(){!B(l)||l&&!f.$eval(l)||d()},r=++s;g?(a.get(g,{cache:c}).success(function(a){if(r===s){var c=f.$new();q.template=a;a=I(c,function(a){z();e.enter(a,null,k,m)});u=c;F=a;u.$emit("$includeContentLoaded");f.$eval(h)}}).error(function(){r===s&&z()}),f.$emit("$includeContentRequested")):(z(),q.template=null)})}}}}],Jd=["$compile",function(a){return{restrict:"ECA",priority:-400,require:"ngInclude",link:function(c,d,e,g){d.html(g.template);a(d.contents())(c)}}}],ud=va({priority:450,
compile:function(){return{pre:function(a,c,d){a.$eval(d.ngInit)}}}}),vd=va({terminal:!0,priority:1E3}),wd=["$locale","$interpolate",function(a,c){var d=/{}/g;return{restrict:"EA",link:function(e,g,f){var k=f.count,m=f.$attr.when&&g.attr(f.$attr.when),h=f.offset||0,l=e.$eval(m)||{},n={},p=c.startSymbol(),r=c.endSymbol(),s=/^when(Minus)?(.+)$/;q(f,function(a,c){s.test(c)&&(l[L(c.replace("when","").replace("Minus","-"))]=g.attr(f.$attr[c]))});q(l,function(a,e){n[e]=c(a.replace(d,p+k+"-"+h+r))});e.$watch(function(){var c=
parseFloat(e.$eval(k));if(isNaN(c))return"";c in l||(c=a.pluralCat(c-h));return n[c](e,g,!0)},function(a){g.text(a)})}}}],xd=["$parse","$animate",function(a,c){var d=t("ngRepeat");return{transclude:"element",priority:1E3,terminal:!0,$$tlb:!0,link:function(e,g,f,k,m){var h=f.ngRepeat,l=h.match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?\s*$/),n,p,r,s,I,x,u={$id:Ja};if(!l)throw d("iexp",h);f=l[1];k=l[2];(l=l[3])?(n=a(l),p=function(a,c,d){x&&(u[x]=a);u[I]=c;u.$index=d;return n(e,
u)}):(r=function(a,c){return Ja(c)},s=function(a){return a});l=f.match(/^(?:([\$\w]+)|\(([\$\w]+)\s*,\s*([\$\w]+)\))$/);if(!l)throw d("iidexp",f);I=l[3]||l[1];x=l[2];var B={};e.$watchCollection(k,function(a){var f,k,l=g[0],n,u={},E,A,H,t,C,y,D=[];if(db(a))C=a,n=p||r;else{n=p||s;C=[];for(H in a)a.hasOwnProperty(H)&&"$"!=H.charAt(0)&&C.push(H);C.sort()}E=C.length;k=D.length=C.length;for(f=0;f<k;f++)if(H=a===C?f:C[f],t=a[H],t=n(H,t,f),Aa(t,"`track by` id"),B.hasOwnProperty(t))y=B[t],delete B[t],u[t]=
y,D[f]=y;else{if(u.hasOwnProperty(t))throw q(D,function(a){a&&a.scope&&(B[a.id]=a)}),d("dupes",h,t);D[f]={id:t};u[t]=!1}for(H in B)B.hasOwnProperty(H)&&(y=B[H],f=Db(y.clone),c.leave(f),q(f,function(a){a.$$NG_REMOVED=!0}),y.scope.$destroy());f=0;for(k=C.length;f<k;f++){H=a===C?f:C[f];t=a[H];y=D[f];D[f-1]&&(l=D[f-1].clone[D[f-1].clone.length-1]);if(y.scope){A=y.scope;n=l;do n=n.nextSibling;while(n&&n.$$NG_REMOVED);y.clone[0]!=n&&c.move(Db(y.clone),null,w(l));l=y.clone[y.clone.length-1]}else A=e.$new();
A[I]=t;x&&(A[x]=H);A.$index=f;A.$first=0===f;A.$last=f===E-1;A.$middle=!(A.$first||A.$last);A.$odd=!(A.$even=0===(f&1));y.scope||m(A,function(a){a[a.length++]=V.createComment(" end ngRepeat: "+h+" ");c.enter(a,null,w(l));l=a;y.scope=A;y.clone=a;u[y.id]=y})}B=u})}}}],yd=["$animate",function(a){return function(c,d,e){c.$watch(e.ngShow,function(c){a[Ra(c)?"removeClass":"addClass"](d,"ng-hide")})}}],rd=["$animate",function(a){return function(c,d,e){c.$watch(e.ngHide,function(c){a[Ra(c)?"addClass":"removeClass"](d,
"ng-hide")})}}],zd=va(function(a,c,d){a.$watch(d.ngStyle,function(a,d){d&&a!==d&&q(d,function(a,d){c.css(d,"")});a&&c.css(a)},!0)}),Ad=["$animate",function(a){return{restrict:"EA",require:"ngSwitch",controller:["$scope",function(){this.cases={}}],link:function(c,d,e,g){var f=[],k=[],m=[],h=[];c.$watch(e.ngSwitch||e.on,function(d){var n,p;n=0;for(p=m.length;n<p;++n)m[n].remove();n=m.length=0;for(p=h.length;n<p;++n){var r=k[n];h[n].$destroy();m[n]=r;a.leave(r,function(){m.splice(n,1)})}k.length=0;h.length=
0;if(f=g.cases["!"+d]||g.cases["?"])c.$eval(e.change),q(f,function(d){var e=c.$new();h.push(e);d.transclude(e,function(c){var e=d.element;k.push(c);a.enter(c,e.parent(),e)})})})}}}],Bd=va({transclude:"element",priority:800,require:"^ngSwitch",link:function(a,c,d,e,g){e.cases["!"+d.ngSwitchWhen]=e.cases["!"+d.ngSwitchWhen]||[];e.cases["!"+d.ngSwitchWhen].push({transclude:g,element:c})}}),Cd=va({transclude:"element",priority:800,require:"^ngSwitch",link:function(a,c,d,e,g){e.cases["?"]=e.cases["?"]||
[];e.cases["?"].push({transclude:g,element:c})}}),Ed=va({link:function(a,c,d,e,g){if(!g)throw t("ngTransclude")("orphan",ga(c));g(function(a){c.empty();c.append(a)})}}),ed=["$templateCache",function(a){return{restrict:"E",terminal:!0,compile:function(c,d){"text/ng-template"==d.type&&a.put(d.id,c[0].text)}}}],Ue=t("ngOptions"),Dd=$({terminal:!0}),fd=["$compile","$parse",function(a,c){var d=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+group\s+by\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?$/,
e={$setViewValue:y};return{restrict:"E",require:["select","?ngModel"],controller:["$element","$scope","$attrs",function(a,c,d){var m=this,h={},l=e,n;m.databound=d.ngModel;m.init=function(a,c,d){l=a;n=d};m.addOption=function(c){Aa(c,'"option value"');h[c]=!0;l.$viewValue==c&&(a.val(c),n.parent()&&n.remove())};m.removeOption=function(a){this.hasOption(a)&&(delete h[a],l.$viewValue==a&&this.renderUnknownOption(a))};m.renderUnknownOption=function(c){c="? "+Ja(c)+" ?";n.val(c);a.prepend(n);a.val(c);n.prop("selected",
!0)};m.hasOption=function(a){return h.hasOwnProperty(a)};c.$on("$destroy",function(){m.renderUnknownOption=y})}],link:function(e,f,k,m){function h(a,c,d,e){d.$render=function(){var a=d.$viewValue;e.hasOption(a)?(F.parent()&&F.remove(),c.val(a),""===a&&x.prop("selected",!0)):D(a)&&x?c.val(""):e.renderUnknownOption(a)};c.on("change",function(){a.$apply(function(){F.parent()&&F.remove();d.$setViewValue(c.val())})})}function l(a,c,d){var e;d.$render=function(){var a=new Ya(d.$viewValue);q(c.find("option"),
function(c){c.selected=B(a.get(c.value))})};a.$watch(function(){xa(e,d.$viewValue)||(e=ka(d.$viewValue),d.$render())});c.on("change",function(){a.$apply(function(){var a=[];q(c.find("option"),function(c){c.selected&&a.push(c.value)});d.$setViewValue(a)})})}function n(e,f,g){function k(){var a={"":[]},c=[""],d,h,s,t,v;t=g.$modelValue;v=w(e)||[];var D=n?Wb(v):v,F,K,A;K={};s=!1;var E,J;if(r)if(x&&O(t))for(s=new Ya([]),A=0;A<t.length;A++)K[m]=t[A],s.put(x(e,K),t[A]);else s=new Ya(t);for(A=0;F=D.length,
A<F;A++){h=A;if(n){h=D[A];if("$"===h.charAt(0))continue;K[n]=h}K[m]=v[h];d=p(e,K)||"";(h=a[d])||(h=a[d]=[],c.push(d));r?d=B(s.remove(x?x(e,K):q(e,K))):(x?(d={},d[m]=t,d=x(e,d)===x(e,K)):d=t===q(e,K),s=s||d);E=l(e,K);E=B(E)?E:"";h.push({id:x?x(e,K):n?D[A]:A,label:E,selected:d})}r||(y||null===t?a[""].unshift({id:"",label:"",selected:!s}):s||a[""].unshift({id:"?",label:"",selected:!0}));K=0;for(D=c.length;K<D;K++){d=c[K];h=a[d];z.length<=K?(t={element:C.clone().attr("label",d),label:h.label},v=[t],z.push(v),
f.append(t.element)):(v=z[K],t=v[0],t.label!=d&&t.element.attr("label",t.label=d));E=null;A=0;for(F=h.length;A<F;A++)s=h[A],(d=v[A+1])?(E=d.element,d.label!==s.label&&E.text(d.label=s.label),d.id!==s.id&&E.val(d.id=s.id),d.selected!==s.selected&&E.prop("selected",d.selected=s.selected)):(""===s.id&&y?J=y:(J=u.clone()).val(s.id).attr("selected",s.selected).text(s.label),v.push({element:J,label:s.label,id:s.id,selected:s.selected}),E?E.after(J):t.element.append(J),E=J);for(A++;v.length>A;)v.pop().element.remove()}for(;z.length>
K;)z.pop()[0].element.remove()}var h;if(!(h=t.match(d)))throw Ue("iexp",t,ga(f));var l=c(h[2]||h[1]),m=h[4]||h[6],n=h[5],p=c(h[3]||""),q=c(h[2]?h[1]:m),w=c(h[7]),x=h[8]?c(h[8]):null,z=[[{element:f,label:""}]];y&&(a(y)(e),y.removeClass("ng-scope"),y.remove());f.empty();f.on("change",function(){e.$apply(function(){var a,c=w(e)||[],d={},h,k,l,p,t,u,v;if(r)for(k=[],p=0,u=z.length;p<u;p++)for(a=z[p],l=1,t=a.length;l<t;l++){if((h=a[l].element)[0].selected){h=h.val();n&&(d[n]=h);if(x)for(v=0;v<c.length&&
(d[m]=c[v],x(e,d)!=h);v++);else d[m]=c[h];k.push(q(e,d))}}else{h=f.val();if("?"==h)k=s;else if(""===h)k=null;else if(x)for(v=0;v<c.length;v++){if(d[m]=c[v],x(e,d)==h){k=q(e,d);break}}else d[m]=c[h],n&&(d[n]=h),k=q(e,d);1<z[0].length&&z[0][1].id!==h&&(z[0][1].selected=!1)}g.$setViewValue(k)})});g.$render=k;e.$watch(k)}if(m[1]){var p=m[0];m=m[1];var r=k.multiple,t=k.ngOptions,y=!1,x,u=w(V.createElement("option")),C=w(V.createElement("optgroup")),F=u.clone();k=0;for(var z=f.children(),J=z.length;k<J;k++)if(""===
z[k].value){x=y=z.eq(k);break}p.init(m,y,F);r&&(m.$isEmpty=function(a){return!a||0===a.length});t?n(e,f,m):r?l(e,f,m):h(e,f,m,p)}}}}],hd=["$interpolate",function(a){var c={addOption:y,removeOption:y};return{restrict:"E",priority:100,compile:function(d,e){if(D(e.value)){var g=a(d.text(),!0);g||e.$set("value",d.text())}return function(a,d,e){var h=d.parent(),l=h.data("$selectController")||h.parent().data("$selectController");l&&l.databound?d.prop("selected",!1):l=c;g?a.$watch(g,function(a,c){e.$set("value",
a);a!==c&&l.removeOption(c);l.addOption(a)}):l.addOption(e.value);d.on("$destroy",function(){l.removeOption(e.value)})}}}}],gd=$({restrict:"E",terminal:!0});T.angular.bootstrap?console.log("WARNING: Tried to load angular more than once."):((Ba=T.jQuery)&&Ba.fn.on?(w=Ba,J(Ba.fn,{scope:Ka.scope,isolateScope:Ka.isolateScope,controller:Ka.controller,injector:Ka.injector,inheritedData:Ka.inheritedData}),Fb("remove",!0,!0,!1),Fb("empty",!1,!1,!1),Fb("html",!1,!1,!0)):w=R,Sa.element=w,Zc(Sa),w(V).ready(function(){Wc(V,
dc)}))})(window,document);!window.angular.$$csp()&&window.angular.element(document).find("head").prepend('<style type="text/css">@charset "UTF-8";[ng\\:cloak],[ng-cloak],[data-ng-cloak],[x-ng-cloak],.ng-cloak,.x-ng-cloak,.ng-hide{display:none !important;}ng\\:form{display:block;}.ng-animate-block-transitions{transition:0s all!important;-webkit-transition:0s all!important;}.ng-hide-add-active,.ng-hide-remove{display:block!important;}</style>');
//# sourceMappingURL=angular.min.js.map
;

/* file-end: js/lib/angular/1.2.18/angular.min.js 
----------------------------------------------------------------------------------*/

/* ---------------------------------------------------------------------------------
   file-start: js/core/angular/common.js 
*/

/*
 * Include LJ.Templates as module dependency to have access to templates,
 * required using require_template. Don't forget to require this file.
 *
 * @example
 *   js:
 *     //= require_template angular/ljMessages.ng.tmpl
 *     angular.module('MyModule', ['LJ.Templates']);
 *
 *   html:
 *     <div ng-include src="'ljMessages.ng.tmpl'">
 *
 * If you need direct access as a string, use $templateCache.
 */
angular.module('LJ.Templates', []).run(['$templateCache', function($templateCache) {
  var template = LJ.get('template'), key;

  for (key in template) {
    if (template.hasOwnProperty(key)) {
      $templateCache.put(key.split('/').pop(), template[key]);
    }
  }
}]);

/*
 * Common directives
 */

angular.module('LJ.Directives', [])

/**
 * Insert html and do not watch for changes
 */
.directive('ljHtml', ['$parse', function ($parse) {
  return {
    compile: function (element, attrs) {
      var getter = $parse( attrs.ljHtml );

      return function link(scope, element) {
        element.html( getter(scope) || '' );
      };
    }
  };
}])

/**
 * Insert html and watch for changes
 */
.directive('ljHtmlLive', ['$parse', function ($parse) {
  return {
    scope: true,
    restrict: 'A',
    compile: function (element, attrs) {
      var getValue = $parse(attrs.ljHtmlLive);

      return function link(scope, element) {
        scope.$watch(function () {
          return getValue(scope);
        }, function (value) {
          element.html( value || '' );
        });
      };
    }
  };
}])

/**
 * Replace ng-include root with it's content,
 * if you have to just include template into the DOM.
 * Notice: should be used in conjunction with ng-include
 *
 * @example
 *
 *     <div ng-include="'Settings.html'" include-replace></div>
 */
.directive('includeReplace', function () {
  return {
    require: 'ngInclude',
    link: function (scope, element) {
      element.replaceWith( element.contents() );
    }
  };
})

/**
 * Notice:
 *   lj-ml-compile could be only used on node without any other directives,
 *   otherwise their behavior will be duplicated (ng-click handlers for example)
 *
 * @example
 *     <!-- replace span text with ml variable value -->
 *     <span lj-ml="user.text.save"></span>
 *
 * @example
 *     <!-- replace `placeholder` attr with ml variable value -->
 *     <input type="text"  lj-ml="user.text.save" lj-ml-attr="placeholder" />
 *
 * @example
 *     <!-- compile angular attributes inside of ml-variable -->
 *     <span lj-ml="some.variable" lj-ml-compile></span>
 *
 * @example
 *     <!-- object notation syntax -->
 *     <span
 *         lj-ml="{
 *             'some.filter': isFilter,
 *             'some.group': isGroup
 *         }"
 *         ></span>
 *
 * @example
 *
 *     Html:
 *
 *     Simple:
 *       <span
 *         lj-ml="entryunit.comments"
 *         lj-ml-resolve="{reply_count: item.comments_cnt}"
 *         ></span>
 *
 *     Deferred:
 *       <!-- wait for substitutions like [[username]] -->
 *       <span lj-ml="user.text.save" lj-ml-resolve="mlResolve" />
 *
 *       var mlDefer = $q.defer();
 *
 *       // Notice:
 *       //   Object with `promise` field is needed!
 *       //   If promise is assigned directly, it will be resolved to `undefined`
 *       $scope.mlResolve = { promise: mlDefer.promise }
 *       mlDefer.resolve({ username: 'good' })
 */
.directive('ljMl', ['$parse', '$compile', function($parse, $compile) {
  return {
    link: function(scope, element, attrs) {
      var mlVar = attrs.ljMl,
          resolve;

      // ml has been processed yet
      if ( attrs.mlParsed ) {
        return;
      }

      // we don't need substitutions
      if ( !attrs.ljMlResolve ) {
        replaceMl(mlVar);
        return;
      }

      resolve = $parse(attrs.ljMlResolve)(scope);

      if ( !resolve.promise ) {
        replaceMl(mlVar, resolve);
        return;
      }

      // if object has promise key => wait for promise resolve
      resolve.promise.then(function (data) {
        replaceMl(mlVar, data);
      });

      // replace variable with value
      function replaceMl(mlVar, dictionary) {
        var ml = LJ.ml(objNotation( mlVar ), dictionary);

        // attribute
        if (attrs.ljMlAttr) {
          element.attr( attrs.ljMlAttr, ml);
        } else {
          // html
          element.html(ml);
        }

        if ( attrs.hasOwnProperty('ljMlCompile') ) {
          // prevent cycled compilation of lj-ml directive
          element.attr('ml-parsed', true);
          $compile(element)(scope);
        }
      }

      /**
       * Allow object notation for ml
       * @param  {String} mlVar Variable value to check
       * @return {String}       Result ml variable value
       */
      function objNotation(mlVar) {
        if ( mlVar.indexOf('{') === -1 ) {
          return mlVar;
        }

        var obj = scope.$eval(mlVar),
            prop;

        if ( obj && typeof obj === 'object' ) {
          for (prop in obj) {
            if ( obj.hasOwnProperty(prop) && obj[prop] ) {
              return prop;
            }
          }
        }

        return mlVar;
      }
    }
  };
}])
.directive('ljSwitchOff', ['$document', '$parse',
                 function ( $document ,  $parse ) {
  /*
   * When area outside of element is clicked or ESC is pressed
   * 'showPopup' will be set to false and 'doSomething()' will be evaluated.
   *
   * <div ng-show="showPopup" lj-switch-off="showPopup" lj-switch-off-action="doSomething()"></div>
   *
   * Skip switching:
   * Notice: now skipping of switch is working for all `lj-switch-off` directives (is not grouped)
   * <span lj-switch-off-skip>This element prevents switching via `lj-switch-off` directive</span>
   *
   */

  return {
    restrict: 'A',
    link: function (scope, element, attrs) {
      var state    = $parse(attrs.ljSwitchOff),
          _clicked = false;

      element.on('click', function () {
        _clicked = true;
      });

      $document
        .on('keydown', keyPressed)
        .on('click', '[lj-switch-off-skip]', preventSwitching)
        .on('click', documentClick);

      // cleanup
      scope.$on('$destroy', function () {
        $document
          .off('keydown', keyPressed)
          .off('click', '[lj-switch-off-skip]', preventSwitching)
          .off('click', documentClick);
      });

      function close() {
        if (attrs.ljSwitchOffAction) {
          scope.$eval(attrs.ljSwitchOffAction);
        }

        state.assign(scope, false);
      }

      function preventSwitching() {
        _clicked = true;
      }

      function documentClick(event) {

        // right click in Firefox is closing the bubble
        if (event.button === 2) {
          return;
        }

        if ( !_clicked && state(scope) ) {
          scope.$apply(close);
        }

        _clicked = false;
      }

      function keyPressed(event) {
        /** ESC */
        if ( event.which === 27 && state(scope) ) {
          scope.$apply(close);
        }
      }
    }
  };
}]).
directive('ljDisabled', [function() {
  /*
   * Toggles disabled state for LiveJournal button
   *
   * <div class="b-ljbutton b-ljbutton-submit">
   *   <button lj-disabled="!comment">Submit comment</button>
   * </div>
   */
  return function (scope, element, attrs) {
    scope.$watch(attrs.ljDisabled, function(value) {
      element.prop('disabled', value);
      element.parent().toggleClass('b-ljbutton-disabled', value);
    });
  };
}])
.directive('focusAndSelect', ['$timeout', function ($timeout) {
  /*
   * Focus and select an input or textarea when expression is true
   *
   * <input focus-and-select="show">
   */
  return {
    restrict: 'A',
    link: function (scope, element, attrs) {
      var attr = attrs.focusAndSelect,
          timeout = 50; // scroll can jump under 50ms

      scope.$watch(attr, function (value, prev) {
        if (value) {
          $timeout(function () {
            element[0].focus();
            element[0].select();
          }, timeout);
        } else if (prev) {
          // fix: blur for IE
          element[0].blur();
        }
      });
    }
  };
}])

/**
 * Debounced update of scope variable on <input /> changes
 *   [lj-debounce-delay]: option for set delay duration (in milliseconds). Default: 300
 *
 * @example
 *
 *   <!-- $scope.model.search will be updated with debounce delay 200ms ->
 *   <input type="search" lj-debounce="model.search" lj-debounce-delay="200" />
 */
.directive('ljDebounce', ['$parse', function ($parse) {
  return {
    link: function (scope, element, attrs) {
      var getter = $parse(attrs.ljDebounce),
          setter = getter.assign,
          delay  = attrs.ljDebounceDelay ? scope.$eval(attrs.ljDebounceDelay) : 300,
          events = 'change paste keyup search',
          handler,
          unwatch,
          _value;

      // changes of variable should be reflected in element
      unwatch = scope.$watch(function () {
        _value = getter(scope);
        return _value;
      }, function (value) {
        element.val(value);
      });

      handler = LJ.Function.debounce(function () {
        var value = element.val();

        if (value !== _value) {
          scope.$apply(function () {
            setter(scope, value);
          });
        }
      }, delay);

      element.on(events, handler);

      scope.$on('$destroy', function () {
        element.off(events, handler);
        unwatch();
      });
    }
  };
}])

/**
 * Scroll to the element, when ljScroll="expression" is true
 *
 * HTML:
 *   <h1 lj-scroll="model.state.scrollTop"></h1>
 *
 * JS:
 *   // scroll to element will be done and prop state will be `false` again
 *   model.state.scrollTop = true;
 */
.directive('ljScroll', ['$parse', function($parse) {
  return {
    restrict: 'A',
    compile: function (element, attrs) {
      var $window = angular.element(window),
          root = angular.element('html, body'),
          ljScroll = $parse(attrs.ljScroll),
          isUp = attrs.hasOwnProperty('ljScrollUp');

      /**
       * Header correction that should affect scrolling
       * @return {Number} Header coorrection
       */
      function headerCorrection() {
        if ( LJ.Flags.isDisabled('schemius') ) {
          return 0;
        }

        var header = angular.element('.s-header');

        return header.css('position') === 'fixed' ? -header.outerHeight() : 0;
      }

      return function link(scope, element) {
        scope.$watch(function () {
          return ljScroll(scope);
        }, function (value) {
          var top;

          if (value) {
            top = element.offset().top;

            // scroll to element only if we are below
            if ( !isUp || (isUp && $window.scrollTop() > top) ) {
              root.animate({
                scrollTop: top + headerCorrection()
              });
            }

            // reset state to false
            ljScroll.assign(scope, false);
          }
        });
      };
    }
  };
}]);
;

/* file-end: js/core/angular/common.js 
----------------------------------------------------------------------------------*/

/* ---------------------------------------------------------------------------------
   file-start: js/core/angular/bubble.js 
*/


Site.page.template['Widgets/ljBubble.tmpl'] = '<div\n    class=\"b-popup bubble-node b-popupus b-popupus-blue b-popup-withclosecontrol b-bubble-{{bubble.name}}\"\n    ng-show=\"show\"\n    lj-switch-off=\"show\"\n    lj-switch-off-action=\"bubble.close()\"\n    ng-style=\"{ left: position.x, top: position.y, visibility: visibility }\"\n    ng-class=\"{\n        \'b-popup-noclosecontrol\': !bubble.options.closeControl\n    }\"\n    >\n    <div class=\"b-popup-outer\">\n        <div class=\"b-popup-inner\">\n            <i class=\"i-popup-arr\" ng-class=\"arrowClass()\">\n                <i class=\"i-popup-arr-brdr-outer\">\n                    <i class=\"i-popup-arr-brdr-inner\">\n                        <i class=\"i-popup-arr-bg\"></i>\n                    </i>\n                </i>\n            </i>\n            <div ng-include src=\"template\"></div>\n            <i class=\"i-popup-close\" ng-click=\"bubble.close()\"></i>\n        </div>\n    </div>\n</div>\n';
LJ.injectStyle('/* LJSUP-15116 General styles for pupupus\n----------------------------------------*/\n.b-popupus {\n    position: absolute;\n    margin: 0;\n    padding: 0;\n    border: 2px solid;\n    border-radius: 10px;\n    -webkit-transition: opacity .3s ease;\n       -moz-transition: opacity .3s ease;\n         -o-transition: opacity .3s ease;\n            transition: opacity .3s ease;\n    }\n    BODY .b-popupus .b-popup-outer {\n        margin: 0;\n        padding: 15px;\n        border: 0;\n        border-radius: 8px;\n        background: #FFF;\n        *zoom: 1;\n        }\n        BODY .b-popupus .b-popup-inner {\n            margin: 0;\n            padding: 0;\n            border: 0;\n            -webkit-border-radius: 0;\n                    border-radius: 0;\n            }\n\n/* Arrows\n----------------------------------------*/\n/* Top Side */\n    BODY .b-popupus .i-popup-arrtl.i-popup-arr,\n    BODY .b-popupus .i-popup-arrtr.i-popup-arr {\n        border-right: 15px solid transparent;\n        border-bottom: 15px solid;\n        border-left: 15px solid transparent;\n        }\n/* Bottom Side */\n    BODY .b-popupus .i-popup-arrbl.i-popup-arr,\n    BODY .b-popupus .i-popup-arrbr.i-popup-arr {\n        border-top: 15px solid;\n        border-right: 15px solid transparent;\n        border-left: 15px solid transparent;\n        }\n/* Left Side */\n    BODY .b-popupus .i-popup-arrlt.i-popup-arr,\n    BODY .b-popupus .i-popup-arrlb.i-popup-arr {\n        border-top: 15px solid transparent;\n        border-right: 15px solid;\n        border-bottom: 15px solid transparent;\n        }\n/* Right Side */\n    BODY .b-popupus .i-popup-arrrt.i-popup-arr,\n    BODY .b-popupus .i-popup-arrrb.i-popup-arr {\n        border-top: 15px solid transparent;\n        border-bottom: 15px solid transparent;\n        border-left: 15px solid;\n        }\n\n\n\n/* Arrows Outers\n----------------------------------------*/\n/* Top Side */\n    BODY .b-popupus .i-popup-arrtl .i-popup-arr-brdr-outer,\n    BODY .b-popupus .i-popup-arrtr .i-popup-arr-brdr-outer {\n        top: 3px;\n        left: -15px;\n        border-right: 15px solid transparent;\n        border-bottom: 15px solid #FFF;\n        border-left: 15px solid transparent;\n        }\n/* Bottom Side */\n    BODY .b-popupus .i-popup-arrbl .i-popup-arr-brdr-outer,\n    BODY .b-popupus .i-popup-arrbr .i-popup-arr-brdr-outer {\n        bottom: 3px;\n        left: -15px;\n        border-top: 15px solid #FFF;\n        border-right: 15px solid transparent;\n        border-left: 15px solid transparent;\n        }\n/* Left Side */\n    BODY .b-popupus .i-popup-arrlt .i-popup-arr-brdr-outer,\n    BODY .b-popupus .i-popup-arrlb .i-popup-arr-brdr-outer {\n        top: -15px;\n        left: 3px;\n        border-top: 15px solid transparent;\n        border-right: 15px solid #FFF;\n        border-bottom: 15px solid transparent;\n        }\n/* Right Side */\n    BODY .b-popupus .i-popup-arrrt .i-popup-arr-brdr-outer,\n    BODY .b-popupus .i-popup-arrrb .i-popup-arr-brdr-outer {\n        top: -15px;\n        right: 3px;\n        border-top: 15px solid transparent;\n        border-bottom: 15px solid transparent;\n        border-left: 15px solid #FFF;\n        }\n\n\n\n/* Arrows inner\n----------------------------------------*/\nBODY .b-popupus .i-popup-arr-brdr-inner {\n    display: none;\n    }\n    BODY .b-popupus .i-popup-arr-bg {\n        display: none;\n        }\n\n\n/* Arrows position\n----------------------------------------*/\n    BODY .b-popupus .i-popup-arrtl {\n        top: -15px;\n        left: 50px;\n        }\n    BODY .b-popupus .i-popup-arrtr {\n        top: -15px;\n        right: 50px;\n        }\n    BODY .b-popupus .i-popup-arrbl {\n        bottom: -15px;\n        left: 50px;\n        }\n    BODY .b-popupus .i-popup-arrbr {\n        right: 50px;\n        bottom: -15px;\n        }\n    BODY .b-popupus .i-popup-arrlt {\n        top: 50px;\n        left: -15px;\n        }\n    BODY .b-popupus .i-popup-arrlb {\n        bottom: 50px;\n        left: -15px;\n        }\n    BODY .b-popupus .i-popup-arrrt {\n        top: 50px;\n        right: -15px;\n        }\n    BODY .b-popupus .i-popup-arrrb {\n        right: -15px;\n        bottom: 50px;\n        }\n\n\n/* Close button\n----------------------------------------*/\n.b-popupus .i-popup-close {\n    position: absolute;\n    top: 5px;\n    right: 5px;\n    width: 16px;\n    height: 16px;\n    margin: 0;\n    padding: 0;\n    background: url(/img/icons/popup-close.png?v=15718) 0 0 no-repeat;\n    font: 0/0 serif;\n    }\n.b-popupus .i-popup-close:hover {\n    background-position: 0 -16px;\n    }\n\n\n/* With Close button\n----------------------------------------*/\nBODY .b-popupus.b-popup-withclosecontrol .b-popup-outer {\n    padding: 15px 35px 15px 15px;\n    }\n\n/* Without Close button\n----------------------------------------*/\nBODY .b-popupus.b-popup-noclosecontrol .b-popup-outer {\n    padding: 15px;\n    }\n\n\n/* LJSV-2573 Confirm Popup\n----------------------------------------*/\nBODY .b-popupus-confirm {\n    -webkit-box-shadow: none;\n            box-shadow: none;\n    }\n    .b-popupus-confirm .b-dialog-footer .b-ljbutton {\n        margin-right: 0.5em;\n        margin-left: 0.5em;\n        }\n\n\n\n/* popup for tiny sreens (LJSUP-18502) */\n@media all and (max-width: 650px) {\n\n    /* class for body */\n    HTML BODY.p-openpopup {\n        overflow: hidden;\n        position: relative;\n        }\n\n        /* fader */\n        .p-openpopup .b-fader {\n            display: block;\n            position: fixed;\n            top: 0 !important;\n            right: 0 !important;\n            bottom: 0 !important;\n            left: 0 !important;\n            z-index: 1999;\n            opacity: 0.5;\n            margin: 0;\n            padding: 0;\n            background-color: #000;\n            }\n\n        /* popup */\n        HTML BODY.p-openpopup .b-popupus {\n            overflow-x: auto;\n            overflow-y: auto;\n            position: fixed;\n            top: 0 !important;\n            right: 0 !important;\n            bottom: 0 !important;\n            left: 0 !important;\n            z-index: 2000;\n            margin: 0;\n            padding: 0;\n            border: 0;\n            box-shadow: none;\n            border-radius: 0;\n            }\n\n            /* outer */\n            HTML BODY.p-openpopup .b-popupus .b-popup-outer {\n                margin: 15px;\n                padding: 0;\n                border-radius: 3px;\n                background: #FFF;\n                }\n\n                /* inner */\n                HTML BODY.p-openpopup .b-popupus .b-popup-inner {\n                    margin: 0;\n                    padding: 30px;\n                    }\n\n                    /* hide popup arrow */\n                    HTML BODY.p-openpopup .b-popupus .i-popup-arr {\n                        display: none;\n                        }\n\n                    /* close button */\n                    HTML BODY.p-openpopup .b-popupus .i-popup-close {\n                        position: absolute;\n                        top: 12px;\n                        right: 12px;\n                        width: 30px;\n                        height: 30px;\n                        background-image: url(/img/schemius/s-icons.svg?v=2);\n                        background-position: -62px 6px;\n                        background-repeat: no-repeat;\n                        cursor: pointer;\n                        font: 0px/0 a;\n                        }\n\n}\n\n');
LJ.injectStyle('/* LJSUP-15116 Colors mod for pupupus\n----------------------------------------*/\n.b-popupus-blue {\n	border-color: #1F4C9E;\n	-webkit-box-shadow: 0 10px 40px #6E8BB7;\n	        box-shadow: 0 10px 40px #6E8BB7;\n	}\n	BODY .b-popupus-blue .b-popup-outer {\n		background-image: -webkit-linear-gradient(top, #FFF 0%, #E1E2E6 100%);\n		background-image:    -moz-linear-gradient(top, #FFF 0%, #E1E2E6 100%);\n		background-image:      -o-linear-gradient(top, #FFF 0%, #E1E2E6 100%);\n		background-image:   linear-gradient(to bottom, #FFF 0%, #E1E2E6 100%);\n		}\n\n\n\n/* Background Fix for Horizontal Arrows on Popup\nProblem: gradient background do not compare on solid arrow background\nFix: two backgrounds (from top to 50% height and from bottom to 50%) with 80px solid colors\n----------------------------------------*/\n.b-popupus-horizontal {\n	}\n	BODY .b-popupus-horizontal.b-popupus-blue .b-popup-outer {\n		background-image: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iI2ZmZmZmZiIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNlMWUyZTYiIHN0b3Atb3BhY2l0eT0iMSIvPgogIDwvbGluZWFyR3JhZGllbnQ+CiAgPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEiIGhlaWdodD0iMSIgZmlsbD0idXJsKCNncmFkLXVjZ2ctZ2VuZXJhdGVkKSIgLz4KPC9zdmc+);\n		background-image:\n			-webkit-linear-gradient(top, #FFF 0%, #FFF 80px, #F0F0F0 51%, transparent 51%, transparent 100%),\n			-webkit-linear-gradient(bottom, #E1E2E6 0%, #E1E2E6 80px, #F0F0F0 51%, transparent 51%, transparent 100%);\n		background-image:\n			-moz-linear-gradient(top, #FFF 0%, #FFF 80px, #F0F0F0 51%, transparent 51%, transparent 100%),\n			-moz-linear-gradient(bottom, #E1E2E6 0%, #E1E2E6 80px, #F0F0F0 51%, transparent 51%, transparent 100%);\n		background-image:\n			-o-linear-gradient(top, #FFF 0%, #FFF 80px, #F0F0F0 51%, transparent 51%, transparent 100%),\n			-o-linear-gradient(bottom, #E1E2E6 0%, #E1E2E6 80px, #F0F0F0 51%, transparent 51%, transparent 100%);\n		background-image:\n			linear-gradient(top, #FFF 0%, #FFF 80px, #F0F0F0 51%, transparent 51%, transparent 100%),\n			linear-gradient(bottom, #E1E2E6 0%, #E1E2E6 80px, #F0F0F0 51%, transparent 51%, transparent 100%);\n		}\n\n\n\n/* Arrow\n----------------------------------------*/\n/* Top Side */\n	BODY .b-popupus-blue .i-popup-arrtl.i-popup-arr,\n	BODY .b-popupus-blue .i-popup-arrtr.i-popup-arr {\n		border-bottom-color: #1F4C9E;\n		}\n/* Bottom Side */\n	BODY .b-popupus-blue .i-popup-arrbl.i-popup-arr,\n	BODY .b-popupus-blue .i-popup-arrbr.i-popup-arr {\n		border-top-color: #1F4C9E;\n		}\n/* Left Side */\n	BODY .b-popupus-blue .i-popup-arrlt.i-popup-arr,\n	BODY .b-popupus-blue .i-popup-arrlb.i-popup-arr {\n		border-right-color: #1F4C9E;\n		}\n/* Right Side */\n	BODY .b-popupus-blue .i-popup-arrrt.i-popup-arr,\n	BODY .b-popupus-blue .i-popup-arrrb.i-popup-arr {\n		border-left-color: #1F4C9E;\n		}\n\n\n\n/* Arrow outers\n----------------------------------------*/\n/* Top Side */\n	BODY .b-popupus-blue .i-popup-arrtl .i-popup-arr-brdr-outer,\n	BODY .b-popupus-blue .i-popup-arrtr .i-popup-arr-brdr-outer {\n		border-bottom-color: #FFF;\n		}\n/* Bottom Side */\n	BODY .b-popupus-blue .i-popup-arrbl .i-popup-arr-brdr-outer,\n	BODY .b-popupus-blue .i-popup-arrbr .i-popup-arr-brdr-outer {\n		border-top-color: #FFF;\n		}\n/* Left Side */\n	BODY .b-popupus-blue .i-popup-arrlt .i-popup-arr-brdr-outer {\n		border-right-color: #FFF;\n		}\n	BODY .b-popupus-blue .i-popup-arrlb .i-popup-arr-brdr-outer {\n		border-right-color: #FFF;\n		}\n/* Right Side */\n	BODY .b-popupus-blue .i-popup-arrrt .i-popup-arr-brdr-outer {\n		border-left-color: #FFF;\n		}\n	BODY .b-popupus-blue .i-popup-arrrb .i-popup-arr-brdr-outer {\n		border-left-color: #FFF;\n		}\n\n/* LJSUP-17656: Redesign of popupus and contextualhover pop-ups\n----------------------------------------*/\n\n.s-schemius .b-popupus,\n.j-layer-air .b-popupus {\n	border-color: #D9E6EA;\n	box-shadow: 0 0 1px 2px #F2F6F8;\n	}\n\nBODY.s-schemius .b-popupus-blue .b-popup-outer,\nBODY.j-layer-air .b-popupus-blue .b-popup-outer {\n	background-image: none;\n	}\n\n/* Top Side */\n	.s-schemius .b-popupus .i-popup-arrtl.i-popup-arr,\n	.s-schemius .b-popupus .i-popup-arrtr.i-popup-arr,\n	.j-layer-air .b-popupus .i-popup-arrtl.i-popup-arr,\n	.j-layer-air .b-popupus .i-popup-arrtr.i-popup-arr {\n		border-bottom-color: #D9E6EA;\n		}\n/* Bottom Side */\n	.s-schemius .b-popupus .i-popup-arrbl.i-popup-arr,\n	.s-schemius .b-popupus .i-popup-arrbr.i-popup-arr,\n	.j-layer-air .b-popupus .i-popup-arrbl.i-popup-arr,\n	.j-layer-air .b-popupus .i-popup-arrbr.i-popup-arr {\n		border-top-color: #D9E6EA;\n		}\n/* Left Side */\n	.s-schemius .b-popupus .i-popup-arrlt.i-popup-arr,\n	.s-schemius .b-popupus .i-popup-arrlb.i-popup-arr,\n	.j-layer-air .b-popupus .i-popup-arrlt.i-popup-arr,\n	.j-layer-air .b-popupus .i-popup-arrlb.i-popup-arr {\n		border-right-color: #D9E6EA;\n		}\n/* Right Side */\n	.s-schemius .b-popupus .i-popup-arrrt.i-popup-arr,\n	.s-schemius .b-popupus .i-popup-arrrb.i-popup-arr,\n	.j-layer-air .b-popupus .i-popup-arrrt.i-popup-arr,\n	.j-layer-air .b-popupus .i-popup-arrrb.i-popup-arr {\n		border-left-color: #D9E6EA;\n		}\n\n\n\n/* Arrow outers\n----------------------------------------*/\n/* Top Side */\n	BODY .b-popupus-blue .i-popup-arrtl .i-popup-arr-brdr-outer,\n	BODY .b-popupus-blue .i-popup-arrtr .i-popup-arr-brdr-outer {\n		border-bottom-color: #FFF;\n		}\n/* Bottom Side */\n	BODY .b-popupus-blue .i-popup-arrbl .i-popup-arr-brdr-outer,\n	BODY .b-popupus-blue .i-popup-arrbr .i-popup-arr-brdr-outer {\n		border-top-color: #FFF;\n		}\n/* Left Side */\n	BODY .b-popupus-blue .i-popup-arrlt .i-popup-arr-brdr-outer {\n		border-right-color: #FFF;\n		}\n	BODY .b-popupus-blue .i-popup-arrlb .i-popup-arr-brdr-outer {\n		border-right-color: #FFF;\n		}\n/* Right Side */\n	BODY .b-popupus-blue .i-popup-arrrt .i-popup-arr-brdr-outer {\n		border-left-color: #FFF;\n		}\n	BODY .b-popupus-blue .i-popup-arrrb .i-popup-arr-brdr-outer {\n		border-left-color: #FFF;\n		}\n\n\n');
/*
 * LJ bubble directive
 *
 * Options:
 *   - closeControl: show close control or not. Default: true
 *
 * @example
 *   html:
 *     <!--
 *       Following will add click handler to button
 *       and include myBubble.tmpl inside bubble.
 *     -->
 *     <button lj-bubble="{
 *         name: 'myBubble',
 *         template: 'settings.ng.tmpl',
 *         closeControl: false
 *       }"
 *       >Show bubble!</button>
 *
 *   js:
 *     angular.module('MyModule', ['LJ.Bubble'])
 *     .controller('MyCtrl', ['$scope', 'Bubble', function($scope, Bubble) {
 *
 *       // Use Bubble.open to control bubble from JS.
 *       // You can pass jQuery node to reposition the bubble from the original placement.
 *       Bubble.open('myBubble', { 'some-stuff': 'optional' }, jQuery('.b-some-other-block'));
 *     }]);
 *
 * @todo
 *   Refactor detection of current bubble open
 *   Refactor disableClick option of directive
 *
 * @authors
 *   Artem Tyurin (artem.tyurin@sup.com)
 *   Valeriy Vasin (valeriy.vasin@sup.com)
 */

(function($) {
  'use strict';

  angular.module('LJ.Bubble', ['LJ.Templates', 'LJ.Directives'])
  .factory('Bubble', ['$rootScope', function ($rootScope) {
    var factory  = {},

        // bubbles options
        _options = {},

        // targets for bubbles
        _targets = {},

        // body className flag
        bubbleOpenClass = 'p-openpopup';

    // currently opened bubble name
    factory.current = null;

    // we can change bubble node while opening bubble
    factory.node = null;

    /**
     * Register bubble
     * @param {String} name Bubble name
     */
    factory._register = function (name, options) {

      if ( _options.hasOwnProperty(name) ) {
        console.warn('Warning: bubble with name `%s` has been registered before!', name);
      }

      var opts = angular.isDefined(options) ? angular.copy(options) : {};

      // extend with default options
      opts = angular.extend({
        closeControl: true
      }, opts);

      _options[name] = opts;
    };

    /**
     * Register target for bubble nodes
     *
     * @param {String} name Target name
     * @param {jQuery} node Target node
     */
    factory._registerTarget = function (name, node) {
      if ( _targets.hasOwnProperty(name) ) {
        throw new Error('Bubble with name `'+ name +'` has been registered before. Check it.');
      }

      _targets[name] = node;
    };

    /**
     * Remove registered target
     * @param  {String} name Target name
     */
    factory._unregisterTarget = function (name) {
      delete _targets[name];
    };

    function getTarget(name) {
      if ( !_targets.hasOwnProperty(name) ) {
        console.warn('Bubble target `'+ name +'` has not been registered yet.');
        return;
      }

      return _targets[name];
    }

    /**
     * Open bubble with provided name
     * @param {String}        name       Bubble name
     * @param {Object}        [options]  Options that will be available for bubble
     * @param {jQuery|String} [node]     jQuery: Node relative to which bubble will be positioned
     *                                   String: Registered bubble target name
     */
    factory.open = function (name, options, node) {
      if ( !_options.hasOwnProperty(name) ) {
        throw new Error('Bubble `'+ name +'` can\'t be opened, it has not been registered yet.');
      }

      if ( options instanceof jQuery ) {
        node = options;
        options = {};
      }

      if ( typeof options === 'string' ) {
        node = getTarget(options);
        options = {};
      }

      if (typeof options === 'object') {
        factory.options(name, options);
      }

      if (node instanceof jQuery) {
        factory.node = node;
      }

      if (typeof node === 'string') {
        factory.node = getTarget(node);
      }

      factory.current = name;
      $rootScope.$broadcast('bubble:open'        , name, options, node);
      $rootScope.$broadcast('bubble:open:' + name, name, options, node);
      angular.element('body').addClass(bubbleOpenClass);
    };

    /**
     * Close all opened bubbles
     * @param {String} [name] Close bubble
     */
    factory.close = function () {
      var name = factory.current,
          options = _options[name],
          option;

      $rootScope.$broadcast('bubble:close'        , name, options, factory.node);
      $rootScope.$broadcast('bubble:close:' + name, name, options, factory.node);

      // clear current bubble options
      for (option in options) {
        if ( options.hasOwnProperty(option) ) {
          delete options[option];
        }
      }

      factory.current = null;
      factory.node = null;
      angular.element('body').removeClass(bubbleOpenClass);
    };

    /**
     * Set context for opened bubble
     * @param  {String} name    Bubble name
     * @param  {Object} options Opening context (arguments)
     * @return {Object}         Bubble options
     */
    factory.options = function (name, options) {
      if (typeof options === 'undefined') {
        return _options[name];
      }

      angular.copy(options, _options[name]);
    };

    return factory;
  }])
  .directive('ljBubble', ['Bubble', '$parse', '$compile', '$timeout', '$templateCache',
                 function( Bubble,   $parse,   $compile,   $timeout,   $templateCache ) {
    return {
      scope: true,
      link: function(scope, element, attrs) {
        var options = $parse(attrs.ljBubble)(scope),
            name    = options.name,
            bubble  = $compile($templateCache.get('ljBubble.tmpl'))(scope),
            arrow   = bubble.find('.i-popup-arr'),
            $window = angular.element(window);

        scope.show = false;

        Bubble._register(name, options);

        scope.template = options.template || (name + '.html');
        scope.bubble = {
          name: name,
          close: Bubble.close,
          options: Bubble.options(name)
        };

        scope.arrow = {
          vertical:   't', /* top  (t) or bottom (b) */
          horizontal: 'l'  /* left (l) or right  (r) */
        };

        scope.position = {
          x: -9999,
          y: -9999
        };

        scope.visibility = 'hidden';

        scope.arrowClass = function () {
          return 'i-popup-arr' + scope.arrow.vertical + scope.arrow.horizontal;
        };

        scope.$watch(function() {
          return Bubble.current;
        }, function(value) {
          hideFromViewport();

          $timeout(function() {
            scope.show = value === name;

            if (value && scope.show) {
              $timeout(setPosition);
            }
          });
        }, true);

        function setPosition() {
          // try to use top/left coords
          var vertical   = scope.arrow.vertical,
              horizontal = scope.arrow.horizontal;

          scope.visibility = 'hidden';

          // calculate positions initially
          recalculatePositions();

          // if there is not enough vertical space,
          // bubble shows at the top of the target
          if ( isOutOfViewportY() ) {

            // we should change arrow position if possible
            scope.arrow.vertical = vertical === 't' ?
                                  (!options.alwaysBottom ? 'b' : 't'):
                                  't';
          }

          // if there is not enough horizontal space,
          // bubble shows at the right of the target
          if ( isOutOfViewportX() ) {

            // we should change arrow position
            scope.arrow.horizontal = horizontal === 'r' ? 'l' : 'r';
          }

          // top/left coords can't be used
          if (
              scope.arrow.horizontal !== horizontal ||
              scope.arrow.vertical   !== vertical
          ) {
            // positions should be recalculated
            // timeout is needed to apply arrow positions
            $timeout(function () {
              recalculatePositions();
              scope.visibility = 'visible';
            });
          } else {
            scope.visibility = 'visible';
          }
        }

        function recalculatePositions() {
          var el      = Bubble.node || element,
              centerX = el.offset().left + Math.floor(el.outerWidth() / 2);

          scope.position.x = centerX - arrow.position().left - Math.floor(arrow.outerWidth() / 2) - 2;

          // top
          if ( scope.arrow.vertical === 't' ) {
            scope.position.y = el.offset().top + el.outerHeight() + arrow.outerHeight();
          } else {
            // bottom
            scope.position.y = el.offset().top - arrow.outerHeight() - bubble.outerHeight();
          }
        }

        function hideFromViewport() {
          scope.position.x = -9999;
        }

        function isOutOfViewportY() {
          var scrollTop = $window.scrollTop();

          if ( scope.position.y < scrollTop ) {
            return true;
          }

          return scope.position.y + bubble.outerHeight() > scrollTop + $window.outerHeight();
        }

        function isOutOfViewportX() {
          var scrollLeft = $window.scrollLeft();

          if ( scope.position.x < scrollLeft ) {
            return true;
          }

          return scope.position.x + bubble.outerWidth() > scrollLeft + $window.outerWidth();
        }

        /**
         * Bubble target click handler
         * @param  {jQuery.Event} event Click event object
         */
        function onTargetClick(event) {
          event.preventDefault();

          $timeout(function() {
            Bubble.open(options.name);
          });
        }

        function onResize() {
          if (scope.show) {
            $timeout(setPosition);
          }
        }

        if ( !options.disableClick ) {
          element.on('click', onTargetClick);
        }

        $window.on('resize', onResize);
        $('body').append(bubble);

        scope.$on('$destroy', function () {
          element.off(onTargetClick);
          $window.off('resize', onResize);
          bubble.remove();
        });
      }
    };
  }])

  // register a target for the bubble
  // <span lj-bubble-target="mytarget"></span>
  .directive('ljBubbleTarget', ['Bubble', function (Bubble) {
    return function link(scope, element, attrs) {
      var name = attrs.ljBubbleTarget;

      Bubble._registerTarget(name, element);

      scope.$on('$destroy', function () {
        Bubble._unregisterTarget(name);
      });
    };
  }]);
})(jQuery);
;

/* file-end: js/core/angular/bubble.js 
----------------------------------------------------------------------------------*/

/* ---------------------------------------------------------------------------------
   file-start: js/core/angular/ljUser.js 
*/

/* ---------------------------------------------------------------------------------
   file-start: js/core/angular/api.js 
*/

/* ---------------------------------------------------------------------------------
   file-start: js/core/angular/messages.js 
*/


Site.page.template['angular/ljMessages.ng.tmpl'] = '<div\n    class=\"b-msgsystem-wrapper b-msgsystem-wrapper-fixed\"\n    ng-hide=\"messages.length === 0\"\n    >\n    <div ng-repeat=\"message in messages\" class=\"b-msgsystem\" ng-class=\"\'b-msgsystem-type-\' + message.type\" ng-animate=\"\'b-msgsystem\'\">\n        <header class=\"b-msgsystem-head\" lj-html=\"message.title\" ng-if=\"message.title\"></header>\n        <div class=\"b-msgsystem-wrap\"><div class=\"b-msgsystem-body\" lj-html=\"message.body\"></div></div>\n        <span class=\"b-msgsystem-close\" ng-click=\"close(message)\">\n            <span class=\"b-msgsystem-close-text\" lj-ml=\"component.messages.close\"></span>\n            <span class=\"b-msgsystem-close-ctrl\" lj-ml=\"component.messages.close\" lj-ml-attr=\"title\">&times;</span>\n        </span>\n    </div>\n</div>\n';
LJ.injectStyle('/* System Message\n----------------------------------- */\n.b-msgsystem-wrapper {\n    width: 100%;\n    height: auto;\n    }\n    .b-msgsystem-wrapper.b-msgsystem-wrapper-fixed {\n        position: fixed;\n        top: 0;\n        left: 0;\n        z-index: 1001;\n        overflow: hidden;\n        padding: 0 0 10px;\n        }\n    .s-schemius .b-msgsystem-wrapper.b-msgsystem-wrapper-fixed {\n        top: 60px;\n        }\n\n    @media (max-width: 900px) {\n        .s-schemius .b-msgsystem-wrapper.b-msgsystem-wrapper-fixed {\n            position: absolute;\n            }\n        }\n        \n    .g-sensor .b-msgsystem-wrapper.b-msgsystem-wrapper-fixed,\n    .mobile-msg .b-msgsystem-wrapper.b-msgsystem-wrapper-fixed {\n        position: static;\n        padding: 0;\n        background-image: none;\n        }\n\n.b-msgsystem {\n    position: relative;\n    min-height: 50px;\n    padding: 10px 140px 10px 120px;\n    font: 14px/1.357 Arial, Helvetica, sans-serif;\n    }\n    .b-msgsystem DD,\n    .b-msgsystem DT,\n    .b-msgsystem TH,\n    .b-msgsystem TD,\n    .b-msgsystem P,\n    .b-msgsystem DIV,\n    .b-msgsystem LI,\n    .b-msgsystem PRE,\n    .b-msgsystem CODE,\n    .b-msgsystem KBD {\n        font-size: 100%;\n        }\n    .b-msgsystem .i-ljuser-userhead {\n        vertical-align: top !important;\n        margin: 3px 0 0 0;\n        }\n.b-msgsystem:after {\n    position: absolute;\n    bottom: -10px;\n    left: 0;\n    display: block;\n    content: \'\';\n    width: 100%;\n    height: 10px;\n    background-image: -webkit-linear-gradient(top, rgba(53, 99, 161, 0.3), rgba(53, 99, 161, 0));\n    background-image:    -moz-linear-gradient(top, rgba(53, 99, 161, 0.3), rgba(53, 99, 161, 0));\n    background-image:      -o-linear-gradient(top, rgba(53, 99, 161, 0.3), rgba(53, 99, 161, 0));\n    background-image:   linear-gradient(to bottom, rgba(53, 99, 161, 0.3), rgba(53, 99, 161, 0));\n    -webkit-background-size: 10px 10px;\n         -o-background-size: 10px 10px;\n            background-size: 10px 10px;\n    background-position: 0 100%;\n    background-repeat: repeat-x;\n    }\n    .b-msgsystem-head {\n        margin: 0 0 0.357em;\n        padding: 0;\n        font-size: 1.142em;\n        font-weight: bold;\n        }\n    .b-msgsystem-wrap {\n        line-height: 50px;\n        min-height: 50px;\n        }\n\n    .b-msgsystem-head ~ .b-msgsystem-wrap {\n        line-height: inherit;\n        min-height: 0;\n        }\n\n    .b-msgsystem-body {\n        display: inline-block;\n        vertical-align: middle;\n        line-height: 1.571;\n        font-size: 1em;\n        color: #787878;\n        }\n\n.b-msgsystem .i-ljuser-username,\n.b-msgsystem .i-ljuser-username:link,\n.b-msgsystem .i-ljuser-username:visited {\n    color: #0051B7 !important;\n    }\n.b-msgsystem .i-ljuser-username:hover,\n.b-msgsystem .i-ljuser-username:active {\n    color: #C00 !important;\n    }\n\n.b-msgsystem-type-error {\n    background: #FFEFEF no-repeat 2.7em 50% url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA7CAYAAADFJfKzAAAKeElEQVRo3tVbCVBURxp2ACMBRWaiOICCIMQDLFDjuaWGxERDUmYVIpaKEl1dN0aN1xrRoBDBAwwi4m0irhpjJB4rri7GI2q5luJ9gMageAAKiJwCwr/9U/9QPc17MwOZgbGrvpqZ9/r//++b7v67X7/3mjUzXVEQLARYchDPaWxei8KLs2JozvAGQwsGaw5vCr9bUL3mZMeLN3uB1jP9PlReXRjpn/HtqsjHUXFJWcvjr+asWJv1dMXaF89WJgB+4m88juexHtZHO/oDzEq4guuWSKwFI/rW7bBlkx5FrT6as3zNy6cr4qG+QDu0Rz/oj1q9OdftFY0tUiO0RmRswBine0uil2VHxeXmLFsDxgL6Q7/onxPdaGNbwXXXNzo7qFumLYqambU0Nj87cjWYCsz/c4yD8WhsW5m6lfnWtE6eOsvnQXhM6pOlsdBYwHgYlxvTJhGs4MamTercsAmPwmMKH0esAl14unE7FBw9AaU30qDiSQ68KiyCqrKXgAU/8Tcex/NYD+vr84lxMT7y4MaywthCsfvYXp8fvuThkuhqBpBD/sEjUJHzDBpS0A7tdfnH+MgD+RAvowjWEnprfvjazLAVIAckWfWyHIxR0E/+waOgKx7jE28swVpCL81eFHF/0TKQwpO1W6H8cRaYoqBf9C8XG3n9WcF8MrI9M23epIzQyGoGEJHFxhlUVYNJC/OPcaTiI6/T0+Z+ToLrnbR4oTY7Rof0+X1+eOm9+REgIu/wMWjMgvGkeDB+hVsDx73DJS2DBStoHrN2smutvDX7m0t35y0BEbnJKdAUBeNK8WE8L3u2cVDRtGRliFhNq2L/b3V6yqy56bPDQERm/BZoyoLxpXid+fvsUORN/PW2bm33ndx7QMebM0Of3/5qIfDIWJUAUF3dpGKhqgr+WBkPIjfGtwB5C91ZZ/bFNajdyYnTo25OXwAiyh49AXMoZZmPQIof8kb+pEM2Oys0rern5uF09Yt5eden/RN4PN6VBOZUHv+YBCJH5I38udZVyHXhmlbdP/rzyVenzgERr0rLzEos8pHiyfhP4VrXQi4D4w6C6mzIlymXJ88CHpmJuw1bBBQVw7nl38HeT0bBLyPHwpVN26CqolL/MGR1sC7aoC36QF96k1XiTyByZfyPoQ7SUyczaxJTy37OLh0uTpzxMnXiDOBRcv+h3sCVpaWwa7A/rGnrroWDY/+mO6mxc1hHtENfFSUlOmOWPHgIIlfkP8jFzQX1SCUqC5qfWm/xHznqQsg04HFj4VKDWvXKxh/qENbg/q+nZO3wnJwd+tRXbiyMBJEz6kA9pMtCsgsfCgiOPR88FXg82LHHILEp0+fJkr4Yt17W7sLqdbJ26FNfQX4iZ9Qh1ZU1WRjXlm1TPptw5NyYycAj73yqQWL/tyJWlnT63gOydnhOzu7cslX6l5GMn8gZdaAebs2saMavmBjUxwNDbp8JmgQ8ijMyDRJb9CQbNr3dsw7hf/UfApVl8pkcz2Ed0Q59oU99pfh+JoicmY401COsqGqnHOzfTicDJuT+FhgCPMoLXhi+dr2dDvsCx0O82hMS2neFwxOnQXF2jn7CrM7hSV/W2KAt+kBfBs0Aefkgcj4RMD4H9ZCuFrxYHMT2DM4nRgRXnBwRDDwMmTqadL4tKQWR8/G/jitGPaSrNklZ0g/cnO5wfPgYEPE6FCneqId01RGLmcsl5eOgimMfBwGPqooKsxZayVpW5JziP6qYxGou+yw1Yt/UiD08NCDv6LBA4FGeX2DWYl/m5oHIOXnoyKeoh5t+LOu07IH3h6f954MRwOPF73+YtdjCexkgcmY60uVatnbM7h44LCX5veHAI+vU2T+3nZJ2F65uSYRfZ4fC/s8mwJ6hI2uA3/EYnsM6DS3IT+SMOqTGrFY23tTHL+Hfgz8BHjfiN9d/V5BtgF9evxW2931PdsEgIrGPH1xatwXKXxTWKxbyEzmjDqlsrDXPLujWM+TAwI+Ax/HxUw2PzBb117ftgs2de2kJWd/RG3YOHAb7Ro6DQ8FTaoDf8RieExcT6KOa7UgYlIkZP5Ez6pCbZ2tXUK42rbyTBnxQ/suAD4HH83T93ayUTe4HgkJqCG/o5AP//WIOpP28DwoyHui96sE6WBdt0BZ97B8VUuNTV0FeIlfk36mlXXepFZTW2pjBfVuvQaf29n0feKRG6l6jFrHN7MTe78KeYQFwZ98heFXe8DsDaHtn/yH42T+wxmeRjq0g5CVyRf6oQ2ptrHXVgxl5cWffOXveYcQFVMpcW5Y+y63plpknTxt/J5H5RN8Yo+78WgJSPJG/MO1oXcDXXs/ioG5vbeOz03fg8909BgGPC99GSxLKTr0CVZWvTLeZyHznXL5W99JwaQyIHJE38qfkVOd6VmungsGBoVNMl54bd/n8BUTkp90xi7k172YaSPFD3sifdEjuVGi6so2mK/dopeyf6NX3xQ7vfsDjMEsaTV0wSycHBIPIjfEtRN5cF7aRuztQu7vI4Mjgubhjt6jtXfuAiCNjJzepWIwvxSvCzSsaeRN/2d1FrbsBDPiUimsLC4vu6z19b25jc6aIizFrmkQoxpXis8HT95atpSVON67E31bXXQGtOwI0R3kMV6lHbPXoUfa9Rw8QcWFlXKMKxXhSPLZ4+Bb7K9t9Sq2qNuSOgNi6Klpbdp3l6B661d2nmgFEHGJjuPpVlWnHKPOPcaTiI69ZavevkSe38Nd7r6fOXTzKaG4M3mFOHhs3s2WdFJI+CoBn126aRCj6Rf9ysb9x6oRrYG/i6VCfu3ha92dpnlJTKveJcPTYubFDN5DDb18vYbv4RUYRWcHuBpxeEA664jE+O5AX8VNz86pVfW5G891ZSRM0jgffUIeOCRucu1QzgBxOzl0E+ekNu2RDO7TX5R/jIw8S6kkLfmVD7rzXeaaCxkGt4H8onUPXOnqWrHN8G3Rhz5BP4UxYJNw9kAxPr92A4qzs2ss3/MTfeBzPn10cVVNfn0+Mi/E5oc7Er0HPVEg+LUPpXCPYx8/GPjDGwf12QjsPaCxgPIwrI9S4jweRYycaI97NFYo+M+wdo+Mc3ArjHdzBVGD+izAOxqNk1Il4GE2onGAlJQM3Sve+7s2th8y3d/4htk3HgjVt3MBYQH/M7zZP5p/F6UHx3Ci+0thCJZ9dpKzXluY1DwYvhp5tLK0GT2nlELHUvv351SrX8jiVK9QXzK4C7dEP+kO/5N+D4rWl+CZ5dlHyqVSaz1T0L7vSGPKiFujdxsLq3SAb1cy5durvF7d2Or7cvv2daPsOud8pXUpWK10AP/E3HsfzWG+0jeortEN78uNFfl0pjorimvSpVMnnjenftaPk5UhXGzieutDY8mXoReT7MvRj6M+hHx3vTfV8ya4L+XEhv29RHJvGet5Y9klyGjt29M+3oyzpQlsjnkS+G7UUiulOn150vAvVcyc7Z/KjIr+2TfEkuc53BOifb0ljSkXjS02Z05nGXAcSpPnuTOfVVF9F9q3IX5O+I2DQ2x+092NLpFvT/q2SxGigpOMacbbcazBm/dqLwkTv9bwWLzWZ3Rtb/weCZK6FTFk50QAAAABJRU5ErkJggg==\');\n    color: #CB1427;\n    }\n    .b-msgsystem-type-error + .b-msgsystem-type-error {\n        border-top: 1px solid #FFDFDF;\n        }\n.b-msgsystem-type-warning {\n    background: #FCF8E3 no-repeat 2.7em 50% url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA7CAYAAADFJfKzAAAJyUlEQVRo3tVbDVRUxxVmWUAEREHFBSpEhUarFrXRiCdHkxxzmkSt1arxaKMSlJrE+IPWvwRUBEzCUWKAClYDFhNrqoBRTBQDgpQ2AWUNsqIYDQqKAiIEEBC5nUvvcmaH93YXw8I653wH9u3ce79vZ+bOvHnzLCxMVxQESwFKDuJ3WpunovDirBisGWwYejHYcugtfO5F9azJjhdv9gJtVwZMcVJnbnj9+oUtYaUFIUdva0Ivll8Ou3O3KKzm3pVwwL/4Ga/j91gP66Md/QBmJVzBdUsk1mtVwJT+mpxN/qUF206VX97eeLcoFDoLtEN79IP+qNWtuW6v6G6RWqFtIiNDZ7ldy/1gx53CkMpyzXboKqA/9Iv+OdHdNrYVXHe1edbLxUGTs3FV2aWt928XbgNTgfmvxjgYj8a2lalbmW9N29QvlvqU5AedLyvYAt0FjIdxuTFtEsEKbmza5aWtXnxLHVRbejEI9OHulWh4UHYSGqoLoLnhNrQ018DjloeABf/iZ7yO32M9rG/IJ8bF+MiDG8uKrhaK3cf+h7OBW2/mv9/KAHKoupkMzQ/L4UkK2qG9Pv8YH3kgH+LVJYJ1hBZmBUaXnN8EcqgqSWYt1ghdUdAP+tMXj/GJ6irBOkIvpL0XciN3PUihrDASmupLwRQF/aJ/udjI65cK5pORfdaxAP8fv1vXygAiyjQxAK2PwaSF+cc4UvGRV2bKMj8S3OmkxQu1S4yaM6H434EN13ICQURlyQnozoLxpHgwfrX7ds56jktaRgtW0Dxm6zaoj1NhxooLV7NXgYiKn76CnigYV4oP45nvPaS/M01LVsaI1bYq9v8+WUl+64qyVoCIEnUk9GTB+FK8ziX7bUbexN9g67Z332ULxj1zKf3tak3GO8Djet6HOIh6VCyO4eu5YSByY3wfIG+hO+vNvrgGdcz48s3wS2f+AiIe1t4EcygNtSUgxQ95I3/SIZudFdpWfdHX0039jX/VD6eXAo9SzT/AnEqpJhFEjupT/lXIn2tdhVwXbmvV5L2zl6m/9gMRLY8azEos8pHiyfgHcK1rKZeBcQfBOfvIgrQLJxYBj5KL+8EcC/ISuTL+Z1AH6emQmbWJyWHiWNfBuSkLG/OOLQQe9Q9uGBW8/EYuJEW8AjHL+0DsigFwer8fG18VRozBe2110QZt0Qf6MlSQl8gV+U8e7+6BeqQSlSXNT33/vmPqvO+T5wOPgjPrjBJ6/3YRxL47AKID7HVwKOR51uWa9HTHprY6ol3sioFtPg2Vgm//CiJn1IF6SJelZBc+vnd65H+PzAUeP6kTjBKbnvguRAXYSeLHfPlFSPH5JFk79GmoID+RM+qQ6sraLIxry4Gn42d8k3N4NvCovPUfo8Qe+2QmRC2zk4T6TLSsnTotStYOfRpcRjJ+ImfUgXq4NbPCgl8xMajSD8y4nP3FTOBRd/+6UWJzkoIZwd6SKC3KlLW7VXRW1g59Gip11TdA5Mx0FKEeYUXVPuVg/3bLODCtMjNxOvBoelht5ERfAQkbnoVPl9rqIPVvbxi0TY2Z18EOfRmT3BrrK0HknJ4w7S7qIV29eLE4iPsxuKfHv9qckfAq8Hjc0tyJlU0FnDu8Hg6HvgBHP57a1n1bH7cYvll//KitLtqgLfowRiiWR831IHJOj/99HeohXe1JSkkfcHN68Lf7XwERT0OR4o16SFcHsZi5PE7Hvdyctvdl4NGZlu2J8qipHkTOp+NeqiOx2ts+pVZsb63YkzGTq07tmQI8mhrum7XYxroKEDmnRk++h3q46UfZoWVTIicVnYx+AXjUVFw1a7G1FcUgcmY6rsi1bPuYPRT+XNqJ3ROBx53idLMWi/xEzqhDaszqZOO4zb+N+WrXeOBx6ewusxaL/ETOqEMqG+vMs5sWD12SEjEOeKTHzzUY8Fpeikmhd5nK+ImcUYfcPNu+gvJ0tR119EOfpqSPfIBHdfllvQF3LVKYFHIFeYlckf8w996jpVZQOmtjhqEJQSMyj4SPAh7nU7foFbvzTQuTQq4gL5Er8kcdUmtjnbsezMhb3vJce3j7CBDxqKnOzObXOpDiifyFaUfnBr79fhYH9a9cbHwOBntXH9r6a+Dx/fEgsxKbezwYRI7IG/lTcupwP6uzU8HgwjAs4m2PuM+DhoGI+3c0ZiG0qqwApPghb+RPOiR3KrRd2U7blcd62/kmbPKsSXz/GeCRGjOjx4W2sn3jE1GvgciN8a1F3lwXtpN7OtC+u8jgyuAdvEgVfmCjB4j4OvZPPSoW40vx2rZEFYG8ib/s7qLO0wAGPKXi2ctaMXrParfChPXuICLvZFiPCMW4UnxiV7tp7G0tcbrxJP72+p4K6DwRoDnK6w++DrP2B6oefrZWBSJyT4R2b0Ji8aR47AtU1b0+wX4mtarKmCcCYus609pyxJrZ/TbvW+PSygAijn86w6ib81/2aKelLY5UfOS1ela/jciTW/gbfNbT4SkeZbQhDKOCF/SN27uyP0jh6EeToeKm2jSPKJlf9C8X+4P5fXENPIp4unTmKZ7O81map1SUyn1CFjp+HrfCCeSQdWgN26+q7RKRzY0/w7l/BoK+eIzPQeRF/FTcvGrVmYfRfHd2ogkax8OYTXPtY/a849jKAHI4e/A9qLr9ZPMx2qG9Pv8YH3mQUG9a8Ds9yZP3DmcqaBy0C17+mu3mqACH+pjlDqAPh0MnQfaXG6A49wjcK8lnW55lbNej5v8HQ9hf/IzX8fvsf21sq2/IJ8bF+JxQd+L3RGcqJE/LUDrXCvZ5abTVnIglvS9Hs1377gLGw7gyQrv2eBA5dqMxMsraymLCymk2Ebvfsq2NYvu8pgLz/zPGwXiUjIYRjy4TKifYiZLBEEr3Y4YOUkxd/0fr+F1+Ng92+9tAVwH9Mb8JXq6WU1mcsRRvCMV36mqhkmcXKesNpHnNi2Ekw7gBjoopAVOVIdvnW30XucSq6RM/K+gsmF0z2qMf9Id+yb8XxRtI8U1ydlHyVCrNZ870K3vSGBpJLTB+QB+LF+f5Wq5aO93ys+A5yvQdC5RXI/6srNy5SFkfuVgJ+Bc/43X8Huu9MclyNdqhPfkZSX49KY4zxTXpqVTJ88b06zpS8nKluw0cT8NpbI1h+B2Rf55hIoMvh4l0fTzVG0N2w8mPB/ntT3Hsuuu8sexJcho7jvTLD6Is6UFbI95E/jfUUihmNP0dSdeHU72hZOdOfpzJr31PnCTX+44A/fIONKacaXypKHO605gbTIK0/7vT9yqq70z2fchfj74jYNTbH7T3Y0+k+9L+rROJ0cKJrmvF2XOvwZj1ay8KE73X81S81GR2b2z9DzRDXz0l+Xs9AAAAAElFTkSuQmCC\');\n    color: #C09853;\n    }\n    .b-msgsystem-type-warning + .b-msgsystem-type-warning {\n        border-top: 1px solid #F9F1C7;\n        }\n.b-msgsystem-type-success {\n    background: #DFF0D8 no-repeat 2.7em 50% url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA7CAYAAADFJfKzAAAKXElEQVRo3tVbCVRV1xX1MwsIgkoRFBwgscikBkTSRq2miRpjnIixDkkVMdYposUhMgq2tQaM4JCotUZNamNjTDROC61jspyXAxqJKAoEBRFkRjh9m5zPujze+/9j+YCXtdfnv3vPOXv/e++5901t2hivaBgmMpgKkNdpbZ6LIoozk2AuwUKCpQQrAW1l3y25nTnbieJbvUCrQfMGOSy+vHh4dEZ0fFxW3O74nPjLCbkJOQkPEgpXPlxJ+MR3HEc92qE97PgHaFXCNcKwBDFLiWiHZWnLpsXdjzsYnxtfLgmixgJ2sIcf+ONeNxeGvaa5RWqF1oocnTjGZXl65Mq4nBV5K36Op6YC/MEv/Auim21ua4ThauH0opPtkrRl82Ky4x7F5qwgY0HyX4A4iMdz28zYvSz2ptWMfTP8Iu9GnY/JjqXmAuIhrjCnjSJYI8xN6wXnw6dG3Y8uisqKIV1Y92ADfff4AF0pvUrZldlU+LSIyqrLCAWf+I7jqEc7tNfnE3ERHzyEuaxpaqEYPjbhVyKiP7wXXSOB1PDVo730c2UuPUuBHex1+Ud88AAf5tUkgusLvR6RvDQzktQAkuXV5dQUBX72SP50xZP4rG0qwfWEzruwIHbxnQ9JCWuyk+l+RRYZo8Av/KvFBq//V7CYjGzCTsyetuj2shoJJEdK9idULf0Zs8A/4ijFB68Zx2e/x4IbnbREodbjt08MDE9fUhr+0xKS49v8A9ScBfGUeEj8isZsDnlJSFoGC9bwOmbVzsXOYc71hRfm34ogOb7J208tURBXiY/E82IHz46OvCyZGSJW26sY/+2mnXh/4dybi0iOpMwUasmC+Eq8pp2ctRS8mb/e3q0bvn1D+3ebdS284E9pC0nEXzOSqEb6a8mCOZxw+yOSc5P4PgZv2XDWmX2xB7WbciwsYea1BSTHvbL71BrK3bJ7pMQPvMGfdahmZ422V90H93CZfnlefuiV+STis6x/UWsqn2XtIjlH8AZ/oXc1akO4tlfH7pkc+sfLc0mO0qelrUos+CjxlPjPEHrXRC0D4wqC4x9OhR2eenE2idicuYNaY9mSuZPkXCX+R6CD9TTIzNrEZNs5qGvXSedmlU86P4tEZJRkGhS8qKKYYs6k0OB/v0uv7Q6l5Es7qLK6Sq8d2qAtbGALH/Clr9yReMm5gn+XV7q5QY9SojLh9cl+6KZRIe+cDSMRi67GGCS0pKqMXtoxnizX+NXD6L1zdGZw1KGN3A6+iiv1T50/S/zknKEDeliXieIQHvntxMSQH0JJxNa7hiWmtRe3NyCsxaE7p1TtUKdmB5/6CvjJOUOH0lDWZmHsLTu9eWjygbGnp5GIM3nnDBIbejhSlfTfzm5WtUOdmt30Q8v1xgU/OWfogB5hz6xpI+6YJDiPTJ2S9tbJ90jE7eK7BomN+369KunPb6hvL1GnZhd9Ollv3IziTJJzlnTcgB7ZjqpuycH4dhlxbEreG8enkoiCikKDxGY9yaXOG19pQNhn2ygqrVI/z0Ud2sjt4As+9ZW8ikck5zzi6JRc6GFdlqJYTOL2ElyHHZ1cOezYZBJhSDbVlqt5t2j4V2Fk/XEfsk8OpIn7F1JO8UO9dmiDtrCBLXzAl0GJUVpv5ZxfT51UDD2sqy5JmfIXXJzu+vvUiSTH81CUeEMP62ogFpnLbcihCZVDDk8gEZXVla1aaElVKck5/+7Q28UsVnvaZ6oV21YrduD+8fmDDoaQiEcVj1u12Ifl+STnPHDfuAfQIyw/pg16Nvjr0Td+8904EvFjYUarFnurKIPknCUdN9V6tm7OBnzxxuEB+8aQiKM5Z1q1WPCTc4YOpTlbLxv7bnw1JXDvWyTio6ubdQZLzfye8suMN9TzSgtqY6gV8JNzhg6lbFxvne25JODdfntGkoiQ1Nk6yZQ9La/d2yZd2KZzPW30KZzkCz7hGzHUCvjJOUOH2jpbt4Nq627n7b97eIX/f0aQiLSCdJ3EsGHHGYvLJwNrdz3pBZnPLBK28AFf8KnrZAC85FzB37qnvY/SDqre3lhCD6+tQ//r8+UwEhF1Psmg07SIE6vrdkCBO0No6clE+jo9le4UZlFV9dMGNjiGOrRBW9ho7eFL34YGvORcwR86lPbG9c56kJHdowLCvXa9RnIUVxl2peJM9iUK+nxCg+0fdkZunw4hzy2v1wL/45i8HWxPZ1/UGwd8lHiCv2zZqXcCX3c+i0lt2cXW74UdQwte/OJVErH8bKLBQxHnqEfunqEJ+8LJIaW/6kZfC7RBW9gYevUy8mwSyTmCN/hzcmpwPlvvSoUEJwk93f4etNFj5xCS4/qj9EbPQSSXE/fPUcqlnbVDc+aRmFrgfxxDna4EpFSu5N8kJX7gDf6sQ/FKhXYoW2uHsnWfDgO6/XNQYfftg0nEyP1hLb6uVtfU0PB900nOTeJbBN7CELZWuztQd3VRQmcJns5RfRLctg0kOcYemN2iYhFfiZdzbN9V4M38Va8u1rsbIAFPqbhrLE19XNYHX3Pd+luSI/7chhYRirhKfFw2BF83sTHDcuPO/G103RWod0eA1ygP2ze7jnbe/HKZ85aXSY4VZ9c1q1DEU+LhvCm42GZ4l1Hcq86G3BGQ964j7y1/3f4Dr6VOm4JrJJAcI7+ZSU9rjHt/Fv4RRyk+eLWf77UYPIWNv957PQ3u4nFG6y7B2z7Sd2OHT4NICa/snkyXHqYZRSj8wr9abPvlPtgDezNPp8bcxat3f5bXKWdO5X52sb47HDYGkho+OL7SoAvbhpQnlSW04MRfSFc8ic928GJ+zsK6ataYm9HicHbgBRrzwd92iVeK/fqAGgmkhjnHVlBa/k/PJBJ2sNflH/HBg4V68obf4VnuvDd4poLnQZ1gq/c9ltom9y2xXdePdCF41zsUcXI1fXnrIF18kEZZxblUWPGkVhQ+8R3HUb/41Ora9vp8Ii7iC0Jdmd8zPVOh+LQMp3OtYD+zwU7j2q7yS7NO7kvNBcRDXBWhTft4EDt24Tni3cbcJNBirscqqzV+RVZr/cloWOP3BHEQj5NRT+bRZELVBDtwMujO6d5f08NmqHnEC/+wSPR9bPGxHzUZJH+S360mnrZDpTh9OF53ju/Q1EIVn13krNeJ1zUPCb0l9NV0tBhoNqNbrHmc1w/mib4V5km+1Ggk+lbCHn7gD37ZvwfH68TxjfLsouJTqbyeOfKv7M5zqDf3QECbjhaDTEJc55mEe2wxjeyVarqy94+mq7zzTFd7l5gm+lDtJ77juFSPdiZvu86HXa39L356s193juPIcY36VKri88b869px8urMZxuYT714bvlL6Mfk+0sIkjBAQBAfD+B2/mzXi/24sd8OHMe6uZ43Vn2SnOeOHf/yv+Is6caXRjyZvBf3FMT48GdvPt6L2/VgO1f248h+bVriSXKd7wjwL2/Lc8qR55czZ05XnnNdWZD2f1eud+b2jmzfjv216DsCBr39wdd+bJi0PV+/dWAxWjjwca04G+E1mFb92ovGSO/1PBcvNbW6N7b+B2yJlhtD2EeEAAAAAElFTkSuQmCC\');\n    color: #468847;\n    }\n    .b-msgsystem-type-success + .b-msgsystem-type-success {\n        border-top: 1px solid #BFE1B1;\n        }\n.b-msgsystem-type-info {\n    background: #D9EDF7 no-repeat 2.7em 50% url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA7CAYAAADFJfKzAAAK6UlEQVR42tVbCVBUVxYdQEVpINIsQRgQUeLKgNEYnZpKdEonVpwJbnEdt3JEGQ0uDGNEBhQ3iEbcUFBBUVR0BEFBURBQxJEgMSibK6Ls0Cwt0NAsd96lXpvfrz/dSNE0OVWnoLv/u/ec/9677/3fv3+nRmhRajPU4ZD5jLb5LYAx14ewL2E/Ql3C/hwOYF7r0uP6YjvGfK832H/ywvVGHuGZX/tcy9+1K64oYs+tkkzfhLIS34TyWr/bFYB/8TW+j5/jcXg8tsP2/MY1b1KHCtMlQo09I3JX7owrvLk7vqxxT0I5fCixHbbHOBgP49L4Oj1rmp2L1OQcN38L7+iXe3bdKq0kYqG7iPEwLsaXme7Jua3FGa79zAYP1996OW/9jriSqp03S0FdJPGrMQ/mw7yYX629zPRmf+eDsQ7eMQUZPnHF0FPEfJhXNqe7zTAAmBKuIAwhfNDW1pbR0tISVltbu9b3araL9/VC8bYbRaCMx+6VQ1xuDWQVN0BxrRTEkhaQSFsBgX/xNb6Pn+NxeLyqmJh3U1jGMiJRjzOXtbpqchBhGChBDREZk1UNXrFveRn9uArKxFLoArAdtmdjsmxzD3+yjcgV4LDukmEAWEpYAQTNLa1w7eFLWHfyNkzb/l+Y4nURXILiIe5RPsiQXlAHntfevGdUZhU0NrdCNwDjoGkam5/uF3MOd8kwAAQBRVTac/jDplAwWnqElyuP3mw/GYjQtDI4nFwMhTVNoA5gXIzvcfU1LzeE/ezDGlZldA4QtLS2wfqQRDSkktsv3QdEYXUTkGZqBcYPTCmB76Py+djmcjxlBTWsumgBwAEg8DiXImfIZHkA/HV3JKwhw9d+o3xPm688BrUNTdCTiM0SgXvkS0VGvBDP8Qwej0VLpWEAcAaC0KTs92am74iAF6XVIAMaG+8eJmf41i+voacR86QS3C4/V+CG8JxHxlZ2Qros9VFmdiRhMxAE3HgEc/dehabmFkC8KG+AjAIxIPyvZciZPXc3FzSBQ4lvYMOlpwpcFXTPg9gxwPmrqncnAIO0V9VNruG5cD6tGBBhd3PkzN5+XACaAM5hv7hXgNq4/O5Cds14p1U2zHDmhVZDQ8NEiUTiLZVKE+4/LU1eez4bkElPRYDAosQ1K3onAU2hQCRBbQpccTR5N/FiSKirrDpr0bOhZ/PpFIvVZzJFa8KeAPJNlQQQk70uvjeK666mcS6tCPXJcfXZTBHq5/Qur1ltejYM5/lGrXIOzQSkZ2QuIN5UiOV6FeevptHQ1IIaFUj0O3N6V5uvV/vQOwjCpYGp8StPPQJkSEoBILAYcc3mvBVBR3iUXw6eF+7BuhO32wteTX0jqML9vCLYEpbSvmM7Hv8Y6iRS6AxOp75BnXIk+hPQB/pRqMycqxl9i9ETrZaffNi4PDgDkHFPygCB4mVGjZcFtG9A+BB4KxOEy+Q3ICNdT9FljB97ItMUNi24zJVU14EqvK6sR51yRP1WDl9Yox++QqVN16ePvtp8ct6SE+kgY1JeBSBwZ8XdbOB2kUVBhRg/491xzfSLBj78kl/e4S7tH2Rb2hlsuZyFWuWIPtAP9aXNO4Rn+sb4LwpMAxkvpxcCwu/KT3JC0p6VAAt2aWJ3Y208g+FgTEaHbezWBkNncCa1ALXKEX2wQ5lbhQWEprN/jI+bf/R/IKNPdDYg7mS/VXnWo3960aFwK+cg4EPw7ScdtnF0OwOdwYOXItQqR/SBftAXtypr0x2HAaH5LP+k3LlHUkHGBcfuAwJ75QvP8HYR49zPwglSRFhgURn+XQiv8M1n7wIfymvqwXr1cd42OJo6g/yKOtQqR+IjD/3I76jokkPHt8VM/+TKWQfvApeya9S8QhE8eFaMxpVWYodNoQqjoFHaAh3hXm4RjHD99SRhgdt4KokWQdUQvWsCVvNM/6Qy9IO+ZEsQtzgNJLT8Zn+S9Bv/ZOBS2tLK9iAuRTgEeSsmHo9LSWzGK3hZWtPJi/UWuJtTCNd/ftW+pn8I6sl6y2r+2/7EOvSDvrhFSoe+MCK0mrEvEViyRrlXP8PWnoS3lWLQNPh0ox/0xWdWSGg93S9eOv2HBOCS27N4W4adW7hOag7Ys83Aav7KL76OmhVSfzoyswNkZqfuviGa5nsLuKyqa5Kbk6zZH6LSQZOoEDcCq3nqruvl6Iez/Ogo9OzkbdF5f951A7h8XloLXHiFp8p2SXgzjpwMCWgSL8rEwGomPp6yPaswZ/+4JTz+yx2xwOWd3BJgUVZTj8UHK7PGgfpYzeiDmbOK1Xi86/GAP227BlweisuC3gzUx2pGH0w1Vlxnh8/bsnySVzRwufhIouotW3K2WqkMqI/VjD7YdVZhB6VnZjNmwtbIpgmeV4DLvGKl6yXOX7WyI6AuVivqFwwaas/uoBT2xoS2DhtC74zbEgFc7ojM6JVmURerFfWjD3ZvrHDVQ2g9bKG3m+PmS8CyrrEZehNQD59O1I8+2KsehetZQsv+Jr93GON2rtrePRy43H45HXoTfCLSgdWIulE/+mCuZxXvVBCaEQ4dumJf0Ci388Ayt6gKegOy3oqATx/qRv3og71TwV7A68mGsr7t2EmfrA+tHb4xDLic/eN10DRayeLutDcWWG1Erxh1c4awHjOEFe8uEg4itLOa573bzvUMsFxwIA40CczPp8t6gc9e1E31895dZIeyHqEx4WCtvrr2Ns6B2bbrQoGlX3QGaAKYl0+PjXNQjrauwB51U/0CdgizQ1mH07vmhMMGjneaZeMSIrH55ylg6Rv1EHoQmI/mZugSXPfR2K+daK+a830joKp3hXRvOdJ0xkYPqzXBbYTAcva+GHpHQX3A+JiHLz/qIvq+R51Ur1Dldz0UWsyOyoxwCOEYs7leQZarTwAfp+2IgMyCClAHMC7G7yi32Zz/BKA+qtOsU9/isZWZs+6a01LuYDLP55z5qiDoiO7kpppY0gTdgXcSKfw7LAWU5SN6wlAX1WeOetnvZ1WaZYazEaElnQ+OQiePALOVgW2E0BE3nk6GvC6ux9gO2yuLj/lRBxqluixQp+pv3lUbFhAKuYYNp7p4mCw7Um+y4igo42TvS7D1/D24kvYcMl+XQ3FV3ftHE/Avvsb38XPPC6ntx6uKiXkxP8eoJdUn6IpRtjr3o4GMOYYd+o+aMtdo0b5c4fIA6CliPszLGlX+tEzXDWNgCzpHxmjp9J2g/xfXvQOXHBQPXHoY1EUS/x3mwXyYl+a3UGa0uwwb0WIwhJZ7Rx0z26mCGZtPGS72rzFccgi6ixiPxD3d52O7qSTPWJpvCM1v1L1GWcO0aNGqZ0rXtWGEowk/1TYw+XLAFGcf/bk70wwWH2gy+PtB+FCSdlJsj3EwHsal8YfRfKaYn312Ua1PpdL1TEjP8mA6h0bTHviMCJ2sO2H++gHT/xWi5+SdqPet7zPB/L2VgoX76wWLDgD+xdf4Pn6Ox+l+vmADtsP2GIfGs6PxzWk+A/ap1B553pieXUNavAYRWtP5NILOLUfCcVT854QTCSdxOJG+/xk9zpG2G0HjWNO4xjSPHvu8cY8/SU7njiE98x8TWlKhttgzVPwo7Clqxp7+HU3fH0GPs6XtLGkcIY0r4HuSXKO/EaBnXh/nFBVqSoefBTVgRWnN+d+Sfm5OjxfS9gYYj+83Ar3u1x/03o8ARVPxA2kFFXJohO9zzAloO03/+kO1aXX8rkdDJn/7v9j6P5SDt02QcYOYAAAAAElFTkSuQmCC\');\n    color: #3A87AD;\n    }\n    .b-msgsystem-type-info + .b-msgsystem-type-info {\n        border-top: 1px solid #B3DBEF;\n        }\n\n.b-msgsystem-close {\n    position: absolute;\n    right: 0;\n    top: 50%;\n    width: 100px;\n    margin: -0.714em 0 0;\n    padding: 0 2em 0 0;\n    text-align: right;\n    cursor: pointer;\n    -webkit-user-select: none;\n       -moz-user-select: none;\n        -ms-user-select: none;\n            user-select: none;\n    color: #000;\n    }\n.b-msgsystem-close:hover {\n    color: #C00;\n    }\n    .b-msgsystem-close-text {\n        border-bottom: 1px dotted;\n        }\n    .b-msgsystem-close-ctrl {\n        margin: 0 0 0 0.1em;\n        vertical-align: middle;\n        font-size: 1.3em;\n        }\n\n\n/* xs-size screen (45em) ~ 630px */\n@media all and (max-width: 45em) {\n    .b-msgsystem {\n        padding: 10px 50px 10px 44px;\n        background-position: 10px 10px;\n        -webkit-background-size: 24px;\n             -o-background-size: 24px;\n                background-size: 24px;\n        }\n\n    .b-msgsystem-close {\n        position: absolute;\n        top: 0;\n        right: 0;\n        bottom: 0;\n        margin: 0;\n        width: 50px;\n        }\n        .b-msgsystem-close-text {\n            display: none;\n            }\n        .b-msgsystem-close-ctrl {\n            position: absolute;\n            top: 50%;\n            left: 50%;\n            margin: -0.6em 0 0 -0.2em;\n            text-shadow: 0 -1px 0 rgba(255, 255, 255, 0.5);\n            font-size: 1.7em;\n            color: rgba(0, 0, 0, 0.5);\n            }\n}\n\n/* Toggle */\n.b-msgsystem {\n    top: 0;\n    opacity: 1;\n    -webkit-transition: 0.3s top, 0.3s opacity;\n       -moz-transition: 0.3s top, 0.3s opacity;\n        -ms-transition: 0.3s top, 0.3s opacity;\n         -o-transition: 0.3s top, 0.3s opacity;\n            transition: 0.3s top, 0.3s opacity;\n    }\n.b-msgsystem-enter,\n.b-msgsystem-leave {\n    top: -100px;\n    opacity: 0;\n    }\n\n');
/*
 * LiveJournal page messages
 * https://conf.sup.com/pages/viewpage.action?pageId=6161047#id-1AddRemoveLinksandButtonsFRSCR-Warnings
 *
 * @example
 *   js:
 *     //= require js/core/angular/messages.js
 *
 *     angular.module('MyModule', ['LJ.Messages'])
 *     .controller('MyCtrl', ['$scope', 'Messages', function($scope, Messages) {
 *       Messages.error({ body: 'Call the cops!', title: 'Title is optional' });
 *     }]);
 *
 * .error, .info, .success, .warning methods are available.
 *
 * @example
 *   Alternatively, you can use it from Perl controller:
 *
 *   LJ::need_var(messages => [{
 *     title => 'hello', body => 'world',
 *     type => 'success'
 *   }]);
 */
!function(){"use strict";angular.module("LJ.Messages",["LJ.Templates","LJ.Directives"]).run(["$compile","$rootScope",function(a,b){a("<div lj-messages></div>")(b).appendTo("body")}]).factory("Messages",[function(){var a={items:LJ.get("messages")||[]},b=["error","info","success","warning"],c={};return a.add=function(d){return-1===b.indexOf(d.type)||c[d.body]?void 0:(c[d.body]=!0,a.items.push(d),a)},b.forEach(function(b){a[b]=function(c){c.type=b,a.add(c)}}),a.clear=function(){a.items.forEach(a._remove)},a._remove=function(b){var d=a.items.indexOf(b);return-1!==d&&a.items.splice(d,1),delete c[b.body],a},a}]).directive("ljMessages",["$timeout","Messages",function(a,b){return{templateUrl:"ljMessages.ng.tmpl",link:function(a){a.messages=b.items,a.close=function(a){return b._remove(a)}}}}])}();;

/* file-end: js/core/angular/messages.js 
----------------------------------------------------------------------------------*/

/**
 * @description Angular wrapper of LJ.Api
 * @author Valeriy Vasin (valeriy.vasin@sup.com)
 *
 * @example
 *
 *     angular.module('MyModule', ['LJ.Api'])
 *       .factory('myFactory', ['Api', function (Api) {
 *          return {
 *            fetch: function () {
 *              return Api.call('rpc.method', {param: 'value'});
 *            },
 *
 *            fetchCached: function () {
 *              return Api.call('rpc.method', { param: 'value' }, { cache: true });
 *            },
 *
 *            fetchCallback: function (callback) {
 *              Api.call('rpc.method', { param: 'value' }, callback);
 *            }
 *          };
 *       }]);
 *
 */

angular.module('LJ.Api', ['LJ.Messages'])
  .factory('Api', ['$cacheFactory', '$rootScope', '$q', 'Messages',
         function ( $cacheFactory,   $rootScope,   $q,   Messages ) {

      var factory = {},
          cacheData = $cacheFactory('LJApiData'),
          cachePromises = $cacheFactory('LJApiPromises');

      /**
       * Call JSON Rpc API
       *
       * @param  {String}   method                   JSON Rpc method
       * @param  {Object}   [params]                 JSON Rpc method params
       * @param  {Function} [callback]               Callback to call after data recieved
       * @param  {Object}   [options]                Additional api options
       * @param  {Boolean}  [options.cache]          Cache options: turn on/off cache for request
       * @param {Boolean}   [options.silent]         Turn on/off messages (error/info etc)
       * @param {Boolean}   [options.meta]           If set to `true` - result will be returned with meta
       *                                             information, e.g. { response, fromCache }
       *
       * @return {Promise}           Promise that will be resolved when data received
       */
      factory.call = function (method, params, callback, options) {
        var defer = $q.defer(),
            defaults = { cache: false, silent: false, meta: false },
            fromCache = false,
            promise,
            cacheKey;

        params = params || {};

        if (typeof callback === 'object') {
          options = callback;
          callback = null;
        }

        options = angular.extend(defaults, options || {});

        cacheKey = method + JSON.stringify(params);

        if ( options.cache ) {
          promise = cachePromises.get(cacheKey);

          if (promise) {
            fromCache = true;
          }
        }

        if ( !fromCache ) {
          promise = defer.promise;

          LJ.Api.call(method, params, function (response) {
            if (response.error) {
              defer.reject(response.error);
            } else {
              defer.resolve(response);
            }

            $rootScope.$apply();
          });

          // save original promise
          if ( options.cache ) {
            cachePromises.put(cacheKey, promise);
          }
        }

        // trigger events
        LJ.Event.trigger('api:request:change', method, true);
        promise.then(function() {
          LJ.Event.trigger('api:request:change', method, false);
        });

        // show errors/messages
        if ( !options.silent ) {
          promise.then(function showMessage(response) {
            var message = response.message;

            if (typeof message === 'undefined') {
              return;
            }

            message.body = message.content;
            Messages.add(message);
          }, function showErrorMessage(error) {

            // no error message provided
            if ( typeof error.message === 'undefined' ) {
              return;
            }

            Messages.error({ body: error.message });
          });
        }

        // add meta information
        if ( options.meta ) {
          promise = promise.then(function (response) {
            return {
              response:  response,
              fromCache: fromCache
            };
          });
        }

        if (typeof callback === 'function') {
          promise.then(callback);
        }

        return promise;
      };

      return factory;
    }
  ]);
;

/* file-end: js/core/angular/api.js 
----------------------------------------------------------------------------------*/


/* ---------------------------------------------------------------------------------
   file-start: js/core/angular/users.js 
*/


/* ---------------------------------------------------------------------------------
   file-start: js/core/angular/options.js 
*/

angular.module("LJ.Options",[]).factory("Options",[function(){return{create:function(a){function b(b,c){"undefined"==typeof c?angular.extend(a,b):a[b]=c}function c(b){return a[b]}function d(){return a}if("undefined"==typeof a&&(a={}),"object"!=typeof a)throw new TypeError("Options should be an object.");return{set:b,get:c,raw:d}}}}]);;

/* file-end: js/core/angular/options.js 
----------------------------------------------------------------------------------*/

!function(){"use strict";angular.module("Users",["LJ.Api","LJ.Options"]).factory("Relations",["$q","$timeout","UsersCache",function(a,b,c){function d(d,e,f){var g=a.defer(),h={addFriend:{is_invite_sent:!0},removeFriend:{is_friend:!1},subscribe:{is_subscribedon:!0},unsubscribe:{is_subscribedon:!1},join:{is_invite_sent:!0},leave:{is_member:!1},setBan:{is_banned:!0},setUnban:{is_banned:!1}},i={addFriend:{is_invite_sent:!1},removeFriend:{is_friend:!0},subscribe:{is_subscribedon:!1},unsubscribe:{is_subscribedon:!0},join:{is_invite_sent:!1},leave:{is_member:!0},setBan:{is_banned:!1},setUnban:{is_banned:!0}},j=angular.copy(c.get(d)||{});return"undefined"==typeof f&&(f={}),f.wait||c.update(d,h[e]||{}),LJ.Event.trigger("relations.change",{username:d,action:e,callback:function(a){b(function(){if(a.error)return f.wait||c.update(d,angular.extend(i[e],j)),void g.reject(a.error.message);var b=LJ.Object.pick(a,"is_banned","is_friend","is_member","is_subscriber","is_subscribedon","is_friend_of","is_invite_sent");c.update(d,b),g.resolve(a)})}}),g.promise}function e(a,b,e){var f=d(a,b?"subscribe":"unsubscribe",e);return b||f.then(function(){c.update(a,{filtermask:0})}),f}function f(a,b,c){return d(a,b?"addFriend":"removeFriend",c)}function g(a,b,c){return d(a,b?"join":"leave",c)}function h(a,b,c){return d(a,b?"setBan":"setUnban",c)}function i(a,b,c){return d(a,b?"banEverywhere":"unbanEverywhere",c)}return{toggleFriend:f,toggleSubscription:e,toggleMember:g,toggleBan:h,toggleBanEverywhere:i}}]).factory("Mask",function(){function a(a){return a>>>0}var b={};return b.change=function(b,c){var d=c.add,e=c.remove;return"undefined"!=typeof d&&(Array.isArray(d)||(d=[d]),b=d.reduce(function(b,c){return a(b|Math.pow(2,c))},b)),"undefined"!=typeof e&&(Array.isArray(e)||(e=[e]),b=e.reduce(function(b,c){var d=Math.pow(2,32)-1-Math.pow(2,c);return a(b&d)},b)),b},b.check=function(a,b){var c=Math.pow(2,b);return Boolean(a&c)},b}).factory("UsersCache",["$q","$cacheFactory","Options",function(a,b,c){function d(a){if("undefined"!=typeof a){var b=j.get(k.get("journal"))||{},c=a;return Array.isArray(a)||(a=[a]),a.forEach(function(a){if("object"==typeof a&&"undefined"!=typeof a.username){var c=b[a.username];b[a.username]=c?angular.extend(c,a):a}}),j.put(k.get("journal"),b),c}}function e(a){var b=j.get(k.get("journal"));return Boolean(b[a])}function f(a){var b,c=typeof a;if("string"===c)return b=j.get(k.get("journal")),b&&b[a]?b[a]:null;if("function"===c)return g(a);if("undefined"===c)return g();throw new TypeError("Incorrect argument passed.")}function g(a){var b,c=j.get(k.get("journal")),d=[];for(b in c)if(c.hasOwnProperty(b)){if(a&&!a(c[b]))continue;d.push(c[b])}return d}function h(a,b){var c=f(a)||{username:a};return angular.extend(c,b),d(c),c}var i,j=b("users"),k=c.create({journal:LJ.get("remoteUser")});return i={add:d,update:h,set:k.set,get:f,exists:e}}]).factory("Users",["$q","$timeout","Api","Mask","UsersCache","Options",function(a,b,c,d,e,f){function g(a){return B[C.get("type")][a]}function h(a){return"subscriptions"===C.get("type")?Boolean(a.is_subscribedon):!0}function i(a,b){return"undefined"==typeof b?a[j()]||1:void(a[j()]=b)}function j(){return"subscriptions"===C.get("type")?"filtermask":"groupmask"}function k(a,b,d){return c.call("user.get",{target:a,fields:b},d).then(function(a){var b=a.user;return e.add(b),b})}function l(a){return c.call("relations.list_friends",{journal:C.get("journal"),fields:a}).then(p("is_friend"))}function m(a){return c.call("groups.list_users",{journal:C.get("journal"),fields:a}).then(function(a){return e.add(a.users),a})}function n(a){return c.call("relations.list_subscriptions",{journal:C.get("journal"),fields:a}).then(p("is_subscribedon"))}function o(a){return c.call("relations.list_banned",{journal:C.get("journal"),fields:a}).then(p("is_banned"))}function p(a){return function(b){var c=b.users;return c.forEach(LJ.Function.set(a,!0)),e.add(c),c}}function q(a){return c.call("relations."+a+"_count").then(function(a){return a.count})}function r(b){return angular.isArray(b)||(b=[b]),0===b.length?a.reject("You should provide users to sync."):c.call(g("update"),{users:b,journal:C.get("journal")}).then(function(a){return e.add(a.users),a})}function s(a,b){var c=e.get(a);return c?d.check(i(c),b):!1}function t(a){return a.filter(e.exists).map(e.get).filter(h)}function u(a){var b=(a.filter||"").toLowerCase(),c=e.get(function(c){return h(c)&&d.check(i(c),a.id)?b&&-1===c.display_username.toLowerCase().indexOf(b)?!1:!0:!1});return a.limit&&(c=c.slice(0,a.limit)),c}function v(a){var b=(a.filter||"").toLowerCase(),c=e.get(function(c){return h(c)?d.check(i(c),a.id)?!1:b&&-1===c.display_username.toLowerCase().indexOf(b)?!1:!0:!1});return a.limit&&(c=c.slice(0,a.limit)),c}function w(a,b){Array.isArray(b)||(b=[b]);var c;return c="subscriptions"===C.get("type")?t(b):b.map(function(a){return e.get(a)||{username:a}}),c.forEach(function(b){i(b,d.change(i(b),{add:a}))}),r(c)}function x(a,b,c){Array.isArray(b)||(b=[b]);var e=t(b);return e.forEach(function(b){i(b,d.change(i(b),{remove:a}))}),c&&c.silent?void 0:r(e)}function y(a,b){return e.update(a,{alias:b}),c.call("user.alias_set",{target:a,alias:b})}function z(a){return function(b,c){return b[a].toLowerCase().localeCompare(c[a].toLowerCase())}}function A(){var a,b=C.get("journal");C.set.apply(null,arguments),a=C.get("journal"),a!==b&&e.set("journal",a)}var B={friends:{read:"relations.list_friends",readOne:"relations.get_friend",update:"groups.update_users"},subscriptions:{read:"relations.list_subscriptions",readOne:"relations.get_subscription",update:"filters.update_users"}},C=f.create({type:"friends",journal:LJ.get("remoteUser")});return{USERHEAD_FIELDS:{alias:1,journal_url:1,profile_url:1,userhead_url:1,is_invisible:1,journaltype:1},set:A,get:C.get,Cache:e,fetchUser:k,fetchBanned:o,fetchFriends:l,fetchGroupUsers:m,fetchSubscriptions:n,fetchCount:q,sync:r,alias:y,isUserInGroup:s,getExisting:t,fromGroup:u,outOfGroup:v,addToGroup:w,removeFromGroup:x,comparator:z}}])}();;

/* file-end: js/core/angular/users.js 
----------------------------------------------------------------------------------*/

Site.page.template['angular/ljUser.ng.tmpl'] = '<span\n    class=\"\n        ljuser\n        i-ljuser\n        i-ljuser-type-{{user.journaltype}}\n        \"\n    ng-class=\"{\n        \'i-ljuser-deleted\': user.is_invisible,\n        \'i-ljuser-nopopup noctxpopup\': user.noctxpopup,\n        \'i-ljuser-withalias\': user.alias,\n        \'i-ljuser-showalias\': user.showalias\n    }\"\n    data-ljuser=\"{{user.username}}\"\n    lj:user=\"{{user.username}}\"\n    >\n    <!--\n\n    Userhead\n    --><a\n        class=\"i-ljuser-profile\"\n        ng-href=\"{{user.profile_url}}\"\n        target=\"{{user.target ? user.target : \'_self\'}}\"\n        ><!--\n        --><img\n            class=\"i-ljuser-userhead\"\n            ng-src=\"{{user.userhead_url}}\"\n            ><!--\n    --></a><!--\n\n    Username\n    --><a\n        class=\"i-ljuser-username\"\n        ng-href=\"{{user.journal_url}}\"\n        title=\"{{user.alias}}\"\n        target=\"{{user.target ? user.target : \'_self\'}}\"\n        ><b ng-bind=\"user.display_name\"></b></a><!--\n    Alias\n    --><span class=\"i-ljuser-alias\"><!--\n        -->{{user.alias}}<!--\n    --></span><!--\n--></span>\n';
angular.module("LJ.User",["LJ.Api","LJ.Templates","Users"]).factory("ljUser",["$rootScope","Api","$q","$templateCache","$compile","$timeout","Users",function(a,b,c,d,e,f,g){function h(a){var b=c.defer(),d=g.Cache.get(a);return d&&d.userhead_url?(b.resolve(d),b.promise):g.fetchUser(a,g.USERHEAD_FIELDS,{cache:!0})}function i(b,d){var i=c.defer(),l=a.$new();return h(b).then(function(){var a;l.user=angular.extend({},g.Cache.get(b),d||{}),a=e(k)(l),f(function(){i.resolve(j.empty().append(a).html()),l.$destroy()})}),i.promise}var j=angular.element("<div />"),k=d.get("ljUser.ng.tmpl");return{prepare:h,get:i}}]).directive("ljUserDynamic",["$parse","Users","ljUser",function(a,b,c){return{templateUrl:"ljUser.ng.tmpl",replace:!0,scope:!0,compile:function(d,e){var f=a(e.ljUserDynamic),g=a(e.ljUserDynamicOptions);return function(a){var d=f(a),e=g(a);a.user=angular.extend({username:d,display_username:d},e||{}),c.prepare(d).then(function(){a.$watch(function(){return b.Cache.get(d)},function(b){angular.extend(a.user,b)},!0)})}}}}]);;

/* file-end: js/core/angular/ljUser.js 
----------------------------------------------------------------------------------*/


/* ---------------------------------------------------------------------------------
   file-start: js/settings/services/filters/filters.js 
*/




;(function () {
  'use strict';

  angular.module('GroupsAndFilters.Services.Filters', ['LJ.Api', 'LJ.Options', 'Users'])

    // filter for output filters and groups
    .filter('filtersOrder', function () {
      return function filtersOrder(filters) {
        // copy array to prevent digest loop during sort
        var copy = filters.slice(0);

        copy.sort(function (a, b) {
          if ( a.id === 31 ) {
            return -1;
          }

          if (b.id === 31) {
            return 1;
          }

          var aName = a.name.toLowerCase(),
              bName = b.name.toLowerCase();

          return aName > bName ? 1 : -1;
        });

        // return sorted copy
        return copy;
      };
    })

    .factory('FilterGroupFactory', ['$q', '$timeout', 'Api', 'Options', 'Users',
                          function ( $q,   $timeout,   Api,   Options,   Users ) {

        /**
         * Filter/Group factory
         *
         * @class FilterGroupFactory
         * @type {Angular.Service}
         * @constructor
         * @private
         */
        function Factory() {
          angular.extend(
            this,
            {
              MAX_COUNT: 31,

              // filters cache
              filters: [],


              // API key: filters/groups
              key: 'filters',

              // RPC endpoints: should be redefined
              rpc: {}
            },
            Options.create({
              journal: LJ.get('remoteUser')
            })
          );
        }

        /**
         * Get filter JSON params, exclude not needed
         *
         * @method toJSON
         * @param  {Object} filter Filter object
         * @return {Object}    Filtered fields
         */
        Factory.prototype.toJSON = function (filter) {
          var json = angular.copy(filter);
          delete json.checked;
          delete json.users;
          return json;
        };

        /**
         * Generate id for new filter/group based on existed:
         * next free id (that is not used by any existed filter)
         *
         * @method nextId
         * @return {Number} Generated next id
         */
        Factory.prototype.nextId = function () {
          var id  = null,
              ids = this.filters.map( LJ.Function.get('id') ),

              // id = 0 - is not used
              i = 1,
              max = this.MAX_COUNT;

          while (i < max && id === null) {
            if ( ids.indexOf(i) === -1) {
              id = i;
            }
            i += 1;
          }

          return id;
        };

        /**
         * Sync current state of filter(s) with server
         *
         * @method sync
         * @param  {Array|Object} filters Filter instance(s)
         */
        Factory.prototype.sync = function (filters) {
          var params = {};

          // wrap single filter to array
          if ( !angular.isArray(filters) ) {
            filters = [filters];
          }

          params[this.key] = filters.map(this.toJSON);
          params.journal   = this.get('journal');

          return Api.call(this.rpc.update, params);
        };

        /**
         * Fetch filters from server
         *
         * @method fetch
         *
         * @param {Object}  [options]             Request option
         * @param {Boolean} [options.cache=false] Cache request or not
         *
         * @return {Promise} Promise that will be resolved with filters data
         */
        Factory.prototype.fetch = function (options) {
          var that = this,
              params = {
                journal: this.get('journal')
              };

          options = angular.extend(options || {}, { cache: false });

          return Api.call(this.rpc.read, params, options).then(function (response) {
            // save fetched filters
            that.filters = response[that.key];
            return that.filters;
          });
        };

        /**
         * Check is filter/group name uniq
         * @param  {String}  name Filter/group name to check
         * @return {Boolean}      Check result
         */
        Factory.prototype._isNameUniq = function (name) {
          var names = this.filters.map(function (filter) {
            return filter.name.toLowerCase();
          });

          name = name.toLowerCase();

          return names.indexOf(name) === -1;
        };

        /**
         * Create filter
         *
         * @method create
         * @param  {String} name  Filter name
         * @return {Promise}      Promise that will be resolved with created
         *                        filter data
         */
        Factory.prototype.create = function (name) {
          var filter;

          name = name.trim();

          if ( name.length === 0 ) {
            return $q.reject(
              this.key === 'filters' ?
              LJ.ml('api.error.filters.filter_name_not_specified') :
              LJ.ml('api.error.groups.group_name_not_specified')
            );
          }

          // check if filter name is uniq
          if ( !this._isNameUniq(name) ) {
            return $q.reject(
              this.key === 'filters' ?
              LJ.ml('api.error.filters.filter_already_exist', { name: name }) :
              LJ.ml('api.error.groups.group_already_exist', { name: name })
            );
          }

          filter = {
            id:      this.nextId(),
            name:    name,
            users:   [],
            public:  false,
            journal: this.get('journal')
          };

          this.filters.push(filter);

          return Api.call(this.rpc.create, filter);
        };

        /**
         * Remove filter(s)
         *
         * @method remove
         * @param  {Object|Object[]} filters  Filters to remove
         * @return {Promise}                  Promise that will be resolved
         *                                    with removed filters data
         */
        Factory.prototype.remove = function (filters) {
          var that   = this,
              params = {};

          filters = Array.isArray(filters) ? filters : [filters];

          params[this.key] = filters.map( LJ.Function.get('id') );
          params.journal   = this.get('journal');

          // splice filters
          filters.forEach(function (filter) {
            that.filters.splice( that.filters.indexOf(filter), 1 );
          });

          return Api.call(this.rpc.remove, params);
        };

        /**
         * Get filter/group count
         * @method getCount
         * @return {Promise} Promise that will be resolved when server respond
         */
        Factory.prototype.getCount = function () {
          return Api.call(this.rpc.count, {
            journal: this.get('journal')
          }).then( LJ.Function.get('count') );
        };

        /**
         * Get filters/groups for user
         * @param  {String} username Username of the user
         * @return {Array}           Array of filters
         */
        Factory.prototype.by = function (username) {
          var user = Users.Cache.get(username);

          if ( !user ) {
            return [];
          }


          return this.filters.filter(function (filter) {
            return Users.isUserInGroup(username, filter.id);
          });
        };

        return Factory;
      }
    ])

    .factory('Filter', ['FilterGroupFactory', function (Factory) {
      /**
       * @class Filter
       * @extends FilterGroupFactory
       * @constructor
       */
      function Filter() {
        /**
         * RPC endpoints
         * @property {Object} rpc
         *
         * @property {String} rpc.create  Create filter endpoint
         * @property {String} rpc.read    Read filters endpoint
         * @property {String} rpc.update  Update filter(s) endpoint
         * @property {String} rpc.remove  Remove filter(s) endpoint
         * @property {String} rpc.count   Count filters endpoint
         */
        this.rpc = {
          create: 'filters.create',
          read:   'filters.list',
          update: 'filters.update',
          remove: 'filters.remove',
          count:  'filters.count'
        };

        /**
         * API key: filters/groups
         * @property {String} key
         */
        this.key = 'filters';
      }

      Filter.prototype = new Factory();

      /**
       * Update privacy for filter(s)
       *
       * @method _setPrivacy
       * @private
       * @param {Objects[]|Object} filters  Filter(s) object(s) to set privacy
       * @param {String} privacy            Privacy to be set: 'public' or 'private'
       * @return {Promise}                  Promise that will be resolved when sync is done
       */
      Filter.prototype._setPrivacy = function (filters, privacy) {
        filters = Array.isArray(filters) ? filters : [filters];

        filters.forEach( LJ.Function.set('public', privacy === 'public') );

        return this.sync(filters);
      };

      /**
       * Update filter(s) privacy to private
       *
       * @method private
       * @param {Object|Object[]} filters   Filter(s) to update
       * @return {Promise}          Promise that will be resolved
       *                    with update filters data
       */
      Filter.prototype.private = function (filters) {
        return this._setPrivacy(filters, 'private');
      };

      /**
       * Update filter(s) privacy to public
       *
       * @method public Set privacy to public
       * @param {Object|Object[]} filters   Filter(s) to update
       * @return {Promise}                  Promise that will be resolved
       *                                    with update filters data
       */
      Filter.prototype.public = function (filters) {
        return this._setPrivacy(filters, 'public');
      };

      return new Filter();
    }])

    .factory('Group', ['FilterGroupFactory', function (Factory) {

      /**
       * @class Group
       * @extends FilterGroupFactory
       * @constructor
       */
      function Group() {
        /**
         * RPC endpoints
         * @property {Object} rpc
         *
         * @property {String} rpc.create  Create group endpoint
         * @property {String} rpc.read    Read groups endpoint
         * @property {String} rpc.update  Update group(s) endpoint
         * @property {String} rpc.remove  Remove group(s) endpoint
         * @property {String} rpc.count   Count groups endpoint
         */
        this.rpc = {
          create: 'groups.create',
          read:   'groups.list',
          update: 'groups.update',
          remove: 'groups.remove',
          count:  'groups.count'
        };

        /**
         * Key for group and filter distinction
         *
         * @property {String} key
         * @type {String}
         */
        this.key = 'groups';
      }

      Group.prototype = new Factory();

      return new Group();
    }]);
}());
;

/* file-end: js/settings/services/filters/filters.js 
----------------------------------------------------------------------------------*/


/* ---------------------------------------------------------------------------------
   file-start: js/settings/directives/filtersFor.js 
*/


LJ.injectStyle('.b-filterset{max-width:290px;font:14px/1.4 Arial,sans-serif;color:#000}.b-filterset DD,.b-filterset DT,.b-filterset TH,.b-filterset TD,.b-filterset P,.b-filterset DIV,.b-filterset SPAN,.b-filterset EM,.b-filterset STRONG,.b-filterset B,.b-filterset I,.b-filterset LI,.b-filterset LABEL,.b-filterset PRE,.b-filterset CODE,.b-filterset KBD{font-size:100%}.b-filterset .i-ljuser-userhead{vertical-align:top!important;margin:1px 0 0!important;border:none!important}.b-filterset .i-ljuser-username:link,.b-filterset .i-ljuser-username:visited,.b-filterset .i-ljuser-username:hover,.b-filterset .i-ljuser-username:active{color:#0051B7!important;text-decoration:none!important;border:none!important}.b-filterset .b-filterset-title{font-weight:700!important}.b-filterset .b-filterset-title,.b-filterset .b-filterset-subtitle{margin:0 1.142em .5em 0!important;color:#222!important}.b-filterset-list{position:relative;z-index:1;overflow:auto;max-height:14em;min-width:220px;margin:0 0 .3em;padding:0;background-attachment:scroll;-moz-background-clip:border-box;background-clip:border-box;background-image:-webkit-radial-gradient(farthest-side at 50% 0,rgba(0,0,0,.1),transparent),-webkit-radial-gradient(farthest-side at 50% 100%,rgba(0,0,0,.1),transparent);background-image:-o-radial-gradient(farthest-side at 50% 0,rgba(0,0,0,.1),transparent),-o-radial-gradient(farthest-side at 50% 100%,rgba(0,0,0,.1),transparent);background-image:-moz-radial-gradient(farthest-side at 50% 0,rgba(0,0,0,.1),transparent),-moz-radial-gradient(farthest-side at 50% 100%,rgba(0,0,0,.1),transparent);background-image:radial-gradient(farthest-side at 50% 0,rgba(0,0,0,.1),transparent),radial-gradient(farthest-side at 50% 100%,rgba(0,0,0,.1),transparent);-moz-background-origin:padding-box;background-origin:padding-box;background-position:0 0,0 100%;background-repeat:no-repeat;-moz-background-size:100% 7px;background-size:100% 7px}.b-filterset-list:before,.b-filterset-list:after{position:relative;z-index:-1;display:block;content:\"\";height:14px;margin:0 0 -14px;background:-webkit-linear-gradient(top,#F4F5F6,#F4F5F6 30%,rgba(244,245,246,0)) 0 0;background:-moz-linear-gradient(top,#F4F5F6,#F4F5F6 30%,rgba(244,245,246,0)) 0 0;background:-o-linear-gradient(top,#F4F5F6,#F4F5F6 30%,rgba(244,245,246,0)) 0 0;background:linear-gradient(to bottom,#F4F5F6,#F4F5F6 30%,rgba(244,245,246,0)) 0 0}.b-filterset-list:after{margin:-14px 0 0;background:-webkit-linear-gradient(top,rgba(228,229,233,0),#E4E5E9 70%,#E4E5E9) 0 0;background:-moz-linear-gradient(top,rgba(228,229,233,0),#E4E5E9 70%,#E4E5E9) 0 0;background:-o-linear-gradient(top,rgba(228,229,233,0),#E4E5E9 70%,#E4E5E9) 0 0;background:linear-gradient(to bottom,rgba(228,229,233,0),#E4E5E9 70%,#E4E5E9) 0 0}.b-filterset-list LI{margin:0;padding:0;list-style-type:none}.b-filterset-list LI.loading{background:url(/img/preloader/preloader-blue-gray.gif?v=16423) no-repeat 100% 50%}.b-filterset-list LABEL{display:block;white-space:nowrap;line-height:1.333;font-size:.857em}.b-filterset-list LABEL:hover{background:#7292BD;color:#FFF}.b-filterset-addnew-input{display:block;margin:0 0 .5em;white-space:nowrap;line-height:1.333;font-size:.857em}.b-filterset-addnew{margin:.5em 0 0}.b-filterset-pseudo{font-size:.857em;color:#0051B7}.b-filterset-submit{text-align:right}.b-filterset-loader:after,.b-filterset-loader:before{display:inline-block;visibility:hidden;content:\'\';width:21px;height:21px;margin:-2px 0 0 4px;background:url(/img/preloader/preloader-blue-gray.gif?v=16423) no-repeat 50% 50%;vertical-align:middle}.b-filterset-loader-before:after,.b-filterset-loader-after:before{display:none}.b-filterset-loading .b-filterset-loader-after:after,.b-filterset-loading .b-filterset-loader-before:before{visibility:visible}');
Site.page.template['angular/controlstrip/filters.ng.tmpl'] = '<div class=\"b-filterset-body\" ng-class=\"{ \'b-filterset-loading\': model.loading }\">\n    <ul class=\"b-filterset-section b-filterset-list\">\n        <li ng-repeat=\"filter in filters | filtersOrder\" ng-class=\"{ \'loading\': loading[filter.id] }\">\n            <label>\n                <input\n                    ng-checked=\"checked = isActive(filter.id)\"\n                    ng-change=\"toggleFilter(filter.id, checked)\"\n                    ng-model=\"checked\"\n                    type=\"checkbox\"\n                    class=\"b-filterset-checkbox\"\n                    >{{filter.name}}\n            </label>\n        </li>\n\n        <li ng-show=\"model.showCreateDialog\">\n            <span class=\"b-filterset-addnew-input\" >\n                <form ng-submit=\"createFilter()\">\n                    <input\n                        ng-model=\"model.newFilter\"\n                        focus-and-select=\"model.showCreateDialog\"\n                        type=\"text\"\n                        />\n                    <input type=\"submit\" lj-ml=\"filterset.button.save\" lj-ml-attr=\"value\" />\n                </form>\n            </span>\n        </li>\n    </ul>\n\n    <div\n        ng-hide=\"model.showCreateDialog || isFiltersCountReached()\"\n        class=\"b-filterset-section b-filterset-addnew\">\n        <span\n            ng-if=\"isFiltersFor\"\n            ng-click=\"model.showCreateDialog = true\"\n            lj-ml=\"filterset.link.addnewfilter\"\n            class=\"b-filterset-pseudo b-pseudo\"\n            ></span>\n        <span\n            ng-if=\"isGroupsFor\"\n            ng-click=\"model.showCreateDialog = true\"\n            lj-ml=\"filterset.link.addnewgroup\"\n            class=\"b-filterset-pseudo b-pseudo\"\n            ></span>\n    </div>\n</div>\n';
!function(){"use strict";function a(a,b,c,d,e,f){function g(){return Array.isArray(a.usernames)?a.usernames:[a.usernames]}a.loading={},a.filters=[],c.fetch({cache:!0}).then(function(b){a.filters=b}),a.model={newFilter:"",showCreateDialog:!1},a.toggleFilter=function(b,c){var e;f.clear(),a.loading[b]=!0,e=c?d.addToGroup(b,g()):d.removeFromGroup(b,g()),e.then(function(){a.loading[b]=!1})},a.isActive=function(a){var b=g().every(function(b){return d.isUserInGroup(b,a)});return b},a.isCountReached=function(){return a.filters.length>=c.MAX_COUNT},a.createFilter=function(){var b=a.model.newFilter.trim();a.resetFilter(),0!==b.length&&(a.model.loading=!0,c.create(b).then(function(b){var c=b.filter;d.addToGroup(c.id,g()).then(function(){a.model.loading=!1})}))},a.resetFilter=function(){a.model.newFilter="",a.model.showCreateDialog=!1},a.$on("bubble:open:controlstrip",a.resetFilter)}angular.module("Filters.List",[]).controller("FiltersForCtrl",["$scope","$q","Filter","Users","Bubble","Messages",a]).controller("GroupsForCtrl",["$scope","$q","Group","Users","Bubble","Messages",a]).directive("filtersFor",[function(){return{controller:"FiltersForCtrl",scope:{usernames:"=filtersFor"},templateUrl:"filters.ng.tmpl",link:function(a){a.isFiltersFor=!0}}}]).directive("groupsFor",[function(){return{controller:"GroupsForCtrl",scope:{usernames:"=groupsFor"},templateUrl:"filters.ng.tmpl",link:function(a){a.isGroupsFor=!0}}}])}();;

/* file-end: js/settings/directives/filtersFor.js 
----------------------------------------------------------------------------------*/

Site.page.template['angular/controlstrip/controlstrip.ng.tmpl'] = '<div\n  class=\"b-filterset\"\n  ng-class=\"{ \'b-filterset-loading\': loading }\"\n  >\n\n  <!-- subscribe user -->\n  <div class=\"b-filterset-title\" ng-show=\"mode == \'subscribe\'\" lj-ml=\"filterset.title.subscribed.journal\" lj-ml-resolve=\"mlResolve\"></div>\n\n  <!-- add user -->\n  <div class=\"b-filterset-title\" ng-show=\"mode == \'add\'\" lj-ml=\"filterset.title.addfriend.journal\" lj-ml-resolve=\"mlResolve\"></div>\n  <div class=\"b-filterset-subtitle\" ng-show=\"mode == \'add\'\" lj-ml=\"filterset.subtitle.addfriend.journal\" lj-ml-resolve=\"mlResolve\"></div>\n\n  <!-- subscribe community -->\n  <div class=\"b-filterset-title\" ng-show=\"mode == \'watch\'\" lj-ml=\"filterset.title.subscribed.community\" lj-ml-resolve=\"mlResolve\"></div>\n\n  <!-- join community -->\n  <div class=\"b-filterset-title\" ng-show=\"mode == \'join\' || mode == \'joinSubscribed\'\" lj-ml=\"filterset.title.join\"></div>\n  <div class=\"b-filterset-subtitle\" ng-show=\"mode == \'join\'\" lj-ml=\"filterset.subtitle.join\" lj-ml-resolve=\"mlResolve\"></div>\n  <div class=\"b-filterset-section b-filterset-submit\" ng-show=\"mode == \'join\'\">\n      <div class=\"b-ljbutton b-filterset-loader b-filterset-loader-before\">\n          <input type=\"submit\" lj-ml=\"filterset.submit.subscribe\" lj-ml-attr=\"value\" ng-click=\"subscribeAfterJoin()\" />\n      </div>\n  </div>\n\n  <!-- filters section -->\n  <!-- Notice: extra div here is because of bug in AngularJS: https://github.com/angular/angular.js/issues/3981 -->\n\n  <div ng-show=\"mode !== \'join\'\">\n    <div\n      class=\"b-filterset-subtitle b-filterset-loader b-filterset-loader-after\"\n      lj-ml=\"filterset.subtitle.filters\"\n      ></div>\n      <div filters-for=\"username\"></div>\n  </div>\n</div>\n';
/*global ContextualPopup, Hourglass */

;(function ($) {
  'use strict';

/**
 * Event tracking helper
 */
function trackEvent(value) {
  LJ.Track.event('Relations', 'Menu', value);
}

angular.module('Relations.Menu', [
  'LJ.Templates',
  'LJ.Bubble',
  'LJ.Directives',
  'LJ.User',
  'LJ.Messages',
  'GroupsAndFilters.Services.Filters',
  'Users',
  'Filters.List'
  ])

  // fix interactions with history API
  .value('$anchorScroll', null)

  .controller('MenuCtrl', ['$scope', 'Bubble', '$timeout', '$q', 'ljUser', 'Filter', 'Users', 'Relations', 'Messages',
                 function ( $scope,   Bubble,   $timeout,   $q,   ljUser,   Filter,   Users,   Relations,   Messages ) {

    var status   = $('.w-cs-status'),
        username = LJ.get('journal.username'),
        hourglass,
        mlDefer;

    // turn on subscriptions mode
    Users.set({ type: 'subscriptions' });

    // need it in scope to show lj-user-dynamic
    $scope.username = username;
    $scope.filters  = [];
    $scope.status   = LJ.get('controlstrip.status');

    // cache current journal
    Users.Cache.add( LJ.get('journal') );

    // override error showing method
    ContextualPopup.showNote = angular.identity;

    mlDefer = $q.defer();
    $scope.mlResolve = { promise: mlDefer.promise };
    ljUser.get(username, {
      noctxpopup: true
    }).then(function (html) {
      mlDefer.resolve({ username: html });
    });

    // watch current journal and update states
    $scope.$watch(function () {
      return Users.Cache.get(username);
    }, function (user) {
      $scope.states = LJ.Object.pick(user, 'is_friend', 'is_member', 'is_subscribedon', 'is_invite_sent');
    }, true);

    /**
     * Toggle loading state
     * @param  {Boolean} state  If `true`: show loader, otherwise: hide loader
     */
    $scope.toggleLoading = function (state) {
      $scope.loading = state;
    };

    // clear messages when relations change request starts
    LJ.Event.on('relations.change', function () {
      $timeout(Messages.clear);
    });

    function changeRelation(action, $event) {
      var relationPromise;

      if ( $event ) {
        showHourglass($event);
      }

      switch (action) {
        case 'addFriend':
          relationPromise = Relations.toggleFriend(username, true, { wait: true });
          break;
        case 'removeFriend':
          relationPromise = Relations.toggleFriend(username, false, { wait: true });
          break;
        case 'join':
          relationPromise = Relations.toggleMember(username, true, { wait: true });
          break;
        case 'leave':
          relationPromise = Relations.toggleMember(username, false, { wait: true });
          break;
        case 'subscribe':
          relationPromise = Relations.toggleSubscription(username, true, { wait: true });
          break;
        case 'unsubscribe':
          relationPromise = Relations.toggleSubscription(username, false, { wait: true });
          break;
      }

      // Notice: .finally() is not allowed in IE8,
      // that is why we need call it with ['finally']() notation
      return relationPromise['finally'](hideHourglass).then(function (data) {

        // Hide contextual popup if we are changing status from contextual popup
        // in control strip.
        if ( ContextualPopup.currentElement === status.find('.ljuser img').get(0) ) {
          ContextualPopup.hide();
        }

        // show error
        if (data.error) {
          return $q.reject(data.error.message);
        }

        // show messages
        if (data.message) {
          data.message.body = data.message.content;
          Messages.add(data.message);
        }

        // update controlstrip status
        if (typeof data.controlstrip_status !== 'undefined') {
          $scope.status = data.controlstrip_status;
        }

        // We should fetch data updates to show filters dialog when:
        // 1) we are subscribing to user/community
        // 2) we are adding friend (add friend also subscribes us to user)
        // 3) we are joining community that we have been subscribed to already
        if ( action === 'subscribe' || action === 'addFriend' || (action === 'join' && data.is_subscribedon) ) {
          return fetchFilters();
        }

        // Reset filters. This line fixes incorrect ng-checked directive behavior:
        // When lots of digest loops in a time it could stay not synced with data
        // This code could be removed after fixing performance issue
        $scope.filters = [];
      }, function onFail(message) {
        Messages.error({ body: message });
      });
    }

    /**
     * Fetch filters data and user filtermask
     * @return {Promise}  Promise that will be resolved when data is ready
     */
    function fetchFilters() {
      var user = Users.Cache.get(username),
          userPromise;

      // we could fetch filters and filtermask only if we subscribed to user
      if ( !user.is_subscribedon ) {
        return $q.reject();
      }

      if ( !user.filtermask ) {
        // fetch filtermask
        userPromise = Users.fetchUser(username, { filtermask: 1 });
      } else {
        // filtermask has been fetched before
        userPromise = $q.defer().resolve();
      }

      return $q.all({
        filters: Filter.fetch({ cache: true }),
        user:    userPromise
      }).then(function (results) {
        $scope.filters = results.filters;
      });
    }

    $scope.subscribe = function ($event) {
      $event.preventDefault();
      trackEvent('subscribe');

      changeRelation('subscribe', $event).then(function () {
        if ( $scope.states.is_subscribedon ) {
          $scope.mode = 'subscribe';
          Bubble.open('controlstrip', 'unsubscribe');
        }
      });
    };

    $scope.unsubscribe = function ($event) {
      $event.preventDefault();
      trackEvent('unsubscribe');
      changeRelation('unsubscribe', $event);
    };

    $scope.addFriend = function ($event) {
      $event.preventDefault();
      trackEvent('add friend');
      changeRelation('addFriend', $event).then(function () {
        if ( $scope.states.is_friend ) {
          $scope.mode = 'add';
          Bubble.open('controlstrip', 'removeFriend');
        }
      });
    };

    $scope.removeFriend = function ($event) {
      $event.preventDefault();
      trackEvent('remove friend');
      changeRelation('removeFriend', $event);
    };

    $scope.watch = function ($event) {
      $event.preventDefault();
      trackEvent('subscribe to community');
      changeRelation('subscribe', $event).then(function () {
        if ( $scope.states.is_subscribedon ) {
          $scope.mode = 'watch';
          Bubble.open('controlstrip', 'unwatch');
        }
      });
    };

    $scope.unwatch = function ($event) {
      $event.preventDefault();
      trackEvent('unsubscribe from community');
      changeRelation('unsubscribe', $event);
    };

    $scope.join = function ($event) {
      $event.preventDefault();
      trackEvent('join community');
      changeRelation('join', $event).then(function () {
        if ( $scope.states.is_member ) {
          $scope.mode = $scope.states.is_subscribedon ? 'joinSubscribed' : 'join';
          Bubble.open('controlstrip', 'leave');
        }
      });
    };

    $scope.leave = function ($event) {
      $event.preventDefault();
      trackEvent('leave community');
      changeRelation('leave', $event);
    };

    /**
     * Subscribe to community updates in a bubble after join action
     */
    $scope.subscribeAfterJoin = function () {
      $scope.toggleLoading(true);
      trackEvent('subscribe to community (after join)');
      changeRelation('subscribe').then(function () {
        $scope.toggleLoading(false);
        $scope.mode = 'watch';
      });
    };

    /**
     * Show hourglass for event
     *
     * @param  {jQuery.Event} event jQuery event (click)
     */
    function showHourglass(event) {
      if (hourglass) {
        hideHourglass();
      }

      hourglass = new Hourglass().setEvent(event).show();
    }

    /**
     * Hide hourglass
     */
    function hideHourglass() {
      if (hourglass) {
        hourglass.remove();
        hourglass = null;
      }
    }
  }]);

}(jQuery));
;

/* file-end: js/relations/menu.js 
----------------------------------------------------------------------------------*/

!function(a){"use strict";function b(){var b,c,d,e;LJ.get("remoteUser")&&(b=a("#lj_controlstrip_new .w-cs-filter-inner"),0!==b.length&&(c=a("#sortByPoster"),d=c.find("[name=poster]"),e=c.find("[type=image]"),b.bubble({target:"#lj_controlstrip_new .w-cs-filter-icon",showOn:"click",closeControl:!1}),d.input(function(){this.value.length?e.css("opacity",1).prop("disabled",!1):e.css("opacity",0).prop("disabled",!0)}),c.on("submit",function(a){d.val().length||a.preventDefault()})))}function c(){a("#lj_controlstrip_new input[placeholder]").labeledPlaceholder()}function d(){b(),c(),LJ.Flags.isEnabled("new_friends_and_subscriptions")&&!e&&angular.bootstrap(a("[data-controlstrip]"),["Relations.Menu"]),function(){function b(a){var b=a.split(",").map(Number);return new Date(b[0],b[1],b[2])}var c=a("#lj_controlstrip_new .w-cs-i-calendar a"),d=/^\/friends\/?$/.test(location.pathname),e=LJ.get("current_journal.url_journal"),f=LJ.get("controlstrip.calendar.earlyDate"),g=LJ.get("controlstrip.calendar.lastDate");c.length&&(c.calendar({showOn:"click",closeControl:!1,dayRef:e+"/"+(d?"friends/":"")+"%Y/%M/%D",allRefs:d,startMonth:f?b(LJ.get("controlstrip.calendar.earlyDate")):new Date,endMonth:g?b(LJ.get("controlstrip.calendar.lastDate")):new Date,classNames:{container:"w-cs-calendar"},ml:{caption:LJ.ml("web.controlstrip.view.calendar")}}).on("daySelected",function(a){a.preventDefault()}),d||c.calendarEvents({fetchOnFirstDisplay:!0}))}(),a(".b-loginpopup").bubble({target:".i-auth-control",closeControl:!1,showOn:"click"}),a("input.text").labeledPlaceholder()}var e=Boolean("undefined"!=typeof document.documentMode&&document.documentMode<8);a(function(){document.getElementById("lj_controlstrip")||document.getElementById("lj_controlstrip_new")?d():a.get(LiveJournal.getAjaxUrl("controlstrip"),{user:LJ.get("currentJournal")},function(b){a(b).appendTo(document.body),d()})})}(jQuery);;

/* file-end: js/controlstrip.js 
----------------------------------------------------------------------------------*/
/* ---------------------------------------------------------------------------------
   file-start: js/jquery/jquery.lj.repostbutton.js 
*/

LJ.UI.registerTemplate('templates-CleanHtml-PaidRepost', "{{if 1}} <span class=\" b-flatrepost repost-button {{if $data.reposted}} b-flatrepost-reposted {{/if}} {{if $data.count}} b-flatrepost-counted {{/if}} {{if $data.budget || $data.cost}} b-flatrepost-gained {{/if}} {{if $data.owner}} b-flatrepost-disabled {{/if}} {{if $data.login}} b-flatrepost-disabled {{/if}} \" ><span class=\"b-flatrepost-icon\" ></span><span class=\"b-flatrepost-name\" data-href=\"{{html $data.url}}\" ><span class=\" b-flatrepost-title b-flatrepost-title-repost \" title=\"{{if $data.login}}{{html LJ.mltext(\'repost.button.title.login\')}}{{else}}{{if $data.owner}}{{html LJ.mltext(\'repost.button.title.myown\')}}{{else}}{{html LJ.mltext(\'repost.button.title\')}}{{/if}}{{/if}}\" >{{html LJ.mltext(\'repost.button.label\')}}</span><span class=\" b-flatrepost-title b-flatrepost-title-reposted \" title=\"{{html LJ.mltext(\'entry.reference.label.title\')}}\" >{{html LJ.mltext(\'entry.reference.label.reposted\')}}</span></span><span class=\"b-flatrepost-gain\" title=\"{{html $data.budget}}{{html LJ.mltext(\'paidrepost.button.title.curr\')}}\" >{{if !$data.owner}}+{{html $data.cost}}{{else $data.budget}}{{html $data.budget}}{{/if}}</span><span class=\"b-flatrepost-counter\" title=\"{{html LJ.mltext(\'repost.button.counter\')}}\" >{{html $data.count}}</span></span> {{else}} <span class=\"lj-button paidrepost-button {{if $data.reposted}}paidrepost-button-active{{/if}} lj-button-light\"><span class=\"lj-button-wrapper\"> <span class=\"lj-button-link\"> <span class=\"lj-button-a\"> <span title=\'{{if $data.owner}}{{html LJ.mltext(\'paidrepost.button.title.owner\')}}{{html $data.budget}}{{html LJ.mltext(\'paidrepost.button.title.curr\')}}{{else}}{{html LJ.mltext(\'paidrepost.button.title\')}}{{/if}}\' data-href=\"{{html $data.url}}\" class=\"lj-button-b\"><span class=\"lj-button-icon {{if $data.single}}lj-button-icon-sinlge{{/if}}\"></span> <span class=\"paidrepost-button-label\">{{html LJ.mltext(\'paidrepost.button.label\')}}</span> <span class=\"paidrepost-button-cost\">{{if !($data.owner)}}{{html $data.cost}}{{/if}}</span> </span> <span data-href=\"{{html $data.url}}\" title=\'{{if $data.owner}}{{html LJ.mltext(\'paidrepost.button.title.owner\')}}{{html $data.budget}}{{html LJ.mltext(\'paidrepost.button.title.curr\')}}{{else}}{{html LJ.mltext(\'paidrepost.button.title.delete\')}}{{/if}}\' class=\"lj-button-b lj-button-b-reposted\"><span class=\"lj-button-icon {{if $data.single}}lj-button-icon-sinlge{{/if}}\"></span> <span class=\"paidrepost-button-label\">{{html LJ.mltext(\'paidrepost.button.label.done\')}}</span><span class=\"paidrepost-button-cost\">{{if !($data.owner)}}{{html $data.cost}}{{/if}}</span> </span> <span title=\'{{html LJ.mltext(\'paidrepost.button.title.counter\')}}\' class=\"lj-button-c {{if !($data.count)}}empty{{/if}}\"> <span class=\"lj-button-arrow\"><span class=\"lj-button-arrow-bg\"></span></span> <span class=\"lj-like-item-count\">{{html $data.count}}</span> </span> </span> </span> </span></span> {{/if}} ", 'JQuery.stat');
LJ.UI.registerTemplate('templates-CleanHtml-Repost', "{{if 1}} <span class=\" b-flatrepost repost-button {{if $data.reposted}} b-flatrepost-reposted {{/if}} {{if $data.count}} b-flatrepost-counted {{/if}} {{if $data.budget}} b-flatrepost-gained {{/if}} {{if $data.owner}} b-flatrepost-disabled {{/if}} {{if $data.login}} b-flatrepost-disabled {{/if}} \" ><span class=\"b-flatrepost-icon\" ></span><span class=\"b-flatrepost-name\" data-href=\"{{html $data.url}}\" ><span class=\" b-flatrepost-title b-flatrepost-title-repost \" title=\"{{if $data.login}}{{html LJ.mltext(\'repost.button.title.login\')}}{{else}}{{if $data.owner}}{{html LJ.mltext(\'repost.button.title.myown\')}}{{else}}{{html LJ.mltext(\'repost.button.title\')}}{{/if}}{{/if}}\" >{{html LJ.mltext(\'repost.button.label\')}}</span><span class=\" b-flatrepost-title b-flatrepost-title-reposted \" title=\"{{html LJ.mltext(\'entry.reference.label.title\')}}\" >{{html LJ.mltext(\'entry.reference.label.reposted\')}}</span></span><span class=\"b-flatrepost-gain\" title=\"{{html $data.budget}}{{html LJ.mltext(\'paidrepost.button.title.curr\')}}\" >+{{html $data.budget}}</span><span class=\"b-flatrepost-counter\" title=\"{{html LJ.mltext(\'repost.button.counter\')}}\" >{{html $data.count}}</span></span> {{else}} <span class=\"lj-button repost-button {{if $data.reposted}}repost-button-active{{/if}} lj-button-light\"><span class=\"lj-button-wrapper\"> <span class=\"lj-button-link\"> <span class=\"lj-button-a\"> <span title=\'{{html LJ.mltext(\'repost.button.title\')}}\' data-href=\"{{html $data.url}}\" class=\"lj-button-b\"><span class=\"lj-button-icon {{if $data.single}}lj-button-icon-sinlge{{/if}}\"></span> {{html LJ.mltext(\'repost.button.label\')}}</span> <span title=\'{{html LJ.mltext(\'entry.reference.label.title\')}}\' data-href=\"{{html $data.url}}\" class=\"lj-button-b lj-button-b-reposted\"><span class=\"lj-button-icon {{if $data.single}}lj-button-icon-sinlge{{/if}}\"></span> {{html LJ.mltext(\'entry.reference.label.reposted\')}}</span> <span title=\'{{html LJ.mltext(\'repost.button.counter\')}}\' class=\"lj-button-c {{if !($data.count)}}empty{{/if}}\"> <span class=\"lj-button-arrow\"><span class=\"lj-button-arrow-bg\"></span></span> <span class=\"lj-like-item-count\">{{html $data.count}}</span> </span> </span> </span> </span></span> {{/if}} ", 'JQuery.stat');
LJ.UI.registerTemplate('templates-CleanHtml-reposted', "{{if $data.content}} {{each ($value.users || $data.users)}}{{if !((!$index) && !($value.dropComma || $data.dropComma))}}, {{/if}}<a href=\"{{html ($value.url || $data.url)}}\">{{html ($value.user || $data.user)}}</a>{{/each}} {{else}} <div class=\"b-reposted-popup\"> <div class=\"b-reposted-popup-header\">{{html LJ.mltext(\'repost.popup.head\')}}</div> <div class=\"b-reposted-popup-content b-reposted-popup-load\"></div> <div class=\"b-reposted-popup-footer\"><a href=\"javascript:void(0);\">{{html LJ.mltext(\'repost.popup.footer\')}}</a></div> </div> {{/if}} ", 'JQuery.stat');
/**
 * @name $.lj.repostbutton
 * @requires $.ui.core, $.ui.widget, $.lj.basicWidget, $.lj.bubble
 * @class Represents repost button
 * @author dmitry.petrov@sup.com (Dmitry Petrov), anazarov@sup.com (Alexander Nazarov)
 */
;(function ($) {
  'use strict';

  /** @lends $.lj.repostbutton.prototype */
  $.widget('lj.repostbutton', $.lj.basicWidget, {
    options: {
      classNames: {
        active: 'repost-button-active',
        inactive: 'repost-button-inactive',
        popupLoad: 'b-reposted-popup-load',
        popupNomore: 'b-reposted-popup-footer-hide',
        repostError: 'repost-error'
      },

      selectors: {
        counterParent: '.lj-button-c',
        button: '.lj-button-b',
        counter: '.lj-like-item-count',
        buttonLink: '.lj-button-link',
        popupContent: '.b-reposted-popup-content',
        popupFooter: '.b-reposted-popup-footer',
        popupMore: '.b-reposted-popup-footer > a'
      },

      templates: {
        popup: 'templates-CleanHtml-reposted'
      },

      url: '',
      reposted: false,
      cost: 0,
      budget: 0,
      paid: false
    },

    _create: function() {

      if ( LJ.Flags.isEnabled('homepage_v3') ) {

        this.options.classNames = {
          active: 'b-flatrepost-reposted',
          inactive: 'b-flatrepost-disabled',
          popupLoad: 'b-reposted-popup-load',
          popupNomore: 'b-reposted-popup-footer-hide',
          repostError: 'repost-error'
        };

        this.options.selectors = {
          counterParent: '.b-flatrepost-counter',
          button: '.b-flatrepost-name',
          counter: '.b-flatrepost-counter',
          buttonLink: '.b-flatrepost-name',
          popupContent: '.b-reposted-popup-content',
          popupFooter: '.b-reposted-popup-footer',
          popupMore: '.b-reposted-popup-footer > a'
        };

      }

      $.lj.basicWidget.prototype._create.apply(this);

      if (!this.options.url) {
        console.warn(this.widgetName, ': no url in options, initialization won\'t continue');
      }

      this._journal = LJ.get('currentJournal');
      this._count = null;
      this._remote = LJ.get('remoteUser');
      this._reposted = this.options.reposted;
      this._el('buttonLink');
      this._href = this.element.find(this._s('button')).data('href');
      this._href = LJ.Util.Journal.parseLink(this._href) || {};

      if (!this._canRepost()) {
        this.element.addClass(this._cl('inactive'));
        this._buttonLink.removeAttr('title');
        this._lock();
      }

      this._popup = null;
      this._popupContent = null;
      this._popupLocked = false;
      this._lastUser = null;
      this._el('counterParent');
      this._el('counter');

      if (!Number(this._counter.html())) { this._hideCounter(); }

      this._bindControls();
    },

    _hideCounter: function () {
      this._counterParent.addClass('empty');
    },

    _showCounter: function () {
      this._counterParent.removeClass('empty');
    },

    _bindControls: function() {
      var repost = this;

      this.element.on('click', this._s('button'), this._onUpdateButton.bind(this));

      this._counterParent.one('click', function() {
        if ( !Number(repost._counter.html()) ) {
          return;
        }

        repost._popup = repost._tmpl('popup');
        repost._el('popupFooter', repost._popup);
        repost._popupContent = repost._popup.find(repost._s('popupContent'));

        repost._popup.bubble({
          showOn: 'click',
          align: 'side',
          alwaysShowUnderTarget: true,
          target: repost._counterParent
        })
        .on('bubblehide', function () {
          repost._lastUser = null;
          repost._popupContent.empty();
          repost._popupFooter.removeClass(repost._cl('popupNomore'));
        })
        .on('bubbleshow', function () {
          repost._loadRepostedList();
        })
        .on('click', repost._s('popupMore'), repost._loadRepostedList.bind(repost));

        Function.defer(function() {
          repost._popup.bubble('show');
        });
      });

      $.lj.basicWidget.prototype._bindControls.apply(repost);
    },

    _loadRepostedList: function(ev) {
      var repost = this;

      if (ev) { ev.preventDefault(); }
      if (this._popupLocked) { return; }

      this._popupLocked = true;
      this._popupContent.addClass(this._cl('popupLoad'));

      LJ.Api.call('repost.get_list', { url: this.options.url, last: this._lastUser }, function(answer) {
        repost._popupContent.removeClass(repost._cl('popupLoad'));
        repost._popupLocked = false;
        if (answer.error) {
          repost._handleAnswer(answer);
        } else {
          repost._render(answer.users, answer.nomore, answer.count);
          repost._lastUser = answer.last;
        }
      });
    },

    _render: function(users, nomore, count) {
      var repost = this;

      /* Display users */
      if (users.length > 0) {
        repost._tmpl('popup', {
          content: true,
          dropComma: !!repost._lastUser,
          users: users
        }).appendTo(repost._popupContent);
      }

      this._updateCounter(count);

      /* Hide 'Show More' button */
      if (nomore) {
        repost._popupFooter.addClass(repost._cl('popupNomore'));
      }
    },

    _onUpdateButton: function(ev) {
      if (!this.locked()) {
        this.toggleRepost();
      }
      ev.preventDefault();
    },

    _handleAnswer: function(answer) {
      if (answer.hasOwnProperty('delete')) {
        if (answer.message) {
          this._showMessage(answer.message);
        }

        /* LJSUP-13479: Repost type or cost changed */
        if ( this.paid !== Boolean(answer.paid) || this.paid && (this.cost !== answer.cost) ) {
          this.element.replaceWith(LJ.Social.renderRepostButton(this.options.url, answer));
          return;
        }
      }

      if (answer.error) {
        if (answer.error.message) {
          this._showMessage(answer.error.message);
        }

        if (answer.error.data) {
          // Redraw button completely with new data
          this.element.replaceWith(LJ.Social.renderRepostButton(this.options.url, answer.error.data));
          return;
        }
      } else {
        this._updateButton( !this._reposted );
      }

      if (!answer.hasOwnProperty('count') && answer.hasOwnProperty('delete')) {
        answer.count = this._count - 1;
      }

      this._updateCounter(answer.count);
      this._unlock();
    },

    _showMessage: function (message) {
      var errorBubble = $('<div />', {
        'class': this._cl('repostError'),
        text: message
      })
      .bubble({
        target: this.element,
        align: 'center',
        hide: function () {
          errorBubble.remove();
        }
      })
      .bubble('show');
    },

    _updateButton: function(reposted) {
      this._reposted = reposted;
      this.element.toggleClass(this._cl('active'), this._reposted);
    },

    _updateCounter: function (count) {
      if (typeof count !== 'undefined') {
        this._count = Number(count);
        this._counter.html(this._count);
      }

      if (!Number(this._counter.html())) {
        this._hideCounter();
      } else {
        this._showCounter();
      }
    },

    _canRepost: function () {
      if (LJ.get('preview')) { return false; }
      if (!this._remote) { return false; }
      if (LJ.get('remote_is_identity')) { return false; }
      if (this._remote === this._href.journal) { return false; }

      return true;
    },

    toggleRepost: function() {
      var repost = this,
        args = {
          url: this.options.url
        };

      if (!this._canRepost()) { return; }

      if (this._count === null) {
        this._count = parseInt( this._el('counter').html(), 10) || 0;
      }

      this._lock();
      if (this._reposted) {
        LJ.Api.call('repost.delete', args, function (answer) {
          /* LJSUP-12559: Reload page when repost is deleted in remote user's journal */
          if (!answer.error && !answer.reposted && repost._journal === repost._remote && !location.href.match(/\/friends(?:friends|times)?\b/)) {
            location.reload();
          } else {
            repost._handleAnswer(answer);
          }
        });
      } else {
        args.timezone = LJ.Util.Date.timezone();

        if (this.options.paid) {
          args.cost = this.options.cost;
        }

        LJ.Api.call('repost.create', args, this._handleAnswer.bind(this));
      }
    }
  });
}(jQuery));

;

/* file-end: js/jquery/jquery.lj.repostbutton.js 
----------------------------------------------------------------------------------*/
/* ---------------------------------------------------------------------------------
   file-start: js/s2.js 
*/



/* ---------------------------------------------------------------------------------
   file-start: js/discovery/directives.js 
*/



Site.page.template['angular/ljImage.ng.tmpl'] = '<a ng-href=\"{{link}}\">\n    <figure class=\"b-journalpicture\">\n        <img\n            class=\"b-journalpicture-image\"\n            title=\"{{textContent}}\"\n            alt=\"{{textContent}}\"\n            ng-src=\"{{source}}\"\n            ng-style=\"dimensions\"\n            >\n        <figcaption class=\"b-journalpicture-caption\" lj-html=\"content\"></figcaption>\n    </figure>\n</a>\n';
Site.page.template['angular/ljGallery.ng.tmpl'] = '<div\n    class=\"b-journalgallery\"\n    ng-style=\"dimensions\"\n    ng-class=\"{\n        \'b-journalgallery-hightpriority\': isTall\n    }\"\n    >\n    <div\n        class=\"b-journalgallery-container\"\n        ng-style=\"dimensions\"\n        >\n        <figure\n            class=\"b-journalgallery-picture\"\n            ng-repeat=\"item in items\"\n            ng-style=\"dimensions\"\n            ng-if=\"isNearby($index)\"\n            ng-class=\"{\n                \'b-journalgallery-picture-prev\': $index < state.index,\n                \'b-journalgallery-picture-current\': $index === state.index,\n                \'b-journalgallery-picture-next\': $index > state.index\n            }\"\n            >\n            <div class=\"b-journalgallery-wrapper\">\n                <img\n                    ng-src=\"{{item.src}}\"\n                    class=\"b-journalgallery-image\"\n                    lj-gallery-load\n                    >\n            </div>\n            <figcaption class=\"b-journalgallery-caption\">\n                <span\n                    class=\"b-journalgallery-caption-title\"\n                    lj-html=\"item.content\"></span>\n            </figcaption>\n        </figure>\n    </div>\n    <span\n        class=\"b-journalgallery-counter\"\n        ng-bind=\"(state.index + 1) + \'/\' + (state.total+1)\"\n        ></span>\n    <span\n        class=\"b-journalgallery-nav b-journalgallery-nav-prev\"\n        ng-show=\"state.index !== 0\"\n        ng-click=\"prev()\"\n        ></span>\n    <span\n        class=\"b-journalgallery-nav b-journalgallery-nav-next\"\n        ng-show=\"state.index < state.total\"\n        ng-click=\"next()\"\n        ></span>\n</div>\n';
Site.page.template['angular/discovery/ljSuggest.ng.tmpl'] = '<div\n    class=\"b-mainpage-seealso\"\n    ng-if=\"suggest\"\n    >\n\n    <!-- head -->\n    <h3\n        class=\"b-mainpage-seealso-head\"\n        lj-ml=\"discovery.article.seealso\"\n        ></h3>\n\n    <!-- items -->\n    <ul class=\"b-mainpage-seealso-items\">\n        <li\n            class=\"b-mainpage-seealso-item\"\n            ng-repeat=\"suggested in suggest\"\n            >\n            <a\n                ng-href=\"{{suggested.url}}\"\n                class=\"b-mainpage-seealso-link\"\n                >\n                <span\n                    class=\"b-mainpage-seealso-pic\"\n                    ng-if=\"suggested.image\"\n                    ng-style=\"{ backgroundImage: \'url({{suggested.image}})\' }\"\n                    ></span>\n                <span\n                    class=\"b-mainpage-seealso-title\"\n                    lj-html=\"suggested.subject\"\n                    ></span>\n            </a>\n            <span class=\"b-mainpage-seealso-user\" ng-if=\"suggested.user\">\n                <span\n                    lj-user-dynamic=\"suggested.user.username\"\n                    lj-user-dynamic-options=\"{target: \'_blank\'}\"\n                    ></span>\n            </span>\n        </li>\n    </ul><!-- /items -->\n\n</div>';
LJ.injectStyle('/* Journal Gallery\n----------------------------------- */\n/*\n<lj-gallery height=\"[x]\" width=\"[x]\">\n    <lj-gallery-item src=\"[image url]\" href=\"[link url]\"> подпись </lj-gallery-item>\n    <lj-gallery-item src=\"[image url]\" href=\"[link url]\"> подпись </lj-gallery-item>\n    <lj-gallery-item src=\"[image url]\" href=\"[link url]\"> подпись </lj-gallery-item>\n</lj-gallery>\n*/\n.b-journalgallery {\n    overflow: hidden;\n    display: block;\n    position: relative;\n    width: 100%;\n    margin: 0 auto;\n    padding: 0 0 70px;\n    font: 0.8125rem/1.1 \"ProximaNova-Semibold\",Tahoma,Arial,sans-serif;\n    }\n    /* container */\n    .b-journalgallery-container {\n        position: relative;\n        background: #FFF;\n        }\n        /* picture */\n        .b-journalgallery-picture {\n            position: absolute;\n            width: 100%;\n            margin: 0;\n            background: url(/img/preloader/preloader-disc-blue-white-16.gif?v=39502) no-repeat 50% 50%;\n            -webkit-transition: 500ms cubic-bezier(0.250, 0.250, 0.750, 0.750) all;\n            -moz-transition: 500ms cubic-bezier(0.250, 0.250, 0.750, 0.750) all;\n            -ms-transition: 500ms cubic-bezier(0.250, 0.250, 0.750, 0.750) all;\n            -o-transition: 500ms cubic-bezier(0.250, 0.250, 0.750, 0.750) all;\n            transition: 500ms cubic-bezier(0.250, 0.250, 0.750, 0.750) all;\n            text-align: center;\n            }\n        .b-journalgallery-picture:after {\n            content: \'\';\n            display: inline-block;\n            height: 100%;\n            margin: 0 0 0 -0.05em; /* To offset spacing. May vary by font */\n            vertical-align: middle;\n            }\n            .b-journalgallery-wrapper {\n                display: inline-block;\n                vertical-align: middle;\n                max-width: 99%;\n                max-width: calc(100% - 0.3em);\n                }\n            .b-journalgallery-hightpriority .b-journalgallery-wrapper {\n                display: inline;\n                }\n                .b-journalgallery-image {\n                    position: relative;\n                    max-width: 100%;\n                    margin: 0;\n                    vertical-align: top;\n                    opacity: 1;\n                    -webkit-transition: 500ms cubic-bezier(0.250, 0.250, 0.750, 0.750) all;\n                    -moz-transition: 500ms cubic-bezier(0.250, 0.250, 0.750, 0.750) all;\n                    -ms-transition: 500ms cubic-bezier(0.250, 0.250, 0.750, 0.750) all;\n                    -o-transition: 500ms cubic-bezier(0.250, 0.250, 0.750, 0.750) all;\n                    transition: 500ms cubic-bezier(0.250, 0.250, 0.750, 0.750) all;\n                    width: auto \\9;\n                    height: auto \\9;\n                    }\n                .b-journalgallery-hightpriority .b-journalgallery-image {\n                    max-height: 100%;\n                    }\n            .b-journalgallery-caption {\n                position: absolute;\n                top: 100%;\n                left: 0;\n                right: 0;\n                height: 70px; /* eq to b-journalgallery padding-bottom */\n                margin: 0;\n                padding: 0;\n                border: 0;\n                text-align: center;\n                background: #FFF;\n                color: #829399;\n                }\n                .b-journalgallery-caption-title {\n                    overflow: hidden;\n                    position: absolute;\n                    top: 0;\n                    right: 40px;\n                    left: 40px;\n                    height: 2.2em;\n                    margin: 0;\n                    padding: 10px 2px 0;\n                    }\n        .b-journalgallery-picture-loaded {\n            background-image: none;\n            }\n            .b-journalgallery-picture-loaded .b-journalgallery-image {\n                opacity: 1;\n                }\n        .b-journalgallery-picture-prev {\n            -webkit-transform: translate3d(-100%, 0, 0);\n            -moz-transform: translate3d(-100%, 0, 0);\n            -ms-transform: translate3d(-100%, 0, 0);\n            -o-transform: translate3d(-100%, 0, 0);\n            transform: translate3d(-100%, 0, 0);\n            opacity: 0;\n            }\n        .b-journalgallery-picture-next {\n            -webkit-transform: translate3d(100%, 0, 0);\n            -moz-transform: translate3d(100%, 0, 0);\n            -ms-transform: translate3d(100%, 0, 0);\n            -o-transform: translate3d(100%, 0, 0);\n            transform: translate3d(100%, 0, 0);\n            opacity: 0;\n            }\n        .b-journalgallery-picture-current {\n            -webkit-transform: translate3d(0, 0, 0);\n            -moz-transform: translate3d(0, 0, 0);\n            -ms-transform: translate3d(0, 0, 0);\n            -o-transform: translate3d(0, 0, 0);\n            transform: translate3d(0, 0, 0);\n            }\n    /* counter */\n    .b-journalgallery-counter {\n        position: absolute;\n        bottom: 44px;\n        right: 0;\n        margin: 0;\n        padding: 2px;\n        border: 0;\n        text-align: right;\n        color: #829399;\n        }\n    /* prev-next arrows */\n    .b-journalgallery-nav {\n        position: absolute;\n        top: 0;\n        bottom: 70px; /* .b-journalgallery {padding-bottom} */\n        margin: 0;\n        padding: 0;\n        border: 0;\n        cursor: pointer;\n        font: 0/0 a;\n        }\n    .b-journalgallery-nav:before {\n        content: \" \";\n        position: absolute;\n        top: 50%;\n        width: 50px;\n        height: 50px;\n        margin: -25px 0 0;\n        padding: 0;\n        border: 0;\n        border-radius: 3px;\n        background: #839399;\n        }\n    .b-journalgallery-nav:hover:before {\n        background: #09C;\n        }\n    .b-discoveryarticle .b-journalgallery-nav:hover:before {\n        background: #39BF71;\n        }\n    .b-journalgallery-nav:after {\n        content: \" \";\n        position: absolute;\n        top: 50%;\n        width: 9px;\n        height: 16px;\n        margin: -8px 0 0;\n        padding: 0;\n        background: url(/img/icons/journalgallery.png?v=39648) no-repeat 0 0;\n        }\n    /* prev */\n    .b-journalgallery-nav-prev {\n        left: 0;\n        width: 30%;\n        }\n    .b-journalgallery-nav-prev:before {\n        left: 20px;\n        }\n    .b-journalgallery-nav-prev:after {\n        left: 40px;\n        }\n    /* next */\n    .b-journalgallery-nav-next {\n        right: 0;\n        width: 70%;\n        }\n    .b-journalgallery-nav-next:before {\n        right: 20px;\n        }\n    .b-journalgallery-nav-next:after {\n        right: 40px;\n        background-position: 0 -17px;\n        }\n\n\n');
angular.module('Discovery.Tags', [
  'LJ.Templates',
  'LJ.Api'
])
/**
 * Discovery tags bootstrap. Should be used in conjunction with lj-html directive
 */
.directive('ljDiscoveryTags', ['$compile', function ($compile) {
  var TAGS = ['lj-gallery', '[lj-memories]'];

  return {
    restrict: 'A',
    terminal: true,
    link: function (scope, element) {
      $compile( element.find( TAGS.join(',') ) )(scope);
    }
  };
}])
.directive('ljGallery', ['$templateCache', '$compile',
               function ( $templateCache,   $compile ) {
    return {
      restrict: 'E',
      scope: true,
      link: function (scope, element, attrs) {
        scope.dimensions = {
          maxWidth:  attrs.width + 'px',
          height: attrs.height || 350
        };

        scope.items = element.find('lj-gallery-item').map(function(){
          var image = angular.element(this).find('img'),
              link = angular.element(this).find('a'),
              capture = angular.element(this).find('lj-gallery-item-capture');

          return {
            content: capture.html(),
            src: image.attr('src'),
            href: link.attr('href')
          };
        }).toArray();

        scope.isTall = ( typeof attrs.tall !== 'undefined' );

        scope.next = function () {
          scope.state.index += 1;
        };

        scope.prev = function () {
          scope.state.index -= 1;
        };

        scope.state = {
          index: 0,
          total: scope.items.length - 1
        };

        scope.isNearby = function (index) {
          return Math.abs(scope.state.index - index) <= 1;
        };

        // replace existed content with our template
        element.html(
          $compile( $templateCache.get('ljGallery.ng.tmpl') )(scope)
        );
      }
    };
}])
.directive('ljSuggest', ['Api', function (Api) {
  return {
    templateUrl: 'ljSuggest.ng.tmpl',
    scope: {
      itemId: '@ljSuggest'
    },
    link: function (scope) {
      Api.call('discovery.suggest', { itemid: scope.itemId }, {cache: true})
        .then(function (response) {
          scope.suggest = response.items;
        });
    }
  };
}]);
;

/* file-end: js/discovery/directives.js 
----------------------------------------------------------------------------------*/

/* ---------------------------------------------------------------------------------
   file-start: js/core/angular/ljMemories.js 
*/



Site.page.template['angular/memories.ng.tmpl'] = '<div ng-controller=\"MemoriesCtrl\">\n\n    <div\n        class=\"b-addtomemories\"\n        ng-class=\"{ \'b-addtomemories-loading\': loading }\"\n        >\n\n        <!-- head -->\n        <h3\n            class=\"b-addtomemories-head\"\n            lj-ml=\"memories.title\"\n            ></h3>\n\n        <!-- intro -->\n        <p class=\"b-addtomemories-intro\">\n            <span\n                ng-show=\"!security\"\n                lj-ml=\"memories.title.add\"\n                ></span>\n            <span\n                ng-show=\"security\"\n                lj-ml=\"memories.title.edit\"\n                ></span>\n        </p>\n\n        <!-- items -->\n        <ul class=\"b-addtomemories-items\">\n\n            <li class=\"b-addtomemories-item\">\n                <label class=\"b-addtomemories-label\">\n                    <input\n                        type=\"radio\"\n                        name=\"security\"\n                        class=\"b-addtomemories-radio\"\n                        value=\"public\"\n                        ng-model=\"security\"\n                        ng-change=\"update()\"\n                        >\n                    <span\n                        class=\"b-addtomemories-title\"\n                        lj-ml=\"memories.security.public\"\n                        ></span>\n                </label>\n            </li>\n\n            <li class=\"b-addtomemories-item\">\n                <label class=\"b-addtomemories-label\">\n                    <input\n                        type=\"radio\"\n                        name=\"security\"\n                        class=\"b-addtomemories-radio\"\n                        value=\"friends\"\n                        ng-model=\"security\"\n                        ng-change=\"update()\"\n                        >\n                    <span\n                        class=\"b-addtomemories-title\"\n                        lj-ml=\"memories.security.friends\"\n                        ></span>\n                </label>\n            </li>\n\n            <li class=\"b-addtomemories-item\">\n                <label class=\"b-addtomemories-label\">\n                    <input\n                        type=\"radio\"\n                        name=\"security\"\n                        class=\"b-addtomemories-radio\"\n                        value=\"private\"\n                        ng-model=\"security\"\n                        ng-change=\"update()\"\n                        >\n                    <span\n                        class=\"b-addtomemories-title\"\n                        lj-ml=\"memories.security.private\"\n                        ></span>\n                </label>\n            </li>\n\n        </ul><!-- /items -->\n\n        <!-- footer -->\n        <div\n            class=\"b-addtomemories-footer\"\n            ng-show=\"removeButton\"\n            >\n            <div\n                class=\"\n                    b-ljbutton\n                    b-ljbutton-delete\n                    \"\n                >\n                <button\n                    ng-click=\"remove()\"\n                    lj-ml=\"memories.remove\"\n                    ></button>\n            </div>\n        </div><!-- /footer -->\n\n        <p class=\"b-addtomemories-options\">\n            <a\n                ng-href=\"{{siteroot}}/tools/memadd.bml?journal={{bubble.options.journal}}&amp;itemid={{bubble.options.ditemid}}\"\n                target=\"_blank\"\n                lj-ml=\"memories.options\"\n                ></a>\n        </p>\n\n    </div><!-- /addtomemories -->\n\n</div>\n';
LJ.injectStyle('/* LJSUP-17006: [S1 entry, memories] Popup in S1 entries */\n/* Add to Memories */\n\n.b-addtomemories {\n    width: 150px;\n    margin: 0;\n    padding: 0;\n    }\n    .b-addtomemories-head {\n        margin: 0 0 0.5em;\n        padding: 0;\n        font: bold 1.13em/1.1 Arial,sans-serif;\n        color: #000;\n        }\n    .b-addtomemories-intro {\n        margin: 0 0 0.3em;\n        }\n    .b-addtomemories-items {\n        margin: 0;\n        padding: 0;\n        list-style: none;\n        }\n        .b-addtomemories-item {\n            margin: 0;\n            padding: 0;\n            }\n            .b-addtomemories-label {\n                display: block;\n                margin: 0 -5px;\n                padding: 5px;\n                cursor: pointer;\n                }\n            .b-addtomemories-item:hover .b-addtomemories-label {\n                background: #C8E6FF;\n                }\n    .b-addtomemories-footer {\n        margin: 1em 0;\n        }\n    .b-addtomemories-options {\n        margin: 0.3em -5px 0;\n        padding: 0.3em 5px 0;\n        border-top: 1px solid #DAE3E6;\n        }\n.b-addtomemories-loading {\n    background: url(/img/preloader/preloader-blue-gray.gif?v=16423) no-repeat 50% 50%;\n    }\n    .b-addtomemories-loading .b-addtomemories-head,\n    .b-addtomemories-loading .b-addtomemories-intro,\n    .b-addtomemories-loading .b-addtomemories-items,\n    .b-addtomemories-loading .b-addtomemories-footer,\n    .b-addtomemories-loading .b-addtomemories-options {\n        visibility: hidden;\n        }\n\n');
(function($) {

angular.module('LJ.Memories', ['LJ.Bubble', 'LJ.Api'])

/**
* Directive build memories popup
*
* Usage:
*   <a
*     href="#"
*     lj-memories="{}"
*     >
*   </a>
*
* or
*
*   <a
*     href="#"
*     lj-memories="getOptions(element)"
*     >
*   </a>
*
* @authors
*   Georgii Kats (g.kats@sup.com)
*/
.directive('ljMemories', ['$parse', '$timeout', 'Bubble', function ($parse, $timeout, Bubble) {
	return {
		scope: {
			ljMemories: '&'
		},
		link: function (scope, element, attrs) {
			var options;

			function clickHandler (event) {
				event.preventDefault();

				if ( !options ) {
					options = ( typeof scope.ljMemories === 'function' ) ?
										scope.ljMemories({ element: element }) :
										scope.ljMemories;
				}

				Bubble.open('memories', options, $(element));
				scope.$apply();
			}

			element.on('click', clickHandler);

			scope.$on('$destroy', function () {
				element.off('click', clickHandler);
			});
		}
	};

}])
.controller('MemoriesCtrl', ['$scope', 'Api',
										function( $scope ,  Api ) {

	var bubble = $scope.bubble;

	$scope.security = null;

	// bubble size could change because of button, reposition
	$scope.$watch('removeButton', function() {
		$(window).trigger('resize');
	});

	$scope.$on('bubble:open:memories', function() {
		Api.call('memories.get', bubble.options, function(result) {
			$scope.security = result.result ? result.result.security : null;

			$scope.removeButton = Boolean($scope.security);
		});
	});

	$scope.$on('bubble:close:memories', function() {
		$scope.removeButton = false;
	});

	$scope.siteroot = LJ.get('siteroot');

	$scope.update = function() {
		Api.call('memories.set', {
			journal:     bubble.options.journal,
			ditemid:     bubble.options.ditemid,
			description: bubble.options.journal + ': ' + bubble.options.title,

			security:    $scope.security
		}, function(result) {
			$scope.security = result;
			bubble.close();
			$scope.removeButton = true;
		});
	};

	$scope.remove = function() {
		Api.call('memories.remove', {
			journal: bubble.options.journal,
			ditemid: bubble.options.ditemid,
		}, function() {
			$scope.security = null;
			bubble.close();
			$scope.removeButton = false;
		});
	};

	LJ.Event.on('api:request:change', function(method, state) {
		if (/^memories/.test(method)) {
			$scope.loading = state;
		}
	});

}]);

})(jQuery);
;

/* file-end: js/core/angular/ljMemories.js 
----------------------------------------------------------------------------------*/

;(function ($) {
    'use strict';

    angular.module('S2Layout', ['Discovery.Tags', 'LJ.Memories']);

    LJ.Event.on('page_load', function() {
        var sidebarCalendar = $('.sidebar-cal');

        /* Nothing to do if widget was not loaded */
        if ( !$.fn.hasOwnProperty('inlineCalendar') ) {
            return;
        }

        // inline calendar could not be available for the style
        sidebarCalendar
            .inlineCalendar( {
                selectors: {
                    month: '.sbar-cal-nav-month',
                    year:  '.sbar-cal-nav-year',

                    prevMonth: '.sbar-cal-nav-month .sbar-cal-nav-prev',
                    nextMonth: '.sbar-cal-nav-month .sbar-cal-nav-next',
                    prevYear:  '.sbar-cal-nav-year .sbar-cal-nav-prev',
                    nextYear:  '.sbar-cal-nav-year .sbar-cal-nav-next',

                    monthLabel: '.sbar-cal-nav-month .sbar-cal-month',
                    yearLabel: '.sbar-cal-nav-year .sbar-cal-year'
                },
                classNames: {
                    current  : 'today',
                    nextDisabled : 'disabled',
                    prevDisabled : 'disabled'
                },
                dayRef: LJ.get('currentJournalBase') + '/%Y/%M/%D',
                monthRef: LJ.get('currentJournalBase') + '/%Y/%M',
                yearRef: LJ.get('currentJournalBase') + '/%Y',
                endMonth: new Date(),
                startAtSunday: true
            }).on('daySelected', function (event) {
                event.preventDefault();
            });

        // calendar events should be available
        if ( $.fn.hasOwnProperty('calendarEvents') ) {
            sidebarCalendar.calendarEvents({
                calendarType: 'inlineCalendar'
            });
        }
    });

    LJ.Event.on('page_load', function () {
        var className = 'hover',
            tabElements = $('.sidebar dl'),
            tabHeaders = $('.sidebar dt'),
            preventClose = false;

        if ($('.sidebar-friendstimes').length === 0) { return; }

        if (LJ.Support.touch) {
            tabHeaders.on('touchstart', function () {
                $(this).parent()
                    .toggleClass(className)
                    .siblings()
                    .removeClass(className);
            });
            tabElements.on('touchstart', function () {
                preventClose = true;
            });
            $(document).on('touchstart', function () {
                if (preventClose) {
                    preventClose = false;
                } else {
                    tabElements.removeClass(className);
                }
            });
        } else {
            tabElements.on({
                mouseenter: function () {
                    $(this).addClass('hover');
                },

                mouseleave: function () {
                    $(this).removeClass('hover');
                }
            });
        }
    });

    // S2 comments
    LJ.Event.on('page_load', function () {
        if (LJ.get('LJ_cmtinfo')) {
            window.LJ_cmtinfo = LJ.get('LJ_cmtinfo');
        }

        if ($.fn.subjecticons) {
            $('.b-subjecticons').subjecticons();
        }

        if ($.fn.commentator && $.fn.authtype && $.fn.quotescreator) {
            $('#postform-wrapper')
                .commentator({
                    publicKey: LJ.get('captcha_public'),
                    captchaContainerId: 'captcha-container'
                })
                .authtype({
                    forceStartupCaptcha: !!(Number(LJ.get('need_captcha'))),
                    selectors: {
                        authTypeRadios: '.b-postform-login-{authType} .b-postform-login-radio'
                    }
                })
                .quotescreator();
        }

        if ($.fn.placeholder) {
            $('#cookieusername').placeholder();
        }

        // Scroll to top
        $(document.body).on('click', '[data-s2-helper-scrollTop]', function(event) {
            event.preventDefault();
            $('body,html').animate({ scrollTop: 0 }, 500);
        });
    });

    $(function () {
        // Switch to new feed version on /friends
        // Notice: code below is only needed for old friends feed that
        // relies on S2 and hasn't it's own JS file
        $('body').on('click', '.b-lenta-msg-close', function (e) {
            e.preventDefault();

            LJ.Api.call('friendsfeed.close_friendsfeed_line', {}, function () {
              $('.b-lenta-msg').remove();
              $('body').addClass('b-lenta-msg-hidden');
            });
        });
    });
}(jQuery));
;

/* file-end: js/s2.js 
----------------------------------------------------------------------------------*/
/* ---------------------------------------------------------------------------------
   file-start: js/esn.js 
*/

/* ---------------------------------------------------------------------------------
   file-start: js/deprecated/dom.js 
*/

/**
 * All deprecated manipulations with the DOM will be here
 */

// handy utilities to create elements with just text in them
function _textSpan() {
    return _textElements('span', arguments);
}
function _textDiv() {
    return _textElements('div', arguments);
}

function _textElements(eleType, txts) {
    var ele = [];
    for (var i = 0; i < txts.length; i++) {
        var node = document.createElement(eleType);
        node.innerHTML = txts[i];
        ele.push(node);
    }

    return ele.length == 1 ? ele[0] : ele;
}
;

/* file-end: js/deprecated/dom.js 
----------------------------------------------------------------------------------*/

var ESN = {};
(function ($, ESN) {
    // When page loads, set up "check all" checkboxes
    ESN.initCheckAllBtns = function () {
      var ntids  = $("ntypeids");
      var catids = $("catids");

      if (!ntids || !catids)
        return;

      ntidList  = ntids.value;
      catidList = catids.value;

      if (!ntidList || !catidList)
        return;

      ntids  = ntidList.split(",");
      catids = catidList.split(",");

      catids.forEach( function (catid) {
        ntids.forEach( function (ntypeid) {
          var className = "SubscribeCheckbox-" + catid + "-" + ntypeid;

          var cab = new CheckallButton();
          cab.init({
            "class": className,
              "button": $("CheckAll-" + catid + "-" + ntypeid),
              "parent": $("CategoryRow-" + catid)
              });
        });
      });
    }

    // attach event handlers to all track buttons
    ESN.initTrackBtns = function (node) {
        // don't do anything if no remote
        if (!Site.has_remote) return;

        node = node || document;
        var trackBtns = DOM.getElementsByTagAndClassName(node, 'img', 'TrackButton');

        trackBtns.forEach(function (trackBtn) {
            if (!trackBtn || !trackBtn.getAttribute) return;

            if (!trackBtn.getAttribute("lj_subid") && !trackBtn.getAttribute("lj_journalid")) return;
            if (trackBtn.getAttribute("lj_dtalkid") && !Site.remote_can_track_threads) return;

            DOM.addEventListener(trackBtn, 'click', ESN.trackBtnClickHandler.bindEventListener(trackBtn));
        });
    };

    ESN.trackBtnClickHandler = function (evt) {
        var trackBtn = evt.target;
        if (! trackBtn || trackBtn.tagName.toLowerCase() != "img") return true;

        Event.stop(evt);

        var btnInfo = {};

        ['arg1', 'arg2', 'etypeid', 'newentry_etypeid', 'newentry_token', 'newentry_subid',
         'journalid', 'subid', 'auth_token'].forEach(function (arg) {
            btnInfo[arg] = trackBtn.getAttribute("lj_" + arg);
        });

        // pop up little dialog to either track by inbox/email or go to more options
        var dlg = document.createElement("div");
        var title = _textDiv("Email me when");
        DOM.addClassName(title, "track_title");
        dlg.appendChild(title);

        var TrackCheckbox = function (title, checked) {
            var checkContainer = document.createElement("div");

            var newCheckbox = document.createElement("input");
            newCheckbox.type = "checkbox";
            newCheckbox.id = "newentrytrack" + Unique.id();
            var newCheckboxLabel = document.createElement("label");
            newCheckboxLabel.setAttribute("for", newCheckbox.id);
            newCheckboxLabel.innerHTML = title;

            checkContainer.appendChild(newCheckbox);
            checkContainer.appendChild(newCheckboxLabel);
            dlg.appendChild(checkContainer);

            newCheckbox.checked = checked ? true : false;

            return newCheckbox;
        };

        // global trackPopup so we can only have one
        if (ESN.trackPopup) {
            ESN.trackPopup.hide();
            ESN.trackPopup = null;
        }

        var saveChangesBtn = document.createElement("input");
        saveChangesBtn.type = "button";
        saveChangesBtn.value = "Save Changes";
        DOM.addClassName(saveChangesBtn, "track_savechanges");

        var trackingNewEntries  = Number(btnInfo['newentry_subid']) ? 1 : 0;
        var trackingNewComments = Number(btnInfo['subid']) ? 1 : 0;

        var newEntryTrackBtn;
        var commentsTrackBtn;

        if (trackBtn.getAttribute("lj_dtalkid")) {
            // this is a thread tracking button
            // always checked: either because they're subscribed, or because
            // they're going to subscribe.
            commentsTrackBtn = TrackCheckbox("someone replies in this comment thread", 1);
        } else {
            // entry tracking button
    		newEntryTrackBtn = TrackCheckbox(Site.currentJournal + ' posts a new entry', trackingNewEntries);
            commentsTrackBtn = TrackCheckbox("someone comments on this post", trackingNewComments);
        }

        DOM.addEventListener(saveChangesBtn, "click", function () {
            ESN.toggleSubscriptions(btnInfo, evt, trackBtn, {
                newEntry: newEntryTrackBtn ? newEntryTrackBtn.checked : false,
                newComments: commentsTrackBtn.checked
            });
            if (ESN.trackPopup) ESN.trackPopup.hide();
        });

        var btnsContainer = document.createElement("div");
        DOM.addClassName(btnsContainer, "track_btncontainer");
        dlg.appendChild(btnsContainer);

        btnsContainer.appendChild(saveChangesBtn);

        var custTrackLink = document.createElement("a");
        custTrackLink.href = trackBtn.parentNode.href;
        btnsContainer.appendChild(custTrackLink);
        custTrackLink.innerHTML = "More Options";
        DOM.addClassName(custTrackLink, "track_moreopts");

        ESN.trackPopup = new LJ_IPPU.showNoteElement(dlg, trackBtn, 0);

        DOM.addEventListener(custTrackLink, "click", function (evt) {
            Event.stop(evt);
            document.location.href = trackBtn.parentNode.href;
            if (ESN.trackPopup) ESN.trackPopup.hide();
            return false;
        });

        return false;
    }

    // toggles subscriptions
    ESN.toggleSubscriptions = function (subInfo, evt, btn, subs) {
        subInfo["subid"] = Number(subInfo["subid"]);
        if ((subInfo["subid"] && ! subs["newComments"])
            || (! subInfo["subid"] && subs["newComments"])) {
            ESN.toggleSubscription(subInfo, evt, btn, "newComments");
        }

        subInfo["newentry_subid"] = Number(subInfo["newentry_subid"]);
        if ((subInfo["newentry_subid"] && ! subs["newEntry"])
            || (! subInfo["newentry_subid"] && subs["newEntry"])) {
                var newentrySubInfo = new Object(subInfo);
                newentrySubInfo["subid"] = Number(btn.getAttribute("lj_newentry_subid"));
                ESN.toggleSubscription(newentrySubInfo, evt, btn, "newEntry");
        }
    };

    // (Un)subscribes to an event
    ESN.toggleSubscription = function (subInfo, evt, btn, sub) {
        var action = "";
        var params = {
            auth_token: sub == "newEntry" ? subInfo.newentry_token : subInfo.auth_token
        };

        if (Number(subInfo.subid)) {
            // subscription exists
            action = "delsub";
            params.subid = subInfo.subid;
        } else {
            // create a new subscription
            action = "addsub";

            var param_keys;
            if (sub == "newEntry") {
                params.etypeid = subInfo.newentry_etypeid;
                param_keys = ["journalid"];
            } else {
                param_keys = ["journalid", "arg1", "arg2", "etypeid"];
            }

            param_keys.forEach(function (param) {
                if (Number(subInfo[param]))
                    params[param] = parseInt(subInfo[param]);
            });
        }

        params.action = action;

        var reqInfo = {
            "method": "POST",
            "url":    LiveJournal.getAjaxUrl('esn_subs'),
            "data":   HTTPReq.formEncoded(params)
        };

        var gotInfoCallback = function (info) {
            if (! info) return LJ_IPPU.showNote("Error changing subscription", btn);

            if (info.error) return LJ_IPPU.showNote(info.error, btn);

            if (info.success) {
                if (info.msg)
                    LJ_IPPU.showNote(info.msg, btn);

                if (info.subscribed) {
                    if (info.subid)
    					btn.setAttribute('lj_subid', info.subid);
                    if (info.newentry_subid)
    					btn.setAttribute('lj_newentry_subid', info.newentry_subid);

    				btn.setAttribute('title', 'Untrack This');

                    // update subthread tracking icons
                    var dtalkid = btn.getAttribute("lj_dtalkid");
                    if (dtalkid)
                        ESN.updateThreadIcons(dtalkid, "on");
                    else // not thread tracking button
                        btn.src = Site.imgprefix + "/btn_tracking.gif?v=17312";
                } else {
                    if (info["event_class"] == "LJ::Event::JournalNewComment")
    					btn.setAttribute('lj_subid', 0);
                    else if (info["event_class"] == "LJ::Event::JournalNewEntry")
    					btn.setAttribute('lj_newentry_subid', 0);

    				btn.setAttribute('title', 'Track This');

                    // update subthread tracking icons
                    var dtalkid = btn.getAttribute("lj_dtalkid");
                    if (dtalkid) {
                        // set state to "off" if no parents tracking this,
                        // otherwise set state to "parent"
                        var state = "off";
                        var parentBtn;
                        var parent_dtalkid = dtalkid;
                        while (parentBtn = ESN.getThreadParentBtn(parent_dtalkid)) {
                            parent_dtalkid = parentBtn.getAttribute("lj_dtalkid");
                            if (! parent_dtalkid) {
                                break;
                            }

                            if (! Number(parentBtn.getAttribute("lj_subid")))
                                continue;
                            state = "parent";
                            break;
                        }

                        ESN.updateThreadIcons(dtalkid, state);
                    } else {
                        // not thread tracking button
                        btn.src = Site.imgprefix + "/btn_track.gif?v=17312";
                    }
                }

                if (info.auth_token)
    				btn.setAttribute('lj_auth_token', info.auth_token);
                if (info.newentry_token)
    				btn.setAttribute('lj_newentry_token', info.newentry_token);
            }
        };

        reqInfo.onData = gotInfoCallback;
        reqInfo.onError = function (err) { LJ_IPPU.showNote("Error: " + err) };

        HTTPReq.getJSON(reqInfo);
    };

    // given a dtalkid, find the track button for its parent comment (if any)
    ESN.getThreadParentBtn = function (dtalkid) {
        var cmtInfo = LJ_cmtinfo[dtalkid + ""];
        if (! cmtInfo) {
            return null;
        }

        var parent_dtalkid = cmtInfo.parent;
        if (! parent_dtalkid)
            return null;

        return $("lj_track_btn_" + parent_dtalkid);
    };

    // update all the tracking icons under a parent comment
    ESN.updateThreadIcons = function (dtalkid, tracking) {
        var btn = $("lj_track_btn_" + dtalkid);
        if (! btn) {
            return;
        }

        var cmtInfo = LJ_cmtinfo[dtalkid + ""];
        if (! cmtInfo) {
            return;
        }

        if (Number(btn.getAttribute("lj_subid")) && tracking != "on") {
            // subscription already exists on this button, don't mess with it
            return;
        }

        if (cmtInfo.rc && cmtInfo.rc.length) {
            // update children
            cmtInfo.rc.forEach(function (child_dtalkid) {
                window.setTimeout(function () {
                    var state;
                    switch (tracking) {
                    case "on":
                        state = "parent";
                        break;
                    case "off":
                        state = "off";
                        break;
                    case "parent":
                        state = "parent";
                        break;
                    default:
                        alert("Unknown tracking state " + tracking);
                        break;
                    }
                    ESN.updateThreadIcons(child_dtalkid, state);
                }, 300);
            });
        }

        // update icon
        var uri;
        switch (tracking) {
            case "on":
                uri = "/btn_tracking.gif?v=17312";
                break;
            case "off":
                uri = "/btn_track.gif?v=17312";
                break;
            case "parent":
                uri = "/btn_tracking_thread.gif?v=17312";
                break;
            default:
                alert("Unknown tracking state " + tracking);
                break;
        }

        btn.src = Site.imgprefix + uri;
    };

    jQuery(function($)
    {
        ESN.initCheckAllBtns();
        ESN.initTrackBtns();

        $('#settings_form').on('click', 'a.delete-group', function(e) {

            var match = this.search.match(/delete_group=([-\d]+)/),
                group = match ? match[1] : null;

            e.preventDefault();

            if (!group) {
                return;
            }

            $.post(location.href, {
                delete_group: group
            });

            $(this).closest('tr').remove();
        });
    });
}(DOM.getElement, ESN));
;

/* file-end: js/esn.js 
----------------------------------------------------------------------------------*/
/* ---------------------------------------------------------------------------------
   file-start: js/jquery/jquery.lj.confirmbubble.js 
*/

LJ.UI.registerTemplate('templates-Widgets-popupcontent', "<div class=\"b-popup-content {{if $data.options_centered}}b-popup-options-centered{{/if}}\"> {{if $data.show_header}} <div class=\"b-popup-content-header\"> <span> {{html $data.header_text}} </span> </div> {{/if}} {{html $data.confirm_text}} {{if $data.show_check}} <div class=\"b-popup-content-inner\"> <input id=\"b-popup-check\" type=\"checkbox\" class=\"b-popup-check\"> <label for=\"b-popup-check\" class=\"b-popup-check-text\"> {{html $data.check_text}} </label> </div> {{/if}} <div class=\"b-popup-submit-options\"> <span class=\"b-popup-preloader\"> <span class=\"b-popup-preloader-inner\"> <button class=\"b-popup-btn\" type=\"button\">{{html $data.yes_text}}</button> <i class=\"preloader\"></i> </span> <a href=\"javascript: void(0);\" class=\"b-popup-cancel\">{{html $data.no_text}}</a> </span> </div> </div> ", 'JQuery.stat');
!function(a){a.widget("lj.confirmbubble",a.lj.basicWidget,{options:{selectors:{ok:".b-popup-btn",cancel:".b-popup-cancel",check:".b-popup-check"},templates:{content:"templates-Widgets-popupcontent"},confirm:jQuery.noop,confirmText:"",yesText:"",noText:"",checkText:"",headerText:"",showCheck:!1,showHeader:!1},_create:function(){a.lj.basicWidget.prototype._create.apply(this),this._content=this._tmpl("content",{confirm_text:this.options.confirmText,yes_text:this.options.confirmYes||LJ.ml("confirm.bubble.yes"),no_text:this.options.confirmNo||LJ.ml("confirm.bubble.no"),show_check:this.options.showCheck,show_header:this.options.showHeader,header_text:this.options.headerText,check_text:this.options.checkText}),this._bindControls(),this._content.bubble({showOn:"click",target:this.element}),this.options.showCheck&&this._content.find(this._s("ok")).attr("disabled",!0),Function.defer(this._content.bubble.bind(this._content,"show"))},_bindControls:function(){var b=this,c=this._content,d=c.find(this._s("ok")),e=this.options;a.lj.basicWidget.prototype._bindControls.apply(this),c.on("click",this._s("ok"),function(){c.bubble("hide"),e.confirm()}).on("change",this._s("check"),function(){a(this).attr("checked")?d.removeAttr("disabled"):d.attr("disabled",!0)}).on("click",this._s("cancel"),function(){c.bubble("hide")}).on("bubblehide",function(){b._trigger("hide")}).on("bubbleshow",function(){b._trigger("show")})},show:function(){this._content.bubble("show")},hide:function(){this._content.bubble("hide")}})}(jQuery,this);;

/* file-end: js/jquery/jquery.lj.confirmbubble.js 
----------------------------------------------------------------------------------*/
/* ---------------------------------------------------------------------------------
   file-start: js/jquery/jquery.lj.ljcut.js 
*/

/**
 * @author Valeriy Vasin (valeriy.vasin@sup.com)
 * @name $.lj.ljcut
 * @requires $.ui.core, $.ui.widget, $.lj.basicWidget, LJ
 * @class The widget is responsible for expanding cuts
 */
;(function ($) {
	"use strict";

	$.widget('lj.ljcut', $.lj.basicWidget, {
		options: {
			// journal identifier (comes from server)
			journalid: null,
			// post identifier (comes from server)
			ditemid: null,
			// cut identifier inside of the post (comes from server)
			cutid: null,
			// server request param: use placeholders or not (1 or 0). Comes from server
			placeholders: 0,

      sticky: false,

			selectors: {
				expand: '.ljcut-link-expand',
				collapse: '.ljcut-link-collapse',

        // bottom collapse link
        collapseLink: '.ljcut-pseudolink-collapse',

        // sticky collapse link
        stickyLink: '.b-sticky-cut-link'
			},

			classNames: {
				'preloader': 'ljcut-link-expanding',
				'expanded': 'ljcut-expanded',
        'sticky-cut-visible': 'b-sticky-cut-visible',
        'cut': '.b-sticky-cut'
			}
		},

		_create: function () {
			$.lj.basicWidget.prototype._create.apply(this);

      this._window = $(window);

      this.cut = $(this._cl('cut'));

      // use current this in handler
      this._stickyCollapseHandler = this._collapse.bind(this);

			// jQuery element that will contain loaded content of the cut
			this.content = null;
			// test OS for Mac
			this._isMac = (/Mac/).test(navigator.userAgent);
			// $.browser.opera is deprecated
			this._isOpera = (/Opera/.test(navigator.userAgent));

      // create collapse node that will be cloned and appended into each ljcut
      this._collapseNode = $('<span class="ljcut-pseudolink"><span class="ljcut-decor"><span class="ljcut-pseudolink-collapse">{close}</span></span></span>'.supplant({close: this._ml('collapse')}));

			this._bindControls();
		},

		_bindControls: function () {
			$.lj.basicWidget.prototype._bindControls.apply(this);
			this.element.on('click', this._s('expand'), this._expand.bind(this));
			this.element.on('click', this._s('collapse'), this._collapse.bind(this));
			$(document).on('keydown', this._shortcuts.bind(this));
      this._window.on('scroll', this._scrolling.bind(this));
		},

		/**
		 * Shortcuts handler
		 * @param  {Object} e jQuery event object
		 */
		_shortcuts: function (e) {
			var ctrl = (this._isMac && this._isOpera) ? e.metaKey : e.ctrlKey,
				alt = e.altKey;

			if (!ctrl || !alt) {
				return;
			}

			switch (e.which) {
				// expand: ctrl + alt + "+"
				case 61: // FireFox, IE
					// fall through
				case 187: // Opera, Chrome, Safari
					this.expand();
					break;

				// collapse: ctrl + alt + "-"
				case 173: // FireFox
					// fall through
				case 31: // Opera Mac
					// fall through
				case 109: // Opera Windows
					// fall through
				case 189: // Chrome, Safari
					this.collapse();
					break;

				// no default
			}
			e.preventDefault();
		},

		/**
		 * Show or hide preloader
		 * @param  {Boolean} state Preloader state: True (show) or False (hide)
		 */
		_togglePreloader: function (state) {
			this.element.toggleClass( this._cl('preloader'), state );
		},

		/**
		 * Toggle content state
		 * @param  {Boolean} state State of content: expand (true) or collapse (false)
		 */
		_toggleContent: function (state, callback) {
			var that = this,
          _top;

			if (this.locked() || !this.content) {
				return;
			}

			this._lock();

			if (typeof callback !== 'function') {
				callback = $.noop;
			}

			this.element.toggleClass( that._cl('expanded'), state );

			if (state) {
        this._showContent(callback);
      } else {
        _top = this.element.offset().top - 30;

        if ( !this.element.is(':screenable') ) {
            $('body').animate({ scrollTop: _top }, 300, function () {
                //delay before collapsing to let user know what is happening
                setTimeout(that._hideContent.bind(that, callback), 50);
            });
        } else {
          this._hideContent(callback);
        }

      }

		},

    /**
		 * Show content state
     */
    _showContent: function (callback) {
        var that = this;

        this.content.slideDown('fast', function () {
            that._trigger('show', null, that);
            callback();
            that._unlock();
        });
    },

    /**
		 * Hide content state
     */
    _hideContent: function (callback) {
        var that = this;

        this.content.slideUp(50, function () {
            that._trigger('hide', null, that);
            callback();
            that._unlock();
        });
    },

		/**
		 * Request server for the cut content
		 * @param  {Object} data Data that is needed for request
		 */
		_requestContent: function (data) {
			var that = this;

			this._lock();
			this._togglePreloader(true);
			LJ.Api.call('event.get_lj_cut', data, function (response) {
				that.content = $('<div />', { html: response.text }).hide();
				that.element.after( that.content );
				that._unlock();
				that._togglePreloader(false);

				// add handlers after content becomes visible
				that._toggleContent(true, that._addHandlers.bind(that));

				// statistic
				if (response.counter_image_url) {
					LJ.Stat.addCounter(response.counter_image_url);
				}
			});
		},

		/**
		 * Provide dynamic behavior for the content (javascript handlers)
		 * @private
		 */
		_addHandlers: function () {
			this.content.ljLikes();
			LJ.Event.trigger('social:widgets:parse');
		},

		/**
		 * Expand content
		 */
		expand: function () {
			if ( this.locked() ) {
				return;
			}
			if ( this.content ) {
				this._toggleContent(true);
			} else {
				this._requestContent({
					journalid: this.options.journalid,
					ditemid: this.options.ditemid,
					cutid: this.options.cutid,
					placeholders: this.options.placeholders
				});
			}
		},

		/**
		 * Collapse content (for external usage)
		 */
		collapse: function () {
			if ( !this.locked() ) {
				this._toggleContent(false);
        this._toggleStickyClass(false);
			}
		},

		/**
		 * Expand link click handler
		 * @param  {Object} e jQuery event object
		 */
		_expand: function (e) {
			// open link in new tab
			if (e.metaKey || e.ctrlKey) {
				return true;
			}

			e.preventDefault();
			this.expand();
		},

		/**
		 * Collapse link click handler
		 * @param  {Object} e jQuery event object
		 */
		_collapse: function (e) {
			// open link in new tab
			if (e.metaKey || e.ctrlKey) {
				return true;
			}

			e.preventDefault();
			this.collapse();
		},

    /**
     * Handler for scrolling event
     */
    _scrolling: function () {
        this._updateStickyCutState();
    },

    /**
     * Check if a sticky cut element is needed to be displayed on the screen and show/hide it
     *
     */
    _updateStickyCutState: function () {
        var viewportHeight,
            viewportTop,
            contentHeight,
            contentTop,
            contentBottom,
            state,
            collapse;

        if ( this._isExpanded() && this.options.sticky && this.content ) {
          viewportHeight = this._window.height();
          viewportTop = $(document).scrollTop();
          contentHeight = this.content.height();
          contentTop = this.content.offset().top;
          contentBottom = contentTop + contentHeight;
          collapse = this.element.find( this._s('collapse') );
          state = contentTop < viewportTop && contentBottom - viewportHeight > viewportTop;

          this._toggleStickyClass(state);
        }
    },

    /**
     * Toggle class of the sticky cut
     *
     * @param {Boolean} state  if `true` - show sticky, cut. Otherwise: hide
     */
    _toggleStickyClass: function (state) {
        this.cut.toggleClass( this._cl('sticky-cut-visible'), state );

        if (state) {
          $(document).on('click', this._s('stickyLink'), this._stickyCollapseHandler);
        } else {
          $(document).off('click', this._s('stickyLink'), this._stickyCollapseHandler);
        }
    },

    /**
     * Extend lj-cut functionality with bottom collapse link and it's handlers
     */
    _addBottomCollapser: function () {
        if ( !this._bottomCloser && this.options.sticky) {
            this._bottomCloser = this._collapseNode.appendTo(this.content);

            this._bottomCloser
                .find( this._s('collapseLink') )
                .on('click', this._bottomCloserClickHandler.bind(this));
        }

        return this._bottomCloser;
    },

    _bottomCloserClickHandler: function () {
        event.preventDefault();
        this.collapse();
    },

    _isExpanded: function () {
        return this.element.hasClass( this._cl('expanded') );
    },

    _isCollapsed: function () {
        return !this._isExpanded();
    }
});
}(jQuery));
;

/* file-end: js/jquery/jquery.lj.ljcut.js 
----------------------------------------------------------------------------------*/
/* ---------------------------------------------------------------------------------
   file-start: js/fb-select-image.js 
*/

jQuery(function(){function a(a,b){jQuery("<div>"+b+"</div>").find("img").each(function(){a.push(this.src)})}function b(){n.close()}var c=$("repost_facebook"),d=$("repost_facebook_thumbnail"),e=$("select-fb-thumbnail"),f=$("select-fb-thumbnail-comments"),g=$("userpic_preview_image"),h=$("fbimg_select_window"),i=$("fbimg_select_window_nav"),j=e||f,k="nothumb",l="userpic";if(null!=j){var m={};m=e?{getText:function(){return window.switchedRteOn?CKEDITOR.instances.draft.getData():jQuery("#draft").val()},getUserPic:function(){return g?g.src:""}}:{getText:function(){var a=$("commenttext")||$("body");return a.value},getUserPic:function(){var a=jQuery("#userpics > [name=prop_picture_keyword]");if(0==a.length&&(a=jQuery("#prop_picture_keyword")),0==a.length)return"";var b=a.val();return b in userpicmap?userpicmap[b]:defaultpicurl||""}};var n={init:function(){this.opened=!1,this.page=1,this.totalImages=1,this.pager={prev:jQuery(i).children(".i-repost-nav-prev"),next:jQuery(i).children(".i-repost-nav-next"),counter:jQuery(i).children(".i-repost-nav-counter")},this.listWrapper=jQuery(h).children(".b-repost-pics-wrapper"),this.list=this.listWrapper.children(".b-repost-pics-items"),this.pagerSize=4,this.pagesNum=1,this.cellWidth=0,this.pager.prev.click(function(){n.changePage(-1)}),this.pager.next.click(function(){n.changePage(1)}),this.firstLi=this.list.children("span:first").click(function(){n.setPicture(k)})},setPicture:function(a){d.value=a,this.close()},updatePager:function(){i.style.display=this.totalImages<this.pagerSize?"none":"block",this.pager.prev[1==this.page?"addClass":"removeClass"]("i-repost-nav-prev-dis"),this.pager.next[this.page==this.pagesNum?"addClass":"removeClass"]("i-repost-nav-next-dis"),this.pager.counter.html(this.page+"/"+this.pagesNum)},makeListItem:function(a,b,c){var d=c?"b-repost-pics-active":"";return jQuery("<span>").addClass(d).append(jQuery("<img>").attr("src",a)).click(function(){n.setPicture(b)})},open:function(a){this.list.children("span:gt(0)").remove(),this.totalImages=a.length,this.page=1,0!=a.length&&-1!=jQuery.inArray(d.value,a)||d.value==l||d.value==k||(d.value="");var b=m.getUserPic();if(b.length>0){var c=b;this.makeListItem(c,l,l==d.value).appendTo(this.list),this.totalImages++}this.pagesNum=Math.ceil((this.totalImages+1)/this.pagerSize),this.totalImages>1&&""==d.value&&(d.value=a[0]);for(var e=1,f=0;f<a.length;++f)a[f]==d.value&&(e=Math.floor((f+1+(b.length>0?1:0))/this.pagerSize)+1),this.makeListItem(a[f],a[f],a[f]==d.value).appendTo(this.list);this.firstLi[this.totalImages<=1&&""==d.value||d.value==k?"addClass":"removeClass"]("b-repost-pics-active"),h.style.display="block",this.opened=!0,this.firstLi.each(function(){n.cellWidth=this.offsetWidth+this.offsetLeft});var g=this.pagerSize>this.totalImages?this.cellWidth*(this.totalImages+1)+"px":"";this.listWrapper.css("width",g),this.changePage(e-1)},changePage:function(a){this.page+=a,this.page=this.page<1?1:this.page>this.pagesNum?this.pagesNum:this.page;var b=-this.cellWidth*(this.page-1)*this.pagerSize;this.list.css("left",b+"px"),this.updatePager()},close:function(){h.style.display="none",this.opened=!1}};n.init(),h.onmousedown=function(a){a=a||window.event,a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},j.onmousedown=function(a){a=a||window.event,n.opened&&(a.stopPropagation?a.stopPropagation():a.cancelBubble=!0)},j.onclick=function(d){d=d||window.event;var e=[];(null===c.getAttribute("disabled")||c.getAttribute("disabled")===!1)&&(n.opened?b():(e.length=0,a(e,m.getText()),n.open(e),setTimeout(function(){DOM.addEventListener(document,"mousedown",b,!1)},0))),d.preventDefault?d.preventDefault():d.returnValue=!1}}});;

/* file-end: js/fb-select-image.js 
----------------------------------------------------------------------------------*/
/* ---------------------------------------------------------------------------------
   file-start: js/quickreply.js 
*/

QuickReply = {
	lastDiv: 'qrdiv',
	
	reply: function(dtid, pid, newsubject)
	{
		var targetname = 'ljqrt' + dtid,
			targetcomment = 'ljcmt' + dtid,
			qr_ptid = $('parenttalkid'),
			qr_rto = $('replyto'),
			qr_dtid = $('dtid'),
			qr_div = $('qrdiv'),
			cur_div = $(targetname),
			qr_form_div = $('qrformdiv'),
			qr_form = $('qrform'),
			subject = $('subject');
		
		// Is this a dumb browser?
		if (!qr_ptid || !qr_rto || !qr_dtid || !qr_div || !cur_div || !qr_form || !qr_form_div || !subject) {
			return true;
		}
		
		qr_ptid.value = pid;
		qr_dtid.value = dtid;
		qr_rto.value = pid;
		
		if (QuickReply.lastDiv == 'qrdiv') {
			qr_div.style.display = 'inline';
			// Only one swap
		} else if (QuickReply.lastDiv != dtid) {
		}

		var comments = $('comments'),
			targetcomment = $(targetcomment);

		//LJSUP-11059: when we show old style entry page, comment form should be placed under comment with
		//shift according to its depth.
		if (!comments || comments.className.indexOf('entry-comments-s1') === -1 || !targetcomment) {
			cur_div.parentNode.insertBefore(qr_div, cur_div);
		} else {
			targetcomment.appendChild(qr_div);
		}
		
		QuickReply.lastDiv = targetname;
		
		if (!subject.value || subject.value == subject.defaultValue || subject.value.substr(0, 4) == 'Re: ') {
			subject.value = newsubject;
			subject.defaultValue = newsubject;
		}
		
		qr_form_div.className = cur_div.className || '';
		
		// have to set a timeout because most browsers won't let you focus
		// on an element that's still in the process of being created.
		// so lame.
		window.setTimeout(function(){ qr_form.body.focus() }, 100);
		
		return false;
	},
	
	more: function()
	{
		var qr_form = $('qrform'),
			basepath = $('basepath'),
			dtid = $('dtid'),
			pidform = $('parenttalkid');
		
		// do not do the default form action (post comment) if something is broke
		if (!qr_form || !basepath || !dtid || !pidform) {
			return false;
		}
		
		if(dtid.value > 0 && pidform.value > 0) {
			//a reply to a comment
			qr_form.action = basepath.value + "replyto=" + dtid.value + "#add_comment";
		} else {
			qr_form.action = basepath.value + "mode=reply#add_comment";
		}
		
		// we changed the form action so submit ourselves
		// and don't use the default form action
		qr_form.submit();
		return false;
	},
	
	submit: function()
	{
		var submitmore = $('submitmoreopts'),
			submit = $('submitpost');
		
		if (!submitmore || !submit) {
			return false;
		}
		
		submit.disabled = true;
		submitmore.disabled = true;
		
		// New top-level comments
		var dtid = $('dtid');
		if (!Number(dtid.value)) {
			dtid.value =+ 0;
		}
		
		var qr_form = $('qrform');
		qr_form.action = Site.siteroot + '/talkpost_do.bml';
		qr_form.submit();
		
		// don't do default form action
		return false;
	},
	
	check: function()
	{
		var qr_form = $('qrform');
		if (!qr_form) return true;
		var len = qr_form.body.value.length;
		if (len > 4300) {
			alert('Sorry, but your comment of ' + len + ' characters exceeds the maximum character length of 4300. Please try shortening it and then post again.');
			return false;
		}
		return true;
	},
	
	// Maintain entry through browser navigations.
	save: function()
	{
		var qr_form = $('qrform');
		if (!qr_form) {
			return false;
		}
		var do_spellcheck = $('do_spellcheck'),
			qr_upic = $('prop_picture_keyword');
		
		$('saved_body').value = qr_form.body.value;
		$('saved_subject').value = $('subject').value;
		$('saved_dtid').value = $('dtid').value;
		$('saved_ptid').value = $('parenttalkid').value;
		
		if (do_spellcheck) {
			$('saved_spell').value = do_spellcheck.checked;
		}
		if (qr_upic) { // if it was in the form
			$('saved_upic').value = qr_upic.selectedIndex;
		}
		
		return false;
	},
	
	// Restore saved_entry text across platforms.
	restore: function()
	{
		setTimeout(function(){
			var saved_body = $('saved_body'),
				dtid = $('saved_dtid'),
				subject = $('saved_subject'),
				subject_str = '',
				qr_form = $('qrform');
			if (!saved_body || saved_body.value == '' || !qr_form || !dtid) {
				return;
			}
			
			if (subject) {
				subject_str = subject.value;
			}
			
			QuickReply.reply(dtid.value, parseInt($('saved_ptid').value, 10), subject_str);
			
			qr_form.body.value = saved_body.value;
			
			// if it was in the form
			var upic = $('prop_picture_keyword');
			if (upic) {
				upic.selectedIndex = $('saved_upic').value;
			}
			
			var spellcheck = $('do_spellcheck');
			if (spellcheck) {
				spellcheck.checked = $('saved_spell').value == 'true';
			}
		}, 100);
	},
	
	userpicSelect: function()
	{
		var ups = new UserpicSelect();
		ups.init();
		ups.setPicSelectedCallback(function(picid, keywords)
		{
			var kws_dropdown = $('prop_picture_keyword');
			
			if (kws_dropdown) {
				var items = kws_dropdown.options;
				
				// select the keyword in the dropdown
				keywords.forEach(function(kw)
				{
					for (var i = 0; i < items.length; i++) {
						var item = items[i];
						if (item.value == kw) {
							kws_dropdown.selectedIndex = i;
							return;
						}
					}
				});
			}
		});
		ups.show();
	}
}

jQuery(QuickReply.restore);
DOM.addEventListener(window, 'unload', QuickReply.save);
;

/* file-end: js/quickreply.js 
----------------------------------------------------------------------------------*/
/* ---------------------------------------------------------------------------------
   file-start: js/md5.js 
*/

/*
 *  md5.jvs 1.0b 27/06/96
 *
 * Javascript implementation of the RSA Data Security, Inc. MD5
 * Message-Digest Algorithm.
 *
 * Copyright (c) 1996 Henri Torgemane. All Rights Reserved.
 *
 * Permission to use, copy, modify, and distribute this software
 * and its documentation for any purposes and without
 * fee is hereby granted provided that this copyright notice
 * appears in all copies. 
 *
 * Of course, this soft is provided "as is" without express or implied
 * warranty of any kind.
 */



function array(n) {
  for(i=0;i<n;i++) this[i]=0;
  this.length=n;
}

/* Some basic logical functions had to be rewritten because of a bug in
 * Javascript.. Just try to compute 0xffffffff >> 4 with it..
 * Of course, these functions are slower than the original would be, but
 * at least, they work!
 */

function integer(n) { return n%(0xffffffff+1); }

function shr(a,b) {
  a=integer(a);
  b=integer(b);
  if (a-0x80000000>=0) {
    a=a%0x80000000;
    a>>=b;
    a+=0x40000000>>(b-1);
  } else
    a>>=b;
  return a;
}

function shl1(a) {
  a=a%0x80000000;
  if (a&0x40000000==0x40000000)
  {
    a-=0x40000000;  
    a*=2;
    a+=0x80000000;
  } else
    a*=2;
  return a;
}

function shl(a,b) {
  a=integer(a);
  b=integer(b);
  for (var i=0;i<b;i++) a=shl1(a);
  return a;
}

function and(a,b) {
  a=integer(a);
  b=integer(b);
  var t1=(a-0x80000000);
  var t2=(b-0x80000000);
  if (t1>=0) 
    if (t2>=0) 
      return ((t1&t2)+0x80000000);
    else
      return (t1&b);
  else
    if (t2>=0)
      return (a&t2);
    else
      return (a&b);  
}

function or(a,b) {
  a=integer(a);
  b=integer(b);
  var t1=(a-0x80000000);
  var t2=(b-0x80000000);
  if (t1>=0) 
    if (t2>=0) 
      return ((t1|t2)+0x80000000);
    else
      return ((t1|b)+0x80000000);
  else
    if (t2>=0)
      return ((a|t2)+0x80000000);
    else
      return (a|b);  
}

function xor(a,b) {
  a=integer(a);
  b=integer(b);
  var t1=(a-0x80000000);
  var t2=(b-0x80000000);
  if (t1>=0) 
    if (t2>=0) 
      return (t1^t2);
    else
      return ((t1^b)+0x80000000);
  else
    if (t2>=0)
      return ((a^t2)+0x80000000);
    else
      return (a^b);  
}

function not(a) {
  a=integer(a);
  return (0xffffffff-a);
}

/* Here begin the real algorithm */

    var state = new array(4); 
    var count = new array(2);
	count[0] = 0;
	count[1] = 0;                     
    var buffer = new array(64); 
    var transformBuffer = new array(16); 
    var digestBits = new array(16);

    var S11 = 7;
    var S12 = 12;
    var S13 = 17;
    var S14 = 22;
    var S21 = 5;
    var S22 = 9;
    var S23 = 14;
    var S24 = 20;
    var S31 = 4;
    var S32 = 11;
    var S33 = 16;
    var S34 = 23;
    var S41 = 6;
    var S42 = 10;
    var S43 = 15;
    var S44 = 21;

    function F(x,y,z) {
	return or(and(x,y),and(not(x),z));
    }

    function G(x,y,z) {
	return or(and(x,z),and(y,not(z)));
    }

    function H(x,y,z) {
	return xor(xor(x,y),z);
    }

    function I(x,y,z) {
	return xor(y ,or(x , not(z)));
    }

    function rotateLeft(a,n) {
	return or(shl(a, n),(shr(a,(32 - n))));
    }

    function FF(a,b,c,d,x,s,ac) {
        a = a+F(b, c, d) + x + ac;
	a = rotateLeft(a, s);
	a = a+b;
	return a;
    }

    function GG(a,b,c,d,x,s,ac) {
	a = a+G(b, c, d) +x + ac;
	a = rotateLeft(a, s);
	a = a+b;
	return a;
    }

    function HH(a,b,c,d,x,s,ac) {
	a = a+H(b, c, d) + x + ac;
	a = rotateLeft(a, s);
	a = a+b;
	return a;
    }

    function II(a,b,c,d,x,s,ac) {
	a = a+I(b, c, d) + x + ac;
	a = rotateLeft(a, s);
	a = a+b;
	return a;
    }

    function transform(buf,offset) { 
	var a=0, b=0, c=0, d=0; 
	var x = transformBuffer;
	
	a = state[0];
	b = state[1];
	c = state[2];
	d = state[3];
	
	for (i = 0; i < 16; i++) {
	    x[i] = and(buf[i*4+offset],0xff);
	    for (j = 1; j < 4; j++) {
		x[i]+=shl(and(buf[i*4+j+offset] ,0xff), j * 8);
	    }
	}

	/* Round 1 */
	a = FF ( a, b, c, d, x[ 0], S11, 0xd76aa478); /* 1 */
	d = FF ( d, a, b, c, x[ 1], S12, 0xe8c7b756); /* 2 */
	c = FF ( c, d, a, b, x[ 2], S13, 0x242070db); /* 3 */
	b = FF ( b, c, d, a, x[ 3], S14, 0xc1bdceee); /* 4 */
	a = FF ( a, b, c, d, x[ 4], S11, 0xf57c0faf); /* 5 */
	d = FF ( d, a, b, c, x[ 5], S12, 0x4787c62a); /* 6 */
	c = FF ( c, d, a, b, x[ 6], S13, 0xa8304613); /* 7 */
	b = FF ( b, c, d, a, x[ 7], S14, 0xfd469501); /* 8 */
	a = FF ( a, b, c, d, x[ 8], S11, 0x698098d8); /* 9 */
	d = FF ( d, a, b, c, x[ 9], S12, 0x8b44f7af); /* 10 */
	c = FF ( c, d, a, b, x[10], S13, 0xffff5bb1); /* 11 */
	b = FF ( b, c, d, a, x[11], S14, 0x895cd7be); /* 12 */
	a = FF ( a, b, c, d, x[12], S11, 0x6b901122); /* 13 */
	d = FF ( d, a, b, c, x[13], S12, 0xfd987193); /* 14 */
	c = FF ( c, d, a, b, x[14], S13, 0xa679438e); /* 15 */
	b = FF ( b, c, d, a, x[15], S14, 0x49b40821); /* 16 */

	/* Round 2 */
	a = GG ( a, b, c, d, x[ 1], S21, 0xf61e2562); /* 17 */
	d = GG ( d, a, b, c, x[ 6], S22, 0xc040b340); /* 18 */
	c = GG ( c, d, a, b, x[11], S23, 0x265e5a51); /* 19 */
	b = GG ( b, c, d, a, x[ 0], S24, 0xe9b6c7aa); /* 20 */
	a = GG ( a, b, c, d, x[ 5], S21, 0xd62f105d); /* 21 */
	d = GG ( d, a, b, c, x[10], S22,  0x2441453); /* 22 */
	c = GG ( c, d, a, b, x[15], S23, 0xd8a1e681); /* 23 */
	b = GG ( b, c, d, a, x[ 4], S24, 0xe7d3fbc8); /* 24 */
	a = GG ( a, b, c, d, x[ 9], S21, 0x21e1cde6); /* 25 */
	d = GG ( d, a, b, c, x[14], S22, 0xc33707d6); /* 26 */
	c = GG ( c, d, a, b, x[ 3], S23, 0xf4d50d87); /* 27 */
	b = GG ( b, c, d, a, x[ 8], S24, 0x455a14ed); /* 28 */
	a = GG ( a, b, c, d, x[13], S21, 0xa9e3e905); /* 29 */
	d = GG ( d, a, b, c, x[ 2], S22, 0xfcefa3f8); /* 30 */
	c = GG ( c, d, a, b, x[ 7], S23, 0x676f02d9); /* 31 */
	b = GG ( b, c, d, a, x[12], S24, 0x8d2a4c8a); /* 32 */

	/* Round 3 */
	a = HH ( a, b, c, d, x[ 5], S31, 0xfffa3942); /* 33 */
	d = HH ( d, a, b, c, x[ 8], S32, 0x8771f681); /* 34 */
	c = HH ( c, d, a, b, x[11], S33, 0x6d9d6122); /* 35 */
	b = HH ( b, c, d, a, x[14], S34, 0xfde5380c); /* 36 */
	a = HH ( a, b, c, d, x[ 1], S31, 0xa4beea44); /* 37 */
	d = HH ( d, a, b, c, x[ 4], S32, 0x4bdecfa9); /* 38 */
	c = HH ( c, d, a, b, x[ 7], S33, 0xf6bb4b60); /* 39 */
	b = HH ( b, c, d, a, x[10], S34, 0xbebfbc70); /* 40 */
	a = HH ( a, b, c, d, x[13], S31, 0x289b7ec6); /* 41 */
	d = HH ( d, a, b, c, x[ 0], S32, 0xeaa127fa); /* 42 */
	c = HH ( c, d, a, b, x[ 3], S33, 0xd4ef3085); /* 43 */
	b = HH ( b, c, d, a, x[ 6], S34,  0x4881d05); /* 44 */
	a = HH ( a, b, c, d, x[ 9], S31, 0xd9d4d039); /* 45 */
	d = HH ( d, a, b, c, x[12], S32, 0xe6db99e5); /* 46 */
	c = HH ( c, d, a, b, x[15], S33, 0x1fa27cf8); /* 47 */
	b = HH ( b, c, d, a, x[ 2], S34, 0xc4ac5665); /* 48 */

	/* Round 4 */
	a = II ( a, b, c, d, x[ 0], S41, 0xf4292244); /* 49 */
	d = II ( d, a, b, c, x[ 7], S42, 0x432aff97); /* 50 */
	c = II ( c, d, a, b, x[14], S43, 0xab9423a7); /* 51 */
	b = II ( b, c, d, a, x[ 5], S44, 0xfc93a039); /* 52 */
	a = II ( a, b, c, d, x[12], S41, 0x655b59c3); /* 53 */
	d = II ( d, a, b, c, x[ 3], S42, 0x8f0ccc92); /* 54 */
	c = II ( c, d, a, b, x[10], S43, 0xffeff47d); /* 55 */
	b = II ( b, c, d, a, x[ 1], S44, 0x85845dd1); /* 56 */
	a = II ( a, b, c, d, x[ 8], S41, 0x6fa87e4f); /* 57 */
	d = II ( d, a, b, c, x[15], S42, 0xfe2ce6e0); /* 58 */
	c = II ( c, d, a, b, x[ 6], S43, 0xa3014314); /* 59 */
	b = II ( b, c, d, a, x[13], S44, 0x4e0811a1); /* 60 */
	a = II ( a, b, c, d, x[ 4], S41, 0xf7537e82); /* 61 */
	d = II ( d, a, b, c, x[11], S42, 0xbd3af235); /* 62 */
	c = II ( c, d, a, b, x[ 2], S43, 0x2ad7d2bb); /* 63 */
	b = II ( b, c, d, a, x[ 9], S44, 0xeb86d391); /* 64 */

	state[0] +=a;
	state[1] +=b;
	state[2] +=c;
	state[3] +=d;

    }

    function init() {
	count[0]=count[1] = 0;
	state[0] = 0x67452301;
	state[1] = 0xefcdab89;
	state[2] = 0x98badcfe;
	state[3] = 0x10325476;
	for (i = 0; i < digestBits.length; i++)
	    digestBits[i] = 0;
    }

    function update(b) { 
	var index,i;
	
	index = and(shr(count[0],3) , 0x3f);
	if (count[0]<0xffffffff-7) 
	  count[0] += 8;
        else {
	  count[1]++;
	  count[0]-=0xffffffff+1;
          count[0]+=8;
        }
	buffer[index] = and(b,0xff);
	if (index  >= 63) {
	    transform(buffer, 0);
	}
    }

    function finish() {
	var bits = new array(8);
	var	padding; 
	var	i=0, index=0, padLen=0;

	for (i = 0; i < 4; i++) {
	    bits[i] = and(shr(count[0],(i * 8)), 0xff);
	}
        for (i = 0; i < 4; i++) {
	    bits[i+4]=and(shr(count[1],(i * 8)), 0xff);
	}
	index = and(shr(count[0], 3) ,0x3f);
	padLen = (index < 56) ? (56 - index) : (120 - index);
	padding = new array(64); 
	padding[0] = 0x80;
        for (i=0;i<padLen;i++)
	  update(padding[i]);
        for (i=0;i<8;i++) 
	  update(bits[i]);

	for (i = 0; i < 4; i++) {
	    for (j = 0; j < 4; j++) {
		digestBits[i*4+j] = and(shr(state[i], (j * 8)) , 0xff);
	    }
	} 
    }

/* End of the MD5 algorithm */

function hexa(n) {
 var hexa_h = "0123456789abcdef";
 var hexa_c=""; 
 var hexa_m=n;
 for (hexa_i=0;hexa_i<8;hexa_i++) {
   hexa_c=hexa_h.charAt(Math.abs(hexa_m)%16)+hexa_c;
   hexa_m=Math.floor(hexa_m/16);
 }
 return hexa_c;
}


var ascii="01234567890123456789012345678901" +
          " !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ"+
          "[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~";

function MD5(entree) 
{
 var l,s,k,ka,kb,kc,kd;

 init();
 for (k=0;k<entree.length;k++) {
   l=entree.charAt(k);
   update(ascii.lastIndexOf(l));
 }
 finish();
 ka=kb=kc=kd=0;
 for (i=0;i<4;i++) ka+=shl(digestBits[15-i], (i*8));
 for (i=4;i<8;i++) kb+=shl(digestBits[15-i], ((i-4)*8));
 for (i=8;i<12;i++) kc+=shl(digestBits[15-i], ((i-8)*8));
 for (i=12;i<16;i++) kd+=shl(digestBits[15-i], ((i-12)*8));
 s=hexa(kd)+hexa(kc)+hexa(kb)+hexa(ka);
 return s; 
}

/* This implement the MD5 test suite */
var testOk=false;
function teste() {
 if (testOk) return;
 document.test.o1.value=MD5(document.test.i1.value);
 document.test.o2.value=MD5(document.test.i2.value);
 document.test.o3.value=MD5(document.test.i3.value);
 document.test.o4.value=MD5(document.test.i4.value);
 document.test.o5.value=MD5(document.test.i5.value);
 document.test.o6.value=MD5(document.test.i6.value);
 document.test.o7.value=MD5(document.test.i7.value);
 testOk=true;
}
;

/* file-end: js/md5.js 
----------------------------------------------------------------------------------*/
/* ---------------------------------------------------------------------------------
   file-start: js/thread_expander.js 
*/

Expander = function(){
    this.__caller__;    // <a> HTML element from where Expander was called
    this.url;           // full url of thread to be expanded
    this.id;            // id of the thread
    this.stored_caller;
    this.iframe;        // iframe, where the thread will be loaded
    this.is_S1;         // bool flag, true == journal is in S1, false == in S2
}
Expander.Collection={};
Expander.make = function(el,url,id,is_S1){
    var local = (new Expander).set({__caller__:el,url:url.replace(/#.*$/,''),id:id,is_S1:!!is_S1});
    local.get();
}

Expander.prototype.set = function(options){
    for(var opt in options){
        this[opt] = options[opt];
    }
    return this;
}

Expander.prototype.getCanvas = function(id,context){
    return context.document.getElementById('ljcmt'+id);
}

Expander.prototype.parseLJ_cmtinfo = function(context,callback){
    var map={}, node, j;
    var LJ = context.LJ_cmtinfo;
    if(!LJ)return false;
    for(j in LJ){
        if(/^\d*$/.test(j) && (node = this.getCanvas(j,context))){
            map[j] = {info:LJ[j],canvas:node};
            if(typeof callback == 'function'){
                callback(j,map[j]);
            }
        }
    }
    return map;
}

Expander.prototype.loadingStateOn = function(){
    this.stored_caller = this.__caller__.cloneNode(true);
    this.__caller__.setAttribute('already_clicked','already_clicked');
    this.__caller__.onclick = function(){return false}
    this.__caller__.style.color = '#ccc';
}

Expander.prototype.loadingStateOff = function(){
    if(this.__caller__){
        // actually, the <a> element is removed from main window by
        // copying comment from ifame, so this code is not executed (?)
        this.__caller__.removeAttribute('already_clicked','already_clicked');
        if(this.__caller__.parentNode) this.__caller__.parentNode.replaceChild(this.stored_caller,this.__caller__);
    }
    var obj = this;
    // When frame is removed immediately, IE raises an error sometimes
    window.setTimeout(function(){obj.killFrame()},100);
}

Expander.prototype.killFrame = function(){
    document.body.removeChild(this.iframe);
}

Expander.prototype.isFullComment = function(comment){
    return !!Number(comment.info.full);
}

Expander.prototype.killDuplicate = function(comments){
    var comment;
    var id,id_,el,el_;
    for(var j in comments){
        if(!/^\d*$/.test(j))continue;
        el_ = comments[j].canvas;
        id_ = el_.id;
        id = id_.replace(/_$/,'');
        el = document.getElementById(id);
        if(el!=null){
            //in case we have a duplicate;
            el_.parentNode.removeChild(el_);
        }else{
            el_.id = id;
            window.ContextualPopup && ContextualPopup.searchAndAdd(el_);
            window.setupAjax && setupAjax(el_);
            window.ESN && ESN.initTrackBtns(el_);
        }
    }
}

Expander.prototype.getS1width = function(canvas){
  //TODO:  may be we should should add somie ID to the spacer img instead of searching it
  //yet, this works until we have not changed the spacers url = 'dot.gif?v=557');
  var img, imgs;
  imgs = canvas.getElementsByTagName('img');
  for(var j=0;j<imgs.length;j++){
    img=imgs[j];
    if(/dot\.gif$/.test(img.src)){
        if (img.width) { return Number(img.width); }
        break;
    }
  }
  return false;
}

Expander.prototype.setS1width = function(canvas,w){
  var img, imgs;
  imgs = canvas.getElementsByTagName('img');
  for(var j=0;j<imgs.length;j++){
    img=imgs[j];
    if(/dot\.gif$/.test(img.src)){
        img.setAttribute('width',w);
        break;
    }
  }
}

Expander.prototype.onLoadHandler = function(iframe){
        var doc = iframe.contentDocument || iframe.contentWindow;
        doc = doc.document||doc;
        var obj = this;
        var win = doc.defaultView||doc.parentWindow;
        var comments_intersection={};
        var comments_page = this.parseLJ_cmtinfo(window);
        var comments_iframe = this.parseLJ_cmtinfo(win,function(id,new_comment){
                                    if(id in comments_page){
                                        comments_page[id].canvas.id = comments_page[id].canvas.id+'_';
                                        comments_intersection[id] = comments_page[id];
                                        // copy comment from iframe to main window if
                                        // 1) the comment is collapsed in main window and is full in iframe
                                        // 2) or this is the root comment of this thread (it may be full in
                                        //     main window too, it's copied so that to remove "expand" link from it)
                                        if((!obj.isFullComment(comments_page[id]) && obj.isFullComment(new_comment)) || (id===obj.id)){
                                            var w;
                                            if(obj.is_S1){
                                                w =obj.getS1width(comments_page[id].canvas);
                                            }
                                            comments_page[id].canvas.innerHTML = new_comment.canvas.innerHTML;
                                            if(obj.is_S1 && w!==false){
                                                    obj.setS1width(comments_page[id].canvas,w);
                                            }
                                            //TODO: may be this should be uncommented
                                            //comments_page[id].canvas.className = new_comment.canvas.className;
                                            LJ_cmtinfo[id].full=1;
                                            LJ_cmtinfo[id].expanded=1;
                                        }
                                    }//if(id in comments_page){
                                });
       this.killDuplicate(comments_intersection);
       this.loadingStateOff();
       return true;
}


//just for debugging
Expander.prototype.toString = function(){
    return '__'+this.id+'__';
}


Expander.prototype.get = function(){
    if(this.__caller__.getAttribute('already_clicked')){
        return false;
    }
    this.loadingStateOn();

    var iframe;
    if(/*@cc_on !@*/0){
        // branch for IE
        Expander.Collection[this.id] = this;
        iframe = document.createElement('<iframe onload="Expander.Collection['+this.id+'].onLoadHandler(this)">');
    }else{
        // branch for all other browsers
        iframe = document.createElement('iframe');
        iframe.onload = function(obj){return function(){
                            obj.onLoadHandler(iframe);
                        }}(this);
    }
    iframe.style.height='1px';
    iframe.style.width='1px';
    iframe.style.display = 'none';
    iframe.src = this.url;
    iframe.id = this.id;
    document.body.appendChild(iframe);
    this.iframe=iframe;
    return true;
};
;

/* file-end: js/thread_expander.js 
----------------------------------------------------------------------------------*/
/* ---------------------------------------------------------------------------------
   file-start: js/thread_expander.ex.js 
*/

/*
 * ExpanderEx object is used in s1 style comment pages and provides
 * ajax functionality to expand comments instead of loading iframe page as it is
 * in old Expander
 * expander object is also used in commentmanage.js
 */
ExpanderEx = function(){
    this.__caller__;    // <a> HTML element from where ExpanderEx was called
    this.url;           // full url of thread to be expanded
    this.id;            // id of the thread
    this.stored_caller;
    this.is_S1;         // bool flag, true == journal is in S1, false == in S2
}
ExpanderEx.Collection={};
ExpanderEx.ReqCache = {};

ExpanderEx.make = function(ev,el,url,id,is_S1){
    var local = (new ExpanderEx).set({__caller__:el,url:url.replace(/#.*$/,''),id:id,is_S1:!!is_S1});
    local.get();
    jQuery.event.fix(ev).preventDefault();
}

ExpanderEx.collapse = function(ev,el,url,id,is_S1){
    var local = (new ExpanderEx).set({__caller__:el,url:url.replace(/#.*$/,''),id:id,is_S1:!!is_S1});
    local.collapseThread();
    jQuery.event.fix(ev).preventDefault();
}

ExpanderEx.prototype.set = function(options){
    for(var opt in options){
        this[opt] = options[opt];
    }
    return this;
}

ExpanderEx.prototype.getCanvas = function(id,context){
    return context.document.getElementById('ljcmt'+id);
}

ExpanderEx.prototype.parseLJ_cmtinfo = function(context,callback){
    var map={}, node, j;
    var LJ = context.LJ_cmtinfo;
    if(!LJ)return false;
    for(j in LJ){
        if(/^\d*$/.test(j) && (node = this.getCanvas(j,context))){
            map[j] = {info:LJ[j],canvas:node};
            if(typeof callback == 'function'){
                callback(j,map[j]);
            }
        }
    }
    return map;
}

ExpanderEx.preloadImg = function(){
    (new Image()).src = Site.imgprefix + '/preloader-s.gif?v=9673';
}

ExpanderEx.prototype.addPreloader = function(){
    this.loader = new Image();
    this.loader.src = Site.imgprefix + '/preloader-s.gif?v=9673';
    this.loader.className = 'i-exp-preloader';
    this.__caller__.parentNode.appendChild( this.loader );
}

ExpanderEx.prototype.removePreloader = function(){
    if( !this.loader ){
        return;
    }

    if( this.loader.parentNode ){
        this.loader.parentNode.removeChild( this.loader );
    }
    delete this.loader;
};

ExpanderEx.prototype.loadingStateOn = function(){
    // turn on preloader there
    this.addPreloader();
    this.stored_caller = this.__caller__.cloneNode(true);
    this.__caller__.setAttribute('already_clicked','already_clicked');
    this.__caller__.onclick = function(){return false}
    this.__caller__.style.color = '#ccc';
}

ExpanderEx.prototype.loadingStateOff = function(){
    if(this.__caller__){
        // actually, the <a> element is removed from main window by
        // copying comment from ifame, so this code is not executed (?)
        this.__caller__.removeAttribute('already_clicked','already_clicked');
        if(this.__caller__.parentNode) this.__caller__.parentNode.replaceChild(this.stored_caller,this.__caller__);
        //remove preloader if exist
        this.removePreloader();
    }
    var obj = this;
    // When frame is removed immediately, IE raises an error sometimes
}

ExpanderEx.prototype.killFrame = function(){
    document.body.removeChild(this.iframe);
}

ExpanderEx.prototype.isFullComment = function( comment ) {
    return !!Number(comment.info.full);
}

ExpanderEx.prototype.expandThread = function( json ) {
    this.loadingStateOff();

    //we show expand link if comment block has collapsed children
    function isChildCollapsed( idx )
    {
        var state;
        for( var i = idx + 1; i < json.length; ++i ) {
            state = json[ i ].state;
            if( state === "expanded" ) { return false; }
            if( state === "collapsed" ) { return true; }
        }

        return  false;
    }

    var threadId, cell, html;
    for( var i = 0; i < json.length; ++i ) {
        //we skip comment blocks thate were not expanded
        if( json[ i ].state === 'deleted' ) {
            LJ_cmtinfo[ json[ i ].thread ].is_deleted = true;
        }
		if( !( json[ i ].thread in LJ_cmtinfo ) ) {
			continue;
		}
        if( json[ i ].state && json[ i ].state !== "expanded") {
            continue;
        }

        threadId = json[ i ].thread;
        html = ExpanderEx.prepareCommentBlock( jQuery( json[ i ].html ), threadId, isChildCollapsed( i ) );

        var oldHtml = LiveJournal.CommentManager.updateCell( threadId, html );
        if( !( threadId in ExpanderEx.Collection ) ) {
            ExpanderEx.Collection[ threadId ] = oldHtml;
        }
    }

    //duplicate cycle, because we do not know, that external scripts do with node
    for( var i = 0; i < json.length; ++i ) {
        threadId = json[ i ].thread;
        LJ_cmtinfo[ threadId ].parent = this.id;
        if( json[ i ].state && json[ i ].state === "expanded") {
            this.initCommentBlock( jQuery( '#ljcmt' + threadId )[0] , threadId );
        }
    }

    return true;
}

ExpanderEx.prototype.collapseThread = function( id ){
    var threadId = id || this.id;
    this.collapseBlock( threadId );

    var children = LJ_cmtinfo[ threadId ].rc;
    for( var i = 0; i < children.length; ++i )
        this.collapseThread( children[ i ] );
}

ExpanderEx.prototype.collapseBlock =  function( id )
{
	if( id in ExpanderEx.Collection ) {
		LiveJournal.CommentManager.updateCell( id, ExpanderEx.Collection[ id ] );

		this.initCommentBlock( LiveJournal.CommentManager.getCell( id )[0], id, true );
		delete ExpanderEx.Collection[ id ];
	}
}

ExpanderEx.prototype.initCommentBlock = function( el_, id, restoreInitState )
{
    if( !restoreInitState ){
        LJ_cmtinfo[ id ].oldvars = {
            full: LJ_cmtinfo[ id ].full || 0,
            expanded: LJ_cmtinfo[ id ].expanded || 0
        }
        LJ_cmtinfo[ id ].full = 1;
        LJ_cmtinfo[ id ].expanded = 1;
    }
    else {
        LJ_cmtinfo[ id ].full = LJ_cmtinfo[ id ].oldvars.full;
        LJ_cmtinfo[ id ].expanded = LJ_cmtinfo[ id ].oldvars.expanded;
        delete LJ_cmtinfo[ id ].oldvars;
    }
    window.ContextualPopup && ContextualPopup.searchAndAdd(el_);
    //window.setupAjax && setupAjax(el_, true);
    window.ESN && ESN.initTrackBtns(el_);
}


//just for debugging
ExpanderEx.prototype.toString = function(){
    return '__'+this.id+'__';
}


ExpanderEx.prototype.get = function(){
    if(this.__caller__.getAttribute('already_clicked')){
        return false;
    }
    this.loadingStateOn();

    var obj = this;
    //set timeout to allow browser to display image before request
    setTimeout( function(){
        LiveJournal.CommentManager.getThreadJSON( obj.id, function(result) {
            obj.expandThread(result);
            ExpanderEx.ReqCache[ obj.id ] = result;
        }, false, false, true );
    }, 0 );

    return true;
}

//toggle visibility of expand and collapse links, if server returns
//html with both of them ( with every ajax request)
ExpanderEx.prepareCommentBlock = function(html, id, showExpand){
    this.showExpandLink( id, html, showExpand );
    return html;
}

ExpanderEx.showExpandLink = function ( id, block, showExpand ) {
    var expandSel = "#expand_" + id,
        collapseSel = "#collapse_" + id,
        selector, resetSelector;

    if( LJ_cmtinfo[ id ].has_link > 0 ) {
        if( showExpand ) {
            selector = collapseSel;
            resetSelector = expandSel;
        } else {
            selector = expandSel;
            resetSelector = collapseSel;
        }
        block.find( resetSelector ).css( 'display', '' );
    }
    else {
        selector = collapseSel + "," + expandSel;
    }

    block.find( selector )
        .css( 'display', 'none' );
}

ExpanderEx.preloadImg();
;

/* file-end: js/thread_expander.ex.js 
----------------------------------------------------------------------------------*/
/* ---------------------------------------------------------------------------------
   file-start: js/commentmanage.js 
*/

// called by S2:
function setStyle (did, attr, val) {
    if (! document.getElementById) return;
    var de = document.getElementById(did);
    if (! de) return;
    if (de.style)
        de.style[attr] = val
}

// called by S2:
function setInner (did, val) {
    if (! document.getElementById) return;
    var de = document.getElementById(did);
    if (! de) return;
    de.innerHTML = val;
}

// called by S2:
function hideElement (did) {
    if (! document.getElementById) return;
    var de = document.getElementById(did);
    if (! de) return;
    de.style.display = 'none';
}

// called by S2:
function setAttr (did, attr, classname) {
    if (! document.getElementById) return;
    var de = document.getElementById(did);
    if (! de) return;
    de.setAttribute(attr, classname);
}

// called from Page:
function multiformSubmit (form, txt) {
    var sel_val = form.mode.value;
    if (!sel_val) {
        alert(txt.no_action);
        return false;
    }

    if (sel_val.substring(0, 4) == 'all:') { // mass action
        return;
    }

    var i = -1, has_selected = false; // at least one checkbox
    while (form[++i]) {
        if (form[i].name.substring(0, 9) == 'selected_' && form[i].checked) {
            has_selected = true;
            break;
        }
    }
    if (!has_selected) {
        alert(txt.no_comments);
        return false;
    }

    if (sel_val == 'delete' || sel_val == 'deletespam') {
        return confirm(txt.conf_delete);
    }
}

function getLocalizedStr( key, username ) {
    return LJ.ml( key, { username: username } );
}

// hsv to rgb
// h, s, v = [0, 1), [0, 1], [0, 1]
// r, g, b = [0, 255], [0, 255], [0, 255]
function hsv_to_rgb (h, s, v)
{
    if (s == 0) {
	v *= 255;
	return [v,v,v];
    }

    h *= 6;
    var i = Math.floor(h);
    var f = h - i;
    var p = v * (1 - s);
    var q = v * (1 - s * f);
    var t = v * (1 - s * (1 - f));

    v = Math.floor(v * 255 + 0.5);
    t = Math.floor(t * 255 + 0.5);
    p = Math.floor(p * 255 + 0.5);
    q = Math.floor(q * 255 + 0.5);

    if (i == 0) return [v,t,p];
    if (i == 1) return [q,v,p];
    if (i == 2) return [p,v,t];
    if (i == 3) return [p,q,v];
    if (i == 4) return [t,p,v];
    return [v,p,q];
}

function deleteComment (ditemid, action) {
	action = action || 'delete';

	var curJournal = (Site.currentJournal !== "") ? (Site.currentJournal) : (LJ_cmtinfo.journal);

    var form = $('ljdelopts' + ditemid),
        todel = $('ljcmt' + ditemid),
        opt_delthread, opt_delauthor, is_deleted, is_error,
        pulse = 0,
		url = LiveJournal.getAjaxUrl('delcomment')+'?mode=js&journal=' + curJournal + '&id=' + ditemid;

	var postdata = 'confirm=1';
    if (form && action == 'delete') {
    	if (form.ban && form.ban.checked) {
			postdata += '&ban=1';
		}
    	if (form.spam && form.spam.checked) {
			postdata += '&spam=1';
		}
    	if (form.delthread && form.delthread.checked) {
			postdata += '&delthread=1';
			opt_delthread = true;
		}
    	if (form.delauthor && form.delauthor.checked) {
        	postdata += '&delauthor=1';
        	opt_delauthor = true;
    	}
    } else if (action == 'markAsSpam') {
		opt_delauthor = opt_delthread = true;
		postdata += '&ban=1&spam=1&delauthor=1';
	}

    postdata += '&lj_form_auth=' + decodeURIComponent(LJ_cmtinfo.form_auth);

    var opts = {
        url: url,
        data: postdata,
        method: 'POST',
        onData: function(data) {
            is_deleted = !!data;
            is_error = !is_deleted;
        },
        onError: function() {
          alert('Error deleting ' + ditemid);
          is_error = true;
        }
    };

	HTTPReq.getJSON(opts);


    var flash = function () {
        var rgb = hsv_to_rgb(0, Math.cos((pulse + 1) / 2), 1);
        pulse += 3.14159 / 5;
        var color = "rgb(" + rgb[0] + "," + rgb[1] + "," + rgb[2] + ")";

        todel.style.border = "2px solid " + color;
        if (is_error) {
            todel.style.border = "";
            // and let timer expire
        } else if (is_deleted) {
			removeComment(ditemid, opt_delthread);
            if (opt_delauthor && LJ_cmtinfo[ditemid].u !== '') {
                for (var item in LJ_cmtinfo) {
					if ( LJ_cmtinfo[item].u == LJ_cmtinfo[ditemid].u
						&& !LJ_cmtinfo[ item ].is_deleted) {
						removeComment(item, false);
                    }
                }
            }
        } else {
            window.setTimeout(flash, 50);
        }
    };

    window.setTimeout(flash, 5);
}

function removeComment (ditemid, killChildren) {
	if( LiveJournal.CommentManager.getState() !== 'iframe'){
		var threadId = ditemid;

		LiveJournal.CommentManager.getThreadJSON(threadId, function(result) {
			LiveJournal.CommentManager.processThreadJSON( result, function( dtid, html, comment) {
				if (LJ_cmtinfo[ threadId ].u !== LJ_cmtinfo[ dtid ].u) {
					return;
				}

				html = ExpanderEx.prepareCommentBlock( html, dtid ); //, isChildCollapsed( i ) );
				LiveJournal.CommentManager.updateCell( dtid, html );
				if( comment.is_deleted && ( dtid in ExpanderEx.Collection ) ) {
					delete ExpanderEx.Collection[ dtid ];
				}
			} );
		}, true );
	}
	else {
		var todel = document.getElementById("ljcmt" + ditemid);
		if (todel) {
			todel.style.display = 'none';

			var userhook = window["userhook_delete_comment_ARG"];
			if (userhook)
				userhook(ditemid);
		}
	}
	if (killChildren) {
		var com = LJ_cmtinfo[ditemid];
		for (var i = 0; i < com.rc.length; i++) {
			removeComment(com.rc[i], true);
		}
	}
}

function createDeleteFunction(ae, dItemid, action) {
	action = action || 'delete';

    return function (e) {
		e = jQuery.event.fix(e || window.event);

		e.stopPropagation();
		e.preventDefault();

        var doIT = 0;
        // immediately delete on shift key
        if (e.shiftKey) {
			doIT = 1;
			deleteComment(dItemid, action);
			return true;
		}

		if (!LJ_cmtinfo) {
			return true;
		}

        var com = LJ_cmtinfo[dItemid],
			comUser = LJ_cmtinfo[dItemid].u,
			remoteUser = LJ_cmtinfo.remote;
        if (!com || !remoteUser) {
			return true;
		}
        var canAdmin = LJ_cmtinfo.canAdmin;

		var markSpamMLPrefix = (Site.remote_is_maintainer == 1 && com.u !== '') ? 'comment.mark.spam.' : 'comment.mark.spam2.';

		if (action == 'markAsSpam') {
			if (!window.ctrlPopup) {
				window.ctrlPopup = jQuery('<div class="b-popup-ctrlcomm" />')
					.delegate('input.spam-comment-button', 'click', function () {
						window.ctrlPopup.bubble('hide');
					});
			}

			window.ctrlPopup
				.html('<div class="b-popup-group"><div class="b-popup-row b-popup-row-head"><strong>' + getLocalizedStr(markSpamMLPrefix + 'title', comUser) + '</strong></div><div class="b-popup-row">' + getLocalizedStr(markSpamMLPrefix + 'subject', comUser) + '</div><div class="b-popup-row"><input type="button" class="spam-comment-button" onclick="deleteComment(' + dItemid + ', \'' + action + '\');" value="' + getLocalizedStr(markSpamMLPrefix + 'button', comUser) + '"></div><div>', ae, e, 'spamComment' + dItemid)
				.bubble()
				.bubble('show', ae);

			return true;
		} else if (action == 'delete') {
			var inHTML = [ "<form id='ljdelopts" + dItemid + "'><div class='b-popup-group'><div class='b-popup-row b-popup-row-head'><strong>" + getLocalizedStr( 'comment.delete.q', comUser ) + "</strong></div>" ];
			var lbl;
			if (com.username !== "" && com.username != remoteUser && canAdmin) {
				lbl = "ljpopdel" + dItemid + "ban";
				inHTML.push("<div class='b-popup-row'><input type='checkbox' name='ban' id='" + lbl + "'> <label for='" + lbl + "'>" + getLocalizedStr( 'comment.ban.user', comUser ) + "</label></div>");
			}

			if (com.rc && com.rc.length && canAdmin) {
				lbl = "ljpopdel" + dItemid + "thread";
				inHTML.push("<div class='b-popup-row'><input type='checkbox' name='delthread' id='" + lbl + "'> <label for='" + lbl + "'>" + getLocalizedStr( 'comment.delete.all.sub', comUser ) + "</label></div>");
			}
			if (canAdmin&&com.username) {
				lbl = "ljpopdel" + dItemid + "author";
				inHTML.push("<div class='b-popup-row'><input type='checkbox' name='delauthor' id='" + lbl + "'> <label for='" + lbl + "'>" +
						(com.username == remoteUser ? getLocalizedStr( 'comment.delete.all.my') :
						getLocalizedStr( 'comment.delete.all', "<b>" + comUser + "</b>" )) + "</label></div>");
			}

			inHTML.push("<div class='b-popup-row'><input class='delete-comment-button' type='button' value='" + getLocalizedStr( 'comment.delete', comUser ) + "' onclick='deleteComment(" + dItemid + ");' /></div></div><div class='b-bubble b-bubble-alert b-bubble-noarrow'><i class='i-bubble-arrow-border'></i><i class='i-bubble-arrow'></i>" + getLocalizedStr( 'comment.delete.no.options', comUser ) + "</div></form>");

			if (!window.delPopup) {
				window.delPopup = jQuery('<div class="b-popup-delcomm" />')
					.delegate('input.delete-comment-button', 'click', function () {
						window.delPopup.bubble('hide');
					});
			}

			window.delPopup
				.html(inHTML.join(' '))
				.bubble()
				.bubble('show', ae);

		} else if (action == 'unspam') {
			deleteComment(dItemid, action);
		}
	};
}

function poofAt (pos) {
    var de = document.createElement("div");
    de.style.position = "absolute";
    de.style.background = "#FFF";
    de.style.overflow = "hidden";
    var opp = 1.0;

    var top = pos.y;
    var left = pos.x;
    var width = 5;
    var height = 5;
    document.body.appendChild(de);

    var fade = function () {
        opp -= 0.15;
        width += 10;
        height += 10;
        top -= 5;
        left -= 5;

        if (opp <= 0.1) {
            de.parentNode.removeChild(de);
        } else {
            de.style.left = left + "px";
            de.style.top = top + "px";
            de.style.height = height + "px";
            de.style.width = width + "px";
            de.style.filter = "alpha(opacity=" + Math.floor(opp * 100) + ")";
            de.style.opacity = opp;
            window.setTimeout(fade, 20);
        }
    };
    fade();
}

function updateLink (ae, resObj, clickTarget) {
    ae.href = resObj.newurl;
    var userhook = window["userhook_" + resObj.mode + "_comment_ARG"];
    var did_something = 0;

    if (clickTarget && clickTarget.src && clickTarget.src == resObj.oldimage) {
        clickTarget.src = resObj.newimage;
        did_something = 1;
    }

    if (userhook) {
        userhook(resObj.id);
        did_something = 1;
    }

    // if all else fails, at least remove the link so they're not as confused
    if (! did_something) {
        if (ae && ae.style)
            ae.style.display = 'none';
        if (clickTarget && clickTarget.style)
            clickTarget.style.dispay = 'none';
    }

}

var tsInProg = {}  // dict of { ditemid => 1 }
function createModerationFunction(control, dItemid, action) {
	var action = action || 'screen',
		comUser = LJ_cmtinfo[dItemid].u;

	return function (e) {
		var	e = jQuery.event.fix(e || window.event),
			pos = { x: e.pageX, y: e.pageY },
			modeParam = LiveJournal.parseGetArgs(location.href).mode,
			hourglass;

		e.stopPropagation();
		e.preventDefault();

		sendModerateRequest();

		function sendModerateRequest() {
			var	bmlName = (action == 'unspam') ? 'spamcomment' : 'talkscreen',
				postUrl = control.href.replace(new RegExp('.+' + bmlName + '\.bml'), LiveJournal.getAjaxUrl(bmlName)),
				postParams = { 'confirm': 'Y', lj_form_auth: decodeURIComponent(LJ_cmtinfo.form_auth) };

			if (action == 'unspam') {
				postUrl += '&jsmode=1';
			}

			hourglass = jQuery(e).hourglass()[0];

			jQuery.post(postUrl, postParams, function (json) {
				tsInProg[dItemid] = 0;

				if (action == 'unspam') {
					json = jQuery.parseJSON(json);

					if (json.result) {
						removeEmptyMarkup(dItemid);
						hourglass.hide();
						return true;
					} else {
						alert(json.errormsg);
					}
				}

				if( LiveJournal.CommentManager.getState() !== 'iframe' ) {
					handleNew();
				} else {
					var ids = checkRcForNoCommentsPage();
					handleIframe(ids);
				}
			});
		}

		function handleNew() {
			var newNode, showExpand, j, children,
				threadId = dItemid,
				threadExpanded = !!(LJ_cmtinfo[ threadId ].oldvars && LJ_cmtinfo[ threadId ].full),
				populateComments = function (result) {
					LiveJournal.CommentManager.processThreadJSON( result, function( dtid, html ) {
						if( LJ_cmtinfo[ dtid ].full ){
							showExpand = !( 'oldvars' in LJ_cmtinfo[ dtid ]);

							//still show expand button if children comments are folded
							if( !showExpand ) {
								children  = LJ_cmtinfo[ dtid ].rc;

								for( j = 0; j < children.length;  ++j ) {
									if( !LJ_cmtinfo[ children[j] ].full && !LJ_cmtinfo[ children[j] ].is_deleted ) {
									// if( !( 'oldvars' in LJ_cmtinfo[ children[j] ] ) ) {
										showExpand = true;
									}
								}
							}

							if (!html) {
								removeEmptyMarkup(result[i].thread);
							}

							var newNode = ExpanderEx.prepareCommentBlock( html, dtid, showExpand );

							LiveJournal.CommentManager.updateCell( dtid, newNode );
						}
					} );
					hourglass.hide();
					poofAt(pos);
				};

			LiveJournal.CommentManager.getThreadJSON(threadId, function (result) {
				//if comment is expanded we need to fetch it's collapsed state additionally
				if( threadExpanded && LJ_cmtinfo[ threadId ].oldvars.full )
				{
					LiveJournal.CommentManager.getThreadJSON( threadId, function (result2) {
						ExpanderEx.Collection[ threadId ] = ExpanderEx.prepareCommentBlock( jQuery( "<div>" + result2[0].html + "</div>" ), threadId, true ).html()
						//ExpanderEx.Collection[ threadId ] = result2[0].html;
						populateComments( result );
					}, true, true );
				}
				else {
					populateComments( result );
				}
			}, false, !threadExpanded);
		}

		function handleIframe(ids) {
			// modified jQuery.fn.load
			jQuery.ajax({
				url: location.href,
				type: 'GET',
				dataType: 'html',
				complete: function (res, status) {
					// If successful, inject the HTML into all the matched elements
					if (status == 'success' || status == 'notmodified') {
						// Create a dummy div to hold the results
						var nodes = jQuery('<div/>')
							// inject the contents of the document in, removing the scripts
							// to avoid any 'Permission Denied' errors in IE
							.append(res.responseText.replace(/<script(.|\s)*?\/script>/gi, ''))
							// Locate the specified elements
							.find(ids)
							.each(function () {
								var id = this.id.replace(/[^0-9]/g, '');
								if (LJ_cmtinfo[id].expanded) {
									var expand = this.innerHTML.match(/Expander\.make\(.+?\)/)[0];
									(function(){
										eval(expand);
									}).apply(document.createElement('a'));
								} else {
									jQuery('#' + this.id).replaceWith(this);
								}
							});
						hourglass.hide();
						poofAt(pos);
					}
				}
			});
		}

		function checkRcForNoCommentsPage() {
			var commsArray = [ dItemid ], ids;

			// check rc for no comments page
			if (LJ_cmtinfo[dItemid].rc) {
				if (/mode=(un)?freeze/.test(control.href)) {
					mapComms(dItemid);
				}
				ids = '#ljcmt' + commsArray.join(',#ljcmt');
			} else {
				var rpcRes;
				eval(json);
				updateLink(control, rpcRes, control.getElementsByTagName('img')[0]);
				// /tools/recent_comments.bml
				if (document.getElementById('ljcmtbar'+dItemid)) {
					ids = '#ljcmtbar' + dItemid;
				}
				// ex.: portal/
				else {
					hourglass.hide();
					poofAt(pos);
					return;
				}
			}


			function mapComms(id) {
				var i = -1, newId;

				while (newId = LJ_cmtinfo[id].rc[++i]) {
					if (LJ_cmtinfo[newId].full) {
						commsArray.push(newId);
						mapComms(String(newId));
					}
				}
			}

			return ids;
		}

		return false;
	}
}

function removeEmptyMarkup(threadId) {
	jQuery('#ljcmt' + threadId).remove();
}

(function( $, window ) {

	window.LiveJournal.CommentManager = function() {
		this.bindLinks();
	}

	LiveJournal.CommentManager.prototype.bindLinks = function() {
		$( 'body' ).delegate( 'a', 'click', function( ev ) {
			var rex_id = /id=(\d+)/, ae = this;

		if (ae.href.indexOf('talkscreen.bml') != -1) {
			var reMatch = rex_id.exec(ae.href);
			if (!reMatch) return;

			var id = reMatch[1];
			if (!document.getElementById('ljcmt' + id)) return;

			createModerationFunction(ae, id)( ev );
		} else if (ae.href.indexOf('delcomment.bml') != -1) {
			if (LJ_cmtinfo && LJ_cmtinfo.disableInlineDelete) return;

			var reMatch = rex_id.exec(ae.href);
			if (!reMatch) return;

			var id = reMatch[1];
			if (!document.getElementById('ljcmt' + id)) return;

			var action = (ae.href.indexOf('spam=1') != -1) ? 'markAsSpam' : 'delete';

			createDeleteFunction(ae, id, action)( ev );
		// unspam
		} else if (ae.href.indexOf('spamcomment.bml') != -1) {
			var reMatch = rex_id.exec(ae.href);
			if (!reMatch) return;

			var id = reMatch[1];
			if (!document.getElementById('ljcmt' + id)) return;
			createModerationFunction(ae, id, 'unspam')( ev );
		} else {
			return;
		}

			ev.preventDefault();
			ev.stopPropagation();
		} );
	}

	var manager = window.LiveJournal.CommentManager;

	window.LiveJournal.CommentManager.getState = function() {
		if( LJ_cmtinfo.use_old_thread_expander ) {
			return "iframe";
		} else {
			return "old";
		}
	}

	/**
	 * @param {Number} threadId Id of thread to update
	 * @param {Node} node Collection of nodes with new content
	 *
	 * @return {String} Returns a string containing old content of the cell;
	 */
	LiveJournal.CommentManager.updateCell = function( threadId, node ) {
		var cell = $( "#ljcmt" + threadId ),
			old_html = $( '<div></div>' ). append( cell.clone() );

		cell.replaceWith( $( node ).filter( "#ljcmt" + threadId ) );

		return old_html.html();
	}

	LiveJournal.CommentManager.getCell = function( threadId ) {
		return $( "#ljcmt" + threadId );
	}

	LiveJournal.CommentManager.getThreadJSON = function(threadId, success, getSingle)
	{
		var postid = location.href.match(/\/(\d+).html/)[1],
			modeParam = LiveJournal.parseGetArgs(location.href).mode,
			params = {
				journal: Site.currentJournal,
				itemid: postid,
				thread: threadId,
				depth: LJ_cmtinfo[ threadId ].depth
			};

		if( getSingle) {
			params.single = '1';
		}

		if (modeParam) {
			params.mode = modeParam;
		}

		var getArgs = LiveJournal.parseGetArgs( location.href );
		if( getArgs && !!getArgs.style && getArgs.style === "mine" ) {
			params.style = "mine";
		}

		var endpoint = LiveJournal.getAjaxUrl( 'get_thread' );
		jQuery.get( LiveJournal.constructUrl( endpoint, params ), success, 'json' );
	}

	LiveJournal.CommentManager.processThreadJSON = function( result, callback ) {
		var comment, dom;
		for( var i = 0; i < result.length; ++i ){
			if( !( result[ i ].thread in LJ_cmtinfo ) ) {
				continue;
			}

			comment = {};
			comment.is_deleted = ( result[i].state === "deleted" );
			if( comment.is_deleted ) {
				LJ_cmtinfo[ result[i].thread ].is_deleted = true;
			}
			dom = $( result[i].html ).filter( "#ljcmt" + result[i].thread );
			callback( result[i].thread, dom, comment );
		}
	}

	$( function() { new LiveJournal.CommentManager(); } );

}( jQuery, window ))

function LJ_Mul( a, b ) { return parseInt(a, 10) * parseInt(b, 10) }

function LJ_JoinURL( url /* parts */ ) {
	var add = [].slice.call( arguments, 1 ).join( '&' );

	url += ( url.indexOf( '?' ) > -1 ) ? '&' : '?';
	return url + add;
}

function LJ_Concat( /* parts */ ) {
	return [].slice.call( arguments, 0 ).join( '' );
}
;

/* file-end: js/commentmanage.js 
----------------------------------------------------------------------------------*/
/* ---------------------------------------------------------------------------------
   file-start: js/jquery/jquery.lj.journalPromoStrip.js 
*/

!function(a){"use strict";a.widget("lj.journalPromoStrip",a.lj.basicWidget,{options:{selectors:{popupInfo:".journalpromo-popup-content-info",popupDelete:".journalpromo-popup-content-delete",button:"#journalpromo-popup-btn",iconClose:".b-journalpromo-actions-close",options:".b-journalpromo-header-options",promoItem:".b-journalpromo-item",iconDelete:".b-journalpromo-actions-delete",info:".journalpromo-popup-info-action",spinner:".journalpromo-popup-spinner",error:".journalpromo-popup-info-error",errorContent:".journalpromo-popup-info-error-content",ban:"#journalpromo-user-ban"},classNames:{iconInfo:".journalpromo-info-icon",iconDelete:".b-journalpromo-actions-delete",noPromo:"b-journalpromo-item-nopromotion"},template:"<dt><a href='{rules_link}'>{subject}</a> {ljuser}</dt><dd>{body}</dd>"},_create:function(){var b=this;a.lj.basicWidget.prototype._create.apply(this),this._el("spinner"),this._el("info"),this._el("button"),this._el("iconClose"),this._el("error"),b._el("promoItem"),this._el("iconDelete"),this._el("popupDelete"),this._el("errorContent"),this._el("iconDelete")[0]&&(this._deleteBubble=this._popupDelete.bubble({target:this._cl("iconDelete"),showOn:"click"})),this._el("popupInfo").bubble({target:this._cl("iconInfo"),showOn:"hover",closeControl:!1,showDelay:500}),this._bindControls()},_toggleSpinner:function(a){this._spinner.toggle(a),this._info.toggle(!a)},_toggleError:function(a,b){this._error.toggle(a),this._info.toggle(!a),b&&this._errorContent.text(b)},_updateBlock:function(a){a.object[0].object_url?this._promoItem.html(this.options.template.supplant({rules_link:a.object[0].object_url,subject:a.object[0].subject,body:a.object[0].body,ljuser:a.object[0].ljuser_display})):this._promoItem.html('<span class="b-journalpromo-item-message">'+a.object[0].body+"</span>").addClass(this._cl("noPromo"))},_closeClick:function(){var a=this;return"#__debug"===location.hash?this._debug():(a._toggleSpinner(!0),void LJ.Api.call("journalpromo.admin_cancel",{object_url:a.options.url,user:Site.currentJournal,get_slot:1,ban_user:document.getElementById("journalpromo-user-ban").checked},function(b){if(a._toggleSpinner(!1),console.dir(b),b.error&&b.error.data&&b.error.data.entry)return a._updated=b.error.data.entry[0],a._toggleError(!0,b.error.message),void console.error(b.error.message);if(!b.error&&b.entry){var c=b.entry[0];if(!c||!c.object||!c.object[0])return void console.error("Wrong data",b);a._updateBlock(c),a._iconDelete.hide()}a._deleteBubble.bubble("hide")}))},_disableClick:function(){var a=this;LJ.Api.call("journalpromo.disable_promo_announce",{journal:LJ.get("currentJournal")},function(b){b.error||a.element.slideUp("fast")})},_bindControls:function(){var b=this;a.lj.basicWidget.prototype._bindControls.apply(this),this._button.on("click",this._closeClick.bind(this)),this._iconClose.on("click",this._disableClick.bind(this)),this._deleteBubble&&this._deleteBubble.bind("bubblehide",function(){b._toggleError(!1),b._updated&&(b._updateBlock(b._updated),b._iconDelete.hide())})},_debug:function(){var a=this;a._toggleSpinner(!0),setTimeout(function(){a._toggleSpinner(!1),a._toggleError(!0,"Sample error")},1e3)}})}(jQuery,window);;

/* file-end: js/jquery/jquery.lj.journalPromoStrip.js 
----------------------------------------------------------------------------------*/
